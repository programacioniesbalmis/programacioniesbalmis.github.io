<!-- The content below will be included at the end of the <head> element. -->
<script type="text/javascript">

    // Configure Mermaid to load icon packs from Iconify

    const configureMermaidIconPacks = () => {
        window["mermaid"].registerIconPacks([
            {
                name: "logos",
                loader: () =>
                    fetch("https://unpkg.com/@iconify-json/logos@1/icons.json").then(
                        (res) => res.json()
                    ),
            },
        ]);
    };

    if (document.readyState !== 'loading') {
        configureMermaidIconPacks();
    } else {
        document.addEventListener("DOMContentLoaded", () => {
            configureMermaidIconPacks();
        });
    }

    // Copy to clipboard functionality for code blocks

    document.addEventListener('DOMContentLoaded', function () {
        initCopyButtons();
    });

    function initCopyButtons() {
        const codeBlocks = document.querySelectorAll('pre[data-role="codeBlock"]');

        codeBlocks.forEach(function (codeBlock) {
            const wrapper = document.createElement('div');
            wrapper.className = 'code-block-wrapper';
            codeBlock.parentNode.insertBefore(wrapper, codeBlock);
            wrapper.appendChild(codeBlock);

            const copyButton = document.createElement('button');
            copyButton.className = 'copy-button';
            copyButton.textContent = 'Copy';
            copyButton.setAttribute('aria-label', 'Copy code to clipboard');

            copyButton.addEventListener('click', function () {
                copyCodeToClipboard(codeBlock, copyButton);
            });

            wrapper.appendChild(copyButton);
        });
    }

    function copyCodeToClipboard(codeBlock, button) {
        const codeText = extractCodeText(codeBlock);
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(codeText)
                .then(function () {
                    showCopySuccess(button);
                })
                .catch(function (err) {
                    console.error('Failed to copy text: ', err);
                    fallbackCopyToClipboard(codeText, button);
                });
        } else {
            fallbackCopyToClipboard(codeText, button);
        }
    }

    function extractCodeText(codeBlock) {
        const clone = codeBlock.cloneNode(true);
        const text = clone.textContent || clone.innerText;
        return text.trim();
    }

    function fallbackCopyToClipboard(text, button) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.top = '0';
        textarea.style.left = '0';
        textarea.style.opacity = '0';

        document.body.appendChild(textarea);
        textarea.focus();
        textarea.select();

        try {
            const successful = document.execCommand('copy');
            if (successful) {
                showCopySuccess(button);
            } else {
                console.error('Fallback copy failed');
            }
        } catch (err) {
            console.error('Fallback copy error: ', err);
        }

        document.body.removeChild(textarea);
    }

    function showCopySuccess(button) {
        const originalText = button.textContent;

        button.textContent = 'Copied';
        button.classList.add('copied');

        setTimeout(function () {
            button.textContent = originalText;
            button.classList.remove('copied');
        }, 2000);
    }
</script>