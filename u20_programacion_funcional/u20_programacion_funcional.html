<!DOCTYPE html><html><head>
      <title>Programación 1º DAM Unidad 20</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css">
      
      
      
      
      
      <style>
      @import url(https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css);
code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}@font-face{font-family:"Material Icons";font-style:normal;font-weight:400;src:local("Material Icons"),local("MaterialIcons-Regular"),url("data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAAfIAAsAAAAADDAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAARAAAAFZW7kosY21hcAAAAYAAAADTAAACjtP6ytBnbHlmAAACVAAAAxgAAAQ4zRtvlGhlYWQAAAVsAAAALwAAADYRwZsnaGhlYQAABZwAAAAcAAAAJAeKAzxobXR4AAAFuAAAABIAAAA8OGQAAGxvY2EAAAXMAAAAIAAAACAG5AfwbWF4cAAABewAAAAfAAAAIAEfAERuYW1lAAAGDAAAAVcAAAKFkAhoC3Bvc3QAAAdkAAAAYgAAAK2vz7wkeJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2BkPsQ4gYGVgYOpk+kMAwNDP4RmfM1gxMjBwMDEwMrMgBUEpLmmMDgwVLy4xKzzX4chhrmK4QpQmBEkBwAZygyweJzFkr0NwjAQhZ+TEP6CRUfHBEwRUWaQTICyQbpMwRCskA5RUIONxG0RnnNpKAIV4qzPku/8c353ACYAYrIjCWCuMAh2ptf0/hiL3p/gyPUWa3osqlt0L1zu9r71z8dGrJRykFoauXQd932Lj5vhG+MjxGeYI8MKETObMpslf5EyP8tg+vHun5r539PvlvXzaVhRFVQDTPEWKVQR90KhnnC5Ek67vUKN4VuFasM/ldARj43CCkCsEjpJSoVVgRyU0GVSK6wUpFFCx8lFgX0BiXpRPQB4nE2TTWjcRhTH3xttpDhxN7uxPlp3u/FK7moRPixafRijNosxSw/LUsIwNcaEHPZggo/FmEKMCKWU4kNOOftQSlhE8alnH0Ix9BqWnHooPRrTQ0+mnu2bXTu2pPdGM9LM/6c3fwECTM4gBBMYQNqxzLrZAjqYSlqu2TAHZQA0/DQJH6FtzqGDnvbt4Ggwvzw/nL8EfH8kW0fsuRqhgWXZnY7M1picaUL7Du5BHeDzMIl83dAt016wH1qmvtSMo5R6YRJHTR//FXsff/nj/tc/5K9P5d+nP22+fFK5u7v3K39SW3y+OtDKO3L85vD09PD9z5X17a2N1g4tqk01RlqX7gyoEmnsWQtVr4rtZMmukEaFBZxzefkCn11cyKMLZgshRwgTYNoLNXCBz2ja7HvZG7hDpPSNfoo5vs0knK/9hb+rNpu+8kHPgk/Ao4kK3tWtTpSEtvkA9c+wE6UaUdwieNkaHg55tBEtRiEPw1s0+FtrtTcc9two2lhMknV7PZF/cs6+uUFTmpTGbEx7sQCPSLOttHS3GRltqp7SNzVSKzl6aWnZT/CX5k6/v9N3Hh8fHBwffJVjhrC6OgH5dkIt/tPsq+d/PD5Qz7G7efzq1THFjdZVPe/N6ulQ3JnDWSE5junsFsVIiFwL/htf1S5gJ3BfOcUxfHKLnzqpFpyfZ9cX+/5WB6a+Y0pHpzkNrYNVDwMsikK+y7WuLCRg/oFHkA8VT3rDg5ZnU6ktzzINymV0m74Xd5pfIGXyFeVEQSShkzqG7TBBa2OxVRKitLXv7h3uuftXnXq7lz2tZ/WnWa9dx9dCjDhHzmuVQATlmljr9dZErUydSo2Hbi/b1vXtrOeGCk2/8s3ZlO8+ueJT8BVlw5pGw2oYccdSiHHqx0RlabHqdNR9jAETl6PreJcPBnnfpTLnOQ8C3OV8AmQGzouV1iZdeb5SSIoVc8W8/kcDtksUH5FrU6/aqBqNWcMEzxG4DAQ14qRQhi9mWU0rzepKezbjfgCwQKxVYq5ajRgpRqy45CqwkJydcEkbTkvRz8P5/2ZpDTN4nGNgZGBgAOKb6v+/xvPbfGXgZmEAgeuB2kkI+v8bFgbmKiCXg4EJJAoAPyAKhQB4nGNgZGBg1vmvwxDDwgACQJKRARXwAwAzZQHQeJxjYQCCFAYGFgbSMQAcWACdAAAAAAAAAAwALgBgAIQAmADSAQgBIgE8AVABoAHeAfwCHHicY2BkYGDgZ7BgYGMAASYg5gJCBob/YD4DAA/hAWQAeJxlkbtuwkAURMc88gApQomUJoq0TdIQzEOpUDokKCNR0BuzBiO/tF6QSJcPyHflE9Klyyekz2CuG8cr7547M3d9JQO4xjccnJ57vid2cMHqxDWc40G4Tv1JuEF+Fm6ijRfhM+oz4Ra6eBVu4wZvvMFpXLIa40PYQQefwjVc4Uu4Tv1HuEH+FW7i1mkKn6Hj3Am3sHC6wm08Ou8tpSZGe1av1PKggjSxPd8zJtSGTuinyVGa6/Uu8kxZludCmzxMEzV0B6U004k25W35fj2yNlCBSWM1paujKFWZSbfat+7G2mzc7weiu34aczzFNYGBhgfLfcV6iQP3ACkSaj349AxXSN9IT0j16JepOb01doiKbNWt1ovippz6sVYYwsXgX2rGVFIkq7Pl2PNrI6qW6eOshj0xaSq9mpNEZIWs8LZUfOouNkVXxp/d5woqebeYIf4D2J1ywQB4nG3LOw6AIBAE0B384B+PAkgEa+QwNnYmHt+EpXSal5lkSBBnoP8oCFSo0aCFRIceA0ZMmLFAYSW88rmvtMUjG3RiQ9HvpfusM6zWNmtc5H/iPewha50tOt5PS/QBx2IeSwAA") format("woff")}.admonition{box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.2);position:relative;margin:1.5625em 0;padding:0 1.2rem;border-left:.4rem solid rgba(68,138,255,.8);border-radius:.2rem;background-color:rgba(255,255,255,.05);overflow:auto}.admonition>p{margin-top:.8rem}.admonition>.admonition-title{margin:0 -1.2rem;padding:.8rem 1.2rem .8rem 3.6rem;border-bottom:1px solid rgba(68,138,255,.2);background-color:rgba(68,138,255,.1);font-weight:700}.admonition>.admonition-title:before{position:absolute;left:1.2rem;font-size:1.5rem;color:rgba(68,138,255,.8);content:"\E3C9"}.admonition>.admonition-title:before{font-family:Material Icons;font-style:normal;font-variant:normal;font-weight:400;line-height:2rem;text-transform:none;white-space:nowrap;speak:none;word-wrap:normal;direction:ltr}.admonition.abstract,.admonition.summary,.admonition.tldr{border-left-color:rgba(0,176,255,.8)}.admonition.abstract>.admonition-title,.admonition.summary>.admonition-title,.admonition.tldr>.admonition-title{background-color:rgba(0,176,255,.1);border-bottom-color:rgba(0,176,255,.2)}.admonition.abstract>.admonition-title:before,.admonition.summary>.admonition-title:before,.admonition.tldr>.admonition-title:before{color:#00b0ff;content:"\E8D2"}.admonition.hint,.admonition.tip{border-left-color:rgba(0,191,165,.8)}.admonition.hint>.admonition-title,.admonition.tip>.admonition-title{background-color:rgba(0,191,165,.1);border-bottom-color:rgba(0,191,165,.2)}.admonition.hint>.admonition-title:before,.admonition.tip>.admonition-title:before{color:#00bfa5;content:"\E80E"}.admonition.info,.admonition.todo{border-left-color:rgba(0,184,212,.8)}.admonition.info>.admonition-title,.admonition.todo>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.info>.admonition-title:before,.admonition.todo>.admonition-title:before{color:#00b8d4;content:"\E88E"}.admonition.check,.admonition.done,.admonition.success{border-left-color:rgba(0,200,83,.8)}.admonition.check>.admonition-title,.admonition.done>.admonition-title,.admonition.success>.admonition-title{background-color:rgba(0,200,83,.1);border-bottom-color:rgba(0,200,83,.2)}.admonition.check>.admonition-title:before,.admonition.done>.admonition-title:before,.admonition.success>.admonition-title:before{color:#00c853;content:"\E876"}.admonition.faq,.admonition.help,.admonition.question{border-left-color:rgba(100,221,23,.8)}.admonition.faq>.admonition-title,.admonition.help>.admonition-title,.admonition.question>.admonition-title{background-color:rgba(100,221,23,.1);border-bottom-color:rgba(100,221,23,.2)}.admonition.faq>.admonition-title:before,.admonition.help>.admonition-title:before,.admonition.question>.admonition-title:before{color:#64dd17;content:"\E887"}.admonition.attention,.admonition.caution,.admonition.warning{border-left-color:rgba(255,145,0,.8)}.admonition.attention>.admonition-title,.admonition.caution>.admonition-title,.admonition.warning>.admonition-title{background-color:rgba(255,145,0,.1);border-bottom-color:rgba(255,145,0,.2)}.admonition.attention>.admonition-title:before{color:#ff9100;content:"\E417"}.admonition.caution>.admonition-title:before,.admonition.warning>.admonition-title:before{color:#ff9100;content:"\E002"}.admonition.fail,.admonition.failure,.admonition.missing{border-left-color:rgba(255,82,82,.8)}.admonition.fail>.admonition-title,.admonition.failure>.admonition-title,.admonition.missing>.admonition-title{background-color:rgba(255,82,82,.1);border-bottom-color:rgba(255,82,82,.2)}.admonition.fail>.admonition-title:before,.admonition.failure>.admonition-title:before,.admonition.missing>.admonition-title:before{color:#ff5252;content:"\E14C"}.admonition.bug,.admonition.danger,.admonition.error{border-left-color:rgba(255,23,68,.8)}.admonition.bug>.admonition-title,.admonition.danger>.admonition-title,.admonition.error>.admonition-title{background-color:rgba(255,23,68,.1);border-bottom-color:rgba(255,23,68,.2)}.admonition.danger>.admonition-title:before{color:#ff1744;content:"\E3E7"}.admonition.error>.admonition-title:before{color:#ff1744;content:"\E14C"}.admonition.bug>.admonition-title:before{color:#ff1744;content:"\E868"}.admonition.example,.admonition.snippet{border-left-color:rgba(0,184,212,.8)}.admonition.example>.admonition-title,.admonition.snippet>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.example>.admonition-title:before,.admonition.snippet>.admonition-title:before{color:#00b8d4;content:"\E242"}.admonition.cite,.admonition.quote{border-left-color:rgba(158,158,158,.8)}.admonition.cite>.admonition-title,.admonition.quote>.admonition-title{background-color:rgba(158,158,158,.1);border-bottom-color:rgba(158,158,158,.2)}.admonition.cite>.admonition-title:before,.admonition.quote>.admonition-title:before{color:#9e9e9e;content:"\E244"}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v28/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
@page a4landscape {
  size: A4 landscape;
  margin: 1cm;
}
@page a4portrait {
  size: A4 portrait;
  margin: 1cm 1cm 2.5cm 1cm;
}
.markdown-preview.markdown-preview .landscape {
  page: a4landscape;
}
.markdown-preview.markdown-preview .portrait {
  page: a4portrait;
}
.markdown-preview.markdown-preview .box_bg_lightgray {
  background-color: #f5f5f5;
  border: 2px solid #969696;
  padding: 15px;
  margin-top: 15px;
  margin-bottom: 15px;
  border-radius: 5px;
  box-shadow: 0 0 7px 0 rgba(78, 120, 158, 0.1);
}
.markdown-preview.markdown-preview .box_bg_lightgreen {
  background-color: #f5faf5;
  border: 2px solid #969b96;
  padding-left: 15px;
  padding-right: 15px;
  margin-top: 15px;
  margin-bottom: 15px;
  border-radius: 5px;
  box-shadow: 0 0 7px 0 rgba(78, 120, 158, 0.1);
}
.markdown-preview.markdown-preview .salida_consola {
  background-color: #000000;
  color: aquamarine;
  border: 3px solid slategrey;
  padding-top: 15px;
  padding-bottom: 15px;
  padding-left: 10px;
  padding-right: 10px;
  margin-top: 10px;
  margin-bottom: 10px;
  border-radius: 5px;
  box-shadow: 3px 3px 6px 0 slategrey;
  font-family: "Lucida Console", Courier, monospace;
  font-size: 0.8rem;
}
.markdown-preview.markdown-preview .contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.markdown-preview.markdown-preview .fondo {
  background: url(https://balmisdigigs.github.io/digitalizacion.github.io/imagenes/fondos/quote.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.markdown-preview.markdown-preview .cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.markdown-preview.markdown-preview .abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.markdown-preview.markdown-preview .cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.markdown-preview.markdown-preview .autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}
.markdown-preview.markdown-preview .flotante {
  display: flex;
  margin-top: 15px;
  margin-bottom: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    justify-content: center;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    justify-content: space-between;
  }
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    flex-direction: column;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    flex-direction: row;
  }
}
.markdown-preview.markdown-preview .flotante_izq {
  margin-right: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante_izq {
    width: 100%;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante_izq {
    width: auto;
  }
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante_der {
    width: 100%;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante_der {
    width: auto;
  }
}
.markdown-preview.markdown-preview .galeria_imagenes {
  display: flex;
  justify-content: space-evenly;
  align-items: center;
  margin-top: 15px;
  margin-bottom: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .galeria_imagenes {
    flex-direction: column;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .galeria_imagenes {
    flex-direction: row;
  }
}

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
    const configureMermaidIconPacks = () => {
        window["mermaid"].registerIconPacks([
            {
                name: "logos",
                loader: () =>
                    fetch("https://unpkg.com/@iconify-json/logos@1/icons.json").then(
                        (res) => res.json()
                    ),
            },
        ]);
    };

    if (document.readyState !== 'loading') {
        configureMermaidIconPacks();
    } else {
        document.addEventListener("DOMContentLoaded", () => {
            configureMermaidIconPacks();
        });
    }
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="unidad-20">Unidad 20 </h1>
<p>Descargar estos apunte en <a href="./u20_programacion_funcional.pdf">pdf</a> o <a href="./u20_programacion_funcional.html">html</a></p>
<h2 id="índice">Índice </h2>

<div class="md-toc">
<div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#índice" class="md-toc-link">
            <p>Índice</p>

          </a></div><details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#programación-funcional" class="md-toc-link"><p>Programación funcional</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#introducción" class="md-toc-link">
            <p>Introducción</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#algunas-definiciones-importantes" class="md-toc-link">
            <p>Algunas definiciones importantes</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#funcionalidades-del-lenguaje-que-vamos-a-necesitar" class="md-toc-link"><p>Funcionalidades del lenguaje que vamos a necesitar</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#tipos-delegados-en-csharp" class="md-toc-link"><p>Tipos Delegados en CSharp</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#sintaxis-y-ejemplo-de-uso-de-delegados" class="md-toc-link">
            <p>Sintaxis y ejemplo de uso de delegados</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#delegados-parametrizados-genéricos" class="md-toc-link">
            <p>Delegados Parametrizados (Genéricos)</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#tipos-anónimos-inmutables-en-csharp" class="md-toc-link">
            <p>Tipos Anónimos Inmutables en CSharp</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#cálculo-lambda" class="md-toc-link"><p>Cálculo Lambda</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#definición-de-expresión-lambda" class="md-toc-link">
            <p>Definición de Expresión Lambda</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#expresiones-lambda-en-csharp" class="md-toc-link">
            <p>Expresiones Lambda en CSharp</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#clausuras-en-csharp" class="md-toc-link"><p>Clausuras en CSharp</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#variables-externas-capturadas" class="md-toc-link">
            <p>Variables Externas Capturadas</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#patrón-map-filter-fold" class="md-toc-link"><p>Patrón Map-Filter-Fold</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#map-o-select" class="md-toc-link">
            <p>Map (o Select)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#filter-o-where" class="md-toc-link">
            <p>Filter (o Where)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#fold-o-aggregate" class="md-toc-link">
            <p>Fold (o Aggregate)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#combinando-las-tres-operaciones" class="md-toc-link">
            <p>Combinando las tres operaciones</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#otras-operaciones-funcionales-declarativas-en-c" class="md-toc-link"><p>Otras operaciones funcionales declarativas en C#</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#orderbyorderbydescending" class="md-toc-link">
            <p>OrderBy/OrderByDescending</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#distinct" class="md-toc-link">
            <p>Distinct</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#groupby" class="md-toc-link"><p>GroupBy</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#resultado-del-groupby-en-un-nuevo-tipo-de-datos" class="md-toc-link">
            <p>Resultado del GroupBy en un nuevo tipo de datos</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#resultado-del-grupby-en-un-diccionario" class="md-toc-link">
            <p>Resultado del GrupBy en un diccionario</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#zip" class="md-toc-link">
            <p>Zip</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#flatmap-o-aplanado" class="md-toc-link">
            <p>FlatMap o Aplanado</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#anexo-i-concepto-de-recursión-de-funciones-o-recursividad" class="md-toc-link"><p>Anexo I: Concepto de Recursión de funciones o Recursividad</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#definiciones" class="md-toc-link">
            <p>Definiciones</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#-ventajas" class="md-toc-link">
            <p>✅ Ventajas</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#-desventajas" class="md-toc-link">
            <p>❌ Desventajas</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#tipos-de-recursividad" class="md-toc-link">
            <p>Tipos de recursividad</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#diseño-de-un-algoritmo-recursivo" class="md-toc-link">
            <p>Diseño de un algoritmo recursivo</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#punto-de-vista-desde-el-lenguaje-csharp" class="md-toc-link"><p>Punto de vista desde el lenguaje CSharp</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#usando-funciones-lambda-lambda" class="md-toc-link">
            <p>Usando funciones Lambda (λ)</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    
</div>
<div style="page-break-after:always;"></div>
<h2 id="programación-funcional">Programación funcional </h2>
<h3 id="introducción">Introducción </h3>
<p>La <strong>programación funcional</strong> es un <strong>paradigma de programación declarativa</strong> basado en el uso de <strong>funciones matemáticas</strong>, en contraste con la programación <strong>imperativa</strong>, que enfatiza los cambios de estado mediante la mutación de variables.</p>
<p>Existen lenguaje de programación funcionales puros como por ejemplo <strong><a href="https://es.wikipedia.org/wiki/Haskell">Haskell</a></strong> y <strong><a href="https://es.wikipedia.org/wiki/Clojure">Clojure</a></strong>. Sin embargo, el paradigma funcional ha ido cogiendo cada vez más peso en la programación moderna. Tanto es así, que lenguajes imperativos y orientados a objetos tradicionales como <strong>C++</strong>, <strong>Java</strong>, <strong>C#</strong> o <strong>PHP</strong> han incluido características de la programación funcional en su sintaxis o potenciando las que ya tenían lenguajes como <strong>JavaScript</strong>, <strong>Python</strong>. Además, los lenguajes multi-paradigma de nueva creación como <strong>Scala</strong>, <strong>Go</strong>, <strong>F#</strong> o <strong>Kotlin</strong> (este último en menor medida) se han diseñado para que tenga más peso la programación funcional que la orientada a objetos e imperativa.</p>
<p>Simplificando y a grandes rasgos podemos decir que <strong>se basa en los siguientes pilares</strong> matemáticos:</p>
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Lambda_calculus">Cálculo Lambda</a>.</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Closure_(computer_programming)">Clausuras</a>.</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Category_theory">Teoría de categorías</a> y más en concreto el concepto de <a href="https://en.wikipedia.org/wiki/Functor">functor</a> y su aplicación a las ciencias de la computación a través de:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Monad_(category_theory)">Mónadas</a>.</li>
<li><a href="https://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science)">Covarianza y Contravarianza.</a></li>
</ul>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Recursion">Recursión o Recursividad</a> (Formaría parte del Cálculo Lambda).</p>
</li>
</ul>
<p>Cómo se puede observar, su bases son bastante amplias y llevaría bastante ahondar todos estos conceptos. Por esta razón, <strong>este tema pretende ser meramente introductorio y por tanto en él solo vamos a abordar algunos conceptos a través del lenguaje C#</strong>. Estos conceptos serán extrapolables a otros lenguajes ya que como hemos comentados todos utilizan, en mayor o medida, dicho paradigma.</p>
<h3 id="algunas-definiciones-importantes">Algunas definiciones importantes </h3>
<p>Algunos de los <strong>conceptos a destacar</strong> en la programación funcional son:</p>
<ul>
<li>
<p><strong>Función</strong>: En programación funcional, una <strong>función</strong> es un bloque de código que toma uno o más argumentos de entrada y produce un valor de salida. A diferencia de las funciones en la programación imperativa, las funciones en la programación funcional son <em><strong>'ciudadanos de primera clase'</strong></em>, lo que significa que pueden ser tratadas como cualquier otro valor, como números o cadenas. Esto implica que las funciones pueden ser:</p>
<ul>
<li><strong>Asignadas a variables</strong>.</li>
<li><strong>Pasadas como argumentos a otras funciones</strong>.</li>
<li><strong>Devueltas como valores desde otras funciones</strong>.</li>
<li>Almacenadas en estructuras de datos.</li>
<li>Combinadas para crear nuevas funciones.</li>
<li>Anidadas dentro de otras funciones.</li>
</ul>
</li>
<li>
<p><strong>Funciones lambda</strong>: Las funciones lambda son funciones anónimas que se pueden definir de manera concisa y se utilizan comúnmente para operaciones de orden superior. Se <strong>tratan como expresiones</strong> que pueden ser asignadas a variables o pasadas como argumentos. (Las trataremos más adelante).</p>
</li>
<li>
<p><strong>Funciones de orden superior (HOF)</strong>: Las funciones de orden superior son aquellas que pueden tomar otras funciones como argumentos o devolver funciones como resultados. Esto permite una mayor abstracción y reutilización del código.</p>
</li>
<li>
<p><strong>Funciones puras</strong>: Las funciones puras son aquellas que siempre producen el mismo resultado para los mismos argumentos y no tienen efectos secundarios, es decir, no modifican ningún estado externo.</p>
</li>
<li>
<p><strong>Callbacks</strong>: Nombre tradicional con el que se conoce a las funciones que se pasan como argumentos a otras funciones y <strong>se ejecutan en un momento determinado, generalmente cuando ocurre un evento o se completa una tarea</strong>. Por tanto, los callbacks <strong>son un caso concreto de HOF</strong>.</p>
</li>
<li>
<p><strong>Expresiones en lugar de declaraciones</strong>: La programación funcional se basa en la evaluación de expresiones en lugar de la ejecución de declaraciones. Esto significa que el enfoque está en qué se quiere lograr en lugar de cómo lograrlo.</p>
</li>
</ul>
<h3 id="funcionalidades-del-lenguaje-que-vamos-a-necesitar">Funcionalidades del lenguaje que vamos a necesitar </h3>
<h4 id="tipos-delegados-en-csharp">Tipos Delegados en CSharp </h4>
<p>Ya hemos comentado que vamos a necesitar almacenar una función en una variable para poder guardarla, pasarlas como parámetro a otros métodos o devolverlas como resultado de otros métodos. El <strong>mecanismo variará según el lenguaje</strong> de programación. En C y C++ se usan <strong>punteros a funciones</strong>, en Java o Kotlin se usan <strong>interfaces funcionales (SAM)</strong>, en Python o JavaScript se usan <strong>funciones anónimas (lambdas)</strong> y en C# se usan <strong>delegados</strong>.</p>
<p>Por ello vamos a necesitar saber definir tipos delegados y por tanto <strong>definiremos un delegado</strong>, como <strong>un tipo especial de clase cuyos objetos pueden almacenar referencias a uno o más métodos con la misma signatura</strong> de tal manera que; a través del objeto, sea posible solicitar la ejecución en cadena de todos ellos.</p>
<p>En otras palabras, podemos decir que es un objeto que almacena una o más referencias a un método para ejecutarlo posteriormente.</p>
<h5 id="sintaxis-y-ejemplo-de-uso-de-delegados">Sintaxis y ejemplo de uso de delegados </h5>
<p>Si un delegado en un objeto, deberá haber un tipo que lo defina. Este tipo tendrá un nombre (identificador) y me indicará la signatura de los métodos que referenciará el objeto delegado.</p>
<p>La sintaxis para definir el tipo será:<br>
<strong><code>&lt;modificadores&gt; delegate &lt;tipoRetorno&gt; &lt;TipoDelegado&gt;(&lt;parámetros formales&gt;);</code></strong></p>
<p>Donde:</p>
<ul>
<li><strong><code>&lt;TipoDelegado&gt;</code></strong> será el <strong>nombre del tipo</strong> que me servirá para definir objetos delegado.</li>
<li><strong><code>&lt;tipoRetorno&gt;</code></strong> y <strong><code>&lt;parámetros formales&gt;</code></strong> se corresponderán, respectivamente, con el tipo del valor de retorno y la lista de parámetros formales que definirán la signatura de los métodos cuyas referencias contendrán los objetos de ese tipo delegado.</li>
</ul>
<p>La sintaxis para instanciar objetos delegado del tipo definido será:<br>
<strong><code>TipoDelegado oDelegado = IdMetodoQueCumpleLaSignaturaDelTipo;</code></strong><br>
que será un <em>syntactic sugar</em> del siguiente código...<br>
<strong><code>TipoDelegado oDelegado = new TipoDelegado(IdMetodoQueCumpleLaSignaturaDelTipo);</code></strong></p>
<p>La sintaxis para hacer una llamada al método o métodos que almacena un objeto delegado será:<br>
<strong><code>tipoRetorno resultado = oDelegado(&lt;parámetros reales&gt;);</code></strong><br>
que será un <em>syntactic sugar</em> del siguiente código...<br>
<strong><code>tipoRetorno resultado = oDelegado.Invoke(&lt;parámetros reales&gt;);</code></strong><br>
y que realmente estaremos haciendo una llamada al método...<br>
<strong><code>tipoRetorno resultado = IdMetodoQueCumpleLaSignaturaDelTipo(&lt;parámetros reales&gt;);</code></strong></p>
<p><strong>¿No te han quedado claro las diferentes sintaxis?</strong>. Veámoslo a través de un ejemplo concreto de uso comentado que puedes descargar de <strong><a href="assets/ejemplos/delegados_ejemplo.cs">este enlace</a></strong>.</p>
<p>Definamos un <strong>tipo delegado</strong> llamado <strong><code>Operacion</code></strong> que referenciará a métodos que reciban dos parámetros de tipo <strong><code>double</code></strong> y retornen un valor de tipo <strong><code>double</code></strong>. Fíjate, sobre todo, que lo que estamos definiendo es un <strong>tipo</strong> como si fuera una clase más.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-delegate">delegate</span> <span class="token return-type class-name"><span class="token keyword keyword-double">double</span></span> <span class="token function">Operacion</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-double">double</span></span> op1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-double">double</span></span> op2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Definamos ahora dos métodos estáticos con cuerpo de expresión que cumplen la signatura definida en el tipo delegado anterior. Esto es, ambos métodos reciben dos parámetros de tipo <strong><code>double</code></strong> y retornan un valor de tipo <strong><code>double</code></strong>.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-double">double</span></span> <span class="token function">Suma</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-double">double</span></span> op1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-double">double</span></span> op2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> op1 <span class="token operator">+</span> op2<span class="token punctuation">;</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-double">double</span></span> <span class="token function">Multiplica</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-double">double</span></span> op1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-double">double</span></span> op2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> op1 <span class="token operator">*</span> op2<span class="token punctuation">;</span> 
</code></pre><p>Método <strong><code>OperaArrays</code></strong> que recibe dos arrays de valores y un objeto delegado del tipo <strong><code>Operacion</code></strong>. El parámetro <strong><code>operacion</code></strong> indicará la '<em>estrategia</em>' (Strategy) a seguir para operar con los valores de ambos arrays. El método devolverá un nuevo array con los resultados de aplicar la operación indicada a cada par de valores de los arrays de entrada.</p>
<pre data-role="codeBlock" data-info="csharp {highlight=[3,7]}" class="language-csharp csharp" data-line="3,7"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">OperaArrays</span><span class="token punctuation">(</span>
                            <span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> ops1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> ops2<span class="token punctuation">,</span> 
                            <span class="token class-name">Operacion</span> operacion<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> resultados <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-double">double</span></span><span class="token punctuation">[</span>ops1<span class="token punctuation">.</span>Length<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> resultados<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
        resultados<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">operacion</span><span class="token punctuation">(</span>ops1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ops2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> resultados<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">

<div aria-hidden="true" class="line-highlight" data-range="3" data-start="3">
</div></div><div class="line-highlight-wrapper">





<div aria-hidden="true" class="line-highlight" data-range="7" data-start="7">
</div></div></pre><p>Programa principal donde se definen dos arrays de valores y se usan ambos métodos definidos anteriormente para realizar sumas y multiplicaciones a través del método <strong><code>OperaArrays</code></strong>. Fíjate como en la <strong><code>línea 6</code></strong> estámos guardando las función suma en la variable <strong><code>operacion</code></strong> del tipo delegado <strong><code>Operacion</code></strong> y se la pasamos al método <strong><code>OperaArrays</code></strong>.</p>
<p>En la <strong><code>línea 10</code></strong> estamos pasando directamente la función multiplicación al método sin necesidad de definir una variable intermedia.</p>
<pre data-role="codeBlock" data-info="csharp {highlight=[6,7, 10]}" class="language-csharp csharp" data-line="6,7,10"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> ops1 <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> ops2 <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token class-name">Operacion</span> operacion <span class="token operator">=</span> Suma<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> sumas <span class="token operator">=</span> <span class="token function">OperaArrays</span><span class="token punctuation">(</span>ops1<span class="token punctuation">,</span> ops2<span class="token punctuation">,</span> operacion<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Sumas: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> sumas<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> multiplicaciones <span class="token operator">=</span> <span class="token function">OperaArrays</span><span class="token punctuation">(</span>ops1<span class="token punctuation">,</span> ops2<span class="token punctuation">,</span> Multiplica<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Multiplicaciones: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> multiplicaciones<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">




<div aria-hidden="true" class="line-highlight" data-range="6" data-start="6">
</div></div><div class="line-highlight-wrapper">





<div aria-hidden="true" class="line-highlight" data-range="7" data-start="7">
</div></div><div class="line-highlight-wrapper">








<div aria-hidden="true" class="line-highlight" data-range="10" data-start="10">
</div></div></pre><div style="page-break-after:always;"></div>
<div class="box_bg_lightgray">
<p>🚀 <strong>Ampliación Opcional</strong> - <strong>Multidifusión de delegados</strong></p>
<p>Se producirá cuando un objeto delegado <strong>llama a más de un método</strong> cuando se invoca. Esta cualidad de los delegados nos será útil, más adelante, cuando veamos el concepto de <strong>evento</strong>.</p>
<ul>
<li>Para <strong>encadenar</strong> un método / delegado en la multidifusión usaré el <strong><code>operador +=</code></strong></li>
<li>Para <strong>retirar</strong> un método / delegado de la multidifusión de llamadas usaré el <strong><code>operador -=</code></strong></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Aviso</p>
<p>Tiene sentido para <strong>métodos que no retornan nada</strong> (procedimientos), ya que si los delegados retornan algo como en el ejemplo anterior, se asignará el resultado <strong>de la última llamada</strong>.</p>
</div>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Ejemplo</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Métodos a añadir al objeto delegado.</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">VerSuma</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> op1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> op2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">op1</span><span class="token punctuation">}</span></span><span class="token string"> + </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">op2</span><span class="token punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">op1 <span class="token operator">+</span> op2</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">VerMultiplicacion</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> op1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> op2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">op1</span><span class="token punctuation">}</span></span><span class="token string"> * </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">op2</span><span class="token punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">op1 <span class="token operator">*</span> op2</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">VerDividion</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> op1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> op2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">op1</span><span class="token punctuation">}</span></span><span class="token string"> / </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">op2</span><span class="token punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">op1 <span class="token operator">/</span> op2</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Definición del tipo delegado con la signarura de los métodos anteriores.</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-delegate">delegate</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">VerOperacion</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> op1<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> op2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token comment">// La primera referencia al método a ejecutar la podemos asignar directamente.</span>
        <span class="token class-name">VerOperacion</span> verOperaciones <span class="token operator">=</span> VerSuma<span class="token punctuation">;</span>
        <span class="token comment">// Las siguientes las añadimos con el operador +=</span>
        verOperaciones <span class="token operator">+=</span> VerMultiplicacion<span class="token punctuation">;</span>
        verOperaciones <span class="token operator">+=</span> VerDividion<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
            <span class="token comment">// En esta invocación del objeto delegado se realizará una multidifusión</span>
            <span class="token comment">// a los tres métodos que referencia, ejecutándose los tres.</span>
            <span class="token function">verOperaciones</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div> <!-- fin ejemplo -->
<div style="page-break-after:always;"></div>
<h6 id="delegados-vs-interfaces-en-csharp">Delegados vs Interfaces en Csharp </h6>
<p>De lo visto en este tema, podemos deducir que hay <strong>otra forma de aproximarnos al patrón Strategy</strong> además de usando Interfaces como vimos en temas anteriores.</p>
<p>Vamos a tratar de aproximarnos a ambas a través de un <strong><a href="assets/ejemplos/list_sort_ejemplo.cs">sencillo ejemplo</a></strong> de uso ya definido en las BCL. Para ello supongamos la siguiente implementación de la clase <strong><code>Persona</code></strong> que hemos usado con anterioridad.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-record">record</span> <span class="token class-name"><span class="token keyword keyword-class">class</span></span> <span class="token function">Persona</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> Nombre<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> Edad<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Supongamos ahora el siguiente programa principal, donde instanciamos una lista de personas...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">Principal</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">List<span class="token punctuation">&lt;</span>Persona<span class="token punctuation">&gt;</span></span> personas <span class="token operator">=</span> 
        <span class="token punctuation">[</span>
            <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"Sonia"</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"Antonio"</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"Margarita"</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"Manuel"</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Si quisiéramos ordenar las personas por <strong><code>Edad</code></strong>, la clase list nos va a ofrecer el método <strong><code>Sort</code></strong>. Como nuestra clase <strong><code>Persona</code></strong> no implementa <strong><code>IComparable&lt;Persona&gt;</code></strong>, deberemos indicarle de algún modo al <strong><code>Sort</code></strong> la '<em>estrategia</em>' de ordenación. Por esta razón <strong><code>Sort</code></strong> nos ofrecerá las siguientes sobrecargas ...</p>
<ol>
<li>
<p>public void <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.collections.generic.list-1.sort#System_Collections_Generic_List_1_Sort_System_Comparison__0__">Sort</a></strong>(<strong>IComparer&lt;T&gt;?</strong> comparer);</p>
<p>y si buscáramos la definición del tipo <strong><code>IComparer&lt;T&gt;</code></strong> obtendríamos el siguiente <strong>interfaz</strong> parametrizado.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-interface">interface</span> <span class="token class-name">IComparer<span class="token punctuation">&lt;</span><span class="token keyword keyword-in">in</span> T<span class="token punctuation">&gt;</span></span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword keyword-int">int</span></span> <span class="token function">Compare</span><span class="token punctuation">(</span><span class="token class-name">T<span class="token punctuation">?</span></span> x<span class="token punctuation">,</span> <span class="token class-name">T<span class="token punctuation">?</span></span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p>public void <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.collections.generic.list-1.sort#System_Collections_Generic_List_1_Sort_System_Collections_Generic_IComparer__0__">Sort</a></strong>(<strong>Comparison&lt;T&gt;</strong> comparison);</p>
<p>y si buscáramos la definición del tipo <strong><code>Comparison&lt;T&gt;</code></strong> obtendríamos el siguiente <strong>delegado</strong> parametrizado.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-delegate">delegate</span> <span class="token return-type class-name"><span class="token keyword keyword-int">int</span></span> <span class="token generic-method"><span class="token function">Comparison</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword keyword-in">in</span> T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T</span> x<span class="token punctuation">,</span> <span class="token class-name">T</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
</ol>
<p>Recordemos que si quisiéramos usar el interfaz para ordenar por edad deberíamos definir una clase que implemente el interfaz. Por ejemplo ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-record">record</span> <span class="token class-name"><span class="token keyword keyword-class">class</span></span> <span class="token function">Persona</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> Nombre<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> Edad<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Definición de la clase que implementa el interfaz </span>
    <span class="token comment">// con la estrategia de comparación.</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">ComparaEdad</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IComparer<span class="token punctuation">&lt;</span>Persona<span class="token punctuation">&gt;</span></span></span>
    <span class="token punctuation">{</span>
        <span class="token return-type class-name"><span class="token keyword keyword-int">int</span></span> IComparer<span class="token operator">&lt;</span>Persona<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token function">Compare</span><span class="token punctuation">(</span><span class="token class-name">Persona<span class="token punctuation">?</span></span> x<span class="token punctuation">,</span> <span class="token class-name">Persona<span class="token punctuation">?</span></span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword keyword-switch">switch</span>
        <span class="token punctuation">{</span>
            <span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span><span class="token keyword keyword-null">null</span><span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span>
            _ <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Edad<span class="token punctuation">.</span><span class="token function">CompareTo</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>Edad<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="row">
<div class="col-sm-6 my-auto">
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">List<span class="token punctuation">&lt;</span>Persona<span class="token punctuation">&gt;</span></span> personas <span class="token operator">=</span>
    <span class="token punctuation">[</span>
        <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"Sonia"</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"Antonio"</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
        <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"Margarita"</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"Manuel"</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    personas<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">Persona<span class="token punctuation">.</span>ComparaEdad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> personas<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div class="col-sm-6">
<p>Si ejemcutamos el programa principal ahora veremos que las personas se han ordenado por edad. <strong>Mostrando por consola</strong>:</p>
<pre class="salida_consola">Persona { Nombre = Margarita, Edad = 32 }
Persona { Nombre = Sonia, Edad = 35 }
Persona { Nombre = Manuel, Edad = 50 }
Persona { Nombre = Antonio, Edad = 55 }</pre> <!-- fin salida consola -->
</div>
</div>
<p>Sin embargo, si quisiéramos usar el delegado <strong><code>Comparison&lt;T&gt;</code></strong> tendríamos <strong>una composición de código más sencilla</strong>...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// Implementamos un método estático que cumpla la signatura del delegado</span>
<span class="token comment">// e implemente la estrategia de ordenación.</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-int">int</span></span> <span class="token function">ComparaEdad</span><span class="token punctuation">(</span><span class="token class-name">Persona</span> p1<span class="token punctuation">,</span> <span class="token class-name">Persona</span> p2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p1<span class="token punctuation">.</span>Edad<span class="token punctuation">.</span><span class="token function">CompareTo</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>Edad<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">List<span class="token punctuation">&lt;</span>Persona<span class="token punctuation">&gt;</span></span> personas <span class="token operator">=</span>
    <span class="token punctuation">[</span>
        <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"Sonia"</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"Antonio"</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"Margarita"</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"Manuel"</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    personas<span class="token punctuation">.</span><span class="token function">Sort</span><span class="token punctuation">(</span>ComparaEdad<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> personas<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><h6 id="cuándo-usar-delegados-vs-interfaces-en-csharp">¿Cuándo usar Delegados vs Interfaces en CSharp? </h6>
<p><strong>Usaremos delegados cuando:</strong></p>
<ul>
<li>Se utilice un modelo de diseño de <strong>eventos</strong>.</li>
<li>Se prefiere a la hora de encapsular un <strong>método estático o de clase</strong>.</li>
<li>El autor de las llamadas no tiene ninguna necesidad de obtener acceso a otras propiedades, métodos o interfaces en el objeto que implementa el método.</li>
<li>Se desea conseguir una <strong>composición sencilla</strong>.</li>
<li>Una clase puede necesitar más de una implementación del método.</li>
</ul>
<p><strong>Usaremos interfaces cuando:</strong></p>
<ul>
<li>Haya un <strong>grupo de métodos relacionados</strong> a los que se pueda llamar.</li>
<li>Una clase <strong>sólo necesita una implementación del método</strong>.</li>
<li>La clase que utiliza la interfaz <strong>deseará convertir esa interfaz en otra interfaz</strong> o tipos de clase.</li>
</ul>
<div style="page-break-after:always;"></div>
<div class="box_bg_lightgray">
<p>🎓 <strong>Caso de estudio:</strong></p>
<p>Supongamos el siguiente programa de ejemplo, donde dado un array de valores. Queremos calcular la media de las raíces cuadradas de los valores y también la media de elevar <strong>e</strong> a los valores.</p>
<p>Una posible propuesta sería la siguiente...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span> 
<span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-double">double</span></span> <span class="token function">MediaRaiz</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> valores<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-double">double</span></span> total <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> valores<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            total <span class="token operator">+=</span> Math<span class="token punctuation">.</span><span class="token function">Sqrt</span><span class="token punctuation">(</span>valores<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> total <span class="token operator">/</span> valores<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-double">double</span></span> <span class="token function">MediaExponencial</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> valores<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-double">double</span></span> total <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> valores<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            total <span class="token operator">+=</span> Math<span class="token punctuation">.</span><span class="token function">Exp</span><span class="token punctuation">(</span>valores<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> total <span class="token operator">/</span> valores<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> valores <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Media raíces:"</span> <span class="token operator">+</span> <span class="token function">MediaRaiz</span><span class="token punctuation">(</span>valores<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Media exponentes:"</span> <span class="token operator">+</span> <span class="token function">MediaExponencial</span><span class="token punctuation">(</span>valores<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Sin embargo en la propuesta anterior se repite el código para calcular la media y cómo nos sucedía en otros casos solo se repite la función aplicada al valor.</p>
<p><strong>Piensa cómo sería la solución usando interfaces</strong>.<br>
Si no se te ocurre puedes ver la solución el la siguiente página...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// Debemos definir el interfaz que implemente la función.</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-interface">interface</span> <span class="token class-name">IFuncion</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword keyword-double">double</span></span> <span class="token function">Funcion</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-double">double</span></span> valor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Definir tipos que implementen el interfaz con la función específica a aplicar.</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">MediaRa</span>íz <span class="token punctuation">:</span> IFuncion
<span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-double">double</span></span> <span class="token function">Funcion</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-double">double</span></span> valor<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">Sqrt</span><span class="token punctuation">(</span>valor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">MediaExponente</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IFuncion</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-double">double</span></span> <span class="token function">Funcion</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-double">double</span></span> valor<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">Exp</span><span class="token punctuation">(</span>valor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Media ahora recibe el objeto que implementa dicho interfaz.</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-double">double</span></span> <span class="token function">Media</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> puntos<span class="token punctuation">,</span> <span class="token class-name">IFuncion</span> funcion<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-double">double</span></span> total <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> puntos<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            total <span class="token operator">+=</span> funcion<span class="token punctuation">.</span><span class="token function">Funcion</span><span class="token punctuation">(</span>puntos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> total <span class="token operator">/</span> puntos<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> puntos <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Media raíces:"</span> <span class="token operator">+</span> <span class="token function">Media</span><span class="token punctuation">(</span>puntos<span class="token punctuation">,</span> <span class="token keyword keyword-new">new</span> MediaRaí<span class="token function">z</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Media exponentes:"</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">MediaExponente</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Cómo vemos en este caso es más apropiado usar delegados porque tenemos una única función. No hay extensión del interfaz y estamos generando mucho código de definición de tipos a cambio repetir el código de cálculo de la media.</p>
<p><strong>Piensa cómo sería la solución usando delegados</strong>.<br>
Si no se te ocurre puedes ver la solución el la siguiente página...</p>
<p>Supongamos el siguiente programa de ejemplo, donde dado un array de valores.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span> 
<span class="token punctuation">{</span>
    <span class="token comment">// Definimos el tipo delegado que más adelante incluso nos podremos ahorrar</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-delegate">delegate</span> <span class="token return-type class-name"><span class="token keyword keyword-double">double</span></span> <span class="token function">Funcion</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-double">double</span></span> valor<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-double">double</span></span> <span class="token function">Media</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> puntos<span class="token punctuation">,</span> <span class="token class-name">Funcion</span> funcion<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-double">double</span></span> total <span class="token operator">=</span> <span class="token number">0.0D</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> puntos<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            total <span class="token operator">+=</span> <span class="token function">funcion</span><span class="token punctuation">(</span>puntos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> total <span class="token operator">/</span> puntos<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> puntos <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Media raíces:"</span> <span class="token operator">+</span> <span class="token function">Media</span><span class="token punctuation">(</span>puntos<span class="token punctuation">,</span> Math<span class="token punctuation">.</span>Sqrt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Media exponentes:"</span> <span class="token operator">+</span> <span class="token function">Media</span><span class="token punctuation">(</span>puntos<span class="token punctuation">,</span> Math<span class="token punctuation">.</span>Exp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div> <!-- fin caso de estudio -->
<div style="page-break-after:always;"></div>
<h5 id="delegados-parametrizados-genéricos">Delegados Parametrizados (Genéricos) </h5>
<p>Podemos definir un delegado de forma parametrizada o que use genéricos. Esto me permitirá usar un <strong>tipos delegado predefinidos para las signaturas de métodos más comunes que se me pueden dar</strong>.</p>
<p>Por ejemplo, es muy común definir delegados en los que se evalúe un parámetro entrada a modo de <a href="https://es.wikipedia.org/wiki/Predicado_(l%C3%B3gica)">'<em>predicado lógico</em>'</a> que se evaluarán a cierto o falso.</p>
<p>Una posible definición sería...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-delegate">delegate</span> <span class="token return-type class-name"><span class="token keyword keyword-bool">bool</span></span> <span class="token generic-method"><span class="token function">Predicado</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>y nos permitiría definir un tipo para cualquier signatura de método que evalúe una entrada a modo de predicado. Por ejemplo...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// Esté método estático me permite evaluar la si es cierto o no </span>
<span class="token comment">// el predicado 'Valor es un número par'</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-bool">bool</span></span> <span class="token function">EsPar</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> valor<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> valor <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">// Esté método estático me permite evaluar la si es cierto o no </span>
<span class="token comment">// el predicado 'Texto empieza por mayúscula'</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-bool">bool</span></span> <span class="token function">EmpiezaPorMayuscula</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> texto<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> texto<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span>texto<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token comment">// En ambos casos puedo usar la misma definición de</span>
    <span class="token comment">// delegado parametrizado para referenciar a los </span>
    <span class="token comment">// métodos anteriores.</span>
    <span class="token class-name">Predicado<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> predicado1 <span class="token operator">=</span> EsPar<span class="token punctuation">;</span>
    <span class="token class-name">Predicado<span class="token punctuation">&lt;</span><span class="token keyword keyword-string">string</span><span class="token punctuation">&gt;</span></span> predicado2 <span class="token operator">=</span> EmpiezaPorMayuscula<span class="token punctuation">;</span>

    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">predicado1</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">predicado2</span><span class="token punctuation">(</span><span class="token string">"Hola"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>De hecho, ya existe una definición similar en el espacio de nombres <strong><code>System</code></strong> de C#...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-delegate">delegate</span> <span class="token return-type class-name"><span class="token keyword keyword-bool">bool</span></span> <span class="token generic-method"><span class="token function">Predicate</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword keyword-in">in</span> T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>y es usada en algunos métodos de las BCL <strong>como por ejemplo</strong> el método <strong><code>public List&lt;T&gt; FindAll(Predicate&lt;T&gt; match);</code></strong> definido en <strong><code>List&lt;T&gt;</code></strong>. De tal manera que podríamos usar nuestro método <strong><code>EsPar</code></strong> para obtener todos los números pares en una lista de números de la siguiente manera ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> l <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> l<span class="token punctuation">.</span><span class="token function">FindAll</span><span class="token punctuation">(</span>EsPar<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Además de <strong><code>delegate bool Predicate&lt;in T&gt;(T obj)</code></strong> podemos destacar la siguientes definiciones en las BCL de delegados parametrizados...</p>
<h6 id="definiciones-para-procedimientos-action">Definiciones para procedimientos <strong><code>Action</code></strong> </h6>
<p>Bajo el tipo <strong><code>Action</code></strong> tendremos predefinidos delegados que admitirán métodos que no retornan nada (void) y que podrán tener de 0 a 16 parámetros.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// Si no parametrizamos es porque no habrá parámetros de entrada.</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-delegate">delegate</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Action</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-delegate">delegate</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token generic-method"><span class="token function">Action</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword keyword-in">in</span> T1<span class="token punctuation">,</span> <span class="token keyword keyword-in">in</span> T2<span class="token punctuation">,</span> …<span class="token punctuation">,</span> <span class="token keyword keyword-in">in</span> T16<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T1</span> obj1<span class="token punctuation">,</span> <span class="token class-name">T2</span> obj2<span class="token punctuation">,</span> …<span class="token punctuation">,</span> <span class="token class-name">T16</span> obj16<span class="token punctuation">)</span>
</code></pre><p>Un ejemplo de uso de este delegado sería el método <strong><code>public void ForEach(Action&lt;T&gt; action);</code></strong> definido en <strong><code>List&lt;T&gt;</code></strong>. De tal manera que me permitirá recorrer los elementos de la secuencia e ir aplicando a cada uno de ellos la acción especificada en forma de delegado...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Muestra</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> valor<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">valor</span><span class="token format-string"><span class="token punctuation">:</span>D2</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> valores <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// Defino un delegado para métodos con un solo parámetro de entrada entero.</span>
    <span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> accion <span class="token operator">=</span> Muestra<span class="token punctuation">;</span>
    valores<span class="token punctuation">.</span><span class="token function">ForEach</span><span class="token punctuation">(</span>accion<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// o directamente ... valores.ForEach(Muestra);</span>
<span class="token punctuation">}</span>
</code></pre><div style="page-break-after:always;"></div>
<h6 id="definiciones-para-funciones-func">Definiciones para funciones <strong><code>Func</code></strong> </h6>
<p>Bajo el tipo <strong><code>Func</code></strong> tendremos predefinidos delegados que admitirán métodos que no retornan un tipo a modo de '<em>función</em>' y que como los <strong><code>Action</code></strong> podrán tener de 0 a 16 parámetros.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// Fíjate que ahora la parametrizacion define al menos el tipo R de (Retorno) de la función.</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-delegate">delegate</span> <span class="token return-type class-name">R</span> <span class="token generic-method"><span class="token function">Func</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword keyword-out">out</span> R<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token comment">// El tipo de retorno se definirá siempre al final en la parametrización.</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-delegate">delegate</span> <span class="token return-type class-name">R</span> <span class="token generic-method"><span class="token function">Func</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword keyword-in">in</span> T1<span class="token punctuation">,</span> …<span class="token punctuation">,</span> <span class="token keyword keyword-in">in</span> T16<span class="token punctuation">,</span> <span class="token keyword keyword-out">out</span> R<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T1</span> obj1<span class="token punctuation">,</span>  …<span class="token punctuation">,</span> <span class="token class-name">T16</span> obj16<span class="token punctuation">)</span>
</code></pre><p>Iremos encontrando este tipo de delegado más adelante, en ciertas definiciones de las BCL de <strong><code>System.Linq</code></strong>. Para poner nuestro ejemplo, vamos a fijarnos que el tipo delegado <strong><code>Predicado&lt;T&gt;</code></strong> que definimos en el nuestro primer ejemplo. Se puede definir también con <strong><code>Func</code></strong> de la siguiente manera <strong><code>Func&lt;T, bool&gt;</code></strong>. Aunque ambos delegados admitan métodos con la misma signatura, para C# serán tipos diferentes.</p>
<p>Veamos cómo reescribir el ejemplo de los predicados usando <strong><code>Func</code></strong>...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-bool">bool</span></span> <span class="token function">EsPar</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> valor<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> valor <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-bool">bool</span></span> <span class="token function">EmpiezaPorMayuscula</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> texto<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> texto<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span>texto<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token comment">// En ambos casos al ser el último tipo parametrizado un bool</span>
    <span class="token comment">// estaremos indicando que la signatura de los métodos debe retornar eso.</span>
    <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-bool">bool</span><span class="token punctuation">&gt;</span></span> predicado1 <span class="token operator">=</span> EsPar<span class="token punctuation">;</span>
    <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-string">string</span><span class="token punctuation">,</span> <span class="token keyword keyword-bool">bool</span><span class="token punctuation">&gt;</span></span> predicado2 <span class="token operator">=</span> EmpiezaPorMayuscula<span class="token punctuation">;</span>

    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">predicado1</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">predicado2</span><span class="token punctuation">(</span><span class="token string">"Hola"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>Aunque solo se dará en casos aislados</strong>, a lo mejor queremos definir un delegado que referencie a un método con más de un parámetro de salida. En este caso, si nos acordamos de principio de curso, usaremos tuplas para definir el valor de retornos.</p>
<p>Recordemos el ejemplo que vimos para este caso...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> sen<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> cos<span class="token punctuation">)</span></span> <span class="token function">Direccion</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-double">double</span></span> anguloGr<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-double">double</span></span> anguloRad <span class="token operator">=</span> anguloGr <span class="token operator">*</span> Math<span class="token punctuation">.</span>PI <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">Sin</span><span class="token punctuation">(</span>anguloRad<span class="token punctuation">)</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">Cos</span><span class="token punctuation">(</span>anguloRad<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>No obstante, como comentamos, a partir de C#7 no sería necesario. Si quisiéramos usar <strong><code>Func</code></strong> para definir un tipo delegado que referenciase a los métodos anteriores podríamos hacer lo siguiente...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-double">double</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword keyword-double">double</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">)</span><span class="token punctuation">&gt;</span></span> f <span class="token operator">=</span> Direccion<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-double">double</span></span> seno<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-double">double</span></span> coseno<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"s=</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">seno</span><span class="token format-string"><span class="token punctuation">:</span>F2</span><span class="token punctuation">}</span></span><span class="token string">, c=</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">coseno</span><span class="token format-string"><span class="token punctuation">:</span>F2</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div style="page-break-after:always;"></div>
<h4 id="tipos-anónimos-inmutables-en-csharp">Tipos Anónimos Inmutables en CSharp </h4>
<p>Es una <strong>herramienta muy útil en programación funcional</strong> para <strong>crear objetos ligeros y temporales</strong> que no requieren una definición de clase completa. Son especialmente útiles en escenarios donde se necesita agrupar datos de manera rápida y sencilla, como consultas sobre una secuencia de datos o en operaciones de <strong>transformación de datos</strong>. A esta <strong>agrupación o proyección de datos</strong> resultado de una consulta sobre otros objetos se le denomina <strong><a href="https://es.wikipedia.org/wiki/Objeto_de_transferencia_de_datos">DTO</a> (Data Transfer Object)</strong> y deben tener las <strong>características de inmutabilidad y comparación de igualdad que tienen los tipos anónimos</strong> que teníamos en C# a través de <strong><code>record class</code></strong>. Pero en ocasiones, no queremos definir un tipo completo para ello porque los necesitamos en un alcance (scope) local o para un proceso de mapeo intermedio. Es aquí donde los tipos anónimos nos serán de gran utilidad.</p>
<p>Resumiendo, <strong>definiremos los tipos anónimos como</strong> una manera de encapsular un conjunto de propiedades de solo lectura en un único objeto sin tener que definir un tipo. Para ello, <strong>el compilador genera el nombre del tipo de forma transparente para el programador y por tanto no disponible en el nivel de código fuente</strong>.</p>
<p>En el <strong>ejemplo</strong> siguiente se muestra dos tipos anónimo que se inicializa con una propiedad <strong><code>Name</code></strong> el primero y dos propiedades <strong><code>Nombre</code></strong> y <strong><code>Edad</code></strong> el segundo.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-var">var</span></span> estudianteDesconocido  <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">"Rigoberto"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-var">var</span></span> estudianteDesconocido2 <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span> Nombre <span class="token operator">=</span> <span class="token string">"Pedro"</span><span class="token punctuation">,</span> Edad <span class="token operator">=</span> <span class="token string">"12"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>Podemos ahorrarnos el indicar los nombres de las propiedades si utilizamos <strong>identificadores de variables</strong> para inicializar el tipo anónimo ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-double">double</span></span> X <span class="token operator">=</span> <span class="token number">9.1</span><span class="token punctuation">;</span> 
<span class="token class-name"><span class="token keyword keyword-float">float</span></span> Y <span class="token operator">=</span> <span class="token number">3.2</span><span class="token punctuation">;</span> 

<span class="token comment">// La variable point1 tendrá una propiedad llamada X de tipo double y </span>
<span class="token comment">// otra llamada Y del tipo float. </span>
<span class="token class-name"><span class="token keyword keyword-var">var</span></span> point1 <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span> X<span class="token punctuation">,</span> Y <span class="token punctuation">}</span><span class="token punctuation">;</span> 

<span class="token comment">// Incluso podemos combinar las formas de inicializar, </span>
<span class="token comment">// en este el siguiente caso point2 tiene como propiedades X y SuperY.</span>
<span class="token class-name"><span class="token keyword keyword-var">var</span></span> point2 <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span> X<span class="token punctuation">,</span> SuperY <span class="token operator">=</span> Y <span class="token punctuation">}</span><span class="token punctuation">;</span> 
</code></pre><p>También se puede definir un array de elementos con tipo anónimo, combinando una variable local con tipo implícito y una matriz con tipo implícito. Por ejemplo ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-var">var</span></span> fruitsSize <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> 
<span class="token punctuation">{</span>
    <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">"Apple"</span><span class="token punctuation">,</span> Diameter <span class="token operator">=</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> 
    <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">"Grape"</span><span class="token punctuation">,</span> Diameter <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="admonition tip">
<p class="admonition-title">Importante</p>
<p>No podremos utilizar expresiones de coleccion var <strong><code>coleccion = [...]</code></strong><br>
Además, en este caso hemos creado <strong>dos objetos anónimos con el mismo nombre de propiedades</strong> y por tanto del '<em>mismo tipo</em>'. Esto será detectado internamente por el Runtime que <strong>combinará ambos tipos anónimos creados</strong>, en uno solo.</p>
</div>
<p><strong>Restricciones</strong> de los tipos anónimos:</p>
<ul>
<li>Son inmutables.</li>
<li>No pueden definir Propiedades Privadas</li>
<li>No pueden definir métodos, campos, constructores, etc.</li>
<li>No se pueden inicializar a null.</li>
<li>Al carecer de un nombre de tipo, no se pueden retornar desde un método o pasar como parámetros a los mismos.</li>
</ul>
<p>Al usar <strong><code>Equals(object obj)</code></strong> <strong>se considerará iguales</strong> aquellos métodos anónimos que tengan:</p>
<ul>
<li>Las mismas propiedades, en nombre y número.</li>
<li>El mismo orden de declaración de las propiedades.</li>
<li>Los mismos valores para esas propiedades.</li>
</ul>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-var">var</span></span> anonimo1 <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span> Nombre <span class="token operator">=</span> <span class="token string">"María"</span><span class="token punctuation">,</span> Edad <span class="token operator">=</span> <span class="token number">23</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-var">var</span></span> anonimo2 <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span> Nombre <span class="token operator">=</span> <span class="token string">"María"</span><span class="token punctuation">,</span> Edad <span class="token operator">=</span> <span class="token number">23</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Mostrará True a pesar de que sean referencias a</span>
<span class="token comment">// objetos diferentes en memoria.</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>anonimo1<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>anonimo2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Por último, puesto que heredan de la clase <strong><code>object</code></strong> podrán mostrarse <strong><code>string ToString()</code></strong> por ejemplo...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-var">var</span></span> anonimo <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span> Nombre <span class="token operator">=</span> <span class="token string">"María"</span><span class="token punctuation">,</span> Edad <span class="token operator">=</span> <span class="token number">23</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Mostrará "{ Nombre = "María", Edad = 23 }" sin necesidad de invalidar ToString().</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>anonimo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="cálculo-lambda">Cálculo Lambda </h3>
<p>Es uno de los pilares de la programación funcional. Esté fue formulado por el matemático-lógico norteamericano <strong>Alonzo Church</strong> y consiste en '<em>...un sistema formal diseñado para investigar la definición de función, la noción de aplicación de funciones y la recursión...</em>'.</p>
<p>Se basa en una definición de función alternativa a la tradicional que dentro del contexto de las ciencias de computación denominaremos: <strong>'<em>Expresión Lambda</em>'</strong>.</p>
<h4 id="definición-de-expresión-lambda">Definición de Expresión Lambda </h4>
<p>Para entender lo que es, vamos ver el concepto de función dependiendo de ámbito de conocimiento...</p>
<ol>
<li>
<p>En <strong>matemática tradicional</strong> las funciones se representan con un nombre <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span> o <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span></p>
<table>
<thead>
<tr>
<th>Definición</th>
<th>Explicación</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>x</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">f(x)=x+2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></td>
<td>Un parámetro.</td>
</tr>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>o</mi><mi>w</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>x</mi><mi>y</mi></msup></mrow><annotation encoding="application/x-tex">pow(x, y)=x^y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span></span></span></span></span></span></span></td>
<td>Dos parámetros.</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>En la <strong>teoría matemática del cálculo lambda</strong> (<em>λ-calculus</em>) esta misma función <strong>se expresaría sin nombre</strong>, solo los parámetros que entran y la expresión que la representa.</p>
<table>
<thead>
<tr>
<th>Definición</th>
<th>Explicación</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>x</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">λx.x+2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></td>
<td>Un parámetro (definición) y equivale a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>x</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">f(x)=x+2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>.</td>
</tr>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>x</mi><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mn>10</mn><mo>=</mo><mn>12</mn></mrow><annotation encoding="application/x-tex">(λx.x+2)10=12</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mord">10</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">12</span></span></span></span></td>
<td>Un parámetro (aplicación de una valor) y equivale a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mn>10</mn><mo stretchy="false">)</mo><mo>=</mo><mn>10</mn><mo>+</mo><mn>2</mn><mo>=</mo><mn>12</mn></mrow><annotation encoding="application/x-tex">f(10)=10+2=12</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord">10</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">12</span></span></span></span>.</td>
</tr>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><msup><mi>x</mi><mi>y</mi></msup></mrow><annotation encoding="application/x-tex">λ(x,y).x^y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">λ</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mord">.</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span></span></span></span></span></span></span></td>
<td>Dos parámetros.</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>✋ En <strong>ciencias de computación</strong> se expresará a través de una <strong>función anónima o expresión lambda</strong>.</p>
<table>
<thead>
<tr>
<th>Definición</th>
<th>Explicación</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>→</mo><mi>x</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">x → x+2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></td>
<td>Un parámetro (definición) y equivale a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>x</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">f(x)=x+2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>.</td>
</tr>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo>→</mo><mi>x</mi><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>10</mn><mo stretchy="false">)</mo><mo>=</mo><mn>12</mn></mrow><annotation encoding="application/x-tex">(x → x+2)(10) = 12</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">10</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">12</span></span></span></span></td>
<td>Un parámetro (aplicación de un valor) y equivale a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mn>10</mn><mo stretchy="false">)</mo><mo>=</mo><mn>10</mn><mo>+</mo><mn>2</mn><mo>=</mo><mn>12</mn></mrow><annotation encoding="application/x-tex">f(10)=10+2=12</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord">10</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">12</span></span></span></span>.</td>
</tr>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>→</mo><msup><mi>x</mi><mi>y</mi></msup></mrow><annotation encoding="application/x-tex">(x,y) → x^y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span></span></span></span></span></span></span></td>
<td>Dos parámetros.</td>
</tr>
</tbody>
</table>
</li>
</ol>
<p>Esta última, forma de definir funciones de forma anónima y como expresiones, es la que usaremos el la gran mayoría de lenguajes de programación y aunque vamos a ver el caso concreto de C#, la forma de hacelos será muy similar en otros lenguajes. Por<br>
ejemplo, si ya las hemos usado en JavaScript, su sintaxis nos será muy familiar.</p>
<h4 id="expresiones-lambda-en-csharp">Expresiones Lambda en CSharp </h4>
<p>Una <strong>λ-expresión</strong> en C# es un <strong>método anónimo</strong> (sin nombre) que se ha de declarar/definir y asignar inmediatamente, sobre una instancia de un <strong>delegado</strong>.</p>
<p>Las λ-expresión puede ser usadas en alguno estos escenarios en C#:</p>
<ol>
<li>Definir cuerpos de expresión dentro de una clase (<strong>Esto ya lo hemos usado</strong>). Por ejemplo, <strong>un cuerpo de expresión es una expresión lambda</strong>.</li>
<li>Pasar como argumento a otra función.</li>
<li>Como tipo de retorno de una función, esto es, '<em>Una función que retorna otra función</em>.</li>
<li>Asignación a instancias de delegados parametrizados.</li>
</ol>
<p>La representación general de una expresión lambda sigue el  siguiente formato general...</p>
<p><strong><code>(parámetros) =&gt; sentencia o {bloque de sentencias con return si función}</code></strong></p>
<p>Vamos a describir que es cada cosa:</p>
<ol>
<li>
<p><strong><code>(parámetros)</code></strong>: Lista de parámetros separada por comas.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">Pow</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Se debe dejar los paréntesis vacíos <strong><code>()</code></strong> si no hay parámetros.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Hola"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Si solo hay <strong>un parámetro</strong>, los paréntesis se pueden obviar.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// Suponiendo que s es de tipo string la expresión lambda siguiente</span>
<span class="token comment">// se evaluará a tipo delegado Func&lt;string, int&gt; esto es, una función anónima</span>
<span class="token comment">// que recibe un string y retorna un int.</span>
s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>Lenght<span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong><code>=&gt;</code></strong>: Este es el <strong>operador</strong> que se encarga de mapear los parámetros a la expresión o al conjunto de sentencias del bloque.</p>
</li>
<li>
<p>La parte derecha, tras el operador <strong><code>=&gt;</code></strong>, puede ser una única sentencia en forma de expresión que se evalúe a lo que retorna la función como en lo ejemplo anteriores o de forma menos habitual, un bloque de instrucciones. En este último caso la sintáxis será equivalente a la de las funciones tradicionales y tratando de sangrar el código y escribirla en varias líneas para mayor claridad.</p>
<pre data-role="codeBlock" data-info="csharp {highlight=4}" class="language-csharp csharp" data-line="4"><code><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
<span class="token punctuation">{</span> 
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Calculando </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">x</span><span class="token punctuation">}</span></span><span class="token string"> elevado a </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">y</span><span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-return">return</span> Math<span class="token punctuation">.</span><span class="token function">Pow</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Fíjate que ahora sí debemos usar return.</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">


<div aria-hidden="true" class="line-highlight" data-range="4" data-start="4">
</div></div></pre></li>
</ol>
<p>Las expresiones lambda anteriores anteriores de forma análoga a lo que sucedería con la expresión <strong><code>int x = 3 + 4</code></strong>, deberemos asignarla a algo. Puesto que los tipos que referencian a funciones son los objetos delegado, deberemos asignarlo a algún identificador de objeto delegado parametrizado o no. Es más, <strong>será completamente necesario para deducir los tipos de los parámetros de entrada y de retorno</strong>.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// x es double y retorna double</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-double">double</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">&gt;</span></span> cubo <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">*</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>

<span class="token comment">// x , y son enteros y retorna entero</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> suma <span class="token operator">=</span> <span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> o1 <span class="token operator">+</span> o2<span class="token punctuation">;</span> 

<span class="token comment">// ERROR no sé deducir los tipos de forma implícita.</span>
<span class="token comment">// Esto solo sería válido en un lenguaje débilmente tipado como JavaScript.</span>
<span class="token class-name"><span class="token keyword keyword-var">var</span></span> suma <span class="token operator">=</span> <span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> o1 <span class="token operator">+</span> o2<span class="token punctuation">;</span>
</code></pre><div class="contenedor">
    <div class="fondo">
        <div class="abre_comilla">"</div>
        <div class="cierra_comilla">"</div>
        <div class="cita">In software, when something is painful, the way to reduce the pain is to do it more frequently, not less..</div>
        <div class="autor">- David Farley</div>
    </div>
</div>
<div style="page-break-after:always;"></div>
<h3 id="clausuras-en-csharp">Clausuras en CSharp </h3>
<p>Para entender el concepto de <strong><a href="https://es.wikipedia.org/wiki/Clausura_(inform%C3%A1tica)">clausura</a></strong>, vamos a ver los siguiente definición del lenguaje C#.</p>
<h4 id="variables-externas-capturadas">Variables Externas Capturadas </h4>
<p>En el cuerpo de expresión de una expresión lambda, podemos incluir referencias a variables locales y a los parámetros de un método. A estas referencias se les conoce como <strong>variables externas capturadas</strong>.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Variable local factor, su alcance o scope es la el método A</span>
    <span class="token comment">// fuera del mismo la variable dejará de existir.</span>
    <span class="token class-name"><span class="token keyword keyword-int">int</span></span> factor <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> 

    <span class="token comment">// factor es una variable externa capturada en la expresión lambda pues </span>
    <span class="token comment">// está siendo usada en un ámbito más cercano.</span>
    <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> producto <span class="token operator">=</span> n <span class="token operator">=&gt;</span> n <span class="token operator">*</span> factor<span class="token punctuation">;</span>

    <span class="token comment">// Como hago una invocación del delegado dentro del scope de A</span>
    <span class="token comment">// factor sigue existiendo y valiendo 3 por lo que al ejecutarse</span>
    <span class="token comment">// el cuerpo de expresión de la función lambda a la que referencia</span>
    <span class="token comment">// se mostrará 5 * 3 = 15</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">producto</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>A las <strong>expresiones lambda</strong> que están integradas por variables externas capturadas se les llama <strong>clausuras</strong>.</p>
<p>Este tipo de variables, se evalúan en el momento en que se llama a la expresión Lambda de tal manera que si reescribiéramos el código anterior así ...</p>
<pre data-role="codeBlock" data-info="csharp {highlight=5}" class="language-csharp csharp" data-line="5"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-int">int</span></span> factor <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> 
    <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> producto <span class="token operator">=</span> n <span class="token operator">=&gt;</span> n <span class="token operator">*</span> factor<span class="token punctuation">;</span>
    factor <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token comment">// Ahora mostrará 5 * 10 = 50 porque evalúa el valor de factor en</span>
    <span class="token comment">// el momento de la llama a la función anónima.</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">producto</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Mostrará 50</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">



<div aria-hidden="true" class="line-highlight" data-range="5" data-start="5">
</div></div></pre><p>La referencia y el valor a una variable capturada, <strong>está disponible mientras el ámbito de la expresión lambda</strong> esté al alcance de su ejecución. Esto es, a pesar de encontrarnos fuera el ámbito de definición de la variable externa capturada, se guarda una referencia y siempre estará accesible para la expresión lambda.</p>
<p>Pero, en nuestro ejemplo <strong><code>producto</code></strong> que es la referencia a nuestra expresión lambda y <strong><code>factor</code></strong> que es la variable externa capturada, tienen el mismo ámbito de ejecución que es el método <strong><code>A</code></strong>, esto es, ambas referencias existen en el heap mientras estoy ejecutando <strong><code>A</code></strong> y al finalizar el método desaparecen. Entonces... <strong>¿Cómo puede extenderse el ámbito de ejecución de <strong><code>producto</code></strong> más allá del ámbito de existencia de <strong><code>factor</code></strong>?</strong></p>
<p>La respuesta es, mediante las ya mencionadas <strong>funciones de orden superior</strong> o <strong>HOF</strong> (<a href="https://en.wikipedia.org/wiki/Higher-order_function">High-Order Functions</a>). Recuerda que las HOF en el λ-cálculo decíamos que <strong>son funciones que reciben como parámetro o retornan otra función</strong>.</p>
<p>¿Cómo pasamos por parámetro o devolvemos una función en C#?. La respuesta sería a través de un tipo delegado. Entonces, cuando tratamos los delegados ... ¿Aquellos métodos que recibían un delegado eran HOF?. La respuesta es <strong>sí</strong>.</p>
<p>¿Cómo redactaremos el código anterior para que el método <strong><code>A</code></strong> sea una HOF y la función lambda (clausura) tenga un alcance de ejecución más allá de su ámbito de definición?. Una posible propuesta sería la siguiente ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// Ahora el método A es HOF porque retorna una función</span>
<span class="token keyword keyword-static">static</span> <span class="token return-type class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-int">int</span></span> factor <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> n <span class="token operator">=&gt;</span> n <span class="token operator">*</span> factor<span class="token punctuation">;</span>    
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-var">var</span></span> producto <span class="token operator">=</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// A() ha desvuelto el control a Main y se supone que la variable local factor</span>
    <span class="token comment">// ya ha desaparecido. Sin embargo, la clausura que la capturaba aún está </span>
    <span class="token comment">// referenciada por el delegado producto y por tanto aún la podemos ejecutar.</span>
    <span class="token comment">// Al no desaparecer el alcance de ejecución la variable capturada factor aún</span>
    <span class="token comment">// no ha desaparecido de la memoria y tendrá el último valor que se le asignó</span>
    <span class="token comment">// que es 3.</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">producto</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Mostrará 15</span>
<span class="token punctuation">}</span>
</code></pre><div class="admonition summary">
<p class="admonition-title">Resumen</p>
<p>Es momento de realizar una breve recapitulación de conceptos...</p>
<p>En programación funcional (λ-cálculo) se denominan funciones de orden superior (HOF), aquellas que:</p>
<ol>
<li>Reciben como parámetro otra función <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>r</mi><mn>1</mn></msub><mo>→</mo><msub><mi>r</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>→</mo><msub><mi>r</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">(r_1 → r_2) → r_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>Devuelven como parámetro otra función <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mn>1</mn></msub><mo>→</mo><mo stretchy="false">(</mo><msub><mi>r</mi><mn>2</mn></msub><mo>→</mo><msub><mi>r</mi><mn>3</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">r_1 → (r_2 → r_3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li>
<li>O ambas cosas <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>r</mi><mn>1</mn></msub><mo>→</mo><msub><mi>r</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>→</mo><mo stretchy="false">(</mo><msub><mi>r</mi><mn>3</mn></msub><mo>→</mo><msub><mi>r</mi><mn>4</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(r_1 → r_2) → (r_3 → r_4)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>.</li>
</ol>
<p>En C# lo serán a aquellas funciones que reciban o devuelvan un delegado, o ambas cosas.</p>
<ol>
<li>
<p>Reciben un delegado...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> func1 <span class="token operator">=</span> d <span class="token operator">=&gt;</span> d <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> func2 <span class="token operator">=</span> <span class="token punctuation">(</span>func<span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">func</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">// func2 es una HOF</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> a <span class="token operator">=</span> <span class="token function">func2</span><span class="token punctuation">(</span>func1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a = func1(3) + 2 = (3 + 1) + 2 = 6</span>
</code></pre></li>
<li>
<p>Devuelven un delegado...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> suma <span class="token operator">=</span> op1 <span class="token operator">=&gt;</span> op2 <span class="token operator">=&gt;</span> op1 <span class="token operator">+</span> op2<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> a <span class="token operator">=</span>  <span class="token function">suma</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a = (op2 =&gt; 3 + op2)(2) = 3 + 2 = 5</span>
</code></pre></li>
</ol>
</div>
<div style="page-break-after:always;"></div>
<p>Veamos un <strong>par de ejemplos</strong> de uso de este concepto de clausura con una utilidad más concreta pero simplemente para que terminemos de entender el concepto y la terminología ...</p>
<div class="box_bg_lightgray">
<p><strong>Ejemplo 1:</strong></p>
<p>Definiremos una HOF <strong><code>Contador()</code></strong> que me devuelva una clausura que al llamarla me devuelva un contador capturado incrementado.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> <span class="token function">Contador</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token comment">// Devuelvo la clausura que captura el contador i..</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Cada cuenta captura una variable i local diferente por lo que </span>
    <span class="token comment">// llevarán cuentas independientes</span>
    <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span>  cuenta1 <span class="token operator">=</span> <span class="token function">Contador</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Creo un contador</span>
    <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span>  cuenta2 <span class="token operator">=</span> <span class="token function">Contador</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Creo un segundo contador contador</span>

    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">cuenta1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Muestra 1</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">cuenta2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Muestra 1 por ser otro contador</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">cuenta2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Muestra 2</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">cuenta2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Muestra 3</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">cuenta1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Muestra 2</span>
<span class="token punctuation">}</span>
</code></pre></div> <!-- fin ejemplo -->
<div style="page-break-after:always;"></div>
<div class="box_bg_lightgray">
<p><strong>Ejemplo 2:</strong></p>
<p>Definiremos una HOF <strong><code>Potencia(double y)</code></strong> que me permita definir otras funciones que calculen potencias con un</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// HOF que devuelve una clausura que captura el parámetro de entrada 'y'.</span>
<span class="token comment">// Fíjate que estemos definiendo un cuerpo de expresión que se evalúa una </span>
<span class="token comment">// clausura que dada una base 'x' calcula 'x' elevado a la variable capturada 'y'.</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-double">double</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">&gt;</span></span> <span class="token function">Potencia</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-double">double</span></span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">Pow</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Definimos una función que calcula cuadrados pasándole el exponente a capturar.</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-readonly">readonly</span> <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-double">double</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">&gt;</span></span> Cuadrado <span class="token operator">=</span> <span class="token function">Potencia</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Definición análoga para capturar el cubo.</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-readonly">readonly</span> <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-double">double</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">&gt;</span></span> Cubo <span class="token operator">=</span> <span class="token function">Potencia</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">Cuadrado</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// x = 10 elevado a y = 2 mostrará 100</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">Cubo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// x = 10 elevado a y = 3 mostrará 1000</span>
<span class="token punctuation">}</span>
</code></pre><p>🚀 <strong>Ampliación Opcional:</strong> ¿Cómo se implementaría el código anterior en <strong>JavaScript</strong> usando <strong>funciones-λ</strong> y <strong>clausuras</strong>?</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> <span class="token function-variable function">potencia</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">pow</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> cuadrado <span class="token operator">=</span> <span class="token function">potencia</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> cubo <span class="token operator">=</span> <span class="token function">potencia</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">cuadrado</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">cubo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Como vemos <strong>el código es muy similar</strong> pero al <strong>no tener tipos</strong> no necesitamos declarar los tipos de los parámetros ni el tipo de retorno.</p>
</div> <!-- fin ejemplo -->
<div style="page-break-after:always;"></div>
<h3 id="patrón-map-filter-fold">Patrón Map-Filter-Fold </h3>
<p>Si vamos al principio del tema donde definíamos lo que era la programación funcional, decíamos que:</p>
<blockquote>
<p>'<em>La <strong>programación funcional</strong> es un <strong>paradigma de programación declarativa</strong> basado</em>' ...</p>
</blockquote>
<p>Para entender un poco mejor a que se refiere con '<em><strong>programación declarativa</strong></em>', vamos a comparar y resumir de forma sencilla la diferencia entre la programación imperativa y declarativa. Diremos que, en la <strong>imperativa</strong> le decimos nosotros al ordenador <strong>'<em>cómo tiene que hacer algo</em>'</strong> mediante una secuencia de instrucciones que sería más o menos lo que hemos hecho hasta ahora. Sin embargo, en la <strong>declarativa</strong> le decimos al ordenador <strong>'<em>lo que tiene que hacer</em>'</strong>, proporcionándole únicamente las estrategias para hacerlo.</p>
<p>Por poner un ejemplo, <strong>el lenguaje SQL sería declarativo</strong> ya que en él, le decimos al SGBD por ejemplo que seleccione n-tuplas que cumplan un criterio y les aplique una estrategia de agrupación, pero <strong>'<em>no le indicamos cómo tiene que hacerlo</em>'</strong>, de hecho no sabemos cómo lo hace internamente.</p>
<p>Sin entrar en aspectos más teóricos o formales matemáticos como quizá hemos hecho al hablar del λ-cálculo, diremos que <strong>la gran mayoría de lenguajes modernos proporcionan una serie de métodos para trabajar sobre secuencias de datos de forma similar a cómo lo haríamos en SQL aplicando programación funcional</strong>.</p>
<p>En C# estos métodos para trabajar con secuencias (<strong><code>IEnumerable&lt;T&gt;</code></strong>) están definidos como <a href="https://docs.microsoft.com/es-es/dotnet/api/system.linq.enumerable">métodos de extensión</a> en <strong><code>System.Linq</code></strong> como ya comentamos al hablar de este tipo de métodos.</p>
<p>Entre ellos podremos destacar: <strong><code>Select</code></strong>, <strong><code>Where</code></strong>, <strong><code>Agreggate</code></strong>, <strong><code>GroupBy</code></strong>, <strong><code>Distinct</code></strong>, <strong><code>ElementAt</code></strong>, <strong><code>Join</code></strong>, <strong><code>GroupJoin</code></strong>, <strong><code>OrderBy</code></strong>, <strong><code>Reverse</code></strong>, <strong><code>SelectMany</code></strong>, etc. <strong>¿Te suenan?</strong></p>
<p><strong>Map-Filter-Fold</strong> (o también conocido como <strong>Map-Reduce</strong>) es un patrón muy común en programación funcional para <strong>transformar, filtrar y agregar datos en secuencias</strong> que utiliza alguna de las funciones de extensión definidas para trabajar con secuencias en C#. En concreto, <strong>Select-Where-Aggregate</strong>.</p>
<p>Vamos a encontrarlo en numerosos lenguajes tan populares como <strong>JavaScriprt</strong>, <strong>Java</strong>, <strong>Python</strong>, <strong>Kotlin</strong>, <strong>Rust</strong>, etc y que permite hacer operaciones declarativas sobre secuencias de elementos de forma análoga a SQL.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Detrás de este patrón hay una gran teoría matemática aunque nosotros la vamos a obviar y vamos a tratar de explicar las operaciones de forma más didáctica. Si quieres profundizar en el tema puedes seguir los enlaces en el tema.</p>
<p>Además, durante el resto del tema <strong>vamos a utilizar la siguiente notación</strong> para representar secuencias (colecciones) y objetos...</p>
<ul>
<li><strong>Corchetes</strong> para secuencias <strong>[</strong> e1, e2, e3, ..., en <strong>]</strong> o <strong>Sec[</strong> e1, e2 <strong>]</strong></li>
<li><strong>Llaves</strong> para objetos <strong>{</strong> Propiedad1=valor1, Porpiedad2=valor2 <strong>}</strong></li>
</ul>
</div>
<h4 id="map-o-select">Map (o Select) </h4>
<p><strong><a href="https://en.wikipedia.org/wiki/Map_(higher-order_function)">Map</a></strong> es una HOF que aplica una función única de '<em>mapeo</em>' o <strong>transformación</strong> a cada elemento de la secuencia y devuelve una nueva secuencia que contiene los resultados de la transformación en el mismo orden de la secuencia de entrada.</p>
<p>A lo largo de este tema vamos a ejemplificar los conceptos de forma genérica con emojis, porque realmente es un concepto abstracto y estos nos ayudarán a entender la abstracción de forma didáctica.<br>
Supongamos que representamos <strong>map</strong> con la expresión <strong>map = (A → B) × Sec[A] → Sec[B]</strong> donde:</p>
<ul>
<li><strong>A</strong> son productos en crudo o sin procesar.<br>
Ej. el maíz 🌽.</li>
<li><strong>B</strong> son productos cocinados o procesados.<br>
Ej. las palomitas de maíz 🍿.</li>
<li><strong>A → B</strong> sería la función que cocina o <strong>transforma</strong> un producto en crudo en un producto cocinado y la podemos llamar por ejemplo <strong>cook</strong>. Esta función se pasará como parámetro a la función <strong>map</strong> (por eso <strong>map</strong> es una HOF).<br>
Ej. <strong>cook(🌽) → 🍿</strong>.</li>
<li><strong>Sec[A]</strong> seria la secuencia de <strong>entrada</strong> de la función <strong>map</strong> de productos en crudo.<br>
Ej. [🐮, 🐟, 🍠, 🐔, 🌽]</li>
<li><strong>Sec[B]</strong> seria la secuencia de <strong>salida</strong> de la función <strong>map</strong> de productos ya cocinados o procesados por la función <strong>cook</strong>.<br>
Ej. [🍔, 🍥, 🍟, 🍗, 🍿]</li>
</ul>
<p>Con lo cual podríamos decir que, <strong>map = cook × ProductosCrudos → ProductosCocinados</strong>. Esto es, map dada una secuencia de productos en crudo le aplica a cada producto la <strong>función de transformación</strong> cocinar y me dará como resultado una secuencia de productos cocinados.<br>
Ej. <strong>[🐮, 🐟, 🍠, 🐔, 🌽].map(cook) → [🍔, 🍥, 🍟, 🍗, 🍿]</strong></p>
<p>En C# lo aplicaremos a través del método extensor <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.linq.enumerable.select">Select</a></strong> ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// Se aplica a secuencia de entrada IEnumerable&lt;A&gt;</span>
<span class="token comment">// A cada elemento de la secuencia de entrada se le aplica el 'mapeo' A =&gt; B</span>
<span class="token comment">// Retorna una secuencia de salida IEnumerable&lt;B&gt; con los </span>
<span class="token comment">// elementos de la secuencia de entrada mapeados.</span>
<span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>B<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">Select</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>A<span class="token punctuation">,</span> B<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>A<span class="token punctuation">&gt;</span></span> source<span class="token punctuation">,</span> <span class="token class-name">Func<span class="token punctuation">&lt;</span>A<span class="token punctuation">,</span> B<span class="token punctuation">&gt;</span></span> mapeoDeAenB<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Veamos su uso a través de un ejemplo sencillo donde transformamos una secuencia de números reales en su equivalente entero. '<em>Mapeando</em>' de real a entero cada uno de elementos de la secuencia de entrada.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// Dada la siguiente secuencia de números reales</span>
<span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> reales <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.5</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">8.7</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Aplicamos la función ToInt32 que cumple con el tipo delegado Func&lt;double, int&gt;</span>
<span class="token comment">// para transformar la secuencia a enteros.</span>
<span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> enteros <span class="token operator">=</span> reales<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>Convert<span class="token punctuation">.</span>ToInt32<span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> enteros<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="filter-o-where">Filter (o Where) </h4>
<p><strong><a href="https://en.wikipedia.org/wiki/Filter_(higher-order_function)">Filter</a></strong> es una HOF que aplica un predicado a cada elemento de la secuencia de entrada y devuelve una secuencia de salida con los elementos en la secuencia que cumplen el predicado.</p>
<p>Supongamos que representamos <strong>filter</strong> con la expresión <strong>filter = (A → bool) × Sec[A] → Sec[A']</strong> donde:</p>
<ul>
<li><strong>A</strong> son productos cocinados o preparados.<br>
Ej. una hamburguesa 🍔.</li>
<li><strong>A → bool</strong> sería el predicado que evalúa si los elementos de <strong>A</strong> cumplen un determinado criterio o no. Este predicado se pasará como parámetro a la función <strong>filter</strong>.<br>
Ej. <strong>isVegetarian(🍔) → false</strong>.</li>
<li><strong>Sec[A]</strong> seria la secuencia de <strong>entrada</strong> de la función <strong>filter</strong> de productos ya cocinados.<br>
Ej.  [🍔, 🍥, 🍟, 🍗, 🍿]</li>
<li><strong>Sec[A']</strong> seria la secuencia de <strong>salida</strong> de la función <strong>filter</strong> de productos ya cocinados que cumplen el predicado <strong>isVegetarian</strong>, esto es, <em><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>⊆</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">A' \subseteq A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879em;vertical-align:-0.136em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span></em>.<br>
Ej. [🍟, 🍿]</li>
</ul>
<p>Con lo cual podríamos decir que, <strong>filter = isVegetarian × ProductosCocinados → ProductosCocinadosVegetarianos</strong>. Esto es, filter dada una secuencia de productos ya cocinados me devolverá aquellos que sean vegetarianos.<br>
Ej. <strong>[🍔, 🍥, 🍟, 🍗, 🍿].filter(isVegetarian) → [🍟, 🍿]</strong></p>
<p>En C# lo aplicaremos a través del método extensor <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.linq.enumerable.where">Where</a></strong> ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// Dada la siguiente secuencia de enteros.</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> enteros <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Filtramos aquellos que sean pares...</span>
<span class="token comment">// 1. Definimos el predicado para ver si un número es par.</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-bool">bool</span><span class="token punctuation">&gt;</span></span> esPar <span class="token operator">=</span> n <span class="token operator">=&gt;</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">// 2. Aplicamos el predicado a la función where</span>
<span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> enterosPares <span class="token operator">=</span> enteros<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>esPar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> enterosPares<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="fold-o-aggregate">Fold (o Aggregate) </h4>
<p><strong><a href="https://en.wikipedia.org/wiki/Fold_(higher-order_function)">Fold</a></strong> es una HOF también conocida como <strong>reduce</strong>, <strong>aggregate</strong>, <strong>accumulate</strong>, etc. que '<em>combina</em>' los elementos de la secuencia de entrada reduciéndolos a un único elemento de retorno. Para obtener este elemento de retorno necesitaremos una función binaria que combine los elementos de la secuencia en dicho elemento de retorno que normalmente tendrá un estado inicial.</p>
<p>Supongamos que representamos <strong>fold</strong> con la expresión <strong>fold = (B × A → B) × Sec[A] × B → B</strong> donde:</p>
<ul>
<li>
<p><strong>B</strong> es el elemento de retorno el cual tomará un valor inicial.<br>
Ej. Pepe que <strong>inicialmente</strong> está hambriento y cansado 😫 pero puede tener otros estados como satisfecho 😋</p>
</li>
<li>
<p><strong>A</strong> son los productos cocinados o preparados.<br>
Ej. la hamburguesa de vacuno 🍔</p>
</li>
<li>
<p><strong>Sec[A]</strong> obviamente es una secuéncia de productos cocinados o preparados.<br>
Ej. [🍔, 🍥, 🍟, 🍗, 🍿]</p>
</li>
<li>
<p><strong>B × A → B</strong> función binaria que combina <strong>B</strong> con <strong>A</strong> y se evalúa a <strong>B</strong>.<br>
Ej. En nuestro ejemplo, esta función de combinación puede ser <strong>eat(😫, 🍔) → 😋</strong> donde el resultado de combinar a 😫(Pepe hambriento) con la 🍔 (hamburguesa) sería 😋(Pepe satisfecho). Ojo!, que también puede pasar que al comer (combinar), el estado de pepe no cambie y siga hambriento <strong>eat(😫, 🍔) → 😫</strong></p>
<p>En otras palabras, <strong>eat</strong> es una función de plegado (<strong>fold</strong>), reducción (<strong>reduce</strong>), agregación (<strong>aggregate</strong>), etc. de la hamburguesa sobre Pepe y que me da como resultado al propio Pepe con menos hambre o saciado...</p>
</li>
</ul>
<p>Con lo cual podríamos decir que, <strong>fold = come × ProductosCocinados × PepeHambriento → PepeSatisfecho</strong>. Esto es, fold dado un Pepe hambriento y una secuencia de productos cocinados, me devolverá un Pepe satisfecho.<br>
Ej. <strong>[🍟, 🍿].fold(😫, eat) → 😋</strong></p>
<p>En C# lo aplicaremos a través de las sobrecargas del método extensor <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.linq.enumerable.aggregate">Aggregate</a></strong> ...</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p><strong><code>System.Linq</code></strong> nos proporciona muchas funciones de agregación ya implementadas como métodos de extension sobre secuencias tales como: <strong>Sum</strong>, <strong>Max</strong>, <strong>Min</strong>, <strong>Average</strong>, o <strong>Count</strong>. Quen realidad son casos particulares de <strong><code>Aggregate</code></strong> que se nos darán un 90% de las ocasiones. Evitando así la complejidad de tener que definir la función de agregación.</p>
</div>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// Dada la siguiente secuencia de notas enteras</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> notas <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Cuenta las notas mayores o iguales a 5.</span>
<span class="token comment">// 1. Definimos la función binaria de agregación que vamos apasar a Aggregate....</span>
<span class="token comment">//    c -&gt; Es el contador.</span>
<span class="token comment">//    n -&gt; Es un elemento de la secuencia (una nota).</span>
<span class="token comment">//    Se evalúa a la cuenta incremetada o sin incrementar dependiendo de</span>
<span class="token comment">//    si nota &gt;= 5 o no.</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> cuentaAprobados <span class="token operator">=</span> <span class="token punctuation">(</span>c<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> n <span class="token operator">&gt;=</span> <span class="token number">5</span> <span class="token punctuation">?</span> c <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">:</span> c<span class="token punctuation">;</span>

<span class="token comment">// 2. Aplicamos la HOF de agregación, pasándole el valor inicial de la cuenta y </span>
<span class="token comment">//    la función agregadora.</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> aprobados <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> cuentaAprobados<span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Total aprobados: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">aprobados</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><strong><code>Aggregate</code></strong> por defecto recorrerá la secuencia de izquierda a derecha y para el caso anterior de contar aprobados nos daría igual. Sin embargo, muchos lenguajes funcionales ofrecen ambas posibilidades:</p>
<ul>
<li><strong><code>foldl</code></strong>: (fold left) Recorre como <strong><code>Aggregate</code></strong> de izquierda a derecha.</li>
<li><strong><code>foldr</code></strong>: (fold right) Recorre la secuencia de derecha a izquierda.</li>
</ul>
<p>Veamos una ejemplo de como hacerlo en C#. Para ello, vamos a suponer que queremos implementar el método de utilidad definido en la clase <strong><code>String</code></strong> y que hemos usado muchas veces a lo largo del curso. <strong><code>string.Join(string? separador, IEnumerable&lt;string?&gt; textos)</code></strong>.</p>
<p>Si nos fijamos cumple con <strong>(B × A → B) × Sec[A] × B → B</strong> pero ahora no obtendremos el mismo resultado si hacemos <strong><code>foldl</code></strong> o <strong><code>foldr</code></strong> ...</p>
<ul>
<li>
<p><strong>A</strong> Serán una palabra (<strong><code>String</code></strong>) a concatenar.</p>
</li>
<li>
<p><strong>Sec[A]</strong> Será la secuencia de palabras a concatenar.</p>
</li>
<li>
<p><strong>B</strong> Ahora el tipo <em>'agregador'</em> sería un <strong><code>StringBuilder</code></strong> donde vamos a concatenar todas las palabras con el separador adecuado.</p>
<ol>
<li>Valor inicial será <strong><code>new StringBuilder(palabras.Length &gt; 0 ? palabras.First() : ""</code></strong>, esto es, un <strong><code>StringBuilder</code></strong> vacío si la secuencia esta vacía o uno que contenga la primera palabra de la misma si contiene alguna.</li>
<li>Valor final será el <strong><code>StringBuilder</code></strong> inicial <strong><code>B</code></strong> al que le he concatenado todas las palabras por la derecha.</li>
</ol>
</li>
<li>
<p><strong>(B × A → B)</strong> La función binaria de agregación será de tipo <strong><code>Func&lt;StringBuilder, string, StringBuilder&gt;</code></strong> y recibirá el <strong><code>StringBuilder</code></strong> <strong><code>B</code></strong> con lo que llevo de la cadena concatenada, la siguiente palabra <strong>A</strong> a concatenar con el separador y retornará el <strong><code>StringBuilder</code></strong> <strong>B</strong> con la palabra concatenada por la derecha.</p>
</li>
</ul>
<p>Podemos resumir de forma simple que <strong><code>Join</code></strong> se comporta como <strong><code>foldl</code></strong> porque entra una secuencia de cadenas y devuelve un único tipo resultado de concatenar las cadenas con un separador determinado.</p>
<p>La única diferencia es que <strong><code>Join</code></strong> devuelve un <strong><code>string</code></strong> y nosotros vamos a devolver un <strong><code>StringBuilder</code></strong> por eficiencia.</p>
<p>Veamos pues nuestra propuesta de implementación de <strong><code>Join</code></strong> con un <strong><code>Aggregate</code></strong> (<strong><code>foldr</code></strong>) en C# ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// Definimos la secuencia</span>
<span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> palabras <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"Once"</span><span class="token punctuation">,</span> <span class="token string">"upon"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"time"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Definimos el separador que será una variable capturada en la función lambda.</span>
<span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> separador <span class="token operator">=</span> <span class="token string">" "</span><span class="token punctuation">;</span>

<span class="token comment">// Función lambda agregadora concatena...</span>
<span class="token comment">//  Si la palabra a concatenar no es nula y no coincide con el valor inicial de la </span>
<span class="token comment">//  concatenación o en otras palabras es la primera palabra de la secuencia la </span>
<span class="token comment">//  concatenamos con el valor del separador capturado.</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span>StringBuilder<span class="token punctuation">,</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">,</span> StringBuilder<span class="token punctuation">&gt;</span></span> concatena <span class="token operator">=</span> 
<span class="token punctuation">(</span>f<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>p <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span> <span class="token operator">&amp;&amp;</span> f<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> p <span class="token punctuation">?</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">separador</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">p</span><span class="token punctuation">}</span></span><span class="token string">"</span></span> <span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">StringBuilder</span> frase <span class="token operator">=</span> palabras<span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span>
                        <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span>palabras<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">?</span> palabras<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                        concatena<span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>frase<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Mostrará "Once upon a time"</span>
</code></pre><p>pero...¿y si quisiéramos hacer un <strong><code>foldr</code></strong> en C#?. Sería '<em>tan simple</em>' como <strong>invertir la secuencia de entrada</strong> con <strong><code>Reverse()</code></strong> y el lugar de tomar la primera ocurrencia (<strong><code>First</code></strong>) de la secuencia para inicializar nuestro <strong><code>StringBuilder</code></strong>, tomaríamos la última <strong><code>Last</code></strong>.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">StringBuilder</span> frase <span class="token operator">=</span> palabras
                    <span class="token punctuation">.</span><span class="token function">Reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span>
                        <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span>palabras<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">?</span> palabras<span class="token punctuation">.</span><span class="token function">Last</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                        concatena<span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>frase<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Mostrará "time a upon Once"</span>
</code></pre><p><strong><code>Aggregate</code></strong> además tiene varias sobrecargas y vamos a comentar una de ellas que nos puede ser interesante en este caso.</p>
<p>Si vamos a ver la definición de <strong><code>Aggregate</code></strong> para el uso anterior tendremos el siguiente interfaz que ya deberíamos entender...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// TSource es la parametrización de A</span>
<span class="token comment">// TAccumulate es la parametrización de B</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">TResult</span> <span class="token generic-method"><span class="token function">Aggregate</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TSource<span class="token punctuation">,</span> TAccumulate<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
        <span class="token keyword keyword-this">this</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">&gt;</span></span> source<span class="token punctuation">,</span>               <span class="token comment">// Sec[A]</span>
        <span class="token class-name">TAccumulate</span> seed<span class="token punctuation">,</span>                               <span class="token comment">// B (inicial)</span>
        <span class="token class-name">Func<span class="token punctuation">&lt;</span>TAccumulate<span class="token punctuation">,</span> TSource<span class="token punctuation">,</span> TAccumulate<span class="token punctuation">&gt;</span></span> func<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// B × A → B</span>
</code></pre><p>Sin embargo, tenemos también la sobrecarga ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">TResult</span> <span class="token generic-method"><span class="token function">Aggregate</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TSource<span class="token punctuation">,</span> TAccumulate<span class="token punctuation">,</span> TResult<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
        <span class="token keyword keyword-this">this</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">&gt;</span></span> source<span class="token punctuation">,</span> 
        <span class="token class-name">TAccumulate</span> seed<span class="token punctuation">,</span> 
        <span class="token class-name">Func<span class="token punctuation">&lt;</span>TAccumulate<span class="token punctuation">,</span> TSource<span class="token punctuation">,</span> TAccumulate<span class="token punctuation">&gt;</span></span> func<span class="token punctuation">,</span> 
        <span class="token class-name">Func<span class="token punctuation">&lt;</span>TAccumulate<span class="token punctuation">,</span> TResult<span class="token punctuation">&gt;</span></span> resultSelector<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>donde aparece otra nuevo tipo parametrizado <strong><code>TResult</code></strong> y función de entrada <strong><code>Func&lt;TAccumulate, TResult&gt; resultSelector</code></strong> que una vez realizado todo el proceso de <strong>'<em>fold</em>'</strong> me transformará (mapeará) mi <strong><code>TAccumulate</code></strong> final en un <strong><code>TResult</code></strong>.</p>
<p>En nuestro ejemplo, al definir el <strong><code>TAccumulate</code></strong> como un <strong><code>StringBuilder</code></strong> por optimización, el resultado del <strong><code>Aggregate</code></strong> será un <strong><code>StringBuilder</code></strong> y no un <strong><code>string</code></strong> como nos proporcionaría el <strong><code>string.Join(...)</code></strong>. Pero la función de mapeo <strong><code>Func&lt;TAccumulate, TResult&gt; resultSelector</code></strong> nos permitirá convertir el <strong><code>StringBuilder</code></strong> a un <strong><code>string</code></strong> con <strong><code>sb =&gt; sb.ToString()</code></strong> y será lo que terminará devolviendo <strong><code>Aggregate</code></strong>.</p>
<p>Nuestra expresión equivalente al <strong><code>Join</code></strong> haciendo un <strong><code>Aggregate</code></strong> (<strong><code>foldl</code></strong>) finalmente quedaría ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> palabras <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"Once"</span><span class="token punctuation">,</span> <span class="token string">"upon"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"time"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> separador <span class="token operator">=</span> <span class="token string">" "</span><span class="token punctuation">;</span>

<span class="token comment">// Con Join</span>
<span class="token class-name"><span class="token keyword keyword-string">string</span></span> frase <span class="token operator">=</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>separador<span class="token punctuation">,</span> palabras<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Con Aggregate</span>
<span class="token class-name"><span class="token keyword keyword-string">string</span></span> frase <span class="token operator">=</span> palabras<span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span>palabras<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">?</span> palabras<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token punctuation">(</span>f<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> p <span class="token operator">&amp;&amp;</span> p <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span> <span class="token punctuation">?</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">separador</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">p</span><span class="token punctuation">}</span></span><span class="token string">"</span></span> <span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    sb <span class="token operator">=&gt;</span> sb<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>frase<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Fíjate que en esta ocasión hemos pasado las funciones de agregación y mapeo directamente a <strong><code>Aggregate</code></strong> en lugar de asignarlas previamente a un delegado. Esto es posible porque <strong>C# es capaz de deducir los tipos</strong> de <strong><code>(f, p) =&gt;</code></strong> y de <strong><code>sb =&gt;</code></strong> a partir del tipo de la secuencia <strong><code>palabras</code></strong> y el tipo del objeto que le pasamos como acumulador.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Obviamente en este caso, es muchísimo más simple utilizar la función ya implementada <strong><code>Join</code></strong>. Pero hemos puesto este ejemplo, además de para ver el concepto de <strong><code>foldl</code></strong> y <strong><code>foldr</code></strong>, para entender la potencia de esta función si entendemos bien lo potente que es esta operación conceptualmente.<br>
De momento la hemos usado para cosas tan diferentes como: que Pepe coma 😋, contar aprobados o concatenar palabras con un separador.</p>
</div>
<h4 id="combinando-las-tres-operaciones">Combinando las tres operaciones </h4>
<p>Podemos combinar dichas operaciones para realizar nuestro proceso en una única función de forma declarativa.</p>
<p>Imaginemos nuestro ejemplo en que queremos alimentar a Pepe, que recordemos que es vegetariano y partimos de un montón de productor en crudo. Podríamos hacer...</p>
<p><strong>[🐮, 🐟, 🍠, 🐔, 🌽].map(cook).filter(isVegetarian).fold(😫, eat) → 😋</strong></p>
<p>Esto equivaldría a las operaciones anteriores de forma encadenada. Donde la secuencia de salida de una función pasa a ser la de entrada de la siguiente [🐮, 🐟, 🍠, 🐔, 🌽] → [🍔, 🍥, 🍟, 🍗, 🍿] → [🍟, 🍿] → 😋</p>
<div class="admonition tip">
<p class="admonition-title">Importante</p>
<p>Sin embargo es importante preguntarnos si el orden de aplicación es eficiente. Fíjate que en este caso, <strong>hemos tenido que <em>'cocinar'</em> todos los alimentos aunque realmente Pepe solo se ha comido dos</strong> de ellos. Este proceso hubiera sido muchísimo más eficiente si hubieramos cocinado solo aquellos que <em>'son vegetales'</em> [🐮, 🐟, 🍠, 🐔, 🌽] → [🍠, 🌽] → [🍟, 🍿] → 😋, esto es, haciendo el filtrado antes que la transformación ...</p>
<p><strong>[🐮, 🐟, 🍠, 🐔, 🌽].filter(isVegetarian).map(cook).fold(😫, eat) → 😋</strong></p>
<p><strong>Nota:</strong> Esto último sería posible solo si la función de filtrado ahora tuviese como conjunto <strong>A</strong> a los productos crudos o una <strong>abstracción</strong> de ambos,  es decir, si se pudiera saber si un productos '<strong>es vegetal</strong>' independientemente de si está cocinado o no <strong>isVegetarian(🌽) → true</strong> y <strong>isVegetarian(🍿) → true</strong></p>
</div>
<p><strong>Ejemplo:</strong> Imaginemos que queremos saber el total de aprobados de una lista de notas con decimales.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// Select (map):      Transforma de double a double sin decimales. </span>
<span class="token comment">//                    Puesto que Math.Round tiene varias sobrecargas, deberemos indicar </span>
<span class="token comment">//                    mediante un cast que queremos una función del tipo A → B</span>
<span class="token comment">//</span>
<span class="token comment">// Where (filter):    Filtramos aquellas notas que que cumplen el predicado n &gt;= 5d</span>
<span class="token comment">//</span>
<span class="token comment">// Aggregate (fold):  Vamos a llevar una cuenta en c empezando en 0d y al final del proceso </span>
<span class="token comment">//                    convertimos la cuenta real en un valor entero. Esto último no sería </span>
<span class="token comment">//                    necesario, si el valor inicial de la cuenta hubiera sido un literal </span>
<span class="token comment">//                    entero, pero lo hacemos así para ves un ejemplo de uso de resultSelector.</span>

<span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> notas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">6.7</span><span class="token punctuation">,</span> <span class="token number">8.7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> aprobados <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Func<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>Math<span class="token punctuation">.</span>Round<span class="token punctuation">)</span>
                     <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">&gt;=</span> <span class="token number">5d</span><span class="token punctuation">)</span>
                     <span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span><span class="token number">0d</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>c<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> c <span class="token operator">=&gt;</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Aprobados: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">aprobados</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Puesto que cosas como contar elementos en usa secuencia, acumular en una suma, buscar un máximo, etc. son casos típicos de fold, ya vienen predefinidos en C# y no tendríamos que implementarlos a través de Aggregate</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-int">int</span></span> aprobados <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Func<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>Math<span class="token punctuation">.</span>Round<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">&gt;=</span> <span class="token number">5d</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Fíjate que es bastante similar a SQL, una posible consulta para hacer lo mismo en SQL.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token function">ROUND</span><span class="token punctuation">(</span>nota<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> aprobados <span class="token keyword keyword-FROM">FROM</span> notas <span class="token keyword keyword-where">where</span> <span class="token function">ROUND</span><span class="token punctuation">(</span>nota<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre><div class="admonition tip">
<p class="admonition-title">Importante</p>
<p>Fíjate que <strong>en este caso no podemos filtrar antes</strong> de hacer el mapeo puesto que el resultado sería diferente. Piensa que <strong><code>4.6</code></strong> después del <strong><code>Round</code></strong> será <strong><code>5</code></strong> y contará como aprobado.</p>
</div>
<div style="page-break-after:always;"></div>
<div class="box_bg_lightgray">
<p>🚀 <strong>Ampliación opcional:</strong></p>
<p>Cómo hemos dicho este patrón existirá de forma similar en otros lenguajes y seguramente sin saber la sintaxis de otros lenguajes seguramente podemos entender el código equivalente en lenguajes tan populares como:</p>
<div class="row">
<div class="col-sm-6">
<p><strong>JavaScript:</strong></p>
<pre data-role="codeBlock" data-info="JavaScript" class="language-javascript JavaScript"><code><span class="token keyword keyword-let">let</span> notas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">6.7</span><span class="token punctuation">,</span> <span class="token number">8.7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword keyword-let">let</span> aprobados <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token property-access">round</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">n</span> <span class="token arrow operator">=&gt;</span> n <span class="token operator">&gt;=</span> <span class="token number">5</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token method function property-access">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Aprobados: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>aprobados<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="col-sm-6">
<p><strong>Python:</strong></p>
<pre data-role="codeBlock" data-info="Python" class="language-python Python"><code><span class="token keyword keyword-from">from</span> functools <span class="token keyword keyword-import">import</span> <span class="token builtin">reduce</span>
notas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">6.7</span><span class="token punctuation">,</span> <span class="token number">8.7</span><span class="token punctuation">]</span>
aprobados <span class="token operator">=</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword keyword-lambda">lambda</span> c<span class="token punctuation">,</span> n<span class="token punctuation">:</span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> 
                    <span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token keyword keyword-lambda">lambda</span> n<span class="token punctuation">:</span> n <span class="token operator">&gt;=</span> <span class="token number">5</span><span class="token punctuation">,</span> 
                            <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">,</span> notas<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Aprobados: </span><span class="token interpolation"><span class="token punctuation">{</span>aprobados<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre></div>
<div class="col-sm-6">
<p><strong>Kotlin:</strong></p>
<pre data-role="codeBlock" data-info="Kotlin" class="language-kotlin Kotlin"><code><span class="token keyword keyword-val">val</span> notas <span class="token operator">=</span> <span class="token function">doubleArrayOf</span><span class="token punctuation">(</span>
    <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">6.7</span><span class="token punctuation">,</span> <span class="token number">8.7</span>
<span class="token punctuation">)</span>
<span class="token keyword keyword-val">val</span> aprobados <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span>
                <span class="token punctuation">.</span><span class="token function">filter</span> <span class="token punctuation">{</span> it <span class="token operator">&gt;=</span> <span class="token number">5</span> <span class="token punctuation">}</span>
                <span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> acc<span class="token punctuation">,</span> _ <span class="token operator">-&gt;</span> acc <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token function">println</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"Aprobados: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">aprobados</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre></div>
<div class="col-sm-6">
<p><strong>Java:</strong></p>
<pre data-role="codeBlock" data-info="Java" class="language-java Java"><code><span class="token keyword keyword-var">var</span> notas <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>
    <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">6.7</span><span class="token punctuation">,</span> <span class="token number">8.7</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-long">long</span> aprobados <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>n <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token keyword keyword-double">double</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>n <span class="token operator">-&gt;</span> n <span class="token operator">&gt;=</span> <span class="token number">5</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>c<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Aprobados: "</span> <span class="token operator">+</span> aprobados<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="col-sm-6">
<p><strong>Rust:</strong></p>
<pre data-role="codeBlock" data-info="Rust" class="language-rust Rust"><code><span class="token keyword keyword-let">let</span> notas <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">6.7</span><span class="token punctuation">,</span> <span class="token number">8.7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword keyword-let">let</span> aprobados <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>n<span class="token closure-punctuation punctuation">|</span></span> n<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-as">as</span> <span class="token keyword keyword-i32">i32</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>n<span class="token closure-punctuation punctuation">|</span></span> n <span class="token operator">&gt;=</span> <span class="token number">5</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>c<span class="token punctuation">,</span> _<span class="token closure-punctuation punctuation">|</span></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="col-sm-6">
<p>Como vemos iumplementan este patrón muchos lenguajes, aunque con ligeras diferencias sintácticas. Siendo las más similares a C# las de <strong>JavaScript</strong> y <strong>Kotlin</strong>.</p>
</div>
</div>
</div> <!-- fin ampliación -->
<div style="page-break-after:always;"></div>
<h3 id="otras-operaciones-funcionales-declarativas-en-c">Otras operaciones funcionales declarativas en C# </h3>
<p>Ya hemos visto que <strong><code>Select</code></strong>, <strong><code>Where</code></strong>, <strong><code>Aggregate</code></strong>, <strong><code>Count</code></strong> y sin duda estas operaciones como hemos mencionado nos deben <em>'sonar'</em> de SQL. Pero..., ¿Existen otras operaciones equivalentes a las que podemos encontrar en SQL?.</p>
<p>la respuesta es <strong>sí</strong> y vamos ver algunas de ellas ...</p>
<h4 id="orderbyorderbydescending">OrderBy/OrderByDescending </h4>
<p>Ordena de manera ascendente/descendente los elementos de una secuencia en función de una clave.</p>
<p>Los tipos deben ser <strong>comparables</strong>. Si no lo son, necesitará de un objeto que implemente el interfaz <strong><code>IComparer&lt;T&gt;</code></strong> entre dos elementos del tipo de la clave por la que hemos decidido ordenar.</p>
<h4 id="distinct">Distinct </h4>
<p>Elimina valores repetidos o duplicados en una secuencia.</p>
<p>El tipo de datos de la secuencia deberá implementar <strong><code>IEquatable</code></strong> para poder comparar en igualdad los elemento de la secuencia o deberemos pasarle un objeto que implemente un interfaz de comparación.</p>
<p><strong>Por ejemplo</strong>, imaginemos que queremos saber la mayor nota redondeada de la siguiente secuencia...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> notas <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">7.2</span><span class="token punctuation">,</span> <span class="token number">7.6</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">8.7</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><p>Podíamos usar un <strong><code>Aggregate</code></strong> para obtener el máximo o usar la función <strong><code>Max</code></strong> que hace la operación específica de la siguiente forma.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-int">int</span></span> notaMayor <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span>
                        <span class="token keyword keyword-double">double</span><span class="token punctuation">.</span>MinValue<span class="token punctuation">,</span> 
                        <span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> n <span class="token operator">&gt;</span> <span class="token class-name">m <span class="token punctuation">?</span></span> n <span class="token punctuation">:</span> m<span class="token punctuation">,</span> 
                        n <span class="token operator">=&gt;</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">Round</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// o también                         </span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> notaMayor <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">Round</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"La nota redondeada mayor es </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">notaMayor</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>En este caso también sería bastante similar a un posible consulta en SQL.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span><span class="token function">ROUND</span><span class="token punctuation">(</span>nota<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> notaMayor <span class="token keyword keyword-FROM">FROM</span> notas<span class="token punctuation">;</span>
</code></pre><p>Aunque más ineficiente, también podríamos usar <strong><code>Distinct</code></strong> y <strong><code>OrderBy</code></strong> de la siguiente manera ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> notas <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">7.2</span><span class="token punctuation">,</span> <span class="token number">7.6</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">8.7</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> notaMayor <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">Round</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   
                        <span class="token comment">// 1. Redondeamos las notas de la secuencia a su valor entero.</span>
                        <span class="token punctuation">.</span><span class="token function">Distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                    
                        <span class="token comment">// 2. Eliminamos de la secuencia las notas repetidas.</span>
                        <span class="token punctuation">.</span><span class="token function">OrderByDescending</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n<span class="token punctuation">)</span>                     
                        <span class="token comment">// 3. Ordenamos la secuencia de en orden descendiente, esto es, </span>
                        <span class="token comment">// la nota mayor es la primera.</span>
                        <span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                      
                        <span class="token comment">// 4. Obtenemos el primer elemento de la secuencia.</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"La nota redondeada mayor es </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">notaMayor</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Fíjate que aunque es un poco más enrevesada, también tenemos una equivalencia en SQL.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-DISTINCT">DISTINCT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span>nota<span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> notaMayor <span class="token keyword keyword-FROM">FROM</span> notas <span class="token keyword keyword-ORDER">ORDER</span> <span class="token keyword keyword-BY">BY</span> notaMayor <span class="token keyword keyword-DESC">DESC</span> <span class="token keyword keyword-LIMIT">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="contenedor">
    <div class="fondo">
        <div class="abre_comilla">"</div>
        <div class="cierra_comilla">"</div>
        <div class="cita">The earlier you catch defects, the cheaper they are to fix.</div>
        <div class="autor">- David Farley</div>
    </div>
</div>
<div style="page-break-after:always;"></div>
<h4 id="groupby">GroupBy </h4>
<p>Agrupa los elementos de una secuencia según una función del selector de claves especificada y crea un valor de resultado a partir de cada grupo y su clave. Los elementos de cada grupo se proyectan utilizando una función determinada.</p>
<p>Existen diferentes sobrecargas posibles para usar la agrupación. Nosotros vamos a usar esta pues es la más '<em>intuitiva</em>'...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>TResult<span class="token punctuation">&gt;</span></span> <span class="token function">GroupBy</span><span class="token punctuation">(</span>
                    <span class="token keyword keyword-this">this</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">&gt;</span></span> source<span class="token punctuation">,</span>
                    <span class="token class-name">Func<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">,</span> TKey<span class="token punctuation">&gt;</span></span> keySelector<span class="token punctuation">,</span> 
                    <span class="token class-name">Func<span class="token punctuation">&lt;</span>TKey<span class="token punctuation">,</span> IEnumerable<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">&gt;</span><span class="token punctuation">,</span> TResult<span class="token punctuation">&gt;</span></span> resultSelector<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Veamos como interpretarla:</p>
<ul>
<li><strong><code>keySelector</code></strong> será la función del selector de claves por las que agruparé la secuencia:
<ul>
<li><strong>Recibe</strong>: <code>TSource</code> que es el tipo de la secuencia a procesar.</li>
<li><strong>Devuelve</strong>:  <code>TKey</code> tipo la clave resultado del mapeo de TSource por que que voy a agrupar.</li>
</ul>
</li>
<li><strong><code>resultSelector</code></strong> será la función que proyecta los elemento de cada grupo con su clave:
<ul>
<li><strong>Recibe</strong>: <code>Tkey</code> con la clave por la que agrupo y la agrupación de los objetos <code>TSource</code> para esa clave.</li>
<li><strong>Devuelve</strong>: <code>TResult</code> con lo que quiero producir en la nueva secuencia resultado de la agrupación.</li>
</ul>
</li>
</ul>
<p>Bueno, hasta ahora ha sido una definición muy formal, pero vamos ha hacerlo con un ejemplo más sencillo para entenderlo. Supongamos nuestro array de notas anterior...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> notas <span class="token operator">=</span>  <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">7.2</span><span class="token punctuation">,</span> <span class="token number">7.6</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">8.7</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><p>Queremos agrupar el valor de las notas sin decimales y contabilizar el número de apariciones de las mismas.</p>
<p>Si estuviéramos en MySQL una posible consulta para resolverlo sería...</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql sql"><code><span class="token keyword keyword-SELECT">SELECT</span> FLOOR<span class="token punctuation">(</span>nota<span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> notaRedondeada<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> veces 
<span class="token keyword keyword-FROM">FROM</span> notas <span class="token keyword keyword-GROUP">GROUP</span> <span class="token keyword keyword-BY">BY</span> notaRedondeada <span class="token keyword keyword-ORDER">ORDER</span> <span class="token keyword keyword-BY">BY</span> notaRedondeada<span class="token punctuation">;</span>
</code></pre><p>El equivalente utilizando la programación funcional y el <strong><code>GroupBy</code></strong> de C# sería ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-string">string</span></span> salida <span class="token operator">=</span> <span class="token string">"notaRedondeada veces\n"</span> <span class="token operator">+</span> 
notas<span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>
        nota <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">Floor</span><span class="token punctuation">(</span>nota<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>nota<span class="token punctuation">,</span> elementosConMismaNota<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                <span class="token keyword keyword-new">new</span>
                <span class="token punctuation">{</span>
                    NotaAgrupada <span class="token operator">=</span> nota<span class="token punctuation">,</span>
                    Veces <span class="token operator">=</span> elementosConMismaNota<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>datoAgrupado <span class="token operator">=&gt;</span> datoAgrupado<span class="token punctuation">.</span>NotaAgrupada<span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span>texto<span class="token punctuation">,</span> datoAgrupado<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                texto <span class="token operator">+=</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">datoAgrupado<span class="token punctuation">.</span>NotaAgrupada<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">14</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">datoAgrupado<span class="token punctuation">.</span>Veces<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">5</span></span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>salida<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="admonition tip">
<p class="admonition-title">Importante</p>
<p>Fíjate que aunque <strong><code>string salida = ...</code></strong> es una única expresión, hemos ido introduciendo saltos de línea e indentado el código para que sea legible y modificable nuestra expresión funcional. De otra manera el código sería prácticamente ilegible y difícil de modificar para un programador humano.</p>
</div>
<p>Si comentamos el código anterior podríamos decir que:</p>
<ol>
<li>
<p>Nuestra función selectora (<code>Func&lt;TSource, TKey&gt; keySelector</code>) es:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>nota <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">Floor</span><span class="token punctuation">(</span>nota<span class="token punctuation">)</span>
</code></pre><p>Siendo <code>TSource</code> los <strong>doubles</strong> de la secuencia de entrada con el identificador <strong><code>nota</code></strong>.<br>
Siendo <code>TKey</code> el <strong>double</strong> resultado de quedarnos con la parte entera de la nota <strong><code>Math.Floor(nota)</code></strong>.<br>
Todos los elementos de la lista de entrada que produzcan la misma clave <code>TKey</code>, estarán en el mismo grupo y por tanto se agruparán en una secuencia. En nuestro caso las claves generadas serán ...</p>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">7.2</span><span class="token punctuation">,</span> <span class="token number">7.6</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">8.7</span> <span class="token punctuation">]</span> → <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span> <span class="token punctuation">]</span>
</code></pre></li>
<li>
<p>Nuestra función des proyección (<code>Func&lt;TKey, IEnumerable&lt;TSource&gt;, TResult&gt; resultSelector</code>) es:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token punctuation">(</span>nota<span class="token punctuation">,</span> elementosConMismaNota<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span>
                <span class="token punctuation">{</span>
                    NotaAgrupada <span class="token operator">=</span> nota<span class="token punctuation">,</span>
                    Veces <span class="token operator">=</span> elementosConMismaNota<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
</code></pre><p>Siendo <code>TKey</code> el <strong>double</strong> con la clave que recordemos es el resultado de aplicar <code>Floor</code> a la nota.<br>
Siendo <code>IEnumerable&lt;TSource&gt;</code> una nueva secuencia con los elementos de la secuencia original, esto es, las notas con decimales <strong>agrupadas a esa clave</strong>. Esto es, los elementos que generaron esa clave.<br>
Así pues, tendré las siguientes parejas de <strong>(clave, agrupación)</strong> en <code>(TKey, IEnumerable&lt;TSource&gt;)</code> en nuestro caso <strong><code>(nota, elementosConMismaNota)</code></strong></p>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code>(<span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token number">1</span> <span class="token punctuation">]</span>)
(<span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token number">3.4</span> <span class="token punctuation">]</span>)
(<span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">4.3</span> <span class="token punctuation">]</span>)
(<span class="token number">7</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token number">7.2</span><span class="token punctuation">,</span> <span class="token number">7.6</span> <span class="token punctuation">]</span>)
(<span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token number">5.6</span> <span class="token punctuation">]</span>)
(<span class="token number">8</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token number">8.7</span> <span class="token punctuation">]</span>)
</code></pre><p>Siendo <code>TResult</code> la <strong>proyección</strong> resultante de gestionar los pares (clave, agrupación) anteriores. En nuestro caso objetos de la '<em>anónimos</em>' con dos propiedades <strong><code>NotaAgrupada</code></strong> y <strong><code>Veces</code></strong> que tendrá la cuenta de cada secuencia de notas agrupadas con la clave.<br>
Por tanto el resultado final será la secuencia de <code>TResult</code> siguiente...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token punctuation">[</span> 
  <span class="token punctuation">{</span> NotaAgrupada <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> Veces <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> NotaAgrupada <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> Veces <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">{</span> NotaAgrupada <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> Veces <span class="token operator">=</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> NotaAgrupada <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">,</span> Veces <span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">{</span> NotaAgrupada <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> Veces <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> NotaAgrupada <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span> Veces <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">}</span> 
<span class="token punctuation">]</span>
</code></pre></li>
<li>
<p>La función</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>datoAgrupado <span class="token operator">=&gt;</span> datoAgrupado<span class="token punctuation">.</span>NotaAgrupada<span class="token punctuation">)</span>
</code></pre><p>aplicada a la secuencia anterior de objetos anónimos producirá la misma secuencia pero ordenada por la propiedad <strong><code>NotaAgrupada</code></strong>.</p>
</li>
<li>
<p>La función</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>texto<span class="token punctuation">,</span> datoAgrupado<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
          texto <span class="token operator">+=</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">datoAgrupado<span class="token punctuation">.</span>NotaAgrupada<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">14</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">datoAgrupado<span class="token punctuation">.</span>Veces<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">5</span></span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Genera una cadena con los pares nota sin decimales y veces que aparece alineados y separados por un salto de línea.</p>
</li>
</ol>
<div style="page-break-after:always;"></div>
<div class="box_bg_lightgray">
<p><strong>Ejemplo GroupBy:</strong> (Puedes descargarlo de <strong><a href="assets/ejemplos/groupby_empleados_por_ciudad_ejemplo.cs">este enlace</a></strong>)</p>
<p>Veamos un ejemplo algo más elaborado usando una secuencia con un tipo algo más complejo que un double. Para ello, supongamos la siguiente clase inmutable que define los datos de un empleado de una determinada empresa...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-enum">enum</span> <span class="token class-name">Ciudad</span> <span class="token punctuation">{</span> Elche<span class="token punctuation">,</span> Alicante <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-record">record</span> <span class="token class-name">Empleado</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> Nombre<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> Edad<span class="token punctuation">,</span> <span class="token class-name">Ciudad</span> Ciudad<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-override">override</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Nombre<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">9</span></span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Edad<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span></span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Ciudad</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>Ahora definimos una clase de utilidad que me devuelva una secuencia de empleados de forma <em>'perezosa'</em>...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">Empleados</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span></span> DepartamentoDeVentas
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-get">get</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-yield">yield</span> <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">Nombre</span><span class="token punctuation">:</span> <span class="token string">"Lola"</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Edad</span><span class="token punctuation">:</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Ciudad</span><span class="token punctuation">:</span> Ciudad<span class="token punctuation">.</span>Alicante<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-yield">yield</span> <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">Nombre</span><span class="token punctuation">:</span> <span class="token string">"Pedro"</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Edad</span><span class="token punctuation">:</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Ciudad</span><span class="token punctuation">:</span> Ciudad<span class="token punctuation">.</span>Alicante<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-yield">yield</span> <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">Nombre</span><span class="token punctuation">:</span> <span class="token string">"Juana"</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Edad</span><span class="token punctuation">:</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Ciudad</span><span class="token punctuation">:</span> Ciudad<span class="token punctuation">.</span>Elche<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-yield">yield</span> <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">Nombre</span><span class="token punctuation">:</span> <span class="token string">"Marco"</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Edad</span><span class="token punctuation">:</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Ciudad</span><span class="token punctuation">:</span> Ciudad<span class="token punctuation">.</span>Elche<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-yield">yield</span> <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">Nombre</span><span class="token punctuation">:</span> <span class="token string">"Ana"</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Edad</span><span class="token punctuation">:</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Ciudad</span><span class="token punctuation">:</span> Ciudad<span class="token punctuation">.</span>Elche<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Queremos obtener un array con los <strong>nombres de los empleados mayores de 40 años sin repeticiones y ordenados por nombre</strong>.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> nombres <span class="token operator">=</span> Empleados<span class="token punctuation">.</span>DepartamentoDeVentas
                            <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Edad <span class="token operator">&gt;</span> <span class="token number">40</span><span class="token punctuation">)</span>  <span class="token comment">// Filtramos por edad.</span>
                            <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Nombre<span class="token punctuation">)</span>    <span class="token comment">// Proyectamos la propiedad Nombre a unna nueva secuencia.</span>
                            <span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n<span class="token punctuation">)</span>          <span class="token comment">// Ordenamos por nombre.</span>
                            <span class="token punctuation">.</span><span class="token function">Distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>               <span class="token comment">// Eliminamos repetidos.</span>
                            <span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// Pasamos la secuencia a array.</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> nombres<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><pre class="salida_consola">Ana, Lola, Marco, Pedro
</pre> <!-- fin salida consola -->
<p>Supongamos que ahora queremos obtener los <strong>empleados mayores de 40 años agrupados por ciudad</strong> usando <strong><code>GroupBy</code></strong>.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-var">var</span></span> empleadosXCiudad <span class="token operator">=</span> Empleados<span class="token punctuation">.</span>DepartamentoDeVentas
                                <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Edad <span class="token operator">&gt;</span> <span class="token number">40</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Ciudad<span class="token punctuation">,</span> 
                                         <span class="token punctuation">(</span>c<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span>Ciudad <span class="token operator">=</span> c<span class="token punctuation">,</span> Empleados <span class="token operator">=</span> g<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="row">
<div class="col-sm-7 my-auto">
<p>El tipo de <strong><code>empleadosXCiudad</code></strong> debe ser implícito (<strong><code>var</code></strong>) pues la secuencia que estamos creando es de un tipo implícito (<strong><code>new {Ciudad = c, Empleados = g}</code></strong>) que estamos definiendo en la función de proyección del <strong><code>GroupBy</code></strong>.</p>
<p>Para obtener la <strong>salida por consola dela imagen de la derecha</strong>, podríamos hacer...</p>
</div>
<div class="col-sm-5">
<pre class="salida_consola">Alicante:
        Lola    45 Alicante
        Pedro   51 Alicante
Elche:
        Marco   45 Elche
        Ana     52 Elche
</pre> <!-- fin salida consola -->
</div>
</div>
<p>Aunque la secuencia sea de un tipo anónimo, podremos componer una cadena con la salida deseada.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">StringBuilder</span> salida <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-var">var</span></span> eXc <span class="token keyword keyword-in">in</span> empleadosXCiudad<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    salida<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">eXc<span class="token punctuation">.</span>Ciudad</span><span class="token punctuation">}</span></span><span class="token string">:\n"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Empleado</span> e <span class="token keyword keyword-in">in</span> eXc<span class="token punctuation">.</span>Empleados<span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Edad<span class="token punctuation">)</span><span class="token punctuation">)</span>
        salida<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"\t</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">e</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>salida<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Al ser la <strong>secuencia de un tipo anónimo</strong>, solo podremos recorrer la secuiencia <strong>en el mismo ámbito de uso de tipo</strong>. Si intentáramos encapsular el la obtención de la secuencia en una función, no podríamos devolverla como tal, sino que deberíamos encapsularla en un tipo de datos o clase que la contuviera.<br>
Lo mismo sucedería si quisieramos encapsular el código que muestra los datos en pantalla. No sabríamos de que tipo asignarle a la secuencia que pasaríamos como parámetro.</p>
</div>
</div> <!-- fin ejemplo -->
<div style="page-break-after:always;"></div>
<h5 id="resultado-del-groupby-en-un-nuevo-tipo-de-datos">Resultado del GroupBy en un nuevo tipo de datos </h5>
<p>Supongamos que hubiéramos querido encapsular la obtención de <strong><code>empleadosXCiudad</code></strong> en una función y hacer el mismo proceso modularizado. Puesto que la secuencia es de un tipo anónimo, nos hubiéramos visto obligados ha definir una nueva clase con una propiedad <strong><code>Ciudad</code></strong> del tipo enumerado y otra <strong><code>Empleados</code></strong> como secuencia de objetos empleados por ejemplo.</p>
<div class="admonition tip">
<p class="admonition-title">Recuerda</p>
<p>A este tipo de datos o clase que definimos para obtener el resultado de una consulta y que únicamente tienen como misión transportar los datos de la consulta, se les denomina <strong>DTO</strong> <strong><a href="https://es.wikipedia.org/wiki/Objeto_de_transferencia_de_datos">Data Transfer Object</a></strong> y deben ser inmutables y tener la mínima funcionalidad posible. Por eso el modificador <strong><code>record class</code></strong> es el más adecuado para definirlos.</p>
</div>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// Definimos el tipo.</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-record">record</span> <span class="token class-name"><span class="token keyword keyword-class">class</span></span> <span class="token function">EmpleadosPorCiudadDto</span><span class="token punctuation">(</span><span class="token class-name">Ciudad</span> Ciudad<span class="token punctuation">,</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span></span> Empleados<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Podemos definir un valor de retorno con un tipo concreto para la secuencia.</span>
<span class="token comment">// En este caso hemos quitado la restricción de mayores de 40 por simplificar.</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>EmpleadosPorCiudadDto<span class="token punctuation">&gt;</span></span> <span class="token function">EmpleadosVentasPorCiudad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
Empleados<span class="token punctuation">.</span>DepartamentoDeVentas
            <span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Ciudad<span class="token punctuation">,</span>
                     <span class="token punctuation">(</span>c<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">EmpleadosPorCiudadDto</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">Ciudad</span><span class="token punctuation">:</span> c<span class="token punctuation">,</span> <span class="token named-parameter punctuation">Empleados</span><span class="token punctuation">:</span> g<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Al tener un tipo concreto, también podemos modularizar la composición de la salida.</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">ATexto</span><span class="token punctuation">(</span><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>EmpleadosPorCiudadDto<span class="token punctuation">&gt;</span></span> empleadosXCiudad<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">StringBuilder</span> salida <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-var">var</span></span> eXc <span class="token keyword keyword-in">in</span> empleadosXCiudad<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        salida<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">eXc<span class="token punctuation">.</span>Ciudad</span><span class="token punctuation">}</span></span><span class="token string">:\n"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Empleado</span> e <span class="token keyword keyword-in">in</span> eXc<span class="token punctuation">.</span>Empleados<span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Edad<span class="token punctuation">)</span><span class="token punctuation">)</span>
            salida<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"\t</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">e</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> salida<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Posteriormente hacer la llamada a las funciones.</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">ATexto</span><span class="token punctuation">(</span><span class="token function">EmpleadosVentasPorCiudad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     
</code></pre><p>En este caso no hemos filtrado por edad como hacíamos en el caso inicial. Pero si quisiéramos hacerlo a posteiori, podríamos hacerlo de la siguiente manera...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-var">var</span></span> empleadosXCiudad <span class="token operator">=</span> <span class="token function">EmpleadosVentasPorCiudad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Mapeamos al mismo DTO pero filtrando la propiedad Empleados por edad.</span>
<span class="token comment">// Fíjate que al ser inmutable EmpleadosPorCiudadDto, </span>
<span class="token comment">// para no tener que crear un nuevo objeto copiando propiedad a propiedad.</span>
<span class="token comment">// Usamos el operador with para crear una nueva instancia </span>
<span class="token comment">// con la propiedad Empleados filtrada.</span>
<span class="token class-name"><span class="token keyword keyword-var">var</span></span> empleadosXCiudadMas40 <span class="token operator">=</span> empleadosXCiudad<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>
                                eXc <span class="token operator">=&gt;</span> eXc <span class="token keyword keyword-with">with</span> <span class="token punctuation">{</span> 
                                    Empleados <span class="token operator">=</span> eXc<span class="token punctuation">.</span>Empleados<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Edad <span class="token operator">&gt;</span> <span class="token number">40</span><span class="token punctuation">)</span> 
                                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">ATexto</span><span class="token punctuation">(</span>empleadosXCiudadMas40<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     
</code></pre><h5 id="resultado-del-grupby-en-un-diccionario">Resultado del GrupBy en un diccionario </h5>
<p>Pero, ¿Habría la posibilidad de retornar la agrupación por clave sin tener que definir el tipo <strong><code>EmpleadosPorCiudadDto</code></strong>?. Podríamos utilizar la posibilidad de transformar cualquier secuencia a las colecciones definidas en el lenguaje.</p>
<p>Por ejemplo vamos a definir la misma función <strong><code>EmpleadosVentasPorCiudad</code></strong> pero en lugar de retornar <strong><code>IEnumerable&lt;EmpleadosPorCiudadDto&gt;</code></strong> ahora retornará <strong><code>Dictionary&lt;Ciudad, List&lt;Empleado&gt;&gt;</code></strong> y así no tendríamos que definir el tipo.</p>
<p>Es fácil e inmediato transformar una secuencia a un array o una lista.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span></span> secuencia <span class="token operator">=</span> <span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">;</span>

<span class="token class-name">Empleado<span class="token punctuation">[</span><span class="token punctuation">]</span></span> arrayEmpleados <span class="token operator">=</span> secuencia<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span></span> listaEmpleados <span class="token operator">=</span> secuencia<span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Pero si queremos crear un diccionario, deberíamos poder indicarle de donde sacamos las claves y los valores asociados infiriendo en ambos casos los tipos parametrizados en el diccionario. Una vez más nos ayudarán la funciones de orden superior (HOF) para hacerlo en este caso podemos usar la siguiente definición de <strong><code>ToDictionary</code></strong>...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">Dictionary<span class="token punctuation">&lt;</span>TKey<span class="token punctuation">,</span> TElement<span class="token punctuation">&gt;</span></span> 
<span class="token generic-method"><span class="token function">ToDictionary</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TSource<span class="token punctuation">,</span> TKey<span class="token punctuation">,</span> TElement<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
                <span class="token keyword keyword-this">this</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">&gt;</span></span> source<span class="token punctuation">,</span>
                <span class="token class-name">Func<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">,</span> TKey<span class="token punctuation">&gt;</span></span> keySelector<span class="token punctuation">,</span> 
                <span class="token class-name">Func<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">,</span> TElement<span class="token punctuation">&gt;</span></span> elementSelector<span class="token punctuation">)</span> <span class="token keyword keyword-where">where</span> <span class="token class-name">TKey</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword keyword-notnull">notnull</span></span><span class="token punctuation">;</span>
</code></pre><p>Donde <strong><code>Func&lt;TSource, TKey&gt; keySelector</code></strong> nos ayudará a decidir que propiedad será la clave del tipo anónimo de entrada <strong><code>TSource</code></strong> y <strong><code>Func&lt;TSource, TElement&gt; elementSelector)</code></strong> hará el proceso análogo para el valor asociado a la clave. Quedando la función anterior.</p>
<pre data-role="codeBlock" data-info="csharp {highlight=[1,5]}" class="language-csharp csharp" data-line="1,5"><code><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">Dictionary<span class="token punctuation">&lt;</span>Ciudad<span class="token punctuation">,</span> List<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">EmpleadosVentasPorCiudad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
Empleados<span class="token punctuation">.</span>DepartamentoDeVentas
          <span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Ciudad<span class="token punctuation">,</span>
                <span class="token punctuation">(</span>c<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span> Ciudad <span class="token operator">=</span> c<span class="token punctuation">,</span> Empleados <span class="token operator">=</span> g <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">ToDictionary</span><span class="token punctuation">(</span>eXc <span class="token operator">=&gt;</span> eXc<span class="token punctuation">.</span>Ciudad<span class="token punctuation">,</span> eXc <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>eXc<span class="token punctuation">.</span>Empleados<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div class="line-highlight-wrapper"><div aria-hidden="true" class="line-highlight" data-range="1" data-start="1">
</div></div><div class="line-highlight-wrapper">



<div aria-hidden="true" class="line-highlight" data-range="5" data-start="5">
</div></div></pre><p>Por último, queremos poder filtrar los empleados de ventas que queremos agrupar por ciudad por cualquier predicado. Una vez más podremos aplicar programación funcional y pasar la estrategia de filtrado como parámetro. (Puedes descargar el del siguiente ejemplo ejemplo en <strong><a href="assets/ejemplos/groupby_empleados_por_ciudad_dictionary_ejemplo.cs">este enlace</a></strong>).</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// En este caso no necesitamos un tipo concreto, podemos usar un diccionario.</span>
<span class="token comment">// y mejoramos la funcionalidad anterior para que admita un filtro mediante una HOF.</span>
<span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">Dictionary<span class="token punctuation">&lt;</span>Ciudad<span class="token punctuation">,</span> List<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> 
<span class="token function">EmpleadosVentasPorCiudad</span><span class="token punctuation">(</span><span class="token class-name">Func<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">,</span> <span class="token keyword keyword-bool">bool</span><span class="token punctuation">&gt;</span></span> filtroEmpleado<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
Empleados<span class="token punctuation">.</span>DepartamentoDeVentas
          <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>filtroEmpleado<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Ciudad<span class="token punctuation">,</span>
                <span class="token punctuation">(</span>c<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span> Ciudad <span class="token operator">=</span> c<span class="token punctuation">,</span> Empleados <span class="token operator">=</span> g <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">ToDictionary</span><span class="token punctuation">(</span>eXc <span class="token operator">=&gt;</span> eXc<span class="token punctuation">.</span>Ciudad<span class="token punctuation">,</span> eXc <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>eXc<span class="token punctuation">.</span>Empleados<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">ATexto</span><span class="token punctuation">(</span><span class="token class-name">Dictionary<span class="token punctuation">&lt;</span>Ciudad<span class="token punctuation">,</span> List<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> empleadosXCiudad<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">StringBuilder</span> salida <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> <span class="token punctuation">(</span>cuidad<span class="token punctuation">,</span> empleados<span class="token punctuation">)</span> <span class="token keyword keyword-in">in</span> empleadosXCiudad<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        salida<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">cuidad</span><span class="token punctuation">}</span></span><span class="token string">:\n"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Empleado</span> e <span class="token keyword keyword-in">in</span> empleados<span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Edad<span class="token punctuation">)</span><span class="token punctuation">)</span>
            salida<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"\t</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">e</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> salida<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-var">var</span> empleadosVentasPorCiudadDeMasDe40Años <span class="token operator">=</span> 
    <span class="token function">EmpleadosVentasPorCiudad</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Edad <span class="token operator">&gt;</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">ATexto</span><span class="token punctuation">(</span>empleadosVentasPorCiudadDeMasDe40Años<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div style="page-break-after:always;"></div>
<h4 id="zip">Zip </h4>
<p>Se trata de una <a href="https://en.wikipedia.org/wiki/Zipping_(computer_science)">operación típica en los lenguajes funcionales</a> al permitirnos manejar el concepto de tupla y que por tanto podemos <a href="https://docs.microsoft.com/es-es/dotnet/api/system.linq.enumerable.zip">encontrar también en C#</a> ya que también nos los permite.</p>
<p>Básicamente realiza una correspondencia unívoca entre los elementos de <strong>dos</strong> o más secuencias iterables, produciendo una <strong>nueva secuencia de tuplas</strong> resultado de dicha correspondencia. Obviamente, su nombre viene de la analogía de cerrar una cremallera.</p>
<p>Supongamos <strong>Sec[A]</strong> = [🐮, 🐟, 🍠, 🐔, 🌽] y <strong>Sec[B]</strong> = [🍔, 🍥, 🍟, 🍗, 🍿]</p>
<p><strong>zip(Sec[A], Sec[B])</strong> = [ <strong>(<strong>🐮, 🍔</strong>)</strong>, <strong>(<strong>🐟, 🍥</strong>)</strong> , <strong>(<strong>🍠, 🍟</strong>)</strong>, <strong>(<strong>🐔, 🍗</strong>)</strong>, <strong>(<strong>🌽, 🍿</strong>)</strong> ]</p>
<p><strong>Ejemplo:</strong> Supongamos que tenemos dos arrays. Uno con nombres de país y otro su población en millones de habitantes. Queremos mostrar una correlación entre ambos arrays por pantalla en forma de texto. Una aproximación funcional a la solución desde C# podría ser...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> paises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"China"</span><span class="token punctuation">,</span> <span class="token string">"India"</span><span class="token punctuation">,</span> <span class="token string">"Estados Unidos"</span><span class="token punctuation">,</span> <span class="token string">"Indonesia"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> poblaciones <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1391</span><span class="token punctuation">,</span> <span class="token number">1364</span><span class="token punctuation">,</span> <span class="token number">327</span><span class="token punctuation">,</span> <span class="token number">264</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword keyword-string">string</span></span> salida  <span class="token operator">=</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span>
                 paises<span class="token punctuation">.</span><span class="token function">Zip</span><span class="token punctuation">(</span>poblaciones<span class="token punctuation">)</span>
                       <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> <span class="token interpolation-string"><span class="token string">$"Población </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">t<span class="token punctuation">.</span>First</span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">t<span class="token punctuation">.</span>Second</span><span class="token punctuation">}</span></span><span class="token string"> millones."</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>salida<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Mostrará por pantalla...</p>
<pre data-role="codeBlock" data-info="txt" class="language-txt txt"><code>Población China 1391 millones.        
Población India 1364 millones.        
Población Estados Unidos 327 millones.
Población Indonesia 264 millones.
</code></pre><p>Fíjate que la función <strong><code>paises.Zip(poblaciones)</code></strong> me genera una secuencia de tuplas del tipo <strong><code>(string , int)</code></strong> → <code>[("China", 1391), (India, 1364)], ... ]</code> y posteriormente en la función de mapeo genera una nueva secuencia de cadenas componiendo los elementos de la tupla <strong>t</strong>.</p>
<div style="page-break-after:always;"></div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>La operación inversa <strong>Unzip</strong> no está definida en el lenguaje porque se puede realizar fácilmente con un mapeo...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> pais<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> poblacion<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span> datos <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">"China"</span><span class="token punctuation">,</span> <span class="token number">1391</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"India"</span><span class="token punctuation">,</span> <span class="token number">1364</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"Estados Unidos"</span><span class="token punctuation">,</span> <span class="token number">327</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"Indonesia"</span><span class="token punctuation">,</span> <span class="token number">264</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> paisesU <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token range operator">..</span> datos<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>pais<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> poblacionU <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token range operator">..</span> datos<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>poblacion<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> paisesU<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> poblacionU<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Si quisieramos hacer un <strong><code>Zip</code></strong> de <strong>tres o más secuencias del mismo tamaño</strong>, podríamos aplicar la función varias veces. En el siguiente ejemplo vamos acombinar los varires de tres vectores en una tupla de tres elementos correpondientes a coordenas en el espacio.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> v1 <span class="token operator">=</span>  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> v2 <span class="token operator">=</span>  <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> v3 <span class="token operator">=</span>  <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> y<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> z<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span> agrupacion <span class="token operator">=</span> v1
    <span class="token comment">// Combinamos v1 con v2</span>
    <span class="token punctuation">.</span><span class="token function">Zip</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> <span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token comment">// Combinamos las tuplas resultantes con v3</span>
    <span class="token punctuation">.</span><span class="token function">Zip</span><span class="token punctuation">(</span>v3<span class="token punctuation">,</span> <span class="token punctuation">(</span>t12<span class="token punctuation">,</span> d3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>t12<span class="token punctuation">.</span>d1<span class="token punctuation">,</span> t12<span class="token punctuation">.</span>d2<span class="token punctuation">,</span> d3<span class="token punctuation">)</span><span class="token punctuation">)</span>  
    <span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token keyword keyword-in">in</span> agrupacion<span class="token punctuation">)</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"(</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">x</span><span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">y</span><span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">z</span><span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div style="page-break-after:always;"></div>
<h4 id="flatmap-o-aplanado">FlatMap o Aplanado </h4>
<p>La operación de aplanado es otra de las funciones típicas de la programación funcional que vamos a encontrar en todos los lenguajes funcionales y otros como JavaScript, Java o C#. A este tipo de HOF se le conoce como <strong><a href="https://es.wikipedia.org/wiki/M%C3%B3nada_(programaci%C3%B3n_funcional)">mónada</a></strong> porque cumple ciertas operaciones matemáticas en la que no vamos a entrar por estar fuera del tema, pero que si has visto la <strong><a href="https://es.wikipedia.org/wiki/M%C3%B3nada_(programaci%C3%B3n_funcional)#Definici%C3%B3n_Formal">definición formal</a></strong> del enlace anterior seguramente no te hayas enterado de nada si no tienes una profunda base matemática del la teoría de categorías.</p>
<p>Pero siguiendo la analogía que hemos usado en el tema, podemos definirla como:<br>
<strong>flatMap = Sec[A] x (A → Sec[B]) → Sec[B]</strong></p>
<p>Donde dada una <strong>Sec[A]</strong> le vamos a aplicar una función <strong>A → Sec[B]</strong> donde para cada elemento de <strong>A</strong> produce una secuencia de <strong>B</strong> <strong>Sec[B]</strong> y el resultado será una <strong>Sec[B]</strong> resultado de <strong>unir</strong> todas los <strong>Sec[B]</strong> producidos por cada <strong>A</strong>.</p>
<p><strong>¿Sigue sin quedar claro?</strong>. No pasa nada, vamos a verlo a través de un ejemplo sencillo, pero esta vez en lugar de usar iconos, vamos a usar enteros y programa sencillo en C#.</p>
<p>En primer lugar comentaremos que la función equivalente en C# que más se aproxima a esta definición básica de <strong>FlatMap</strong> es <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.linq.enumerable.selectmany#system-linq-enumerable-selectmany-2(system-collections-generic-ienumerable((-0))-system-func((-0-system-collections-generic-ienumerable((-1)))))">SelectMany</a></strong> y en concreto la sobrecarga siguiente:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>B<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">SelectMany</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>A<span class="token punctuation">,</span> B<span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">(</span>
                            <span class="token keyword keyword-this">this</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">&gt;</span></span> source<span class="token punctuation">,</span>
                            <span class="token class-name">Func<span class="token punctuation">&lt;</span>A<span class="token punctuation">,</span> IEnumerable<span class="token punctuation">&lt;</span>B<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Supongamos la siguiente de representación donde tenemos el típico array de arrays o tabla dentada. En el fondo, podemos considerarlo como una secuencia de secuencias (sub-secuencias) de enteros:</p>
<p></p><p align="center" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="550pt" height="210pt" viewBox="0.00 0.00 550.00 210.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.8 0.8) rotate(0) translate(5.32 244.75)">
<title>G</title>
<polygon fill="white" stroke="none" points="-5.32,17.75 -5.32,-244.75 682.18,-244.75 682.18,17.75 -5.32,17.75"></polygon>
<!-- ot1 -->
<g id="node1" class="node">
<title>ot1</title>
<polygon fill="none" stroke="black" points="42,-188.6 42,-222.6 76,-222.6 76,-188.6 42,-188.6"></polygon>
<polygon fill="none" stroke="black" points="76,-188.6 76,-222.6 110,-222.6 110,-188.6 76,-188.6"></polygon>
<polygon fill="none" stroke="black" points="110,-188.6 110,-222.6 144,-222.6 144,-188.6 110,-188.6"></polygon>
<polygon fill="none" stroke="black" points="144,-188.6 144,-222.6 178,-222.6 178,-188.6 144,-188.6"></polygon>
</g>
<!-- ot11 -->
<g id="node2" class="node">
<title>ot11</title>
<polygon fill="none" stroke="black" points="10.21,-73.6 10.21,-108.4 43.79,-108.4 43.79,-73.6 10.21,-73.6"></polygon>
<text text-anchor="start" x="19.21" y="-86.8" font-family="Arial" font-size="14.00">11</text>
<polygon fill="none" stroke="black" points="10.21,-38.8 10.21,-73.6 43.79,-73.6 43.79,-38.8 10.21,-38.8"></polygon>
<text text-anchor="start" x="19.21" y="-52" font-family="Arial" font-size="14.00">22</text>
</g>
<!-- ot1&#45;&gt;ot11 -->
<g id="edge1" class="edge">
<title>ot1:c-&gt;ot11:n</title>
<path fill="none" stroke="black" d="M53.43,-188.71C46.87,-170.02 36.18,-139.55 30.62,-123.69"></path>
<polygon fill="black" stroke="black" points="27.4,-114.51 34.96,-122.46 28.65,-118.08 30.71,-123.95 30.71,-123.95 30.71,-123.95 28.65,-118.08 26.47,-125.44 27.4,-114.51"></polygon>
</g>
<!-- ot12 -->
<g id="node3" class="node">
<title>ot12</title>
<polygon fill="none" stroke="black" points="65.21,-91 65.21,-125.8 98.79,-125.8 98.79,-91 65.21,-91"></polygon>
<text text-anchor="start" x="74.21" y="-104.2" font-family="Arial" font-size="14.00">34</text>
<polygon fill="none" stroke="black" points="65.21,-56.2 65.21,-91 98.79,-91 98.79,-56.2 65.21,-56.2"></polygon>
<text text-anchor="start" x="74.21" y="-69.4" font-family="Arial" font-size="14.00">35</text>
<polygon fill="none" stroke="black" points="65.21,-21.4 65.21,-56.2 98.79,-56.2 98.79,-21.4 65.21,-21.4"></polygon>
<text text-anchor="start" x="74.21" y="-34.6" font-family="Arial" font-size="14.00">29</text>
</g>
<!-- ot1&#45;&gt;ot12 -->
<g id="edge2" class="edge">
<title>ot1:c-&gt;ot12:n</title>
<path fill="none" stroke="black" d="M90.67,-188.94C88.55,-174.71 85.48,-154.1 83.62,-141.6"></path>
<polygon fill="black" stroke="black" points="82.18,-131.95 88.1,-141.18 82.74,-135.69 83.65,-141.84 83.65,-141.84 83.65,-141.84 82.74,-135.69 79.2,-142.51 82.18,-131.95"></polygon>
</g>
<!-- ot13 -->
<g id="node4" class="node">
<title>ot13</title>
<polygon fill="none" stroke="black" points="120.21,-56.2 120.21,-91 153.79,-91 153.79,-56.2 120.21,-56.2"></polygon>
<text text-anchor="start" x="129.21" y="-69.4" font-family="Arial" font-size="14.00">10</text>
</g>
<!-- ot1&#45;&gt;ot13 -->
<g id="edge3" class="edge">
<title>ot1:c-&gt;ot13:n</title>
<path fill="none" stroke="black" d="M128.43,-189.03C130.48,-166.73 134.21,-126.25 135.99,-106.86"></path>
<polygon fill="black" stroke="black" points="136.89,-97.15 140.45,-107.52 136.54,-100.92 135.97,-107.11 135.97,-107.11 135.97,-107.11 136.54,-100.92 131.49,-106.7 136.89,-97.15"></polygon>
</g>
<!-- ot14 -->
<g id="node5" class="node">
<title>ot14</title>
<polygon fill="none" stroke="black" points="175.21,-108.4 175.21,-143.2 208.79,-143.2 208.79,-108.4 175.21,-108.4"></polygon>
<text text-anchor="start" x="184.21" y="-121.6" font-family="Arial" font-size="14.00">17</text>
<polygon fill="none" stroke="black" points="175.21,-73.6 175.21,-108.4 208.79,-108.4 208.79,-73.6 175.21,-73.6"></polygon>
<text text-anchor="start" x="184.21" y="-86.8" font-family="Arial" font-size="14.00">14</text>
<polygon fill="none" stroke="black" points="175.21,-38.8 175.21,-73.6 208.79,-73.6 208.79,-38.8 175.21,-38.8"></polygon>
<text text-anchor="start" x="184.21" y="-52" font-family="Arial" font-size="14.00">30</text>
<polygon fill="none" stroke="black" points="175.21,-4 175.21,-38.8 208.79,-38.8 208.79,-4 175.21,-4"></polygon>
<text text-anchor="start" x="184.21" y="-17.2" font-family="Arial" font-size="14.00">31</text>
</g>
<!-- ot1&#45;&gt;ot14 -->
<g id="edge4" class="edge">
<title>ot1:c-&gt;ot14:n</title>
<path fill="none" stroke="black" d="M169.64,-188.61C175.15,-178.39 182.13,-165.48 186.81,-156.82"></path>
<polygon fill="black" stroke="black" points="191.42,-148.27 190.63,-159.21 189.62,-151.6 186.67,-157.07 186.67,-157.07 186.67,-157.07 189.62,-151.6 182.71,-154.93 191.42,-148.27"></polygon>
</g>
<!-- otFlat -->
<g id="node6" class="node">
<title>otFlat</title>
<polygon fill="none" stroke="black" points="333.14,-188.2 333.14,-223 366.71,-223 366.71,-188.2 333.14,-188.2"></polygon>
<text text-anchor="start" x="342.14" y="-201.4" font-family="Arial" font-size="14.00">11</text>
<polygon fill="none" stroke="black" points="366.71,-188.2 366.71,-223 400.28,-223 400.28,-188.2 366.71,-188.2"></polygon>
<text text-anchor="start" x="375.71" y="-201.4" font-family="Arial" font-size="14.00">22</text>
<polygon fill="none" stroke="black" points="400.28,-188.2 400.28,-223 433.86,-223 433.86,-188.2 400.28,-188.2"></polygon>
<text text-anchor="start" x="409.28" y="-201.4" font-family="Arial" font-size="14.00">34</text>
<polygon fill="none" stroke="black" points="433.86,-188.2 433.86,-223 467.43,-223 467.43,-188.2 433.86,-188.2"></polygon>
<text text-anchor="start" x="442.86" y="-201.4" font-family="Arial" font-size="14.00">35</text>
<polygon fill="none" stroke="black" points="467.43,-188.2 467.43,-223 501,-223 501,-188.2 467.43,-188.2"></polygon>
<text text-anchor="start" x="476.43" y="-201.4" font-family="Arial" font-size="14.00">29</text>
<polygon fill="none" stroke="black" points="501,-188.2 501,-223 534.57,-223 534.57,-188.2 501,-188.2"></polygon>
<text text-anchor="start" x="510" y="-201.4" font-family="Arial" font-size="14.00">10</text>
<polygon fill="none" stroke="black" points="534.57,-188.2 534.57,-223 568.14,-223 568.14,-188.2 534.57,-188.2"></polygon>
<text text-anchor="start" x="543.57" y="-201.4" font-family="Arial" font-size="14.00">17</text>
<polygon fill="none" stroke="black" points="568.14,-188.2 568.14,-223 601.72,-223 601.72,-188.2 568.14,-188.2"></polygon>
<text text-anchor="start" x="577.14" y="-201.4" font-family="Arial" font-size="14.00">14</text>
<polygon fill="none" stroke="black" points="601.72,-188.2 601.72,-223 635.29,-223 635.29,-188.2 601.72,-188.2"></polygon>
<text text-anchor="start" x="610.72" y="-201.4" font-family="Arial" font-size="14.00">30</text>
<polygon fill="none" stroke="black" points="635.29,-188.2 635.29,-223 668.86,-223 668.86,-188.2 635.29,-188.2"></polygon>
<text text-anchor="start" x="644.29" y="-201.4" font-family="Arial" font-size="14.00">31</text>
</g>
<!-- ot1&#45;&gt;otFlat -->
<g id="edge5" class="edge">
<title>ot1-&gt;otFlat</title>
<path fill="none" stroke="blue" d="M185.85,-205.6C222.6,-205.6 268.52,-205.6 313.83,-205.6"></path>
<polygon fill="none" stroke="blue" points="313.82,-209.1 323.82,-205.6 313.82,-202.1 313.82,-209.1"></polygon>
<text text-anchor="middle" x="255.57" y="-212.8" font-family="Arial" font-size="14.00" fill="blue">Flat o Aplanado</text>
</g>
</g>
</svg>
</p><p></p>
<p>Si te fijas en el diagrama podemos ver que la operación de flat consiste en generar una nueva secuencia con datos de las sub-secuencias de entrada. El efecto es como si estuviéramos '<em>aplanando</em>' la tabla dentada.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> jagged <span class="token operator">=</span> 
<span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// SelectMany = int[][] → (int[] → int[]) → int[]</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> flat <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token range operator">..</span> jagged<span class="token punctuation">.</span><span class="token function">SelectMany</span><span class="token punctuation">(</span>v <span class="token operator">=&gt;</span> v<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">,</span> flat<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Mostrará por pantalla: 11, 22, 34, 25, 29, 10, 17, 14, 30, 31</span>
</code></pre><div class="box_bg_lightgray">
<p><strong>Ejemplo SelectMany:</strong> (Puedes descargarlo desde <strong><a href="assets/ejemplos/selectmany_autores_ejemplo.cs">este enlace</a></strong>).</p>
<p>Vemos un ejemplo más ilustrativo de este tipo de operación con tipos más elaborados.</p>
<p>Supongamos que la siguiente típica relación de cardinalidad uno a varios entre <strong><code>Autor</code></strong> y <strong><code>Libro</code></strong>. Donde suponemos que un autor ha escrito uno o varios libros y que modelizaremos de la siguiente manera...</p>
<p></p><p align="center" class="puml"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" data-diagram-type="CLASS" height="106px" preserveAspectRatio="none" style="width:447px;height:106px;" version="1.1" viewBox="0 0 447 106" width="447px" zoomAndPan="magnify"><defs></defs><g><!--class Autor--><g id="elem_Autor"><rect codeline="13" fill="#F1F1F1" height="92.8281" id="Autor" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="211.2334" x="7" y="7"></rect><ellipse cx="91.6357" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"></ellipse><path d="M94.4014,18.875 Q94.5576,18.6563 94.7451,18.5469 Q94.9326,18.4375 95.1514,18.4375 Q95.5264,18.4375 95.7607,18.7031 Q95.9951,18.9531 95.9951,19.5625 L95.9951,21.0156 Q95.9951,21.625 95.7607,21.8906 Q95.5264,22.1563 95.1514,22.1563 Q94.8076,22.1563 94.6045,21.9531 Q94.4014,21.7656 94.292,21.25 Q94.2451,20.8906 94.0576,20.7031 Q93.7295,20.3281 93.1201,20.1094 Q92.5107,19.8906 91.8857,19.8906 Q91.1201,19.8906 90.4795,20.2188 Q89.8545,20.5469 89.3545,21.2969 Q88.8701,22.0469 88.8701,23.0781 L88.8701,24.1719 Q88.8701,25.4063 89.7607,26.2344 Q90.6514,27.0469 92.2451,27.0469 Q93.1826,27.0469 93.8389,26.7969 Q94.2295,26.6406 94.6514,26.2031 Q94.917,25.9375 95.0576,25.8594 Q95.2139,25.7813 95.417,25.7813 Q95.7451,25.7813 95.9951,26.0469 Q96.2607,26.2969 96.2607,26.6406 Q96.2607,26.9844 95.917,27.3906 Q95.417,27.9688 94.6201,28.2969 Q93.542,28.75 92.2451,28.75 Q90.7295,28.75 89.5264,28.125 Q88.542,27.625 87.8545,26.5625 Q87.167,25.4844 87.167,24.2031 L87.167,23.0469 Q87.167,21.7188 87.7764,20.5781 Q88.4014,19.4219 89.4951,18.8125 Q90.5889,18.1875 91.8232,18.1875 Q92.5576,18.1875 93.1982,18.3594 Q93.8545,18.5156 94.4014,18.875 Z " fill="#000000"></path><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33.4619" x="112.1357" y="28.7285">Autor</text><line style="stroke:#000000;stroke-width:0.5;" x1="8" x2="217.2334" y1="39" y2="39"></line><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168.082" x="13" y="57.5332">-nombre : string {readOnly}</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="199.2334" x="13" y="75.1426">-nacionalidad : string {readOnly}</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="194.5234" x="13" y="92.752">-muerte : DateTime  {readOnly}</text></g><!--class Libro--><g id="elem_Libro"><rect codeline="20" fill="#F1F1F1" height="92.8281" id="Libro" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:0.5;" width="162.2061" x="278" y="7"></rect><ellipse cx="339.2876" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"></ellipse><path d="M342.0532,18.875 Q342.2095,18.6563 342.397,18.5469 Q342.5845,18.4375 342.8032,18.4375 Q343.1782,18.4375 343.4126,18.7031 Q343.647,18.9531 343.647,19.5625 L343.647,21.0156 Q343.647,21.625 343.4126,21.8906 Q343.1782,22.1563 342.8032,22.1563 Q342.4595,22.1563 342.2563,21.9531 Q342.0532,21.7656 341.9438,21.25 Q341.897,20.8906 341.7095,20.7031 Q341.3813,20.3281 340.772,20.1094 Q340.1626,19.8906 339.5376,19.8906 Q338.772,19.8906 338.1313,20.2188 Q337.5063,20.5469 337.0063,21.2969 Q336.522,22.0469 336.522,23.0781 L336.522,24.1719 Q336.522,25.4063 337.4126,26.2344 Q338.3032,27.0469 339.897,27.0469 Q340.8345,27.0469 341.4907,26.7969 Q341.8813,26.6406 342.3032,26.2031 Q342.5688,25.9375 342.7095,25.8594 Q342.8657,25.7813 343.0688,25.7813 Q343.397,25.7813 343.647,26.0469 Q343.9126,26.2969 343.9126,26.6406 Q343.9126,26.9844 343.5688,27.3906 Q343.0688,27.9688 342.272,28.2969 Q341.1938,28.75 339.897,28.75 Q338.3813,28.75 337.1782,28.125 Q336.1938,27.625 335.5063,26.5625 Q334.8188,25.4844 334.8188,24.2031 L334.8188,23.0469 Q334.8188,21.7188 335.4282,20.5781 Q336.0532,19.4219 337.147,18.8125 Q338.2407,18.1875 339.4751,18.1875 Q340.2095,18.1875 340.8501,18.3594 Q341.5063,18.5156 342.0532,18.875 Z " fill="#000000"></path><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.1309" x="359.7876" y="28.7285">Libro</text><line style="stroke:#000000;stroke-width:0.5;" x1="279" x2="439.2061" y1="39" y2="39"></line><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="150.1855" x="284" y="57.5332">-titulo : string {readOnly}</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="124.5234" x="284" y="75.1426">-año : int {readOnly}</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="150.2061" x="284" y="92.752">-paginas : int {readOnly}</text></g><!--reverse link Autor to Libro--><g id="link_Autor_Libro"><path codeline="9" d="M230.25,53.5 C250.21,53.5 258.81,53.5 277.85,53.5 " fill="transparent" id="Autor-backto-Libro" style="stroke:#000000;stroke-width:1;"></path><polygon fill="transparent" points="218.25,53.5,224.25,57.5,230.25,53.5,224.25,49.5,218.25,53.5" style="stroke:#000000;stroke-width:1;"></polygon><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7.23" x="226.2729" y="67.6018">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5.0591" x="264.8701" y="67.7826">*</text></g><!--SRC=[VP31IiH038RlynIXHw6WLs_jUX44XLtmd7PY6tOwMJ8feaiVocVmnPnQ2iMLdKl8_D_y_oI1tWnCGBdh3JmhjSOINJfoFA7Y06t0b2epvMOqUcmbxlcJu7Q3LAholfCW2dN0zhYHNdAB7TMvT2fZz0lsshFHVf0ZRTZTd5IBUjB_pVww71HZoX95SwuQBLyLTmL8MK9nKy0JDohEzUnfcG86ibvyScvfVv-uiuDyIeWoD4fm3odF6ZiuAw5_Zk5ZMW5iysemi4T_1Hj6Kfjz7j3em0F1bfdMyELtQxYnZK6kkEBtronpj4ljX1r7J9Vov7u0]--></g></svg></p><p></p>
<p>El programa generará una <strong>secuencia de autores</strong> que mostrará al ejecutarse y que contendrá los siguientes autores:</p>
<pre class="salida_consola">Nombre: William Shakespeare
Nacionalidad: Inglesa
Muerte: 03/05/1616
Libros:
        Titulo: Macbeth                                Año: 1623  Páginas: 128
        Titulo: La tempestad                           Año: 1611  Páginas: 160

Nombre: Miguel de Cervantes
Nacionalidad: Española
Muerte: 22/06/1616
Libros:
        Titulo: Don Quijote de la Mancha               Año: 1605  Páginas: 1376
        Titulo: La Galatea                             Año: 1585  Páginas: 664
        Titulo: Los trabajos de Persiles y Sigismunda  Año: 1617  Páginas: 888
        Titulo: Novelas ejemplares                     Año: 1613  Páginas: 1160

Nombre: Fernando de Rojas
Nacionalidad: Española
Muerte: 07/02/1541
Libros:
        Titulo: La Celestina                           Año: 1500  Páginas: 160
</pre> <!-- fin salida consola -->
<p>Con las funciones que hemos visto hasta el momento podríamos hacer consultas sobre los autores. Por ejemplo, para ver aquellos autores que han publicado algún libro en el siglo XVII podríamos hacer...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>Autor<span class="token punctuation">&gt;</span></span> autoresConLibrosPublicadosDuranteSigloXVII <span class="token operator">=</span>
Datos<span class="token punctuation">.</span>Autores<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Libros<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span>l <span class="token operator">=&gt;</span> l<span class="token punctuation">.</span>Año <span class="token operator">&gt;=</span> <span class="token number">1600</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Pero, si quisiéramos obtener los libros publicados en el siglo XVII a partir de la secuencia de autores. Ahora tendríamos un caso de uso de <strong><code>SelectMany</code></strong> (<strong>Flat Map</strong>):</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// IEnumerable&lt;Autor&gt; x (Autor → IEnumerable&lt;Libro&gt;) → IEnumerable&lt;Libro&gt;</span>
<span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>Libro<span class="token punctuation">&gt;</span></span> librosSigloXVII <span class="token operator">=</span>
Datos<span class="token punctuation">.</span>Autores<span class="token punctuation">.</span><span class="token function">SelectMany</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Libros<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>l <span class="token operator">=&gt;</span> l<span class="token punctuation">.</span>Año <span class="token keyword keyword-is">is</span> <span class="token operator">&gt;</span> <span class="token number">1600</span> <span class="token keyword keyword-and">and</span> <span class="token operator">&lt;</span> <span class="token number">1701</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Incluso podríamos <strong>generar una correlación</strong> entre <strong><code>Libros</code></strong> y <strong><code>Autor</code></strong> proyectando cada libro que cumple la condición a una nueva <strong>secuencia de objetos anónimos</strong>.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// IEnumerable&lt;Autor&gt; → (Autor → IEnumerable&lt;'a&gt;) → IEnumerable&lt;'a&gt;</span>
<span class="token comment">// Donde 'a es un tipo anónimo que tiene los campos solicitados de la proyección.</span>
<span class="token class-name"><span class="token keyword keyword-var">var</span></span> librosDeMenosDeMilPaginas <span class="token operator">=</span> Datos<span class="token punctuation">.</span>Autores<span class="token punctuation">.</span><span class="token function">SelectMany</span><span class="token punctuation">(</span>
                                               a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Libros<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>l <span class="token operator">=&gt;</span> l<span class="token punctuation">.</span>Paginas <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">)</span>
                                                            <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>l <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span>
                                                            <span class="token punctuation">{</span>
                                                                Libro <span class="token operator">=</span> l<span class="token punctuation">.</span>Titulo<span class="token punctuation">,</span>
                                                                Autor <span class="token operator">=</span> a<span class="token punctuation">.</span>Nombre<span class="token punctuation">,</span>
                                                                Páginas <span class="token operator">=</span> l<span class="token punctuation">.</span>Paginas
                                                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="admonition warning">
<p class="admonition-title">Aviso</p>
<p>Fíjate que en esta sentencia <strong>hemos indentado el código para que sea legible</strong>. Aunque es una única expresión funcional, el código es mucho más claro y modificable de esta manera. En una línea sería prácticamente ilegible y sería fácil cometer errores al modificarlo.<br>
Ademásm, <strong><code>librosDeMenosDeMilPaginas</code></strong> no puede tener un tipo explícito pues es un tipo anónimo. Por tanto debemos usar <strong><code>var</code></strong> para que el compilador infiera el tipo y deberíamos usar la secuencia en el mismo ámbito donde se define no pudiendo encapsularla en una función.</p>
</div>
<p>Por ejemplo, si quisiésemos obtener esta vista libro, autor y número de páginas y retornarla desde una función, deberíamos definir un nuevo tipo de datos <strong>DTO</strong> para encapsular la información.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-record">record</span> <span class="token class-name"><span class="token keyword keyword-class">class</span></span> <span class="token function">LibroDto</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> Libro<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> Autor<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> Paginas<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-override">override</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token interpolation-string"><span class="token string">$"Libro: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Libro</span><span class="token punctuation">}</span></span><span class="token string">\nAutor: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Autor</span><span class="token punctuation">}</span></span><span class="token string">\nPáginas: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Paginas</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>LibroDto<span class="token punctuation">&gt;</span></span> <span class="token function">LibrosDeMenosdeMilPaginas</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
Datos<span class="token punctuation">.</span>Autores<span class="token punctuation">.</span><span class="token function">SelectMany</span><span class="token punctuation">(</span>
            a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Libros<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>l <span class="token operator">=&gt;</span> l<span class="token punctuation">.</span>Paginas <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">)</span>
                         <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>l <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">LibroDto</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">Libro</span><span class="token punctuation">:</span> l<span class="token punctuation">.</span>Titulo<span class="token punctuation">,</span> <span class="token named-parameter punctuation">Autor</span><span class="token punctuation">:</span> a<span class="token punctuation">.</span>Nombre<span class="token punctuation">,</span> <span class="token named-parameter punctuation">Paginas</span><span class="token punctuation">:</span> l<span class="token punctuation">.</span>Paginas<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><p>Posteriormente si ejecutamos ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>LibroDto<span class="token punctuation">&gt;</span></span> librosDeMenosDeMilPaginasDto <span class="token operator">=</span> <span class="token function">LibrosDeMenosdeMilPaginas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">"\n\n"</span><span class="token punctuation">,</span> librosDeMenosDeMilPaginasDto<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div style="page-break-after:always;"></div>
<p>Generando la siguiente salida por consola...</p>
<pre class="salida_consola">Libro: Macbeth
Autor: William Shakespeare
Páginas: 128

Libro: La tempestad
Autor: William Shakespeare
Páginas: 160

Libro: La Galatea
Autor: Miguel de Cervantes
Páginas: 664

Libro: Los trabajos de Persiles y Sigismunda
Autor: Miguel de Cervantes
Páginas: 888

Libro: La Celestina
Autor: Fernando de Rojas
Páginas: 160
</pre> <!-- fin salida consola -->
</div> <!-- fin ejemplo -->
<div style="page-break-after:always;"></div>
<div class="box_bg_lightgray">
<p>🎓 <strong>Caso de estudio:</strong> (Puedes descargarlo desde <strong><a href="assets/ejemplos/autores_libros_consultas_ejemplo.cs">este enlace</a></strong>).</p>
<p>Vamos a realizar varias consultas sobre el código del ejemplo anterior donde tenemos libros por autor. <strong>Intenta pensarlas sin mirar la propuesta de solución.</strong></p>
<ol>
<li>
<p><strong>Nombres</strong> de autores que <strong>tienen más de un libro</strong> ordenados alfabéticamente.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Consulta 1: Nombres de autores con más de un libro ordenados."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword keyword-string">string</span><span class="token punctuation">&gt;</span></span> nombreAutoresConMasDeUnLibro <span class="token operator">=</span> Datos<span class="token punctuation">.</span>Autores
                                                        <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Libros<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>
                                                        <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Nombre<span class="token punctuation">)</span>
                                                        <span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> nombreAutoresConMasDeUnLibro<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <pre class="salida_consola"> Consulta 1: Nombres de autores con más de un libro ordenados.
 Miguel de Cervantes
 William Shakespeare</pre> <!-- fin salida consola -->
</li>
<li>
<p>Total de <strong>libros</strong> escritos por escritores de <strong>nacionalidad Española</strong>.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Consulta 2: Total de libros escritos por escritores Españoles."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-var">var</span></span> totalLibros <span class="token operator">=</span> Datos<span class="token punctuation">.</span>Autores
                       <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Nacionalidad <span class="token operator">==</span> <span class="token string">"Española"</span><span class="token punctuation">)</span>
                       <span class="token punctuation">.</span><span class="token function">SelectMany</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Libros<span class="token punctuation">)</span>
                       <span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Hay </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">totalLibros</span><span class="token punctuation">}</span></span><span class="token string"> libros escritos por españoles\n"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <pre class="salida_consola"> Consulta 2: Total de libros escritos por escritores Españoles.
 Hay 5 libros escritos por españoles</pre> <!-- fin salida consola -->
 <div style="page-break-after:always;"></div>
</li>
<li>
<p><strong>Nombre</strong> y <strong>año muerte</strong> de Autores <strong>agrupados por siglo</strong> en el que murioeron.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Consulta 3: Nombre y año muerte de Autores agrupados por siglo en el que murioeron."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-var">var</span></span> autoresFallecidosPorSiglos <span class="token operator">=</span> Datos<span class="token punctuation">.</span>Autores
                                        <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span> Autor <span class="token operator">=</span> a<span class="token punctuation">.</span>Nombre<span class="token punctuation">,</span> AñoMuerte <span class="token operator">=</span> a<span class="token punctuation">.</span>Muerte<span class="token punctuation">.</span>Year <span class="token punctuation">}</span><span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>AñoMuerte<span class="token punctuation">)</span>
                                        <span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>AñoMuerte <span class="token operator">/</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
                                                <span class="token punctuation">(</span>siglo<span class="token punctuation">,</span> autores<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span>
                                                <span class="token punctuation">{</span>
                                                    Siglo <span class="token operator">=</span> siglo<span class="token punctuation">,</span>
                                                    Autores <span class="token operator">=</span> autores
                                                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">StringBuilder</span> salida <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-var">var</span></span> autoresXSiglo <span class="token keyword keyword-in">in</span> autoresFallecidosPorSiglos<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    salida<span class="token punctuation">.</span><span class="token function">AppendLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Siglo </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">autoresXSiglo<span class="token punctuation">.</span>Siglo</span><span class="token punctuation">}</span></span><span class="token string">:"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-var">var</span></span> autor <span class="token keyword keyword-in">in</span> autoresXSiglo<span class="token punctuation">.</span>Autores<span class="token punctuation">)</span>
        salida<span class="token punctuation">.</span><span class="token function">AppendLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"\t</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">autor<span class="token punctuation">.</span>Autor</span><span class="token punctuation">}</span></span><span class="token string"> fallecido en </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">autor<span class="token punctuation">.</span>AñoMuerte</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>salida<span class="token punctuation">)</span><span class="token punctuation">;</span>      
</code></pre> <pre class="salida_consola"> Consulta 3: Nombre y año muerte de Autores agrupados por siglo en el que murioeron.
 Siglo 16:
         Fernando de Rojas fallecido en 1541
 Siglo 17:
         William Shakespeare fallecido en 1616
         Miguel de Cervantes fallecido en 1616</pre> <!-- fin salida consola -->
</li>
<li>
<p>Total de <strong>páginas</strong> escritas por <strong>William Shakespeare</strong>.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Consulta 4: Número total de páginas escritas por William Shakespeare."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-var">var</span></span> totalPaginas <span class="token operator">=</span> Datos<span class="token punctuation">.</span>Autores<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Nombre <span class="token operator">==</span> <span class="token string">"William Shakespeare"</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">SelectMany</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Libros<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>l <span class="token operator">=&gt;</span> l<span class="token punctuation">.</span>Paginas<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"William Shakespeare escribió </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">totalPaginas</span><span class="token punctuation">}</span></span><span class="token string"> páginas."</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <pre class="salida_consola"> Consulta 4: Número total de páginas escritas por William Shakespeare.
 William Shakespeare escribió 288 páginas.</pre> <!-- fin salida consola -->
</li>
</ol>
</div> <!-- fin caso de estudio -->
<div style="page-break-after:always;"></div>
<h2 id="anexo-i-concepto-de-recursión-de-funciones-o-recursividad">Anexo I: Concepto de Recursión de funciones o Recursividad </h2>
<h3 id="definiciones">Definiciones </h3>
<p><strong>Llamada recursiva</strong>: Se produce cuando un método se llama a si mismo para realizar el proceso u obtener el valor de retorno.<br>
<strong>Recursividad</strong>: La capacidad de un módulo de llamarse a si mismo.<br>
<strong>Algoritmo recursivo</strong>: Un algoritmo resuelto mediante <strong><a href="https://en.wikipedia.org/wiki/Recursion_(computer_science)">recursividad</a></strong>.</p>
<div class="admonition tip">
<p class="admonition-title">Importante</p>
<p>Cualquier <strong>algoritmo recursivo</strong> tiene un equivalente <strong>iterativo</strong>.</p>
</div>
<h3 id="-ventajas">✅ Ventajas </h3>
<p>Existen problemas cuya <strong>solución natural es claramente recursiva</strong> con lo que el algoritmo resulta <strong>muy simple y claro frente</strong> a la solución iterativa. Por ejemplo ...</p>
<ul>
<li>El recorrido de colecciones tipo <strong>árbol</strong> o <strong>grafo</strong>.</li>
<li>Algoritmos que generan árboles en la búsqueda de una solución como el <strong><a href="https://en.wikipedia.org/wiki/Backtracking">Backtracking</a></strong>.</li>
</ul>
<h3 id="-desventajas">❌ Desventajas </h3>
<ul>
<li>Generalmente es <strong>menos eficiente</strong> que la solución iterativa. Aunque se puede aliviar con una técnica denominada <strong>memoization</strong>.</li>
<li>Consume muchos más recursos.</li>
<li>Puede llevar al <strong>desbordamiento de la pila</strong> de llamadas o (<strong>Stack Overflow</strong>).</li>
</ul>
<div class="contenedor">
    <div class="fondo">
        <div class="abre_comilla">"</div>
        <div class="cierra_comilla">"</div>
        <div class="cita">To understand recursion, one must first understand recursion.</div>
        <div class="autor">- Etephen Hawking</div>
    </div>
</div>
<div style="page-break-after:always;"></div>
<h3 id="tipos-de-recursividad">Tipos de recursividad </h3>
<div class="row">
<div class="col-sm-6">
<p><strong>Recursividad directa</strong>: se produce cuando un subprograma o módulo se llama a si mismo.</p>
<p><strong>Recursividad indirecta</strong>: se produce cuando un subprograma o módulo <strong>A</strong> llama a otro <strong>B</strong> que acaba llamando de nuevo a <strong>A</strong>.</p>
</div>
<div class="col-sm-6">
<p></p><p align="center" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="250pt" height="130pt" viewBox="0.00 0.00 250.00 130.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.55 0.55) rotate(0) translate(10.19 229.48)">
<title>G</title>
<polygon fill="white" stroke="none" points="-10.19,6.88 -10.19,-229.48 444.36,-229.48 444.36,6.88 -10.19,6.88"></polygon>
<!-- PP -->
<g id="node1" class="node">
<title>PP</title>
<polygon fill="none" stroke="black" points="241.15,-218.6 163.68,-218.6 163.68,-177 241.15,-177 241.15,-218.6"></polygon>
<polygon fill="none" stroke="black" points="245.15,-222.6 159.68,-222.6 159.68,-173 245.15,-173 245.15,-222.6"></polygon>
<text text-anchor="middle" x="202.41" y="-202" font-family="Arial" font-size="14.00">Programa</text>
<text text-anchor="middle" x="202.41" y="-185.2" font-family="Arial" font-size="14.00">Principal</text>
</g>
<!-- A -->
<g id="node2" class="node">
<title>A</title>
<polygon fill="none" stroke="black" points="133.83,-136 33,-136 33,-94.4 133.83,-94.4 133.83,-136"></polygon>
<text text-anchor="middle" x="83.41" y="-119.4" font-family="Arial" font-size="14.00">Subprograma</text>
<text text-anchor="middle" x="83.41" y="-102.6" font-family="Arial" font-size="14.00">A</text>
</g>
<!-- PP&#45;&gt;A -->
<g id="edge1" class="edge">
<title>PP-&gt;A</title>
<path fill="none" stroke="black" d="M166.71,-172.62C152.8,-163.2 136.82,-152.37 122.6,-142.74"></path>
<polygon fill="black" stroke="black" points="124.58,-139.85 114.33,-137.14 120.65,-145.65 124.58,-139.85"></polygon>
</g>
<!-- D -->
<g id="node5" class="node">
<title>D</title>
<polygon fill="none" stroke="black" points="252.83,-136 152,-136 152,-94.4 252.83,-94.4 252.83,-136"></polygon>
<text text-anchor="middle" x="202.41" y="-119.4" font-family="Arial" font-size="14.00">Subprograma</text>
<text text-anchor="middle" x="202.41" y="-102.6" font-family="Arial" font-size="14.00">D</text>
</g>
<!-- PP&#45;&gt;D -->
<g id="edge5" class="edge">
<title>PP-&gt;D</title>
<path fill="none" stroke="black" d="M202.41,-172.62C202.41,-164.74 202.41,-155.87 202.41,-147.55"></path>
<polygon fill="black" stroke="black" points="205.91,-147.81 202.41,-137.81 198.91,-147.81 205.91,-147.81"></polygon>
</g>
<!-- E -->
<g id="node6" class="node">
<title>E</title>
<polygon fill="none" stroke="black" points="371.83,-136 271,-136 271,-94.4 371.83,-94.4 371.83,-136"></polygon>
<text text-anchor="middle" x="321.41" y="-119.4" font-family="Arial" font-size="14.00">Subprograma</text>
<text text-anchor="middle" x="321.41" y="-102.6" font-family="Arial" font-size="14.00">E</text>
</g>
<!-- PP&#45;&gt;E -->
<g id="edge6" class="edge">
<title>PP-&gt;E</title>
<path fill="none" stroke="black" d="M238.12,-172.62C252.02,-163.2 268.01,-152.37 282.23,-142.74"></path>
<polygon fill="black" stroke="black" points="284.18,-145.65 290.49,-137.14 280.25,-139.85 284.18,-145.65"></polygon>
</g>
<!-- B -->
<g id="node3" class="node">
<title>B</title>
<polygon fill="none" stroke="black" points="100.83,-41.6 0,-41.6 0,0 100.83,0 100.83,-41.6"></polygon>
<text text-anchor="middle" x="50.41" y="-25" font-family="Arial" font-size="14.00">Subprograma</text>
<text text-anchor="middle" x="50.41" y="-8.2" font-family="Arial" font-size="14.00">B</text>
</g>
<!-- A&#45;&gt;B -->
<g id="edge2" class="edge">
<title>A-&gt;B</title>
<path fill="none" stroke="black" d="M72.34,-94.16C69.5,-88.52 66.63,-82.32 64.41,-76.4 61.66,-69.04 59.25,-60.92 57.25,-53.24"></path>
<polygon fill="black" stroke="black" points="60.65,-52.44 54.88,-43.56 53.85,-54.1 60.65,-52.44"></polygon>
</g>
<!-- C -->
<g id="node4" class="node">
<title>C</title>
<polygon fill="none" stroke="black" points="219.83,-41.6 119,-41.6 119,0 219.83,0 219.83,-41.6"></polygon>
<text text-anchor="middle" x="169.41" y="-25" font-family="Arial" font-size="14.00">Subprograma</text>
<text text-anchor="middle" x="169.41" y="-8.2" font-family="Arial" font-size="14.00">C</text>
</g>
<!-- A&#45;&gt;C -->
<g id="edge4" class="edge">
<title>A-&gt;C</title>
<path fill="none" stroke="black" d="M108.43,-94.26C114.86,-88.72 121.6,-82.54 127.41,-76.4 134.76,-68.64 142.1,-59.65 148.54,-51.22"></path>
<polygon fill="black" stroke="black" points="151.3,-53.37 154.47,-43.27 145.69,-49.19 151.3,-53.37"></polygon>
</g>
<!-- B&#45;&gt;A -->
<g id="edge3" class="edge">
<title>B-&gt;A</title>
<path fill="none" stroke="red" d="M57.56,-41.81C61.92,-54.03 67.59,-69.9 72.51,-83.67"></path>
<polygon fill="red" stroke="red" points="69.08,-84.48 75.74,-92.73 75.68,-82.13 69.08,-84.48"></polygon>
<text text-anchor="middle" x="96.72" y="-63.8" font-family="Arial" font-size="14.00" fill="red">Indirecta</text>
</g>
<!-- E&#45;&gt;E -->
<g id="edge7" class="edge">
<title>E:n-&gt;E:s</title>
<path fill="none" stroke="darkgreen" d="M321.41,-136C344.22,-145.82 389.83,-145.82 389.83,-115.2 389.83,-88.88 356.14,-85.18 332.2,-90.9"></path>
<polygon fill="darkgreen" stroke="darkgreen" points="331.28,-87.51 322.85,-93.93 333.45,-94.17 331.28,-87.51"></polygon>
<text text-anchor="middle" x="412" y="-111" font-family="Arial" font-size="14.00" fill="darkgreen">Directa</text>
</g>
</g>
</svg>
</p><p></p>
</div>
</div>
<div class="admonition danger">
<p class="admonition-title"><strong>Peligro</strong>: La <strong>recursividad indirecta</strong>, no deberíamos usarla <strong>en ningún caso</strong>.</p>
</div>
<h3 id="diseño-de-un-algoritmo-recursivo">Diseño de un algoritmo recursivo </h3>
<p>Necesitaremos definir o buscar dos cosas:</p>
<ol>
<li>
<p><strong>El caso general</strong></p>
<ul>
<li>Deberemos subdividir el problema en <strong>versiones menores de si mismo</strong>.
<ul>
<li>Pueden darse varios casos generales.</li>
<li>Todos <strong>tenderán</strong> a un determinado caso base.</li>
</ul>
</li>
<li>Deberemos confiar en que la llamada recursiva va a hacer su trabajo y va a solucionar o devolver parte del problema.</li>
</ul>
</li>
<li>
<p><strong>Al menos una caso base</strong></p>
<ul>
<li>Condición de salida de la recursividad o llamada recursiva, donde el caso general ya no se puede subdividir más y donde dejamos de hacer llamadas recursivas.</li>
<li>Pueden darse varios casos base.</li>
<li>Si <strong>no existe el caso base</strong>, no saldríamos de la recursividad y se produciría un <strong>Stack Overflow 💀</strong>.</li>
</ul>
</li>
</ol>
<h3 id="punto-de-vista-desde-el-lenguaje-csharp">Punto de vista desde el lenguaje CSharp </h3>
<ul>
<li>Tendremos una <strong>pila de llamadas</strong> al mismo método.</li>
<li>En cada llamada se apilan o <em>'guardan'</em> y no se modifican los objetos locales y parámetros del método llamador.</li>
<li>Al recuperar el control, el valor de los objetos apilados es recuperado.</li>
<li>Es interesante usar el depurador para ver como funcionan este tipo de programas.</li>
</ul>
<div class="box_bg_lightgray">
<p><strong>Ejemplo:</strong></p>
<p>Veámoslo a través de un problema que ya hemos solucionado de forma iterativa, pero que tiene una solución matemática natural recursiva.</p>
<p>Vamos a implementar una <strong>función recursiva para calcular el factorial de un número entero</strong>. Recordemos que el factorial se simboliza como <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo stretchy="false">!</mo></mrow><annotation encoding="application/x-tex">n!</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">n</span><span class="mclose">!</span></span></span></span>, se lee como '<em>n factorial</em>', y la definición es: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo stretchy="false">!</mo><mo>=</mo><mi>n</mi><mo>×</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>×</mo><mo stretchy="false">(</mo><mi>n</mi><mo>−</mo><mn>2</mn><mo stretchy="false">)</mo><mo>×</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo>×</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n! = n \times (n-1) \times (n-2) \times ... \times 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">n</span><span class="mclose">!</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">...</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>. Además, no se puede calcular el factorial de números negativos, y el factorial de 0 es 1, de modo que una función bien hecha para cálculo de factoriales debería incluir un control para esos casos.</p>
<p>Pasos:</p>
<ol>
<li>La función debería tener un interfaz descriptivo, tal y como lo tiene la iterativa, esto es: <strong><code>ulong Factorial(ulong n)</code></strong></li>
<li>Identificaremos el caso base, en este caso es <strong>si n = 0 → !n = 1</strong></li>
<li>Identificaremos el caso general, esto es, cómo descomponer el problema de tal manera que tienda al caso base. En este caso será <strong>n! = n X (n - 1)!</strong></li>
</ol>
<div class="row">
<div class="col-sm-8 my-auto">
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-ulong">ulong</span></span> <span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-ulong">ulong</span></span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-ulong">ulong</span></span> valor<span class="token punctuation">;</span>

    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>        
        valor <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                      <span class="token comment">// Caso Base</span>
    <span class="token keyword keyword-else">else</span>        
        valor <span class="token operator">=</span> n <span class="token operator">*</span> <span class="token function">Factorial</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Caso General</span>
    <span class="token keyword keyword-return">return</span> valor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>La variable local <strong><code>valor</code></strong> y el parámetro formal <strong><code>n</code></strong> será diferente en cada llamada y se liberarán de memoria en cuanto se <strong>desapilen</strong> la llamadas a la función.</p>
<p>Si ejecutásemos el siguiente código:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">Factorial</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div class="col-sm-4">
<p></p><p align="center" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="110pt" height="260pt" viewBox="0.00 0.00 110.00 260.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.6 0.6) rotate(0) translate(4.02 427.47)">
<title>G</title>
<!-- P4 -->
<g id="node1" class="node">
<title>P4</title>
<polygon fill="none" stroke="black" points="133.89,-421.6 1.16,-421.6 1.16,-380 133.89,-380 133.89,-421.6"></polygon>
<text text-anchor="middle" x="67.52" y="-405" font-family="Arial" font-size="14.00">Caso Base retorna</text>
<text text-anchor="middle" x="67.52" y="-388.2" font-family="Arial" font-size="14.00">1</text>
</g>
<!-- P3 -->
<g id="node2" class="node">
<title>P3</title>
<polygon fill="none" stroke="black" points="135.04,-327.2 0,-327.2 0,-285.6 135.04,-285.6 135.04,-327.2"></polygon>
<text text-anchor="middle" x="67.52" y="-310.6" font-family="Arial" font-size="14.00">Factorial(1) retorna</text>
<text text-anchor="middle" x="67.52" y="-293.8" font-family="Arial" font-size="14.00">1 * Factorial(1-1)</text>
</g>
<!-- P4&#45;&gt;P3 -->
<g id="edge5" class="edge">
<title>P4:e-&gt;P3:e</title>
<path fill="none" stroke="Black" d="M134.89,-400.8C172.75,-400.8 177.38,-323.94 147.1,-308.92"></path>
<polygon fill="Black" stroke="Black" points="148.04,-305.55 137.52,-306.74 146.49,-312.37 148.04,-305.55"></polygon>
<text text-anchor="middle" x="170.83" y="-349.4" font-family="Arial" font-size="14.00">1</text>
</g>
<!-- P3&#45;&gt;P4 -->
<g id="edge4" class="edge">
<title>P3-&gt;P4</title>
<path fill="none" stroke="Gray" d="M67.52,-327.45C67.52,-339.44 67.52,-354.93 67.52,-368.5"></path>
<polygon fill="Gray" stroke="Gray" points="64.02,-368.28 67.52,-378.28 71.02,-368.28 64.02,-368.28"></polygon>
<text text-anchor="middle" x="79.39" y="-349.4" font-family="Arial" font-size="14.00" fill="Gray">n=0</text>
</g>
<!-- P2 -->
<g id="node3" class="node">
<title>P2</title>
<polygon fill="none" stroke="black" points="135.04,-232.8 0,-232.8 0,-191.2 135.04,-191.2 135.04,-232.8"></polygon>
<text text-anchor="middle" x="67.52" y="-216.2" font-family="Arial" font-size="14.00">Factorial(2) retorna</text>
<text text-anchor="middle" x="67.52" y="-199.4" font-family="Arial" font-size="14.00">2 * Factorial(2-1)</text>
</g>
<!-- P3&#45;&gt;P2 -->
<g id="edge6" class="edge">
<title>P3:e-&gt;P2:e</title>
<path fill="none" stroke="Black" d="M136.04,-306.4C173.9,-306.4 177.6,-229.54 147.13,-214.52"></path>
<polygon fill="Black" stroke="Black" points="148.04,-211.14 137.52,-212.34 146.49,-217.97 148.04,-211.14"></polygon>
<text text-anchor="middle" x="171.4" y="-255" font-family="Arial" font-size="14.00">1</text>
</g>
<!-- P2&#45;&gt;P3 -->
<g id="edge3" class="edge">
<title>P2-&gt;P3</title>
<path fill="none" stroke="Gray" d="M67.52,-233.05C67.52,-245.04 67.52,-260.53 67.52,-274.1"></path>
<polygon fill="Gray" stroke="Gray" points="64.02,-273.88 67.52,-283.88 71.02,-273.88 64.02,-273.88"></polygon>
<text text-anchor="middle" x="79.39" y="-255" font-family="Arial" font-size="14.00" fill="Gray">n=1</text>
</g>
<!-- P1 -->
<g id="node4" class="node">
<title>P1</title>
<polygon fill="none" stroke="black" points="135.04,-138.4 0,-138.4 0,-96.8 135.04,-96.8 135.04,-138.4"></polygon>
<text text-anchor="middle" x="67.52" y="-121.8" font-family="Arial" font-size="14.00">Factorial(3) retorna</text>
<text text-anchor="middle" x="67.52" y="-105" font-family="Arial" font-size="14.00">3 * Factorial(3-1)</text>
</g>
<!-- P2&#45;&gt;P1 -->
<g id="edge7" class="edge">
<title>P2:e-&gt;P1:e</title>
<path fill="none" stroke="Black" d="M136.04,-212C173.9,-212 177.6,-135.14 147.13,-120.12"></path>
<polygon fill="Black" stroke="Black" points="148.04,-116.74 137.52,-117.94 146.49,-123.57 148.04,-116.74"></polygon>
<text text-anchor="middle" x="171.4" y="-160.6" font-family="Arial" font-size="14.00">2</text>
</g>
<!-- P1&#45;&gt;P2 -->
<g id="edge2" class="edge">
<title>P1-&gt;P2</title>
<path fill="none" stroke="Gray" d="M67.52,-138.65C67.52,-150.64 67.52,-166.13 67.52,-179.7"></path>
<polygon fill="Gray" stroke="Gray" points="64.02,-179.48 67.52,-189.48 71.02,-179.48 64.02,-179.48"></polygon>
<text text-anchor="middle" x="79.39" y="-160.6" font-family="Arial" font-size="14.00" fill="Gray">n=2</text>
</g>
<!-- M -->
<g id="node5" class="node">
<title>M</title>
<polygon fill="none" stroke="black" points="94.52,-40 40.52,-40 40.52,-4 94.52,-4 94.52,-40"></polygon>
<polygon fill="none" stroke="black" points="98.52,-44 36.52,-44 36.52,0 98.52,0 98.52,-44"></polygon>
<text text-anchor="middle" x="67.52" y="-17.8" font-family="Arial" font-size="14.00">Main</text>
</g>
<!-- P1&#45;&gt;M -->
<g id="edge8" class="edge">
<title>P1:e-&gt;M:e</title>
<path fill="none" stroke="Black" d="M136.04,-117.6C177.7,-117.6 150.56,-37.38 110.75,-23.91"></path>
<polygon fill="Black" stroke="Black" points="111.46,-20.48 101.01,-22.25 110.28,-27.38 111.46,-20.48"></polygon>
<text text-anchor="middle" x="158.57" y="-66.2" font-family="Arial" font-size="14.00">6</text>
</g>
<!-- M&#45;&gt;P1 -->
<g id="edge1" class="edge">
<title>M-&gt;P1</title>
<path fill="none" stroke="Gray" d="M67.52,-44.24C67.52,-56.34 67.52,-71.72 67.52,-85.19"></path>
<polygon fill="Gray" stroke="Gray" points="64.02,-84.89 67.52,-94.89 71.02,-84.89 64.02,-84.89"></polygon>
<text text-anchor="middle" x="79.39" y="-66.2" font-family="Arial" font-size="14.00" fill="Gray">n=3</text>
</g>
</g>
</svg>
</p><p></p>
</div>
</div>
</div> <!-- fin ejemplo -->
<div style="page-break-after:always;"></div>
<h4 id="usando-funciones-lambda-lambda">Usando funciones Lambda (λ) </h4>
<p>Para expresar la función factorial anterior con expresiones lambda haríamos algo cómo ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> factorial <span class="token operator">=</span> n <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>n <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> n <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><p>Pero como aún no hemos completado la instrucción donde <strong>definimos</strong> el identificador del delegado factorial <strong>nos dice que aún no existe al usarlo</strong>.</p>
<p>Existen varias soluciones al problema '<em>elegantes</em>' desde el punto de vista <strong>funcional y matemático</strong>. Pero una solución muy simple sería definir primero el <strong>identificador</strong> que referencia al delegado asignándole <strong><code>default</code></strong>.</p>
<p>Cómo ya está definido el identificador y es una referencia a un delegado. Podremos <strong>reasignarlo</strong> haciendo una clausura dentro del mismo la referencia.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> factorial <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
factorial <span class="token operator">=</span> n <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>n <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> n <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="box_bg_lightgray">
<p>🚀 <strong>Ampliación opcional:</strong></p>
<p>Fíjate que la implementación en otros lenguajes es similar, pero en los lenguajes dinámicos como JavaScript o Python no es necesario definir el tipo antes como sucede en C# o Kotlin.</p>
<p><strong>JavaScript:</strong></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-let">let</span> <span class="token function-variable function">factorial</span> <span class="token operator">=</span> <span class="token parameter">n</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">(</span>n <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> n <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><p><strong>Python:</strong></p>
<pre data-role="codeBlock" data-info="python" class="language-python python"><code>factorial <span class="token operator">=</span> <span class="token keyword keyword-lambda">lambda</span> n <span class="token punctuation">:</span> n <span class="token operator">*</span> factorial<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>n <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword keyword-else">else</span> <span class="token number">1</span>
<span class="token keyword keyword-print">print</span><span class="token punctuation">(</span>factorial<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><p><strong>Kotlin:</strong></p>
<pre data-role="codeBlock" data-info="kotlin" class="language-kotlin kotlin"><code><span class="token keyword keyword-var">var</span> factorial<span class="token operator">:</span> <span class="token punctuation">(</span>Int<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> Int
factorial <span class="token operator">=</span> <span class="token punctuation">{</span> n <span class="token operator">-&gt;</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>n <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> n <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-else">else</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token function">println</span><span class="token punctuation">(</span><span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div>
<div class="box_bg_lightgray">
<p><strong>Ejemplo 1:</strong></p>
<p>Vamos ha hacer una <strong>función recursiva que calcule la potencia de un numero</strong>.</p>
<p><strong>Interfaz</strong>: <strong><code>double Pow(double b, int e)</code></strong> ... Debería ser igual que el de la iterativa.<br>
<strong>Caso Base</strong>: b<sup>0</sup> → 1<br>
<strong>Caso General</strong>: b<sup>e</sup> → b x b<sup>e-1</sup></p>
<div class="row">
<div class="col-sm-5 my-auto">
<p><strong>Propuesta de solución</strong>:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-double">double</span></span> <span class="token function">Pow</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-double">double</span></span> b<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-double">double</span></span> p<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>e <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment">// Caso Base</span>
        p <span class="token operator">=</span> <span class="token number">1d</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-else">else</span>
        <span class="token comment">// Caso General</span>
        p <span class="token operator">=</span> b <span class="token operator">*</span> <span class="token function">Pow</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> e <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div class="col-sm-7">
<p><strong>Propuesta con λ</strong>:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-double">double</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">&gt;</span></span> pow <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
pow <span class="token operator">=</span> <span class="token punctuation">(</span>b<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> e <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">?</span> b <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> e <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token number">1d</span><span class="token punctuation">;</span>
</code></pre></div>
</div>
</div>
<div style="page-break-after:always;"></div>
<div class="box_bg_lightgray">
<p><strong>Ejemplo 2:</strong></p>
<p>Vamos a implementar una función que dado un número decimal de entrada, me devuelva una cadena con su representación en binario (base 2). En este ejemplo es un poco más difícil de ver el caso base y general.</p>
<p><strong>Interfaz</strong>: <strong><code>string Binario(int valorDecimal)</code></strong><br>
<em>Caso Base</em>*: Habrá dos casos base que son los valores que no necesitan conversión por ser menores que 2 que que són los dos posibles cocientes que concatenaré en primer lugar ...</p>
<ol>
<li>valorDecimal = 0 → cadenaBinaria = "0"</li>
<li>valorDecimal = 1 → cadenaBinaria = "1"<br>
<strong>Caso General</strong>:  Binario(valorDecimal / 2) + "Resto de dividir valorDecimal por 2"<br>
Como he concatenar los restos de del último al primero, por eso voy concatenando los restos por la derecha.</li>
</ol>
<div class="row">
<div class="col-sm-5 my-auto">
<p><strong>Propuesta de solución:</strong></p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">Binario</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> valorDecimal<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-string">string</span></span> cadenaBinaria<span class="token punctuation">;</span>
    <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>valorDecimal<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">0</span><span class="token punctuation">:</span>
            cadenaBinaria <span class="token operator">=</span> <span class="token string">"0"</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
            cadenaBinaria <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-default">default</span><span class="token punctuation">:</span>
            cadenaBinaria <span class="token operator">=</span> 
            <span class="token function">Binario</span><span class="token punctuation">(</span>valorDecimal <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> 
            <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">valorDecimal <span class="token operator">%</span> <span class="token number">2</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
            <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> cadenaBinaria<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div class="col-sm-7">
<p><strong>Propuesta con λ</strong>:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">&gt;</span></span> binario <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
binario <span class="token operator">=</span> d <span class="token operator">=&gt;</span> d <span class="token keyword keyword-switch">switch</span>
<span class="token punctuation">{</span>
    <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token string">"0"</span><span class="token punctuation">,</span>
    <span class="token number">1</span> <span class="token operator">=&gt;</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
    _ <span class="token operator">=&gt;</span> <span class="token function">binario</span><span class="token punctuation">(</span>d <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">d <span class="token operator">%</span> <span class="token number">2</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">binario</span><span class="token punctuation">(</span><span class="token number">44</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Mostrará "101100"</span>

<span class="token comment">// Algo más ofuscada podría ser la siguiente expresión.</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">&gt;</span></span> binario <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
binario <span class="token operator">=</span> d <span class="token operator">=&gt;</span> d <span class="token operator">&gt;</span> <span class="token number">1</span> 
          <span class="token punctuation">?</span> <span class="token function">binario</span><span class="token punctuation">(</span>d <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">d <span class="token operator">%</span> <span class="token number">2</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span> 
          <span class="token punctuation">:</span> <span class="token punctuation">(</span>d <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">?</span> <span class="token string">"0"</span> <span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
</div>
</div>
<div style="page-break-after:always;"></div>
<div class="box_bg_lightgray">
<p><strong>Ejemplo 3:</strong></p>
<p>Dada una cadena de entrada, implementar una función recursiva que me devuelva su inversa.</p>
<p><strong>Interfaz</strong>: <strong><code>string Invierte(string t)</code></strong><br>
<strong>Caso Base</strong>: Si la longitud de la cadena de entrada es 1 su inversa es ella misma.<br>
<strong>Caso General</strong>: Invierte(t menos la primera letra) + primera letra de t</p>
<div class="row">
<div class="col-sm-7 my-auto">
<p><strong>Propuesta de solución:</strong></p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">Invierte</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> t<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-string">string</span></span> invertida<span class="token punctuation">;</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>
        invertida <span class="token operator">=</span> 
        <span class="token function">Invierte</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>Length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
        <span class="token operator">+</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-else">else</span>
        invertida <span class="token operator">=</span> t<span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> invertida<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div class="col-sm-5">
<p><strong>Propuesta con λ:</strong></p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-string">string</span><span class="token punctuation">,</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">&gt;</span></span> invierte <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
invierte <span class="token operator">=</span> t <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">1</span> 
           <span class="token punctuation">?</span> <span class="token function">invierte</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">1</span><span class="token range operator">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> 
           <span class="token punctuation">:</span> t<span class="token punctuation">;</span>
</code></pre></div>
</div>
</div>
<div class="admonition summary">
<p class="admonition-title">Resumen</p>
<p>Existen problemas típicos mucho más complejos a resolver mediante recursividad pero quedan fuera de lo que pretende este tema que es una mera introducción al concepto.</p>
</div>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>