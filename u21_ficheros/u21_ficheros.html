<!DOCTYPE html><html><head>
      <title>Programación 1º DAM Unidad 21</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/katex.min.css">
      
      
      
      
      
      <style>
      @import url(https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css);
code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}@font-face{font-family:"Material Icons";font-style:normal;font-weight:400;src:local("Material Icons"),local("MaterialIcons-Regular"),url("data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAAfIAAsAAAAADDAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAARAAAAFZW7kosY21hcAAAAYAAAADTAAACjtP6ytBnbHlmAAACVAAAAxgAAAQ4zRtvlGhlYWQAAAVsAAAALwAAADYRwZsnaGhlYQAABZwAAAAcAAAAJAeKAzxobXR4AAAFuAAAABIAAAA8OGQAAGxvY2EAAAXMAAAAIAAAACAG5AfwbWF4cAAABewAAAAfAAAAIAEfAERuYW1lAAAGDAAAAVcAAAKFkAhoC3Bvc3QAAAdkAAAAYgAAAK2vz7wkeJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2BkPsQ4gYGVgYOpk+kMAwNDP4RmfM1gxMjBwMDEwMrMgBUEpLmmMDgwVLy4xKzzX4chhrmK4QpQmBEkBwAZygyweJzFkr0NwjAQhZ+TEP6CRUfHBEwRUWaQTICyQbpMwRCskA5RUIONxG0RnnNpKAIV4qzPku/8c353ACYAYrIjCWCuMAh2ptf0/hiL3p/gyPUWa3osqlt0L1zu9r71z8dGrJRykFoauXQd932Lj5vhG+MjxGeYI8MKETObMpslf5EyP8tg+vHun5r539PvlvXzaVhRFVQDTPEWKVQR90KhnnC5Ek67vUKN4VuFasM/ldARj43CCkCsEjpJSoVVgRyU0GVSK6wUpFFCx8lFgX0BiXpRPQB4nE2TTWjcRhTH3xttpDhxN7uxPlp3u/FK7moRPixafRijNosxSw/LUsIwNcaEHPZggo/FmEKMCKWU4kNOOftQSlhE8alnH0Ix9BqWnHooPRrTQ0+mnu2bXTu2pPdGM9LM/6c3fwECTM4gBBMYQNqxzLrZAjqYSlqu2TAHZQA0/DQJH6FtzqGDnvbt4Ggwvzw/nL8EfH8kW0fsuRqhgWXZnY7M1picaUL7Du5BHeDzMIl83dAt016wH1qmvtSMo5R6YRJHTR//FXsff/nj/tc/5K9P5d+nP22+fFK5u7v3K39SW3y+OtDKO3L85vD09PD9z5X17a2N1g4tqk01RlqX7gyoEmnsWQtVr4rtZMmukEaFBZxzefkCn11cyKMLZgshRwgTYNoLNXCBz2ja7HvZG7hDpPSNfoo5vs0knK/9hb+rNpu+8kHPgk/Ao4kK3tWtTpSEtvkA9c+wE6UaUdwieNkaHg55tBEtRiEPw1s0+FtrtTcc9two2lhMknV7PZF/cs6+uUFTmpTGbEx7sQCPSLOttHS3GRltqp7SNzVSKzl6aWnZT/CX5k6/v9N3Hh8fHBwffJVjhrC6OgH5dkIt/tPsq+d/PD5Qz7G7efzq1THFjdZVPe/N6ulQ3JnDWSE5junsFsVIiFwL/htf1S5gJ3BfOcUxfHKLnzqpFpyfZ9cX+/5WB6a+Y0pHpzkNrYNVDwMsikK+y7WuLCRg/oFHkA8VT3rDg5ZnU6ktzzINymV0m74Xd5pfIGXyFeVEQSShkzqG7TBBa2OxVRKitLXv7h3uuftXnXq7lz2tZ/WnWa9dx9dCjDhHzmuVQATlmljr9dZErUydSo2Hbi/b1vXtrOeGCk2/8s3ZlO8+ueJT8BVlw5pGw2oYccdSiHHqx0RlabHqdNR9jAETl6PreJcPBnnfpTLnOQ8C3OV8AmQGzouV1iZdeb5SSIoVc8W8/kcDtksUH5FrU6/aqBqNWcMEzxG4DAQ14qRQhi9mWU0rzepKezbjfgCwQKxVYq5ajRgpRqy45CqwkJydcEkbTkvRz8P5/2ZpDTN4nGNgZGBgAOKb6v+/xvPbfGXgZmEAgeuB2kkI+v8bFgbmKiCXg4EJJAoAPyAKhQB4nGNgZGBg1vmvwxDDwgACQJKRARXwAwAzZQHQeJxjYQCCFAYGFgbSMQAcWACdAAAAAAAAAAwALgBgAIQAmADSAQgBIgE8AVABoAHeAfwCHHicY2BkYGDgZ7BgYGMAASYg5gJCBob/YD4DAA/hAWQAeJxlkbtuwkAURMc88gApQomUJoq0TdIQzEOpUDokKCNR0BuzBiO/tF6QSJcPyHflE9Klyyekz2CuG8cr7547M3d9JQO4xjccnJ57vid2cMHqxDWc40G4Tv1JuEF+Fm6ijRfhM+oz4Ra6eBVu4wZvvMFpXLIa40PYQQefwjVc4Uu4Tv1HuEH+FW7i1mkKn6Hj3Am3sHC6wm08Ou8tpSZGe1av1PKggjSxPd8zJtSGTuinyVGa6/Uu8kxZludCmzxMEzV0B6U004k25W35fj2yNlCBSWM1paujKFWZSbfat+7G2mzc7weiu34aczzFNYGBhgfLfcV6iQP3ACkSaj349AxXSN9IT0j16JepOb01doiKbNWt1ovippz6sVYYwsXgX2rGVFIkq7Pl2PNrI6qW6eOshj0xaSq9mpNEZIWs8LZUfOouNkVXxp/d5woqebeYIf4D2J1ywQB4nG3LOw6AIBAE0B384B+PAkgEa+QwNnYmHt+EpXSal5lkSBBnoP8oCFSo0aCFRIceA0ZMmLFAYSW88rmvtMUjG3RiQ9HvpfusM6zWNmtc5H/iPewha50tOt5PS/QBx2IeSwAA") format("woff")}.admonition{box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.2);position:relative;margin:1.5625em 0;padding:0 1.2rem;border-left:.4rem solid rgba(68,138,255,.8);border-radius:.2rem;background-color:rgba(255,255,255,.05);overflow:auto}.admonition>p{margin-top:.8rem}.admonition>.admonition-title{margin:0 -1.2rem;padding:.8rem 1.2rem .8rem 3.6rem;border-bottom:1px solid rgba(68,138,255,.2);background-color:rgba(68,138,255,.1);font-weight:700}.admonition>.admonition-title:before{position:absolute;left:1.2rem;font-size:1.5rem;color:rgba(68,138,255,.8);content:"\E3C9"}.admonition>.admonition-title:before{font-family:Material Icons;font-style:normal;font-variant:normal;font-weight:400;line-height:2rem;text-transform:none;white-space:nowrap;speak:none;word-wrap:normal;direction:ltr}.admonition.abstract,.admonition.summary,.admonition.tldr{border-left-color:rgba(0,176,255,.8)}.admonition.abstract>.admonition-title,.admonition.summary>.admonition-title,.admonition.tldr>.admonition-title{background-color:rgba(0,176,255,.1);border-bottom-color:rgba(0,176,255,.2)}.admonition.abstract>.admonition-title:before,.admonition.summary>.admonition-title:before,.admonition.tldr>.admonition-title:before{color:#00b0ff;content:"\E8D2"}.admonition.hint,.admonition.tip{border-left-color:rgba(0,191,165,.8)}.admonition.hint>.admonition-title,.admonition.tip>.admonition-title{background-color:rgba(0,191,165,.1);border-bottom-color:rgba(0,191,165,.2)}.admonition.hint>.admonition-title:before,.admonition.tip>.admonition-title:before{color:#00bfa5;content:"\E80E"}.admonition.info,.admonition.todo{border-left-color:rgba(0,184,212,.8)}.admonition.info>.admonition-title,.admonition.todo>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.info>.admonition-title:before,.admonition.todo>.admonition-title:before{color:#00b8d4;content:"\E88E"}.admonition.check,.admonition.done,.admonition.success{border-left-color:rgba(0,200,83,.8)}.admonition.check>.admonition-title,.admonition.done>.admonition-title,.admonition.success>.admonition-title{background-color:rgba(0,200,83,.1);border-bottom-color:rgba(0,200,83,.2)}.admonition.check>.admonition-title:before,.admonition.done>.admonition-title:before,.admonition.success>.admonition-title:before{color:#00c853;content:"\E876"}.admonition.faq,.admonition.help,.admonition.question{border-left-color:rgba(100,221,23,.8)}.admonition.faq>.admonition-title,.admonition.help>.admonition-title,.admonition.question>.admonition-title{background-color:rgba(100,221,23,.1);border-bottom-color:rgba(100,221,23,.2)}.admonition.faq>.admonition-title:before,.admonition.help>.admonition-title:before,.admonition.question>.admonition-title:before{color:#64dd17;content:"\E887"}.admonition.attention,.admonition.caution,.admonition.warning{border-left-color:rgba(255,145,0,.8)}.admonition.attention>.admonition-title,.admonition.caution>.admonition-title,.admonition.warning>.admonition-title{background-color:rgba(255,145,0,.1);border-bottom-color:rgba(255,145,0,.2)}.admonition.attention>.admonition-title:before{color:#ff9100;content:"\E417"}.admonition.caution>.admonition-title:before,.admonition.warning>.admonition-title:before{color:#ff9100;content:"\E002"}.admonition.fail,.admonition.failure,.admonition.missing{border-left-color:rgba(255,82,82,.8)}.admonition.fail>.admonition-title,.admonition.failure>.admonition-title,.admonition.missing>.admonition-title{background-color:rgba(255,82,82,.1);border-bottom-color:rgba(255,82,82,.2)}.admonition.fail>.admonition-title:before,.admonition.failure>.admonition-title:before,.admonition.missing>.admonition-title:before{color:#ff5252;content:"\E14C"}.admonition.bug,.admonition.danger,.admonition.error{border-left-color:rgba(255,23,68,.8)}.admonition.bug>.admonition-title,.admonition.danger>.admonition-title,.admonition.error>.admonition-title{background-color:rgba(255,23,68,.1);border-bottom-color:rgba(255,23,68,.2)}.admonition.danger>.admonition-title:before{color:#ff1744;content:"\E3E7"}.admonition.error>.admonition-title:before{color:#ff1744;content:"\E14C"}.admonition.bug>.admonition-title:before{color:#ff1744;content:"\E868"}.admonition.example,.admonition.snippet{border-left-color:rgba(0,184,212,.8)}.admonition.example>.admonition-title,.admonition.snippet>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.example>.admonition-title:before,.admonition.snippet>.admonition-title:before{color:#00b8d4;content:"\E242"}.admonition.cite,.admonition.quote{border-left-color:rgba(158,158,158,.8)}.admonition.cite>.admonition-title,.admonition.quote>.admonition-title{background-color:rgba(158,158,158,.1);border-bottom-color:rgba(158,158,158,.2)}.admonition.cite>.admonition-title:before,.admonition.quote>.admonition-title:before{color:#9e9e9e;content:"\E244"}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v28/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
@page a4landscape {
  size: A4 landscape;
  margin: 1cm;
}
@page a4portrait {
  size: A4 portrait;
  margin: 1cm 1cm 2.5cm 1cm;
}
.markdown-preview.markdown-preview .landscape {
  page: a4landscape;
}
.markdown-preview.markdown-preview .portrait {
  page: a4portrait;
}
.markdown-preview.markdown-preview .box_bg_lightgray {
  background-color: #f5f5f5;
  border: 2px solid #969696;
  padding: 15px;
  margin-top: 15px;
  margin-bottom: 15px;
  border-radius: 5px;
  box-shadow: 0 0 7px 0 rgba(78, 120, 158, 0.1);
}
.markdown-preview.markdown-preview .box_bg_lightgreen {
  background-color: #f5faf5;
  border: 2px solid #969b96;
  padding-left: 15px;
  padding-right: 15px;
  margin-top: 15px;
  margin-bottom: 15px;
  border-radius: 5px;
  box-shadow: 0 0 7px 0 rgba(78, 120, 158, 0.1);
}
.markdown-preview.markdown-preview .salida_consola {
  background-color: #000000;
  color: aquamarine;
  border: 3px solid slategrey;
  padding-top: 15px;
  padding-bottom: 15px;
  padding-left: 10px;
  padding-right: 10px;
  margin-top: 10px;
  margin-bottom: 10px;
  border-radius: 5px;
  box-shadow: 3px 3px 6px 0 slategrey;
  font-family: "Lucida Console", Courier, monospace;
  font-size: 0.8rem;
}
.markdown-preview.markdown-preview .contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.markdown-preview.markdown-preview .fondo {
  background: url(https://balmisdigigs.github.io/digitalizacion.github.io/imagenes/fondos/quote.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.markdown-preview.markdown-preview .cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.markdown-preview.markdown-preview .abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.markdown-preview.markdown-preview .cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.markdown-preview.markdown-preview .autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}
.markdown-preview.markdown-preview .flotante {
  display: flex;
  margin-top: 15px;
  margin-bottom: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    justify-content: center;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    justify-content: space-between;
  }
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    flex-direction: column;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    flex-direction: row;
  }
}
.markdown-preview.markdown-preview .flotante_izq {
  margin-right: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante_izq {
    width: 100%;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante_izq {
    width: auto;
  }
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante_der {
    width: 100%;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante_der {
    width: auto;
  }
}
.markdown-preview.markdown-preview .galeria_imagenes {
  display: flex;
  justify-content: space-evenly;
  align-items: center;
  margin-top: 15px;
  margin-bottom: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .galeria_imagenes {
    flex-direction: column;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .galeria_imagenes {
    flex-direction: row;
  }
}

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
    const configureMermaidIconPacks = () => {
        window["mermaid"].registerIconPacks([
            {
                name: "logos",
                loader: () =>
                    fetch("https://unpkg.com/@iconify-json/logos@1/icons.json").then(
                        (res) => res.json()
                    ),
            },
        ]);
    };

    if (document.readyState !== 'loading') {
        configureMermaidIconPacks();
    } else {
        document.addEventListener("DOMContentLoaded", () => {
            configureMermaidIconPacks();
        });
    }
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="unidad-21">Unidad 21 </h1>
<p>Descargar estos apunte en <a href="./u21_ficheros.pdf">pdf</a> o <a href="./u21_ficheros.html">html</a></p>
<h2 id="índice">Índice </h2>

<div class="md-toc">
<div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#índice" class="md-toc-link">
            <p>Índice</p>

          </a></div><details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#ficheros" class="md-toc-link"><p>Ficheros</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#definiciones-básicas" class="md-toc-link">
            <p>Definiciones básicas</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#gestión-de-rutas-en-net" class="md-toc-link"><p>Gestión de rutas en .NET</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#clase-path" class="md-toc-link"><p>Clase Path</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#operaciones-con-rutas" class="md-toc-link">
            <p>Operaciones con rutas</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#gestión-de-archivos-y-directorios" class="md-toc-link"><p>Gestión de archivos y directorios</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#clases-de-utilidad-file-y-directory" class="md-toc-link">
            <p>Clases de utilidad File y Directory</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#clases-fileinfo-y-directoryinfo" class="md-toc-link">
            <p>Clases FileInfo y DirectoryInfo</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#streams" class="md-toc-link"><p>Streams</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#conceptos-generales" class="md-toc-link"><p>Conceptos generales</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#operaciones-y-nomenclatura-relacionada-con-streams" class="md-toc-link"><p>Operaciones y nomenclatura relacionada con Streams</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#apertura-open" class="md-toc-link">
            <p>Apertura (Open)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#cierre-close" class="md-toc-link">
            <p>Cierre (Close)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#lectura-read-y-escritura-write" class="md-toc-link">
            <p>Lectura (Read) y Escritura (Write)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#volcado-flush" class="md-toc-link">
            <p>Volcado (Flush)</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#streams-en-csharp" class="md-toc-link"><p>Streams en CSharp</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#lectura-y-escritura-de-ficheros-sin-transformar" class="md-toc-link"><p>Lectura y escritura de ficheros sin transformar</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#apertura-y-cierre-de-un-fichero-con-filestream" class="md-toc-link">
            <p>Apertura y Cierre de un fichero con FileStream</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#escritura-de-un-fichero-con-filestream" class="md-toc-link">
            <p>Escritura de un fichero con FileStream</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#lectura-de-un-fichero-con-filestream" class="md-toc-link">
            <p>Lectura de un fichero con FileStream</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#longitud-y-posición-en-el-stream" class="md-toc-link">
            <p>Longitud y Posición en el Stream</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#desplazándonos-por-el-stream" class="md-toc-link">
            <p>Desplazándonos por el Stream</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#recorriendo-un-filestream-hasta-el-final" class="md-toc-link">
            <p>Recorriendo un FileStream hasta el final</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#pasando-el-flujo-por-un-decorator-stream" class="md-toc-link"><p>Pasando el flujo por un '<em>Decorator Stream</em>'</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ejemplo-de-decorator-stream-usando-bufferedstream" class="md-toc-link">
            <p>Ejemplo de '<em>Decorator Stream</em>' usando BufferedStream</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#transformando-el-flujo-con-un-stream-adapter" class="md-toc-link"><p>Transformando el flujo con un '<em>Stream Adapter</em>'</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#stream-adapters-binarywriter-y-binaryreader" class="md-toc-link">
            <p>Stream Adapters BinaryWriter y BinaryReader</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#stream-adapters-streamwriter-y-streamreader" class="md-toc-link">
            <p>Stream Adapters StreamWriter y StreamReader</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#manejo-de-excepciones-con-ficheros-y-streams" class="md-toc-link">
            <p>Manejo de excepciones con ficheros y streams</p>

          </a></div><details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#serilización-y-deserialización-a-csv" class="md-toc-link"><p>Serilización y deserialización a CSV</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#separadores-de-campos-alternativos" class="md-toc-link">
            <p>Separadores de campos alternativos</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#csv-desde-csharp" class="md-toc-link">
            <p>CSV desde CSharp</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#anexo-i-ejemplo-de-lectura-binaria-opcional" class="md-toc-link">
            <p>Anexo I: Ejemplo de lectura binaria opcional</p>

          </a></div>
</div>
<div style="page-break-after:always;"></div>
<h2 id="ficheros">Ficheros </h2>
<h3 id="definiciones-básicas">Definiciones básicas </h3>
<p>El siguiente <em>'pre-conocimiento'</em> será necesario tenerlo presente para abordar el siguiente tema. Por pertenecer los siguiente conceptos al currículo del módulo de <strong>'<em>Sistemas Informáticos</em>'</strong>, únicamente vamos a enumerar los conceptos que vamos a necesitar.</p>
<ul>
<li>Un <strong>archivo o fichero</strong> informático es un conjunto de bytes que son almacenados en un dispositivo.<br>
(<em>Fuente Wikipedia</em>)</li>
<li>En informática, <strong>una ruta (path, en inglés)</strong> es la forma de referenciar un archivo informático o directorio en un sistema de archivos de un sistema operativo determinado.<br>
(<em>Fuente Wikipedia</em>)</li>
<li>Las <strong>rutas absolutas</strong> señalan la ubicación de un archivo o directorio desde el <strong>directorio raíz</strong> del sistema de archivos.<br>
(<em>Fuente Wikipedia</em>)</li>
<li>Las <strong>rutas relativas</strong> señalan la ubicación de un archivo o directorio a partir de nuestra <strong>posición actual</strong> en el sistema de archivos.<br>
(<em>Fuente Wikipedia</em>)</li>
</ul>
<p><img src="./assets/imagenes/rutas.png" alt="nombre" style="display:block;margin:0 auto;width:100%;max-width:700px;"></p>
<div style="page-break-after:always;"></div>
<h3 id="gestión-de-rutas-en-net">Gestión de rutas en .NET </h3>
<p>Al tratarse .NET de un Framework <strong>multiplataforma</strong>, dispondrá de una serie de <strong>clases de utilidad para el manejo de rutas</strong> de forma '<em>transparente</em>' al <strong>Sistema Operativo (SO)</strong> en el que estemos ejecutando.</p>
<h4 id="clase-path">Clase Path </h4>
<p>Esta clase nos proporcionará de forma abstracta las siguientes propiedades, que pueden tomar valores diferentes dependiendo del SO donde estemos ejecutando.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Campo</th>
<th style="text-align:left">Parte de la ruta que su valor representa</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong><code>DirectorySeparatorChar</code></strong></td>
<td style="text-align:left">Separador de directorios. En Windows es <code>\</code>, en Unix es <code>/</code> y Macintosh es <code>:</code></td>
</tr>
<tr>
<td style="text-align:left"><strong><code>AltDirectorySeparatorChar</code></strong></td>
<td style="text-align:left">Carácter alternativo usable como separador de directorios. En Windows y Macintosh es <code>/</code>, - mientras que en Unix es <code>\</code></td>
</tr>
<tr>
<td style="text-align:left"><strong><code>PathSeparator</code></strong></td>
<td style="text-align:left">Separador entre rutas. Aunque en los sistemas operativos más comunes es ; podría variar en otros.</td>
</tr>
<tr>
<td style="text-align:left"><strong><code>VolumeSeparatorChar</code></strong></td>
<td style="text-align:left">Separador de unidades lógicas. En Windows y Macintosh es : (por ejemplo <code>C:\datos</code>) y en Unix <code>/</code></td>
</tr>
</tbody>
</table>
<p><strong>Ejemplo:</strong> Si en lugar de asignar el siguiente literal en el código ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-string">string</span></span> ruta <span class="token operator">=</span> <span class="token string">@"\datos\fichero.txt"</span><span class="token punctuation">;</span>
</code></pre><p>escribimos...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-char">char</span></span> s <span class="token operator">=</span> Path<span class="token punctuation">.</span>DirectorySeparatorChar<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-string">string</span></span> ruta <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">s</span><span class="token punctuation">}</span></span><span class="token string">datos</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">s</span><span class="token punctuation">}</span></span><span class="token string">fichero.txt"</span></span><span class="token punctuation">;</span>
</code></pre><p>Conseguiremos que la variable <strong><code>ruta</code></strong> almacene el formato de la misma según corresponda al sistema operativo sobre el que se ejecute el código anterior. Es decir, mientras que en <strong>Windows</strong> contendría <strong><code>\datos\fichero.txt</code></strong>, en <strong>Linux o Mac OSX</strong> contendría <strong><code>/datos/fichero.txt</code></strong></p>
<h5 id="operaciones-con-rutas">Operaciones con rutas </h5>
<p>Si te fijas en el ejemplo anterior, ocurre que en Windows el carácter usado como separador de directorios <strong><code>\</code></strong> coincide con el que C# usa como indicador de secuencias de escape. Por eso es incorrecto indicar literales de cadena para rutas como <strong><code>"C:\datos"</code></strong>, ya que C# entendería que estamos intentando escapar el caracter <strong><code>d</code></strong>.</p>
<p>En su lugar hay tres alternativas:</p>
<ol>
<li>
<p>Usar el campo independiente del sistema operativo <strong><code>$"C:{Path.DirectorySeparatorChar}datos"</code></strong></p>
</li>
<li>
<p>Duplicar los caracteres de los literales para que dejen de considerarse<br>
secuencias de escape. Así, la ruta de ejemplo anterior quedaría... <strong><code>"C:\\datos"</code></strong></p>
</li>
<li>
<p>Lo que hemos hecho en nuestro ejemplo que consiste en especificar la ruta mediante un literal de cadena plano, pues en ellos no se tienen en cuenta las secuencias de escape. Así, ahora la ruta del ejemplo quedaría ... como <strong><code>@"C:\datos"</code></strong>.<br>
Esta opción es la más simple, si sabemos cual es el SO donde vamos a ejecutar.</p>
</li>
</ol>
<ul>
<li>
<p>Obtener la ruta con el <strong>directorio <em>'padre'</em></strong> o <strong>null</strong> si es raíz.</p>
<p><strong>string Path.<a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.path.getdirectoryname#System_IO_Path_GetDirectoryName_System_String_">GetDirectoryName</a>(string path)</strong></p>
<ul>
<li><strong><code>GetDirectoryName(@"C:\MyDir\MySubDir\myfile.ext")</code></strong> devuelve <strong><code>"C:\MyDir\MySubDir"</code></strong></li>
<li><strong><code>GetDirectoryName(@"C:\MyDir\MySubDir")</code></strong> devuelve <strong><code>"C:\MyDir"</code></strong></li>
<li><strong><code>GetDirectoryName(@"C:\MyDir\")</code></strong> devuelve <strong><code>"C:\MyDir"</code></strong></li>
<li><strong><code>GetDirectoryName(@"C:\MyDir")</code></strong> devuelve <strong><code>"C:\"</code></strong></li>
<li><strong><code>GetDirectoryName(@"C:\")</code></strong> devuelve <strong><code>null</code></strong></li>
</ul>
</li>
<li>
<p>Obtener el archivo o directorio del final de la ruta. (vacío si acaba en separador)</p>
<p><strong>string Path.<a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.path.getfilename#System_IO_Path_GetFileName_System_String_">GetFileName</a>(string path)</strong></p>
<ul>
<li><strong><code>GetFileName(@"C:\MyDir\MySubDir\myfile.ext")</code></strong> devuelve <strong><code>"myfile.ext"</code></strong></li>
<li><strong><code>GetFileName(@"C:\MyDir\MySubDir")</code></strong> devuelve <strong><code>"MySubDir"</code></strong></li>
<li><strong><code>GetFileName(@"C:\MyDir\")</code></strong> devuelve <strong><code>""</code></strong> (Cadena vacía)</li>
</ul>
</li>
<li>
<p>Combinar un <strong>DirectoryName path1</strong> y un <strong>FileName path2</strong> para formar <strong>una nueva ruta</strong>. Siempre que <strong>path2</strong> no empiece por el carácter separador de directorio o de volumen.</p>
<p><strong>string <a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.path.combine#System_IO_Path_Combine_System_String_System_String_">Combine</a>(string path1, string path2);</strong></p>
<ul>
<li><strong><code>Combine(@"C:\MyDir", @"myfile.ext")</code></strong> devuelve <strong><code>"C:\MyDir\myfile.ext"</code></strong></li>
<li><strong><code>Combine(@"C:\MyDir\", @"myfile.ext")</code></strong> devuelve <strong><code>"C:\MyDir\myfile.ext"</code></strong></li>
<li><strong><code>Combine(@"C:\MyDir", @"MySubDir\myfile.ext")</code></strong>  devuelve <strong><code>"C:\MyDir\MySubDir\myfile.ext"</code></strong></li>
<li><strong><code>Combine(@"C:\MyDir\", @"MySubDir\myfile.ext")</code></strong> devuelve <strong><code>"C:\MyDir\MySubDir\myfile.ext"</code></strong></li>
<li>❌ <strong><code>Combine(@"C:\MyDir\", @"\MySubDir\myfile.ext")</code></strong></li>
<li>❌ <strong><code>Combine(@"C:\MyDir\", @"C:\MySubDir\myfile.ext")</code></strong></li>
</ul>
</li>
</ul>
<div style="page-break-after:always;"></div>
<h3 id="gestión-de-archivos-y-directorios">Gestión de archivos y directorios </h3>
<h4 id="clases-de-utilidad-file-y-directory">Clases de utilidad File y Directory </h4>
<p>Ambas clases contienen gran cantidad de <strong>métodos estáticos de utilidad</strong> para hacer <strong>operaciones</strong> con ficheros/archivos y directorios/carpetas, del estilo de las que se hacen desde la <strong>línea de comandos</strong>.</p>
<p>Lógicamente los métodos definidos en <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.directory">Directory</a></strong> realizan operaciones sobre <strong>directorios</strong> y los definidos en <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.file">File</a></strong> sobre <strong>archivos</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Cómo no es idea de estos temas copiar la documentación de Microsoft en castellano. Es recomendable que le eches un vistazo a los enlaces del anterior párrafo para hacerte una idea de las operaciones definidas en estas clases.</p>
</div>
<h6 id="ejemplo-de-uso-de-file-y-directory">Ejemplo de uso de File y Directory </h6>
<p>Veamos alguno de estos métodos a través del siguiente <strong>ejemplo comentado</strong>:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-char">char</span></span> s <span class="token operator">=</span> Path<span class="token punctuation">.</span>DirectorySeparatorChar<span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword keyword-string">string</span></span> ruta <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$".</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">s</span><span class="token punctuation">}</span></span><span class="token string">datos</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">s</span><span class="token punctuation">}</span></span><span class="token string">datos.txt"</span></span><span class="token punctuation">;</span>

    <span class="token comment">// Si no existe el directorio datos en la ruta relativa actual lo crearé.</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">GetDirectoryName</span><span class="token punctuation">(</span>ruta<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
        Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span><span class="token string">"datos"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Creo el fichero datos.txt vacío. Más adelante en el tema</span>
    <span class="token comment">// veremos que llamar al Close() es importante para que no</span>
    <span class="token comment">// se quede abierto.</span>
    File<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>ruta<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Me sitúo en el directorio datos.</span>
    Directory<span class="token punctuation">.</span><span class="token function">SetCurrentDirectory</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">GetDirectoryName</span><span class="token punctuation">(</span>ruta<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">s</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"El fichero "</span> <span class="token operator">+</span> ruta <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Compruebo si se ha creado el fichero correctamente viendo si </span>
    <span class="token comment">// existe o no en el directorio datos (donde me acabo de situar).</span>
    <span class="token comment">// Mostraré si existe o no por pantalla.</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">GetFileName</span><span class="token punctuation">(</span>ruta<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">?</span><span class="token string">"existe"</span> <span class="token punctuation">:</span> <span class="token string">"no existe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div style="page-break-after:always;"></div>
<h4 id="clases-fileinfo-y-directoryinfo">Clases FileInfo y DirectoryInfo </h4>
<p>Además de las clases con métodos de operaciones sobre directorios y ficheros. También dispondremos de objetos que contendrán información sobre los mismos además de permitirnos también hacer ciertas operaciones.<br>
Dichos objetos se instanciarán en memoria a través de las clases...</p>
<p><strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.directoryinfo">DirectoryInfo</a></strong> y <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.fileinfo">FileInfo</a></strong> pues ...</p>
<ul>
<li>
<p>Me devolverán información sobre <strong>carpetas</strong> y <strong>archivos</strong> respectivamente.</p>
</li>
<li>
<p>Además de permitirme <em>'navegar</em> por el sistema de ficheros, moviéndome entre las diferentes carpetas. Me permitirán <strong>realizar acciones más precisas y con más detalle</strong> sobre el sistema de ficheros.</p>
</li>
<li>
<p><strong>Ambas clases heredarán de la clases abstracta</strong> <code>FileSystemInfo</code> que contendrá la información común a archivos y carpetas. Un ejemplo sería la fecha de creación y otras propiedades comunes.</p>
</li>
<li>
<p>La abstracción del sistema de ficheros se almacena en la clase <strong><code>FileSystemInfo</code></strong>:</p>
<ul>
<li>Se accederá a través de la sustitución de Liskov de objetos de tipo <strong><code>DirectoryInfo</code></strong> o <strong><code>FileInfo</code></strong>.</li>
</ul>
<p></p><p align="center" class="puml"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" data-diagram-type="MINDMAP" height="301.5px" preserveAspectRatio="none" style="width:436px;height:301px;background:#FFFFFF;" version="1.1" viewBox="0 0 436 301" width="436.5px" zoomAndPan="magnify"><defs></defs><g><rect fill="#FFFAFA" height="99.4438" rx="11.25" ry="11.25" style="stroke:#000000;stroke-width:1.35;" width="191.5875" x="234.2786" y="100.2107"></rect><text fill="#000000" font-family="Arial" font-size="12.6" font-weight="bold" lengthAdjust="spacing" textLength="89.6212" x="285.2618" y="125.5293">FileSystemInfo</text><text fill="#000000" font-family="Arial" font-size="12.6" lengthAdjust="spacing" textLength="3.5007" x="328.322" y="140.0181">&nbsp;</text><text fill="#000000" font-family="Arial" font-size="12.6" lengthAdjust="spacing" textLength="147.7793" x="256.1827" y="154.5069">Información y operaciones</text><text fill="#000000" font-family="Arial" font-size="12.6" lengthAdjust="spacing" textLength="164.5875" x="247.7786" y="168.9957">comunes a ambos elementos</text><text fill="#000000" font-family="Arial" font-size="12.6" lengthAdjust="spacing" textLength="132.3615" x="263.8916" y="183.4844">del sistema de ficheros.</text><rect fill="#F0F8FF" height="113.9326" rx="11.25" ry="11.25" style="stroke:#000000;stroke-width:1.35;" width="171.2786" x="9" y="22.5"></rect><text fill="#000000" font-family="Arial" font-size="12.6" font-weight="bold" lengthAdjust="spacing" textLength="78.4116" x="55.4335" y="47.8187">DirectoryInfo</text><text fill="#000000" font-family="Arial" font-size="12.6" lengthAdjust="spacing" textLength="3.5007" x="92.889" y="62.3074">&nbsp;</text><text fill="#000000" font-family="Arial" font-size="12.6" lengthAdjust="spacing" textLength="119.0663" x="35.1062" y="76.7962">Contiene información</text><text fill="#000000" font-family="Arial" font-size="12.6" lengthAdjust="spacing" textLength="125.3725" x="31.9531" y="91.285">especifica de carpetas</text><text fill="#000000" font-family="Arial" font-size="12.6" lengthAdjust="spacing" textLength="144.2786" x="22.5" y="105.7737">y operaciones especificas</text><text fill="#000000" font-family="Arial" font-size="12.6" lengthAdjust="spacing" textLength="101.526" x="43.8763" y="120.2625">sobre las mismas.</text><path d="M234.2786,149.9326 L225.2786,149.9326 C211.7786,149.9326 202.7786,79.4663 189.2786,79.4663 L180.2786,79.4663" fill="none" style="stroke:#000000;stroke-width:0.9;"></path><rect fill="#F0F8FF" height="113.9326" rx="11.25" ry="11.25" style="stroke:#000000;stroke-width:1.35;" width="171.2786" x="9" y="163.4326"></rect><text fill="#000000" font-family="Arial" font-size="12.6" font-weight="bold" lengthAdjust="spacing" textLength="44.7952" x="72.2417" y="188.7513">FileInfo</text><text fill="#000000" font-family="Arial" font-size="12.6" lengthAdjust="spacing" textLength="3.5007" x="92.889" y="203.24">&nbsp;</text><text fill="#000000" font-family="Arial" font-size="12.6" lengthAdjust="spacing" textLength="119.0663" x="35.1062" y="217.7288">Contiene información</text><text fill="#000000" font-family="Arial" font-size="12.6" lengthAdjust="spacing" textLength="123.9636" x="32.6575" y="232.2176">especifica de archivos</text><text fill="#000000" font-family="Arial" font-size="12.6" lengthAdjust="spacing" textLength="144.2786" x="22.5" y="246.7063">y operaciones especificas</text><text fill="#000000" font-family="Arial" font-size="12.6" lengthAdjust="spacing" textLength="64.4335" x="62.4226" y="261.1951">sobre ellos.</text><path d="M234.2786,149.9326 L225.2786,149.9326 C211.7786,149.9326 202.7786,220.3989 189.2786,220.3989 L180.2786,220.3989" fill="none" style="stroke:#000000;stroke-width:0.9;"></path><!--SRC=[bPBDRXf13CVlynIMUW6aKA1G9IYgal2H5a65kYINqeEPDOlL-K0piqIaobFr4VfYzMw9qaezj9VLs7_RFtlrlue9GxBiSejx5JKQWaxxGWKkTWcI1qFR13a7qeczKvSn7GszKwUECMCHqC8t1J1dHzeR7s1ZK7-LpDIxz14jmNLWDAT4ney4tRv4pkTKTm8iCS_P5T0TrE42Gy7kENhl0pzA9vfhmuMpv19e-L2evHk1tGPVkdnKqnzsd4YK9_MaBb-VzcrzVXMTV_W2hTQK3MN7cCX-S5lVQgtTsbMlO57pZ-yEZk3t52JmZkBQQMzBUG02sesFG8Qg5Rn8EHc8N8r2a5ksh7SKV6ohbl3GiAQDAQc2Zki_wCFnXJcIavWS0Vy6NmjfJvfbL3rIOzXJGc7ziHMyL8aK_IOG68nWELhy6xyw-Z_H6FIE3_vVq6HCTVKLYIbELb9BWoxTBUPme12b4xhjNgStQFSR6IQObGvwvz1zC-nS37i364so5LHwKpLkbtE8lWoQn7Wn1TwKbVUQQeO7X4-bx6vf25NKM2sQa4sUap1n1mw-jeYQtIz-5Oc1KhRtgIv-sp-xuGGP1TaBxXTgJ5iiJP9MxIiF3k5kDJqxLtDqHOc5W2YgaTWhXUCG9jbF]--></g></svg></p><p></p>
<ul>
<li>Una ejemplo de esta información común detallada. Es el campo <strong><code>Attributes</code></strong> del sistema de ficheros.<br>
El campo <strong><code>Attributes</code></strong> es una máscara creada a partir del <strong>Enum <a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.fileattributes">FileAttributes</a></strong>. Con información común a ficheros y directorios. Échale un vistazo a los bits de la máscara en el enlace del tipo.</li>
</ul>
</li>
</ul>
<p>Aunque es "imposible" tratar todas los casos de uso de estos objetos. Vamos a ver un par ejemplos y un caso de uso.</p>
<div style="page-break-after:always;"></div>
<div class="box_bg_lightgray">
<p><strong>Ejemplo 1:</strong> (Puedes descargar el código completo desde <strong><a href="./assets/ejemplos/fileinfo_fichero_ejemplo.cs">este enlace</a></strong>)</p>
<p>Supongamos una función que recibe la ruta al fichero del sistema Windows <strong><code>C:\Windows\write.exe</code></strong> y nos muestra la información común almacenada en la clase abstracta <strong><code>FileSystemInfo</code></strong> sobre él.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">FileInfoEjemplo</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">ObtenInformacion</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> rutaAFichero<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Obtenemos la información del fichero y </span>
        <span class="token comment">// hacemos una sustitución a la superclase.</span>
        <span class="token class-name">FileSystemInfo</span> f <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileInfo</span><span class="token punctuation">(</span>rutaAFichero<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">StringBuilder</span> informacion <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Añadimos información del fichero.</span>
        <span class="token comment">// Fíjate que f.Attributes muestra todos </span>
        <span class="token comment">// los valores dele enum añadidos a la máscara.</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>f<span class="token punctuation">.</span>Exists<span class="token punctuation">)</span>
            informacion<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Nombre completo: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">f<span class="token punctuation">.</span>FullName</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span>
                       <span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Nombre : </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">f<span class="token punctuation">.</span>Name</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span>
                       <span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Extensión : </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">f<span class="token punctuation">.</span>Extension</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span>
                       <span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Fecha creación: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">f<span class="token punctuation">.</span>CreationTime</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span>
                       <span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Fecha último acceso: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">f<span class="token punctuation">.</span>LastAccessTime</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span>
                       <span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Fecha última modificación: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">f<span class="token punctuation">.</span>LastWriteTime</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span>
                       <span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Atributos: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">f<span class="token punctuation">.</span>Attributes</span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> 
            informacion<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token string">"Archivo no encontrado"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> informacion<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">ObtenInformacion</span><span class="token punctuation">(</span><span class="token string">@"C:\Windows\write.exe"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div> <!-- fin ejemplo -->
<div style="page-break-after:always;"></div>
<div class="box_bg_lightgray">
<p><strong>Ejemplo 2:</strong> (Puedes descargar el código completo desde <strong><a href="./assets/ejemplos/fileinfo_carpeta_ejemplo.cs">este enlace</a></strong>)</p>
<p>Supongamos un programa que me liste lo que contiene el directorio '<em>HOME</em>' de un usuario para diferentes SO, indicándome si lo encontrado es un archivo o una carpeta.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-string">string</span></span> home <span class="token operator">=</span> Environment<span class="token punctuation">.</span><span class="token function">ExpandEnvironmentVariables</span><span class="token punctuation">(</span><span class="token string">"%HOMEDRIVE%%HOMEPATH%"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Compruebo si existe la ruta devuelta por el entorno.</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>home<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Me sitúo en el directorio home.</span>
        Directory<span class="token punctuation">.</span><span class="token function">SetCurrentDirectory</span><span class="token punctuation">(</span>home<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Instancio el objeto de tipo DirectoryInfo con la información de la carpeta.</span>
        <span class="token class-name">DirectoryInfo</span> infoCarpeta <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">DirectoryInfo</span><span class="token punctuation">(</span>home<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Obtengo información de todos los objetos que hay en dicha carpeta </span>
        <span class="token comment">// ya sean otras capetas o archivos. </span>
        <span class="token comment">// Para eso llamo a GetFileSystemInfos() que me</span>
        <span class="token comment">// devuelve un array de FileSystemInfo con dicha información.</span>
        <span class="token class-name">FileSystemInfo<span class="token punctuation">[</span><span class="token punctuation">]</span></span> infosEnFS <span class="token operator">=</span> infoCarpeta<span class="token punctuation">.</span><span class="token function">GetFileSystemInfos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Si hubiera querido ver si hay otras carpetas hubiera hecho...</span>
        <span class="token comment">// -&gt; DirectoryInfo[] infoCarpetas = infoCarpeta.GetDirectories();</span>
        <span class="token comment">// De forma análoga si hubiera querido coger solo información de archivos...</span>
        <span class="token comment">// -&gt; FileInfo[] infoArchivos = infoCarpeta.GetFiles();</span>

        <span class="token comment">// Recorro el array.</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name">FileSystemInfo</span> infoEnFS <span class="token keyword keyword-in">in</span> infosEnFS<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Compruebo si en la máscara el item que estoy recorriendo </span>
            <span class="token comment">// me indica que es una carpeta.</span>
            <span class="token class-name"><span class="token keyword keyword-bool">bool</span></span> esCarpeta <span class="token operator">=</span> <span class="token punctuation">(</span>infoEnFS<span class="token punctuation">.</span>Attributes <span class="token operator">&amp;</span> FileAttributes<span class="token punctuation">.</span>Directory<span class="token punctuation">)</span> <span class="token operator">==</span> FileAttributes<span class="token punctuation">.</span>Directory<span class="token punctuation">;</span>
            <span class="token comment">// Muestro el nombre completo indicando si es un archivo o una carpeta.</span>
            <span class="token class-name"><span class="token keyword keyword-string">string</span></span> info <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span>esCarpeta <span class="token punctuation">?</span> <span class="token string">"Carpeta"</span><span class="token punctuation">:</span><span class="token string">"Archivo"</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">-&gt;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">infoEnFS<span class="token punctuation">.</span>FullName</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-else">else</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"No se ha podido encontrar la carpeta home."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div> <!-- fin ejemplo -->
<div style="page-break-after:always;"></div>
<div class="box_bg_lightgray">
<p>🎓 <strong>Caso de estudio:</strong> (Puedes descargar el código completo desde <strong><a href="./assets/ejemplos/directorio_oculto_ejemplo.cs">este enlace</a></strong>)</p>
<p>En el siguiente caso de estudio, vamos a crear un método llamado <strong><code>void OcultaDirectorio(string ruta)</code></strong> que reciba una ruta a una carpeta y la marque como oculta.</p>
<p>Además, vamos a controlar las posibles excepciones que se generen y las vamos a relanzar al <strong><code>Main</code></strong>. Para ello, si hacemos <strong><code>Ctrl + Click</code></strong> sobre el constructor de <strong><code>DirectoryInfo</code></strong> podemos ver que genera las excepciones:</p>
<ul>
<li><strong><code>UnauthorizedAccessException</code></strong>: Si no tenemos permiso de acceso a la carpeta.</li>
<li><strong><code>ArgumentException</code></strong>: Si la ruta contiene algún caracter inválido.</li>
<li><strong><code>PathTooLongException</code></strong>: Si la ruta es demasiado larga para el SO.</li>
</ul>
<p>Además de las anteriores, generaré yo la excepción <strong><code>FileNotFoundException</code></strong> si no existe la ruta que recibe el método por parámetro.<br>
Una <strong>propuesta de solución</strong> podría ser la siguiente ...</p>
<div class="row">
<div class="col-sm-8 my-auto">
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">OcultaDirectorio</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> ruta<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-string">string</span></span> log <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"Ocultando el directorio '</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ruta</span><span class="token punctuation">}</span></span><span class="token string">'"</span></span><span class="token punctuation">;</span>
    <span class="token keyword keyword-try">try</span> 
    <span class="token punctuation">{</span>
        <span class="token class-name">FileSystemInfo</span> d <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">DirectoryInfo</span><span class="token punctuation">(</span>ruta<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>d<span class="token punctuation">.</span>Exists<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileNotFoundException</span><span class="token punctuation">(</span>
                    log<span class="token punctuation">,</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileNotFoundException</span><span class="token punctuation">(</span>
                            <span class="token interpolation-string"><span class="token string">$"El directorio '</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ruta</span><span class="token punctuation">}</span></span><span class="token string">' no existe"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        d<span class="token punctuation">.</span>Attributes <span class="token operator">|=</span> FileAttributes<span class="token punctuation">.</span>Hidden<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnauthorizedAccessException</span> e<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">UnauthorizedAccessException</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">ArgumentException</span> e<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">ArgumentException</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">PathTooLongException</span> e<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">PathTooLongException</span><span class="token punctuation">(</span>log<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div class="col-sm-4">
<p>Genero la excepción indicando lo que estoy haciendo y además le añado como <strong><code>innerException</code></strong> otra instancia donde indico realmente el error.</p>
<p>Añado el atributo <strong><code>Hidden</code> (Oculto)</strong> a la máscara de atributos del <strong><code>FileSystemInfo</code></strong> del directorio. Enumerado no excluyente, por lo que uso un <strong>OR de bits</strong> para añadirlo.</p>
</div>
</div>
<p>Ahora defino un <strong><code>Main</code></strong> donde voy a usar el método definido de tal manera que:</p>
<ol>
<li>Primero creo un directorio llamado <strong><code>'oculto'</code></strong> donde estoy ejecutando la aplicación.</li>
<li>Posteriormente lo ocultaré llamando al método <strong><code>OcultaDirectorio</code></strong>.<br>
Además, capturo cualquier excepción que se pueda producir, tanto creando el directorio prueba, como llamándo al método para ocultarlo,</li>
</ol>
<div class="row">
<div class="col-sm-8 my-auto">
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-try">try</span> 
    <span class="token punctuation">{</span>
        <span class="token class-name">DirectoryInfo</span> d <span class="token operator">=</span> Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span><span class="token string">"oculto"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">OcultaDirectorio</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>FullName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">?</span> e<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            e <span class="token operator">=</span> e<span class="token punctuation">.</span>InnerException<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div class="col-sm-4">
<p>Fíjate que <strong><code>Directory.CreateDirectory(..)</code></strong> devuelve un <strong><code>DirectoryInfo</code></strong> con la información del directorio que acabo de crear y que aprovecho para pasar la información de la ruta completa a <strong><code>OcultaDirectorio(...)</code></strong></p>
</div>
</div>
<p>En este caso de estudio, se propone hacer las siguientes modificaciones...</p>
<ol>
<li>Ejecutaló y comprueba si se ha creado un directorio oculto llamado <em>'oculto'</em>.</li>
<li>Intenta ocultar un directorio inexistente.</li>
<li>Revoca todos los permisos a tu usuario para esa carpeta y prueba a ocultarla.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En el <strong><a href="https://support.microsoft.com/es-es/windows/permisos-de-aplicaci%C3%B3n-aea98a7c-b61a-1930-6ed0-47f0ed2ee15c">siguiente enlace</a></strong> puede ver somo se quitan los permisos al Administrador en Windows. <strong>Intenta hacer lo mismo pero solo para tu usuario</strong>.</p>
</div>
</div> <!-- fin caso de estudio -->
<div style="page-break-after:always;"></div>
<h2 id="streams">Streams </h2>
<h3 id="conceptos-generales">Conceptos generales </h3>
<p>La lectura y escritura de un archivo son hechas usando un concepto genérico llamado <strong>stream</strong>.</p>
<p>Los <strong>stream</strong> son <strong>flujos de datos</strong> <strong>secuenciales</strong> que se utilizan para la <strong>transferencia de información de un punto a otro</strong>.</p>
<div class="row">
<div class="col-sm-5">
<p>Los datos del stream se agrupan de forma básica en una <strong>secuencia de bytes</strong>....</p>
<p>Los stream pueden ser transferidos en <strong>dos posibles direcciones</strong>:</p>
</div>
<div class="col-sm-7 my-auto">
<p></p><p align="center" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="260pt" height="70pt" viewBox="0.00 0.00 260.00 70.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.6 0.6) rotate(0) translate(-17.33 124.73)">
<title>G</title>
<polygon fill="white" stroke="none" points="17.33,-8.07 17.33,-124.73 450.67,-124.73 450.67,-8.07 17.33,-8.07"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-8 8,-124.8 460,-124.8 460,-8 8,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<polygon fill="none" stroke="black" points="23.68,-20 23.68,-54.8 79.82,-54.8 79.82,-20 23.68,-20"></polygon>
<text text-anchor="start" x="32.68" y="-33.2" font-family="Arial" font-size="14.00">byte 0</text>
<polygon fill="none" stroke="black" points="79.82,-20 79.82,-54.8 135.96,-54.8 135.96,-20 79.82,-20"></polygon>
<text text-anchor="start" x="88.82" y="-33.2" font-family="Arial" font-size="14.00">byte 1</text>
<polygon fill="none" stroke="black" points="135.96,-20 135.96,-54.8 192.1,-54.8 192.1,-20 135.96,-20"></polygon>
<text text-anchor="start" x="144.96" y="-33.2" font-family="Arial" font-size="14.00">byte 2</text>
<polygon fill="none" stroke="black" points="192.1,-20 192.1,-54.8 248.23,-54.8 248.23,-20 192.1,-20"></polygon>
<text text-anchor="start" x="201.1" y="-33.2" font-family="Arial" font-size="14.00">byte 3</text>
<polygon fill="none" stroke="black" points="248.23,-20 248.23,-54.8 304.37,-54.8 304.37,-20 248.23,-20"></polygon>
<text text-anchor="start" x="257.23" y="-33.2" font-family="Arial" font-size="14.00">byte 4</text>
<polygon fill="none" stroke="black" points="304.37,-20 304.37,-54.8 360.51,-54.8 360.51,-20 304.37,-20"></polygon>
<text text-anchor="start" x="313.37" y="-33.2" font-family="Arial" font-size="14.00">byte 5</text>
<polygon fill="none" stroke="black" points="360.51,-20 360.51,-54.8 416.65,-54.8 416.65,-20 360.51,-20"></polygon>
<text text-anchor="start" x="369.51" y="-33.2" font-family="Arial" font-size="14.00">byte 6</text>
<text text-anchor="start" x="424.65" y="-33.2" font-family="Arial" font-size="14.00">...</text>
</g>
<!-- posición -->
<g id="node2" class="node">
<title>posición</title>
<text text-anchor="middle" x="193" y="-94.6" font-family="Arial" font-size="14.00">posición</text>
</g>
<!-- posición&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>posición-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" d="M193,-80.9C193,-80.9 193,-66.31 193,-66.31"></path>
<polygon fill="black" stroke="black" points="196.5,-66.31 193,-56.31 189.5,-66.31 196.5,-66.31"></polygon>
</g>
</g>
</svg>
</p><p></p>
</div>
</div>
<ol>
<li>Si los datos son transferidos desde una fuente externa al programa, entonces se habla de <strong>'<em>leer desde el stream</em>'</strong>.</li>
<li>Si los datos son transferidos desde el programa a alguna fuente externa, entonces se habla de <strong>'<em>escribir al stream</em>'</strong>.</li>
</ol>
<p>Frecuentemente, la fuente externa será un <strong>archivo</strong>, pero no es absolutamente necesario. Las fuentes de información externas  pueden ser de diversos tipos. Algunas posibilidades incluyen:</p>
<ul>
<li>Leer o escribir datos a una red utilizando algún protocolo de red, donde la intención es que estos datos sean recibidos o enviados por otro computador</li>
<li>Lectura o escritura a un área de memoria.</li>
<li>La Consola.</li>
<li>La Impresora.</li>
<li>Otros ...</li>
</ul>
<p>Podemos considerar pues un <strong>flujo</strong> o <strong>stream</strong> como una <strong>secuencia bytes</strong> sobre la que podemos leer o escribir. Un fichero es un tipo específico de <strong>stream</strong>.</p>
<h4 id="operaciones-y-nomenclatura-relacionada-con-streams">Operaciones y nomenclatura relacionada con Streams </h4>
<h5 id="apertura-open">Apertura (Open) </h5>
<p>Además de memoria, muchos flujos necesitan recursos extra. Por ejemplo, las conexiones de red crean sockets y los ficheros crean descriptores de ficheros en el sistema operativo.</p>
<p>En ocasiones, este proceso de apertura puede devolver errores o excepciones normalmente generadas por el SO como podrían ser:</p>
<ul>
<li>Falta de permisos de acceso.</li>
<li>Bloqueo o uso por parte de otro programa.</li>
<li>El SO no puede crear más descriptores o '<em>manejadores</em>' de ficheros.</li>
<li>Otros ...</li>
</ul>
<p>Por tanto, al proceso de reservar, adquirir o bloquear estos recursos se denomina <strong>'<em>apertura</em>'</strong> y tras crear un flujo de datos diremos que lo estamos <strong>'<em>abriendo</em>'</strong>.</p>
<h5 id="cierre-close">Cierre (Close) </h5>
<p>Cómo hemos comentado, si en el proceso de apertura necesitamos reservar, adquirir o bloquear recursos. Necesitaremos realizar el proceso opuesto de <strong>'<em>liberación</em>'</strong> de los mismos.</p>
<p>Deberemos llevar especial cuidado que este proceso de cierre se haga también si se ha producido algún error. Por tanto, si usamos excepciones, el <strong>'<em>cierre</em>'</strong> de un flujo debería ir en un bloque <strong><code>finally</code></strong>.</p>
<p>Por tanto, tras finalizar el trabajo con el flujo de datos deberemos <strong>'<em>cerrarlo</em>'</strong>.</p>
<h5 id="lectura-read-y-escritura-write">Lectura (Read) y Escritura (Write) </h5>
<p>Son las operaciones básicas sobre flujos y por tanto en su forma más básica transferirán bytes. Sin embargo en ocasiones estos bytes se pueden '<em>agrupar</em>' en la lectura para obtener tipos más manejables y por tanto también puede suceder el proceso inverso en el proceso de escritura.</p>
<h5 id="volcado-flush">Volcado (Flush) </h5>
<p>Muchos flujos, en especial los que manejan ficheros, trabajan internamente con buffers donde se almacena temporalmente los bytes que se solicita <strong>escribir</strong>, hasta que su número alcance una cierta cantidad, momento en que son verdaderamente escritos todos a la vez en el flujo.<br>
Esto se hace porque las <strong>escrituras</strong> en flujos suelen ser <strong>operaciones lentas</strong>, e interesa que se hagan el menor número de veces posible.<br>
Sin embargo, hay ocasiones en que puede interesar asegurarse de que en un cierto instante se haya realizado el <strong>'<em>volcado</em>'</strong> real de los bytes en un flujo. En esos casos puede forzarse el volcado mediante la operación <strong>Flush</strong>, que vacía por completo su buffer interno en el flujo.</p>
<p>Por tanto, la operación de <strong>escritura</strong> en ficheros se realiza sobre un buffer de memoria RAM el cual se <strong>'<em>volcará</em>'</strong> en el soporte de almacenamiento por bloques para optimizar, ya sea de forma transparente o forzada.</p>
<div style="page-break-after:always;"></div>
<h3 id="streams-en-csharp">Streams en CSharp </h3>
<p>En C# los archivos, directorios y flujos con ficheros, se manejan con clases del las BCL definidas en el namespace: <strong><code>System.IO</code></strong></p>
<p><strong>Todos los flujos de datos</strong> en C# heredan de la clase <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.stream">Stream</a></strong> que implementa las operaciones básicas antes descritas.</p>
<p>En el diagrama siguiente podemos ver de forma <strong>resumida</strong> cómo ha diseñado .NET sus clases para manejo de flujos. Estos patrones de diseño y clases son análogos en otros lenguajes OO.</p>
<p></p><p align="center" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="550pt" height="190pt" viewBox="0.00 0.00 550.00 190.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.4 0.4) rotate(0) translate(-9.88 465.5)">
<title>G</title>
<polygon fill="white" stroke="none" points="9.88,9.5 9.88,-465.5 1384.88,-465.5 1384.88,9.5 9.88,9.5"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-52 8,-448 168,-448 168,-52 8,-52"></polygon>
<text text-anchor="middle" x="88" y="-417" font-family="Arial" font-size="30.00">Datos</text>
</g>
<g id="clust2" class="cluster">
<title>clusterG</title>
<polygon fill="none" stroke="#104e8b" points="352.83,-8 352.83,-440 1094.36,-440 1094.36,-8 352.83,-8"></polygon>
<text text-anchor="middle" x="723.59" y="-409" font-family="Arial" font-size="30.00" fill="#104e8b">Clases para el manejo de streams</text>
</g>
<g id="clust3" class="cluster">
<title>cluster1</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="357.83,-13 357.83,-371 541.83,-371 541.83,-13 357.83,-13"></polygon>
<text text-anchor="middle" x="449.83" y="-349" font-family="Arial" font-size="20.00" fill="#104e8b">Stream Adapters</text>
</g>
<g id="clust4" class="cluster">
<title>cluster2</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="610.83,-33 610.83,-391 794.83,-391 794.83,-33 610.83,-33"></polygon>
<text text-anchor="middle" x="702.83" y="-369" font-family="Arial" font-size="20.00" fill="#104e8b">Decorator Streams</text>
</g>
<g id="clust5" class="cluster">
<title>cluster3</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="868.83,-13 868.83,-295 1089.36,-295 1089.36,-13 868.83,-13"></polygon>
<text text-anchor="middle" x="979.09" y="-273" font-family="Arial" font-size="20.00" fill="#104e8b">Backing Store Streams</text>
</g>
<g id="clust6" class="cluster">
<title>cluster4</title>
<polygon fill="none" stroke="none" points="1202.77,-10 1202.77,-310 1386.77,-310 1386.77,-10 1202.77,-10"></polygon>
<text text-anchor="middle" x="1294.77" y="-279" font-family="Arial" font-size="30.00">Dispositivos</text>
</g>
<!-- Texto -->
<g id="node1" class="node">
<title>Texto</title>
<polygon fill="none" stroke="black" points="154,-294 16,-294 16,-210 160,-210 160,-288 154,-294"></polygon>
<polyline fill="none" stroke="black" points="154,-294 154,-288"></polyline>
<polyline fill="none" stroke="black" points="160,-288 154,-288"></polyline>
<text text-anchor="middle" x="88" y="-258" font-family="Arial" font-size="20.00">Texto en</text>
<text text-anchor="middle" x="88" y="-234" font-family="Arial" font-size="20.00">UTF-8</text>
</g>
<!-- StreamWriter -->
<g id="node4" class="node">
<title>StreamWriter</title>
<polygon fill="#36648b" stroke="#36648b" points="521.83,-318.8 377.83,-318.8 377.83,-261.2 521.83,-261.2 521.83,-318.8"></polygon>
<text text-anchor="middle" x="449.83" y="-285.2" font-family="Arial" font-size="16.00" fill="white">StreamWriter</text>
</g>
<!-- Texto&#45;&gt;StreamWriter -->
<g id="edge1" class="edge">
<title>Texto-&gt;StreamWriter</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M160.35,-277.6C160.35,-277.6 363.06,-277.6 363.06,-277.6"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="363.06,-281.1 373.06,-277.6 363.06,-274.1 363.06,-281.1"></polygon>
<text text-anchor="middle" x="268.91" y="-260.7" font-family="Arial" font-size="19.00" fill="#1874cd">string</text>
</g>
<!-- Tipos -->
<g id="node2" class="node">
<title>Tipos</title>
<polygon fill="none" stroke="black" points="154,-192 16,-192 16,-60 160,-60 160,-186 154,-192"></polygon>
<polyline fill="none" stroke="black" points="154,-192 154,-186"></polyline>
<polyline fill="none" stroke="black" points="160,-186 154,-186"></polyline>
<text text-anchor="start" x="34" y="-156" font-family="Arial" font-size="20.00">int</text>
<text text-anchor="start" x="34" y="-132" font-family="Arial" font-size="20.00">double</text>
<text text-anchor="start" x="34" y="-108" font-family="Arial" font-size="20.00">string</text>
<text text-anchor="start" x="34" y="-84" font-family="Arial" font-size="20.00">...</text>
</g>
<!-- BinaryWriter -->
<g id="node6" class="node">
<title>BinaryWriter</title>
<polygon fill="#36648b" stroke="#36648b" points="521.83,-90.8 377.83,-90.8 377.83,-33.2 521.83,-33.2 521.83,-90.8"></polygon>
<text text-anchor="middle" x="449.83" y="-57.2" font-family="Arial" font-size="16.00" fill="white">BinaryWriter</text>
</g>
<!-- Tipos&#45;&gt;BinaryWriter -->
<g id="edge2" class="edge">
<title>Tipos-&gt;BinaryWriter</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M160.35,-75.4C160.35,-75.4 363.06,-75.4 363.06,-75.4"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="363.06,-78.9 373.06,-75.4 363.06,-71.9 363.06,-78.9"></polygon>
<text text-anchor="middle" x="268.91" y="-78.7" font-family="Arial" font-size="19.00" fill="#1874cd">tipos básicos</text>
</g>
<!-- Bytes -->
<g id="node3" class="node">
<title>Bytes</title>
<polygon fill="none" stroke="black" points="154,-396 16,-396 16,-312 160,-312 160,-390 154,-396"></polygon>
<polyline fill="none" stroke="black" points="154,-396 154,-390"></polyline>
<polyline fill="none" stroke="black" points="160,-390 154,-390"></polyline>
<text text-anchor="middle" x="88" y="-360" font-family="Arial" font-size="20.00">Bytes sin</text>
<text text-anchor="middle" x="88" y="-336" font-family="Arial" font-size="20.00">transformar</text>
</g>
<!-- DeflateStream -->
<g id="node8" class="node">
<title>DeflateStream</title>
<polygon fill="#4f94cd" stroke="#4f94cd" points="774.83,-110.8 630.83,-110.8 630.83,-53.2 774.83,-53.2 774.83,-110.8"></polygon>
<text text-anchor="middle" x="702.83" y="-77.2" font-family="Arial" font-size="16.00" fill="white">DeflateStream</text>
</g>
<!-- StreamWriter&#45;&gt;DeflateStream -->
<g id="edge5" class="edge">
<title>StreamWriter-&gt;DeflateStream</title>
<path fill="none" stroke="none" stroke-width="3" d="M522.31,-272C550.58,-272 576.33,-272 576.33,-272 576.33,-272 576.33,-100 576.33,-100 576.33,-100 615.8,-100 615.8,-100"></path>
<polygon fill="none" stroke="none" stroke-width="3" points="615.8,-103.5 625.8,-100 615.8,-96.5 615.8,-103.5"></polygon>
</g>
<!-- StreamReader -->
<g id="node5" class="node">
<title>StreamReader</title>
<polygon fill="#36648b" stroke="#36648b" points="521.83,-242.8 377.83,-242.8 377.83,-185.2 521.83,-185.2 521.83,-242.8"></polygon>
<text text-anchor="middle" x="449.83" y="-209.2" font-family="Arial" font-size="16.00" fill="white">StreamReader</text>
</g>
<!-- StreamReader&#45;&gt;Texto -->
<g id="edge3" class="edge">
<title>StreamReader-&gt;Texto</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M377.47,-226.4C377.47,-226.4 174.77,-226.4 174.77,-226.4"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="174.77,-222.9 164.77,-226.4 174.77,-229.9 174.77,-222.9"></polygon>
</g>
<!-- BinaryReader -->
<g id="node7" class="node">
<title>BinaryReader</title>
<polygon fill="#36648b" stroke="#36648b" points="521.83,-166.8 377.83,-166.8 377.83,-109.2 521.83,-109.2 521.83,-166.8"></polygon>
<text text-anchor="middle" x="449.83" y="-133.2" font-family="Arial" font-size="16.00" fill="white">BinaryReader</text>
</g>
<!-- BinaryReader&#45;&gt;Tipos -->
<g id="edge4" class="edge">
<title>BinaryReader-&gt;Tipos</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M377.47,-138C377.47,-138 174.77,-138 174.77,-138"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="174.77,-134.5 164.77,-138 174.77,-141.5 174.77,-134.5"></polygon>
</g>
<!-- FileStream -->
<g id="node13" class="node">
<title>FileStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="1050.59,-242.8 906.59,-242.8 906.59,-185.2 1050.59,-185.2 1050.59,-242.8"></polygon>
<text text-anchor="middle" x="978.59" y="-209.2" font-family="Arial" font-size="16.00" fill="white">FileStream</text>
</g>
<!-- DeflateStream&#45;&gt;FileStream -->
<g id="edge6" class="edge">
<title>DeflateStream-&gt;FileStream</title>
<path fill="none" stroke="none" stroke-width="3" d="M775,-99.4C808.36,-99.4 840.71,-99.4 840.71,-99.4 840.71,-99.4 840.71,-196 840.71,-196 840.71,-196 891.88,-196 891.88,-196"></path>
<polygon fill="none" stroke="none" stroke-width="3" points="891.88,-199.5 901.88,-196 891.88,-192.5 891.88,-199.5"></polygon>
</g>
<!-- GZipStream -->
<g id="node9" class="node">
<title>GZipStream</title>
<polygon fill="#4f94cd" stroke="#4f94cd" points="774.83,-186.8 630.83,-186.8 630.83,-129.2 774.83,-129.2 774.83,-186.8"></polygon>
<text text-anchor="middle" x="702.83" y="-153.2" font-family="Arial" font-size="16.00" fill="white">GZipStream</text>
</g>
<!-- CryptoStream -->
<g id="node10" class="node">
<title>CryptoStream</title>
<polygon fill="#4f94cd" stroke="#4f94cd" points="774.83,-262.8 630.83,-262.8 630.83,-205.2 774.83,-205.2 774.83,-262.8"></polygon>
<text text-anchor="middle" x="702.83" y="-229.2" font-family="Arial" font-size="16.00" fill="white">CryptoStream</text>
</g>
<!-- BufferedStream -->
<g id="node11" class="node">
<title>BufferedStream</title>
<polygon fill="#4f94cd" stroke="#4f94cd" points="774.83,-338.8 630.83,-338.8 630.83,-281.2 774.83,-281.2 774.83,-338.8"></polygon>
<text text-anchor="middle" x="702.83" y="-305.2" font-family="Arial" font-size="16.00" fill="white">BufferedStream</text>
</g>
<!-- c1 -->
<g id="node12" class="node">
<title>c1</title>
<ellipse fill="black" stroke="black" cx="449.83" cy="-391" rx="0.36" ry="0.36"></ellipse>
</g>
<!-- Fichero -->
<g id="node16" class="node">
<title>Fichero</title>
<polygon fill="none" stroke="black" points="1366.77,-246 1226.77,-246 1222.77,-242 1222.77,-186 1362.77,-186 1366.77,-190 1366.77,-246"></polygon>
<polyline fill="none" stroke="black" points="1362.77,-242 1222.77,-242"></polyline>
<polyline fill="none" stroke="black" points="1362.77,-242 1362.77,-186"></polyline>
<polyline fill="none" stroke="black" points="1362.77,-242 1366.77,-246"></polyline>
<text text-anchor="middle" x="1294.77" y="-210" font-family="Arial" font-size="20.00">Fichero</text>
</g>
<!-- FileStream&#45;&gt;Fichero -->
<g id="edge7" class="edge">
<title>FileStream-&gt;Fichero</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M1065.27,-214.4C1065.27,-214.4 1207.85,-214.4 1207.85,-214.4"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1065.27,-210.9 1055.27,-214.4 1065.27,-217.9 1065.27,-210.9"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1207.85,-217.9 1217.85,-214.4 1207.85,-210.9 1207.85,-217.9"></polygon>
<text text-anchor="middle" x="1146.06" y="-220.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- MemoryStream -->
<g id="node14" class="node">
<title>MemoryStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="1050.59,-166.8 906.59,-166.8 906.59,-109.2 1050.59,-109.2 1050.59,-166.8"></polygon>
<text text-anchor="middle" x="978.59" y="-133.2" font-family="Arial" font-size="16.00" fill="white">MemoryStream</text>
</g>
<!-- Memoria -->
<g id="node17" class="node">
<title>Memoria</title>
<polygon fill="none" stroke="black" points="1366.77,-168 1226.77,-168 1222.77,-164 1222.77,-108 1362.77,-108 1366.77,-112 1366.77,-168"></polygon>
<polyline fill="none" stroke="black" points="1362.77,-164 1222.77,-164"></polyline>
<polyline fill="none" stroke="black" points="1362.77,-164 1362.77,-108"></polyline>
<polyline fill="none" stroke="black" points="1362.77,-164 1366.77,-168"></polyline>
<text text-anchor="middle" x="1294.77" y="-132" font-family="Arial" font-size="20.00">Memoria</text>
</g>
<!-- MemoryStream&#45;&gt;Memoria -->
<g id="edge8" class="edge">
<title>MemoryStream-&gt;Memoria</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M1065.27,-138C1065.27,-138 1207.85,-138 1207.85,-138"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1065.27,-134.5 1055.27,-138 1065.27,-141.5 1065.27,-134.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1207.85,-141.5 1217.85,-138 1207.85,-134.5 1207.85,-141.5"></polygon>
<text text-anchor="middle" x="1146.06" y="-143.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- NetworkStream -->
<g id="node15" class="node">
<title>NetworkStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="1050.59,-90.8 906.59,-90.8 906.59,-33.2 1050.59,-33.2 1050.59,-90.8"></polygon>
<text text-anchor="middle" x="978.59" y="-57.2" font-family="Arial" font-size="16.00" fill="white">NetworkStream</text>
</g>
<!-- Red -->
<g id="node18" class="node">
<title>Red</title>
<polygon fill="none" stroke="black" points="1366.77,-90 1226.77,-90 1222.77,-86 1222.77,-30 1362.77,-30 1366.77,-34 1366.77,-90"></polygon>
<polyline fill="none" stroke="black" points="1362.77,-86 1222.77,-86"></polyline>
<polyline fill="none" stroke="black" points="1362.77,-86 1362.77,-30"></polyline>
<polyline fill="none" stroke="black" points="1362.77,-86 1366.77,-90"></polyline>
<text text-anchor="middle" x="1294.77" y="-54" font-family="Arial" font-size="20.00">Red</text>
</g>
<!-- NetworkStream&#45;&gt;Red -->
<g id="edge9" class="edge">
<title>NetworkStream-&gt;Red</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M1065.27,-61.6C1065.27,-61.6 1207.85,-61.6 1207.85,-61.6"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1065.27,-58.1 1055.27,-61.6 1065.27,-65.1 1065.27,-58.1"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1207.85,-65.1 1217.85,-61.6 1207.85,-58.1 1207.85,-65.1"></polygon>
<text text-anchor="middle" x="1146.06" y="-66.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
</g>
</svg>
</p><p></p>
<p>Si nos fijamos, tendremos de derecha a izquierda ...</p>
<ul>
<li>
<p>Una serie de <strong>dispositivos</strong> donde vamos a realizar las operaciones de lectura y escritura.</p>
</li>
<li>
<p>Una serie de clases denominadas <strong>Backing Store Streams</strong> que serán las que hereden de <strong><code>Stream</code></strong> y hagan las operaciones del lectura y escritura en los dispositivos. En concreto, <strong>para ficheros usaremos</strong> la subclase de stream <strong><code>FileStream</code></strong>.</p>
</li>
<li>
<p>Una serie de clases denominadas <strong>Decorator Streams</strong> que transformarán una secuencia de <strong>bytes</strong> en otra secuencia de <strong>bytes</strong> y cuyo uso será opcional si queremos hacer operaciones como compresión, cifrado, etc. En este, tema veremos un case de uso <strong><code>BufferedStream</code></strong> pero no profundizaremos en su uso.</p>
</li>
<li>
<p>Una serie de clases denominadas <strong>Stream Adapters</strong> adapter que adaptarán, en ambos sentidos, <strong>tipos de datos básicos</strong> manejables por los programas a secuencias de <strong>bytes</strong> manejables.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Si los datos que manejamos en el programa son directamente <strong>bytes sin transformar</strong> nos saltaremos estas clases para manejar directamente '<em>Decorator Streams</em>' o '<em>Backing Store Streams</em>'</p>
</div>
</li>
</ul>
<p>Podremos realizar correspondencias, entre los diferentes bloques de clases, dependiendo de flujo de datos que queramos manejar y lo que queramos hacer teniendo en cuenta los datos.</p>
<h4 id="lectura-y-escritura-de-ficheros-sin-transformar">Lectura y escritura de ficheros sin transformar </h4>
<p>Escribiremos y leeremos bloques de <strong>bytes</strong>. Por tanto, solo necesitaremos usar la clase <strong><code>FileStream</code></strong> y por tanto estaremos usando la siguiente combinación...</p>
<p></p><p align="center" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="550pt" height="100pt" viewBox="0.00 0.00 550.00 100.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.5 0.5) rotate(0) translate(14.98 200)">
<title>G</title>
<polygon fill="white" stroke="none" points="-14.98,0 -14.98,-200 1085.02,-200 1085.02,0 -14.98,0"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-12 8,-156 168,-156 168,-12 8,-12"></polygon>
<text text-anchor="middle" x="88" y="-125" font-family="Arial" font-size="30.00">Datos</text>
</g>
<g id="clust2" class="cluster">
<title>clusterG</title>
<polygon fill="none" stroke="#104e8b" points="293.41,-8 293.41,-192 764.63,-192 764.63,-8 293.41,-8"></polygon>
<text text-anchor="middle" x="529.02" y="-161" font-family="Arial" font-size="30.00" fill="#104e8b">Clases para el manejo de streams</text>
</g>
<g id="clust3" class="cluster">
<title>cluster3</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="418.25,-13 418.25,-143 638.79,-143 638.79,-13 418.25,-13"></polygon>
<text text-anchor="middle" x="528.52" y="-121" font-family="Arial" font-size="20.00" fill="#104e8b">Backing Store Streams</text>
</g>
<g id="clust4" class="cluster">
<title>cluster4</title>
<polygon fill="none" stroke="none" points="878.04,-12 878.04,-156 1062.04,-156 1062.04,-12 878.04,-12"></polygon>
<text text-anchor="middle" x="970.04" y="-125" font-family="Arial" font-size="30.00">Dispositivos</text>
</g>
<!-- Bytes -->
<g id="node1" class="node">
<title>Bytes</title>
<polygon fill="none" stroke="black" points="154,-104 16,-104 16,-20 160,-20 160,-98 154,-104"></polygon>
<polyline fill="none" stroke="black" points="154,-104 154,-98"></polyline>
<polyline fill="none" stroke="black" points="160,-98 154,-98"></polyline>
<text text-anchor="middle" x="88" y="-68" font-family="Arial" font-size="20.00">Bytes sin</text>
<text text-anchor="middle" x="88" y="-44" font-family="Arial" font-size="20.00">transformar</text>
</g>
<!-- FileStream -->
<g id="node2" class="node">
<title>FileStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="600.02,-90.8 456.02,-90.8 456.02,-33.2 600.02,-33.2 600.02,-90.8"></polygon>
<text text-anchor="middle" x="528.02" y="-57.2" font-family="Arial" font-size="16.00" fill="white">FileStream</text>
</g>
<!-- Bytes&#45;&gt;FileStream -->
<g id="edge1" class="edge">
<title>Bytes-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M174.71,-62C174.71,-62 441.27,-62 441.27,-62"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="174.71,-58.5 164.71,-62 174.71,-65.5 174.71,-58.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="441.27,-65.5 451.27,-62 441.27,-58.5 441.27,-65.5"></polygon>
<text text-anchor="middle" x="236.71" y="-67.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- Fichero -->
<g id="node3" class="node">
<title>Fichero</title>
<polygon fill="none" stroke="black" points="1042.04,-92 902.04,-92 898.04,-88 898.04,-32 1038.04,-32 1042.04,-36 1042.04,-92"></polygon>
<polyline fill="none" stroke="black" points="1038.04,-88 898.04,-88"></polyline>
<polyline fill="none" stroke="black" points="1038.04,-88 1038.04,-32"></polyline>
<polyline fill="none" stroke="black" points="1038.04,-88 1042.04,-92"></polyline>
<text text-anchor="middle" x="970.04" y="-56" font-family="Arial" font-size="20.00">Fichero</text>
</g>
<!-- FileStream&#45;&gt;Fichero -->
<g id="edge2" class="edge">
<title>FileStream-&gt;Fichero</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M615.06,-62C615.06,-62 883.33,-62 883.33,-62"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="615.06,-58.5 605.06,-62 615.06,-65.5 615.06,-58.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="883.33,-65.5 893.33,-62 883.33,-58.5 883.33,-65.5"></polygon>
<text text-anchor="middle" x="821.33" y="-67.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
</g>
</svg>
</p><p></p>
<h5 id="apertura-y-cierre-de-un-fichero-con-filestream">Apertura y Cierre de un fichero con FileStream </h5>
<p>La forma de abrirlo o crearlo más común de encontrar en la mayoría de lenguajes es usando el constructor...</p>
<p><strong>public <a href="https://learn.microsoft.com/es-es/dotnet/api/system.io.filestream.-ctor?view=net-10.0">FileStream</a>(string path, FileMode mode, FileAccess access)</strong></p>
<ul>
<li>
<p><strong><code>string path</code></strong>: Ubicación del fichero sobre el que queremos abrir un flujo.</p>
</li>
<li>
<p><strong><code>FileMode mode</code></strong>: Enum con las posibilidades de apertura del fichero.</p>
<ul>
<li><strong><code>Append</code></strong>: Abre el archivo si existe y realiza una búsqueda hasta el final del mismo, o crea un archivo nuevo.</li>
<li><strong><code>Create</code></strong>: Especifica que el sistema operativo debe crear un archivo nuevo. Si el archivo ya existe, se sobrescribirá.</li>
<li><strong><code>CreateNew</code></strong>: Especifica que el sistema operativo debe crear un archivo nuevo. Si el archivo ya existe hay una excepción.</li>
<li><strong><code>Open</code></strong>: Especifica que el sistema operativo debe abrir un archivo existente.</li>
<li><strong><code>OpenOrCreate</code></strong>: Especifica que el sistema operativo debe abrir un archivo si ya existe; en caso contrario, debe crearse uno nuevo.</li>
<li><strong><code>Truncate</code></strong>: Especifica que el sistema operativo debe abrir un archivo existente. Una vez abierto, debe truncarse el archivo para que su tamaño sea de cero bytes.</li>
</ul>
</li>
<li>
<p><strong><code>FileAccess access</code></strong>: Enum con el tipo de operación que vamos a realizar.</p>
<ul>
<li><strong><code>Read</code></strong>: Acceso de lectura al archivo.</li>
<li><strong><code>ReadWrite</code></strong>: Acceso de lectura y escritura al archivo.</li>
<li><strong><code>Write</code></strong>: Acceso de escritura al archivo.</li>
</ul>
</li>
</ul>
<p>El cierre del fichero lo haremos a través de...</p>
<p><strong>public void Stream.<a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.stream.close">Close</a>()</strong></p>
<ul>
<li>Libera el descriptor o manejador del fichero creado por el SO.</li>
<li>Hace un <strong><code>Flush()</code></strong> del buffer del <strong><code>Stream</code></strong> en el dispositivo si lo hemos abierto para escritura y hay escrituras pendientes de guardar.</li>
<li>En el lenguaje C#, esta tarea la hace el método <strong><code>Dispose()</code></strong> con el que todo flujo cuenta como <strong>estándar recomendado</strong> para liberar recursos de manera determinista. Sin embargo, por analogía con otros lenguajes a la clase <strong><code>Stream</code></strong> también dispone de un método <strong><code>Close()</code></strong> que hace lo mismo.</li>
</ul>
<p><strong>Ejemplo básico de uso</strong>:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-using">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO</span><span class="token punctuation">;</span>
<span class="token keyword keyword-namespace">namespace</span> <span class="token namespace">Ejemplo</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// El siguiente programa crea o sobrescribe el archivo ejemplo.txt en el</span>
        <span class="token comment">// directorio donde me estoy ejecutando.</span>
        <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">FileStream</span> fichero <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span>
                                    <span class="token named-parameter punctuation">path</span><span class="token punctuation">:</span> <span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span>      <span class="token comment">// Nombre del fichero</span>
                                    mode<span class="token punctuation">:</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span>    <span class="token comment">// Lo creo o sobrescribo si existe</span>
                                    access<span class="token punctuation">:</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Solo puedo escribir en él.</span>
            fichero<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="contenedor">
    <div class="fondo">
        <div class="abre_comilla">"</div>
        <div class="cierra_comilla">"</div>
        <div class="cita">I think Microsoft named .Net so it wouldn't show up in a Unix directory listing.</div>
        <div class="autor">- Oktal.</div>
    </div>
</div>
<div style="page-break-after:always;"></div>
<h5 id="escritura-de-un-fichero-con-filestream">Escritura de un fichero con FileStream </h5>
<p>La forma escribir más común, herencia del lenguaje C es el método...</p>
<p><strong>public override void fileStream.<a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.filestream.write#System_IO_FileStream_Write_System_Byte___System_Int32_System_Int32_">Write</a>(byte[] array, int offset, int count)</strong></p>
<ul>
<li><strong><code>byte[] array</code></strong>: Buffer que contiene los datos a escribir.</li>
<li><strong><code>int offset</code></strong>: Desplazamiento en bytes de base cero de array donde se comienzan a copiar los datos en la secuencia actual.</li>
<li><strong>int count</strong>: Número máximo de bytes que se deben escribir.</li>
</ul>
<div class="box_bg_lightgray">
<p><strong>Ejemplo básico:</strong></p>
<div class="row">
<div class="col-sm-6 my-auto">
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span>
                    <span class="token named-parameter punctuation">path</span><span class="token punctuation">:</span> <span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span>
                    <span class="token named-parameter punctuation">mode</span><span class="token punctuation">:</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span>
                    <span class="token named-parameter punctuation">access</span><span class="token punctuation">:</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Escribo 3 bytes con el valor en hexadecimal del </span>
<span class="token comment">// dígito '0' en UTF-8 al principio del stream.</span>
<span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> datos <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x30</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>datos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> datos<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Volcamos a disco el buffer de manera forzada.</span>
fs<span class="token punctuation">.</span><span class="token function">Flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Cerramos el stream.</span>
fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<div class="col-sm-6">
<p></p><p align="center" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="250pt" height="150pt" viewBox="0.00 0.00 250.00 150.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.8 0.8) rotate(0) translate(-14.75 192.15)">
<title>G</title>
<text text-anchor="middle" x="171" y="-180.2" font-family="Arial" font-size="14.00">El descriptor se se desplzará por el Stream</text>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-8 8,-116.4 334,-116.4 334,-8 8,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<polygon fill="none" stroke="black" points="39.9,-52.8 39.9,-104.4 88.26,-104.4 88.26,-52.8 39.9,-52.8"></polygon>
<text text-anchor="start" x="48.9" y="-82.8" font-family="Arial" font-size="14.00">0x30</text>
<text text-anchor="start" x="57.51" y="-66" font-family="Arial" font-size="14.00">'0'</text>
<polygon fill="none" stroke="black" points="88.26,-52.8 88.26,-104.4 136.62,-104.4 136.62,-52.8 88.26,-52.8"></polygon>
<text text-anchor="start" x="97.26" y="-82.8" font-family="Arial" font-size="14.00">0x30</text>
<text text-anchor="start" x="105.87" y="-66" font-family="Arial" font-size="14.00">'0'</text>
<polygon fill="none" stroke="black" points="136.62,-52.8 136.62,-104.4 184.98,-104.4 184.98,-52.8 136.62,-52.8"></polygon>
<text text-anchor="start" x="145.62" y="-82.8" font-family="Arial" font-size="14.00">0x30</text>
<text text-anchor="start" x="154.23" y="-66" font-family="Arial" font-size="14.00">'0'</text>
<polygon fill="none" stroke="black" points="184.98,-52.8 184.98,-104.4 202.98,-104.4 202.98,-52.8 184.98,-52.8"></polygon>
<polygon fill="none" stroke="black" points="202.98,-52.8 202.98,-104.4 220.98,-104.4 220.98,-52.8 202.98,-52.8"></polygon>
<polygon fill="none" stroke="black" points="220.98,-52.8 220.98,-104.4 238.98,-104.4 238.98,-52.8 220.98,-52.8"></polygon>
<polygon fill="none" stroke="black" points="238.98,-52.8 238.98,-104.4 256.98,-104.4 256.98,-52.8 238.98,-52.8"></polygon>
<text text-anchor="start" x="264.98" y="-74.4" font-family="Arial" font-size="14.00">Stream</text>
<text text-anchor="start" x="52.4" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="60.19" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">00</text>
<text text-anchor="start" x="100.76" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="108.54" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">01</text>
<text text-anchor="start" x="149.12" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="156.9" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">02</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="40" y="-155.4" font-family="Arial" font-size="14.00" fill="lightgray">antes</text>
<text text-anchor="middle" x="40" y="-138.6" font-family="Arial" font-size="14.00" fill="lightgray">Write</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="lightgray" d="M41.45,-130.54C41.45,-130.54 41.45,-115.91 41.45,-115.91"></path>
<polygon fill="lightgray" stroke="lightgray" points="44.95,-115.91 41.45,-105.91 37.95,-115.91 44.95,-115.91"></polygon>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="184" y="-155.4" font-family="Arial" font-size="14.00">después</text>
<text text-anchor="middle" x="184" y="-138.6" font-family="Arial" font-size="14.00">Write</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" d="M184,-130.54C184,-130.54 184,-115.91 184,-115.91"></path>
<polygon fill="black" stroke="black" points="187.5,-115.91 184,-105.91 180.5,-115.91 187.5,-115.91"></polygon>
</g>
</g>
</svg>
</p><p></p>
</div>
</div>
</div> <!-- fin ejemplo -->
<p><strong>public override void fileStream.<a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.filestream.writebyte">WriteByte</a>(byte byte)</strong></p>
<p>Esté método será análogo al anterior pero escribirá solo 1 byte en el flujo desplazando el descriptor una posición.</p>
<div style="page-break-after:always;"></div>
<h5 id="lectura-de-un-fichero-con-filestream">Lectura de un fichero con FileStream </h5>
<p>La forma escribir más común, herencia del lenguaje C es el método...</p>
<p><strong>public override int <a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.filestream.read?#System_IO_FileStream_Read_System_Byte___System_Int32_System_Int32_">Read</a>(byte[] array, int offset, int count)</strong></p>
<div class="row">
<div class="col-sm-6 my-auto">
<ul>
<li><strong><code>byte[] array</code></strong>: Array a rellenar con los bytes leídos.</li>
<li><strong><code>int offset</code></strong>: Desplazamiento de bytes en el parámetro array donde debe comenzar la lectura.</li>
<li><strong><code>int count</code></strong>: Número máximo de bytes que se pueden leer.</li>
<li><strong>Devuelve:</strong> un entero con <strong>el número de bytes leídos</strong>.</li>
</ul>
</div>
<div class="col-sm-6 my-auto">
<div class="admonition warning">
<p class="admonition-title">Aviso</p>
<p>El <strong>array</strong> debe estar predimensionado con el espacio suficiente. Además, esta dimensión puede ser mayor al número de bytes a leer.</p>
</div>
</div>
</div>
<div class="box_bg_lightgray">
<p><strong>Ejemplo básico:</strong></p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">FileStream</span> fichero <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span>
                            <span class="token named-parameter punctuation">path</span><span class="token punctuation">:</span> <span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span>
                            <span class="token named-parameter punctuation">mode</span><span class="token punctuation">:</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span>      <span class="token comment">// Abro un fichero existente (sino error)</span>
                            access<span class="token punctuation">:</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Lo abro específicamente para lectura.</span>

<span class="token comment">// Como voy a leer los 3 bytes que escribí en el ejemplo anterior</span>
<span class="token comment">// creo un array con espacio de 3 como mínimo.</span>
<span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> datos <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-byte">byte</span></span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Leo desde el principio datos.Length = 3 bytes y los añado del array datos </span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> bytesLeidos <span class="token operator">=</span> fichero<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>datos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> datos<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Cómo no se lo que ha leído realmente porque en el fichero a lo </span>
<span class="token comment">// mejor solo había 2 bytes. En lugar de recorrer con un foreach</span>
<span class="token comment">// recorro hasta el número de bytes leídos que me ha devuelto el método.</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bytesLeidos<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">datos<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span><span class="token format-string"><span class="token punctuation">:</span>X</span><span class="token punctuation">}</span></span><span class="token string"> "</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fichero<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div> <!-- fin ejemplo -->
<p><strong>public override int fileStream.<a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.filestream.readbyte">ReadByte</a>()</strong></p>
<p>Lee un byte del archivo y avanza la posición de lectura un byte. Devuelve, el byte, convertido en un int, o <strong>-1 si se ha alcanzado el final de la secuencia</strong>.</p>
<h5 id="longitud-y-posición-en-el-stream">Longitud y Posición en el Stream </h5>
<ul>
<li><strong>long Length</strong>: Número de bytes almacenados en el flujo (tamaño del flujo).<br>
En ficheros, el tamaño en bytes el fichero.</li>
<li><strong>long Position</strong>: Número del <strong>byte actual</strong> en el flujo <strong>empezando en 0</strong>.<br>
En ficheros, la posición actual <strong>donde se encuentra el descriptor</strong> de lectura o escritura del fichero.</li>
</ul>
<div class="box_bg_lightgray">
<p><strong>Ejemplo básico:</strong> (Puedes descargar el código completo desde <strong><a href="assets/ejemplos/readbyte_ejemplo.cs">este enlace</a></strong>)</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Paso la cadena a un array de 17 bytes para poder</span>
<span class="token comment">// escribirla con un FileStream.</span>
<span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> buffer <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span><span class="token string">"Lorem ipsum dolor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Longitud Fichero: "</span> <span class="token operator">+</span> fs<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Mostrará 17</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Posicion descriptor lectura: "</span> <span class="token operator">+</span> fs<span class="token punctuation">.</span>Position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Devolverá un 0</span>
</code></pre><p></p><p align="center" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="550pt" height="100pt" viewBox="0.00 0.00 550.00 100.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.6 0.6) rotate(0) translate(45.33 165.13)">
<title>G</title>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-8 8,-99.6 818,-99.6 818,-8 8,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<text text-anchor="start" x="32.33" y="-66" font-family="Arial" font-size="14.00"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</text>
<polygon fill="none" stroke="black" points="71.45,-52.8 71.45,-87.6 110.81,-87.6 110.81,-52.8 71.45,-52.8"></polygon>
<text text-anchor="start" x="84.56" y="-66" font-family="Arial" font-size="14.00">'L'</text>
<polygon fill="none" stroke="black" points="110.81,-52.8 110.81,-87.6 150.17,-87.6 150.17,-52.8 110.81,-52.8"></polygon>
<text text-anchor="start" x="123.92" y="-66" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="150.17,-52.8 150.17,-87.6 189.53,-87.6 189.53,-52.8 150.17,-52.8"></polygon>
<text text-anchor="start" x="164.84" y="-66" font-family="Arial" font-size="14.00">'r'</text>
<polygon fill="none" stroke="black" points="189.53,-52.8 189.53,-87.6 228.88,-87.6 228.88,-52.8 189.53,-52.8"></polygon>
<text text-anchor="start" x="202.64" y="-66" font-family="Arial" font-size="14.00">'e'</text>
<polygon fill="none" stroke="black" points="228.88,-52.8 228.88,-87.6 268.24,-87.6 268.24,-52.8 228.88,-52.8"></polygon>
<text text-anchor="start" x="240.06" y="-66" font-family="Arial" font-size="14.00">'m'</text>
<polygon fill="none" stroke="black" points="268.24,-52.8 268.24,-87.6 307.6,-87.6 307.6,-52.8 268.24,-52.8"></polygon>
<text text-anchor="start" x="283.3" y="-66" font-family="Arial" font-size="14.00">' '</text>
<polygon fill="none" stroke="black" points="307.6,-52.8 307.6,-87.6 346.96,-87.6 346.96,-52.8 307.6,-52.8"></polygon>
<text text-anchor="start" x="323.05" y="-66" font-family="Arial" font-size="14.00">'i'</text>
<polygon fill="none" stroke="black" points="346.96,-52.8 346.96,-87.6 386.32,-87.6 386.32,-52.8 346.96,-52.8"></polygon>
<text text-anchor="start" x="360.07" y="-66" font-family="Arial" font-size="14.00">'p'</text>
<polygon fill="none" stroke="black" points="386.32,-52.8 386.32,-87.6 425.68,-87.6 425.68,-52.8 386.32,-52.8"></polygon>
<text text-anchor="start" x="399.82" y="-66" font-family="Arial" font-size="14.00">'s'</text>
<polygon fill="none" stroke="black" points="425.68,-52.8 425.68,-87.6 465.03,-87.6 465.03,-52.8 425.68,-52.8"></polygon>
<text text-anchor="start" x="438.79" y="-66" font-family="Arial" font-size="14.00">'u'</text>
<polygon fill="none" stroke="black" points="465.03,-52.8 465.03,-87.6 504.39,-87.6 504.39,-52.8 465.03,-52.8"></polygon>
<text text-anchor="start" x="476.21" y="-66" font-family="Arial" font-size="14.00">'m'</text>
<polygon fill="none" stroke="black" points="504.39,-52.8 504.39,-87.6 543.75,-87.6 543.75,-52.8 504.39,-52.8"></polygon>
<text text-anchor="start" x="519.45" y="-66" font-family="Arial" font-size="14.00">' '</text>
<polygon fill="none" stroke="black" points="543.75,-52.8 543.75,-87.6 583.11,-87.6 583.11,-52.8 543.75,-52.8"></polygon>
<text text-anchor="start" x="556.86" y="-66" font-family="Arial" font-size="14.00">'d'</text>
<polygon fill="none" stroke="black" points="583.11,-52.8 583.11,-87.6 622.47,-87.6 622.47,-52.8 583.11,-52.8"></polygon>
<text text-anchor="start" x="596.22" y="-66" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="622.47,-52.8 622.47,-87.6 661.83,-87.6 661.83,-52.8 622.47,-52.8"></polygon>
<text text-anchor="start" x="637.92" y="-66" font-family="Arial" font-size="14.00">'l'</text>
<polygon fill="none" stroke="black" points="661.83,-52.8 661.83,-87.6 701.18,-87.6 701.18,-52.8 661.83,-52.8"></polygon>
<text text-anchor="start" x="674.94" y="-66" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="701.18,-52.8 701.18,-87.6 740.54,-87.6 740.54,-52.8 701.18,-52.8"></polygon>
<text text-anchor="start" x="715.86" y="-66" font-family="Arial" font-size="14.00">'r'</text>
<text text-anchor="start" x="748.54" y="-66" font-family="Arial" font-size="14.00">Stream</text>
<text text-anchor="start" x="79.45" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="87.24" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">00</text>
<text text-anchor="start" x="118.81" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="126.59" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">01</text>
<text text-anchor="start" x="158.17" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="165.95" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">02</text>
<text text-anchor="start" x="197.53" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="205.31" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">03</text>
<text text-anchor="start" x="236.88" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="244.67" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">04</text>
<text text-anchor="start" x="276.24" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="284.03" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">05</text>
<text text-anchor="start" x="315.6" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="323.39" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">06</text>
<text text-anchor="start" x="354.96" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="362.75" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">07</text>
<text text-anchor="start" x="394.32" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="402.1" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">08</text>
<text text-anchor="start" x="433.68" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="441.46" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">09</text>
<text text-anchor="start" x="473.03" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="480.82" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">10</text>
<text text-anchor="start" x="512.39" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="520.18" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">11</text>
<text text-anchor="start" x="551.75" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="559.54" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">12</text>
<text text-anchor="start" x="591.11" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="598.9" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">13</text>
<text text-anchor="start" x="630.47" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="638.25" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">14</text>
<text text-anchor="start" x="669.83" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="677.61" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">15</text>
<text text-anchor="start" x="709.18" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="716.97" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">16</text>
</g>
<!-- p -->
<g id="node2" class="node">
<title>p</title>
<text text-anchor="middle" x="72" y="-141.4" font-family="Arial" font-size="14.00">fs.Position = 0</text>
</g>
<!-- p&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="black" d="M72,-127.88C72,-127.88 72,-99.11 72,-99.11"></path>
<polygon fill="black" stroke="black" points="75.5,-99.11 72,-89.11 68.5,-99.11 75.5,-99.11"></polygon>
</g>
<!-- l -->
<g id="node3" class="node">
<title>l</title>
<text text-anchor="middle" x="740" y="-141.4" font-family="Arial" font-size="14.00">fs.Length = 17</text>
</g>
<!-- l&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>l-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M740,-127.88C740,-110.83 740,-87.6 740,-87.6"></path>
</g>
</g>
</svg>
</p><p></p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-char">char</span></span> c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>fs<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c = 'L'</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Posición descriptor lectura: "</span> <span class="token operator">+</span> fs<span class="token punctuation">.</span>Position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Devolverá un 1</span>
</code></pre><p></p><p align="center" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="550pt" height="100pt" viewBox="0.00 0.00 550.00 100.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.6 0.6) rotate(0) translate(45.33 165.13)">
<title>G</title>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-8 8,-99.6 818,-99.6 818,-8 8,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<text text-anchor="start" x="32.33" y="-66" font-family="Arial" font-size="14.00"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</text>
<polygon fill="none" stroke="black" points="71.45,-52.8 71.45,-87.6 110.81,-87.6 110.81,-52.8 71.45,-52.8"></polygon>
<text text-anchor="start" x="84.56" y="-66" font-family="Arial" font-size="14.00">'L'</text>
<polygon fill="none" stroke="black" points="110.81,-52.8 110.81,-87.6 150.17,-87.6 150.17,-52.8 110.81,-52.8"></polygon>
<text text-anchor="start" x="123.92" y="-66" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="150.17,-52.8 150.17,-87.6 189.53,-87.6 189.53,-52.8 150.17,-52.8"></polygon>
<text text-anchor="start" x="164.84" y="-66" font-family="Arial" font-size="14.00">'r'</text>
<polygon fill="none" stroke="black" points="189.53,-52.8 189.53,-87.6 228.88,-87.6 228.88,-52.8 189.53,-52.8"></polygon>
<text text-anchor="start" x="202.64" y="-66" font-family="Arial" font-size="14.00">'e'</text>
<polygon fill="none" stroke="black" points="228.88,-52.8 228.88,-87.6 268.24,-87.6 268.24,-52.8 228.88,-52.8"></polygon>
<text text-anchor="start" x="240.06" y="-66" font-family="Arial" font-size="14.00">'m'</text>
<polygon fill="none" stroke="black" points="268.24,-52.8 268.24,-87.6 307.6,-87.6 307.6,-52.8 268.24,-52.8"></polygon>
<text text-anchor="start" x="283.3" y="-66" font-family="Arial" font-size="14.00">' '</text>
<polygon fill="none" stroke="black" points="307.6,-52.8 307.6,-87.6 346.96,-87.6 346.96,-52.8 307.6,-52.8"></polygon>
<text text-anchor="start" x="323.05" y="-66" font-family="Arial" font-size="14.00">'i'</text>
<polygon fill="none" stroke="black" points="346.96,-52.8 346.96,-87.6 386.32,-87.6 386.32,-52.8 346.96,-52.8"></polygon>
<text text-anchor="start" x="360.07" y="-66" font-family="Arial" font-size="14.00">'p'</text>
<polygon fill="none" stroke="black" points="386.32,-52.8 386.32,-87.6 425.68,-87.6 425.68,-52.8 386.32,-52.8"></polygon>
<text text-anchor="start" x="399.82" y="-66" font-family="Arial" font-size="14.00">'s'</text>
<polygon fill="none" stroke="black" points="425.68,-52.8 425.68,-87.6 465.03,-87.6 465.03,-52.8 425.68,-52.8"></polygon>
<text text-anchor="start" x="438.79" y="-66" font-family="Arial" font-size="14.00">'u'</text>
<polygon fill="none" stroke="black" points="465.03,-52.8 465.03,-87.6 504.39,-87.6 504.39,-52.8 465.03,-52.8"></polygon>
<text text-anchor="start" x="476.21" y="-66" font-family="Arial" font-size="14.00">'m'</text>
<polygon fill="none" stroke="black" points="504.39,-52.8 504.39,-87.6 543.75,-87.6 543.75,-52.8 504.39,-52.8"></polygon>
<text text-anchor="start" x="519.45" y="-66" font-family="Arial" font-size="14.00">' '</text>
<polygon fill="none" stroke="black" points="543.75,-52.8 543.75,-87.6 583.11,-87.6 583.11,-52.8 543.75,-52.8"></polygon>
<text text-anchor="start" x="556.86" y="-66" font-family="Arial" font-size="14.00">'d'</text>
<polygon fill="none" stroke="black" points="583.11,-52.8 583.11,-87.6 622.47,-87.6 622.47,-52.8 583.11,-52.8"></polygon>
<text text-anchor="start" x="596.22" y="-66" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="622.47,-52.8 622.47,-87.6 661.83,-87.6 661.83,-52.8 622.47,-52.8"></polygon>
<text text-anchor="start" x="637.92" y="-66" font-family="Arial" font-size="14.00">'l'</text>
<polygon fill="none" stroke="black" points="661.83,-52.8 661.83,-87.6 701.18,-87.6 701.18,-52.8 661.83,-52.8"></polygon>
<text text-anchor="start" x="674.94" y="-66" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="701.18,-52.8 701.18,-87.6 740.54,-87.6 740.54,-52.8 701.18,-52.8"></polygon>
<text text-anchor="start" x="715.86" y="-66" font-family="Arial" font-size="14.00">'r'</text>
<text text-anchor="start" x="748.54" y="-66" font-family="Arial" font-size="14.00">Stream</text>
<text text-anchor="start" x="79.45" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="87.24" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">00</text>
<text text-anchor="start" x="118.81" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="126.59" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">01</text>
<text text-anchor="start" x="158.17" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="165.95" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">02</text>
<text text-anchor="start" x="197.53" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="205.31" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">03</text>
<text text-anchor="start" x="236.88" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="244.67" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">04</text>
<text text-anchor="start" x="276.24" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="284.03" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">05</text>
<text text-anchor="start" x="315.6" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="323.39" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">06</text>
<text text-anchor="start" x="354.96" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="362.75" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">07</text>
<text text-anchor="start" x="394.32" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="402.1" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">08</text>
<text text-anchor="start" x="433.68" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="441.46" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">09</text>
<text text-anchor="start" x="473.03" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="480.82" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">10</text>
<text text-anchor="start" x="512.39" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="520.18" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">11</text>
<text text-anchor="start" x="551.75" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="559.54" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">12</text>
<text text-anchor="start" x="591.11" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="598.9" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">13</text>
<text text-anchor="start" x="630.47" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="638.25" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">14</text>
<text text-anchor="start" x="669.83" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="677.61" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">15</text>
<text text-anchor="start" x="709.18" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="716.97" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">16</text>
</g>
<!-- p -->
<g id="node2" class="node">
<title>p</title>
<text text-anchor="middle" x="111" y="-141.4" font-family="Arial" font-size="14.00">fs.Position = 1</text>
</g>
<!-- p&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="black" d="M111,-127.88C111,-127.88 111,-99.11 111,-99.11"></path>
<polygon fill="black" stroke="black" points="114.5,-99.11 111,-89.11 107.5,-99.11 114.5,-99.11"></polygon>
</g>
<!-- l -->
<g id="node3" class="node">
<title>l</title>
<text text-anchor="middle" x="740" y="-141.4" font-family="Arial" font-size="14.00">fs.Length = 17</text>
</g>
<!-- l&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>l-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M740,-127.88C740,-110.83 740,-87.6 740,-87.6"></path>
</g>
</g>
</svg>
</p><p></p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>fs<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c = 'o'</span>
c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>fs<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c = 'r'</span>
c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>fs<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c = 'e'</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Posición descriptor lectura: "</span> <span class="token operator">+</span> fs<span class="token punctuation">.</span>Position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Devolverá un 4</span>
fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p></p><p align="center" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="550pt" height="100pt" viewBox="0.00 0.00 550.00 100.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.6 0.6) rotate(0) translate(45.33 165.13)">
<title>G</title>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-8 8,-99.6 818,-99.6 818,-8 8,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<text text-anchor="start" x="32.33" y="-66" font-family="Arial" font-size="14.00"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</text>
<polygon fill="none" stroke="black" points="71.45,-52.8 71.45,-87.6 110.81,-87.6 110.81,-52.8 71.45,-52.8"></polygon>
<text text-anchor="start" x="84.56" y="-66" font-family="Arial" font-size="14.00">'L'</text>
<polygon fill="none" stroke="black" points="110.81,-52.8 110.81,-87.6 150.17,-87.6 150.17,-52.8 110.81,-52.8"></polygon>
<text text-anchor="start" x="123.92" y="-66" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="150.17,-52.8 150.17,-87.6 189.53,-87.6 189.53,-52.8 150.17,-52.8"></polygon>
<text text-anchor="start" x="164.84" y="-66" font-family="Arial" font-size="14.00">'r'</text>
<polygon fill="none" stroke="black" points="189.53,-52.8 189.53,-87.6 228.88,-87.6 228.88,-52.8 189.53,-52.8"></polygon>
<text text-anchor="start" x="202.64" y="-66" font-family="Arial" font-size="14.00">'e'</text>
<polygon fill="none" stroke="black" points="228.88,-52.8 228.88,-87.6 268.24,-87.6 268.24,-52.8 228.88,-52.8"></polygon>
<text text-anchor="start" x="240.06" y="-66" font-family="Arial" font-size="14.00">'m'</text>
<polygon fill="none" stroke="black" points="268.24,-52.8 268.24,-87.6 307.6,-87.6 307.6,-52.8 268.24,-52.8"></polygon>
<text text-anchor="start" x="283.3" y="-66" font-family="Arial" font-size="14.00">' '</text>
<polygon fill="none" stroke="black" points="307.6,-52.8 307.6,-87.6 346.96,-87.6 346.96,-52.8 307.6,-52.8"></polygon>
<text text-anchor="start" x="323.05" y="-66" font-family="Arial" font-size="14.00">'i'</text>
<polygon fill="none" stroke="black" points="346.96,-52.8 346.96,-87.6 386.32,-87.6 386.32,-52.8 346.96,-52.8"></polygon>
<text text-anchor="start" x="360.07" y="-66" font-family="Arial" font-size="14.00">'p'</text>
<polygon fill="none" stroke="black" points="386.32,-52.8 386.32,-87.6 425.68,-87.6 425.68,-52.8 386.32,-52.8"></polygon>
<text text-anchor="start" x="399.82" y="-66" font-family="Arial" font-size="14.00">'s'</text>
<polygon fill="none" stroke="black" points="425.68,-52.8 425.68,-87.6 465.03,-87.6 465.03,-52.8 425.68,-52.8"></polygon>
<text text-anchor="start" x="438.79" y="-66" font-family="Arial" font-size="14.00">'u'</text>
<polygon fill="none" stroke="black" points="465.03,-52.8 465.03,-87.6 504.39,-87.6 504.39,-52.8 465.03,-52.8"></polygon>
<text text-anchor="start" x="476.21" y="-66" font-family="Arial" font-size="14.00">'m'</text>
<polygon fill="none" stroke="black" points="504.39,-52.8 504.39,-87.6 543.75,-87.6 543.75,-52.8 504.39,-52.8"></polygon>
<text text-anchor="start" x="519.45" y="-66" font-family="Arial" font-size="14.00">' '</text>
<polygon fill="none" stroke="black" points="543.75,-52.8 543.75,-87.6 583.11,-87.6 583.11,-52.8 543.75,-52.8"></polygon>
<text text-anchor="start" x="556.86" y="-66" font-family="Arial" font-size="14.00">'d'</text>
<polygon fill="none" stroke="black" points="583.11,-52.8 583.11,-87.6 622.47,-87.6 622.47,-52.8 583.11,-52.8"></polygon>
<text text-anchor="start" x="596.22" y="-66" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="622.47,-52.8 622.47,-87.6 661.83,-87.6 661.83,-52.8 622.47,-52.8"></polygon>
<text text-anchor="start" x="637.92" y="-66" font-family="Arial" font-size="14.00">'l'</text>
<polygon fill="none" stroke="black" points="661.83,-52.8 661.83,-87.6 701.18,-87.6 701.18,-52.8 661.83,-52.8"></polygon>
<text text-anchor="start" x="674.94" y="-66" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="701.18,-52.8 701.18,-87.6 740.54,-87.6 740.54,-52.8 701.18,-52.8"></polygon>
<text text-anchor="start" x="715.86" y="-66" font-family="Arial" font-size="14.00">'r'</text>
<text text-anchor="start" x="748.54" y="-66" font-family="Arial" font-size="14.00">Stream</text>
<text text-anchor="start" x="79.45" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="87.24" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">00</text>
<text text-anchor="start" x="118.81" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="126.59" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">01</text>
<text text-anchor="start" x="158.17" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="165.95" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">02</text>
<text text-anchor="start" x="197.53" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="205.31" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">03</text>
<text text-anchor="start" x="236.88" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="244.67" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">04</text>
<text text-anchor="start" x="276.24" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="284.03" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">05</text>
<text text-anchor="start" x="315.6" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="323.39" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">06</text>
<text text-anchor="start" x="354.96" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="362.75" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">07</text>
<text text-anchor="start" x="394.32" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="402.1" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">08</text>
<text text-anchor="start" x="433.68" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="441.46" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">09</text>
<text text-anchor="start" x="473.03" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="480.82" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">10</text>
<text text-anchor="start" x="512.39" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="520.18" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">11</text>
<text text-anchor="start" x="551.75" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="559.54" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">12</text>
<text text-anchor="start" x="591.11" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="598.9" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">13</text>
<text text-anchor="start" x="630.47" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="638.25" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">14</text>
<text text-anchor="start" x="669.83" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="677.61" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">15</text>
<text text-anchor="start" x="709.18" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="716.97" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">16</text>
</g>
<!-- p -->
<g id="node2" class="node">
<title>p</title>
<text text-anchor="middle" x="229" y="-141.4" font-family="Arial" font-size="14.00">fs.Position = 4</text>
</g>
<!-- p&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="black" d="M229,-127.88C229,-127.88 229,-99.11 229,-99.11"></path>
<polygon fill="black" stroke="black" points="232.5,-99.11 229,-89.11 225.5,-99.11 232.5,-99.11"></polygon>
</g>
<!-- l -->
<g id="node3" class="node">
<title>l</title>
<text text-anchor="middle" x="740" y="-141.4" font-family="Arial" font-size="14.00">fs.Length = 17</text>
</g>
<!-- l&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>l-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M740,-127.88C740,-110.83 740,-87.6 740,-87.6"></path>
</g>
</g>
</svg>
</p><p></p>
<div class="admonition tip">
<p class="admonition-title">Consejo</p>
<p>Estos valores nos pueden ser útiles para controlar si hemos llegado o no al final de las secuencia en <strong>algunos casos</strong>. Por ejemplo, con la condición <strong><code>while (fichero.Position &lt; fichero.Length)</code></strong> puedo saber si estoy al final de un stream.</p>
</div>
</div> <!-- fin ejemplo -->
<h5 id="desplazándonos-por-el-stream">Desplazándonos por el Stream </h5>
<p><strong>public override long <a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.filestream.seek">Seek</a>(long offset, SeekOrigin origin)</strong></p>
<ul>
<li>
<p><strong><code>long offset</code></strong>: El punto relativo a origin desde el que comienza la operación Seek. Pude ser un valor negativo si me desplazo hacia la “izquierda”.</p>
</li>
<li>
<p><strong><code>SeekOrigin origin</code></strong>: Especifica el comienzo, el final o la posición actual como un punto de referencia para origin, mediante el uso de un valor del <strong><code>Enum SeekOrigin</code></strong>.<br>
Estos valores pueden ser: <strong><code>Begin</code></strong>, <strong><code>Current</code></strong> y <strong><code>End</code></strong></p>
<div class="admonition warning">
<p class="admonition-title">Aviso</p>
<p>No en todos los streams podremos desplazarnos con <strong><code>Seek</code></strong> como en los <strong><code>FileStream</code></strong>. Por esa razón la clase base <strong><code>Stream</code></strong> dispone de una propiedad <strong><code>CanSeek</code></strong> que me dirá si puedo desplazarme por él o no. Fíjate en el siguiente ejemplo.</p>
</div>
</li>
</ul>
<div style="page-break-after:always;"></div>
<div class="box_bg_lightgray">
<p><strong>Ejemplo básico:</strong></p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">FileStream</span> fichero <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>fichero<span class="token punctuation">.</span>CanSeek<span class="token punctuation">)</span> <span class="token comment">// Para streams que no admiten desplazamientos </span>
<span class="token punctuation">{</span>
    <span class="token comment">// Me sitúo al final y me desplazo 1 a la izquierda.</span>
    fichero<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>End<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">// Leo el último byte.         </span>
    <span class="token class-name"><span class="token keyword keyword-int">int</span></span> ultimoByte <span class="token operator">=</span> fichero<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"El valor del último byte es </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ultimoByte</span><span class="token format-string"><span class="token punctuation">:</span>X</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-else">else</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"El stream no admite desplazamientos."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fichero<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div> <!-- fin ejemplo -->
<div class="row">
<div class="col-sm-6 my-auto">
<p><strong>Caso de desplazamiento 1</strong>:</p>
<p><strong><code>fichero.Seek(-1, SeekOrigin.End);</code></strong></p>
<p>Me sitúo al <strong>final</strong> y me desplazo <strong>1 byte a la izquierda</strong>, de tal manera que me quedo para escribir o leer sobre el último byte el <strong>byte n</strong>.</p>
</div>
<div class="col-sm-6">
<p></p><p class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="260pt" height="100pt" viewBox="0.00 0.00 260.00 100.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.5 0.5) rotate(0) translate(30 181.8)">
<title>G</title>
<polygon fill="white" stroke="none" points="-30,18.2 -30,-181.8 490,-181.8 490,18.2 -30,18.2"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-8 8,-99.6 452,-99.6 452,-8 8,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<polygon fill="none" stroke="black" points="39.9,-52.8 39.9,-87.6 79.26,-87.6 79.26,-52.8 39.9,-52.8"></polygon>
<polygon fill="none" stroke="black" points="79.26,-52.8 79.26,-87.6 118.62,-87.6 118.62,-52.8 79.26,-52.8"></polygon>
<polygon fill="none" stroke="black" points="118.62,-52.8 118.62,-87.6 157.98,-87.6 157.98,-52.8 118.62,-52.8"></polygon>
<text text-anchor="start" x="165.98" y="-66" font-family="Arial" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="185.65,-52.8 185.65,-87.6 229.67,-87.6 229.67,-52.8 185.65,-52.8"></polygon>
<polygon fill="none" stroke="black" points="229.67,-52.8 229.67,-87.6 273.69,-87.6 273.69,-52.8 229.67,-52.8"></polygon>
<polygon fill="none" stroke="black" points="273.69,-52.8 273.69,-87.6 374.97,-87.6 374.97,-52.8 273.69,-52.8"></polygon>
<text text-anchor="start" x="282.69" y="-67" font-family="Arial" font-size="14.00">Byte</text>
<text text-anchor="start" x="310.7" y="-67" font-family="Arial" baseline-shift="sub" font-size="14.00">Lenght-1</text>
<text text-anchor="start" x="382.97" y="-66" font-family="Arial" font-size="14.00">Stream</text>
<text text-anchor="start" x="47.9" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="55.69" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">00</text>
<text text-anchor="start" x="87.26" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="95.05" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">01</text>
<text text-anchor="start" x="126.62" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="134.41" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">02</text>
<text text-anchor="start" x="193.65" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="201.43" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">L-3</text>
<text text-anchor="start" x="237.67" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="245.46" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">L-2</text>
<text text-anchor="start" x="310.32" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="318.11" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">L-1</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="254" y="-141.4" font-family="Arial" font-size="14.00">SeekOrigin.End-1</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="black" d="M255.98,-127.85C257.7,-118.59 260.9,-107.04 266.82,-97.42"></path>
<polygon fill="black" stroke="black" points="269.38,-99.83 272.76,-89.79 263.85,-95.53 269.38,-99.83"></polygon>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="392" y="-141.4" font-family="Arial" font-size="14.00" fill="lightgray">SeekOrigin.End</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="lightgray" d="M391.02,-127.76C389.83,-118.57 387.26,-107.15 381.79,-97.64"></path>
<polygon fill="lightgray" stroke="lightgray" points="384.7,-95.68 375.88,-89.81 379.11,-99.9 384.7,-95.68"></polygon>
</g>
</g>
</svg>
</p><p></p>
</div>
<div class="col-sm-6 my-auto">
<p><strong>Caso de desplazamiento 2</strong>:</p>
<p><strong><code>fichero.Seek(2, SeekOrigin.Begin);</code></strong></p>
<p>Me sitúo al <strong>principio</strong> y me desplazo <strong>2 bytes</strong> a la derecha, de tal manera que me quedo para escribir o leer sobre el <strong>byte 2</strong>.</p>
</div>
<div class="col-sm-6">
<p></p><p class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="260pt" height="100pt" viewBox="0.00 0.00 260.00 100.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.5 0.5) rotate(0) translate(22.26 181.8)">
<title>G</title>
<polygon fill="white" stroke="none" points="-22.26,18.2 -22.26,-181.8 497.74,-181.8 497.74,18.2 -22.26,18.2"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="65.48,-8 65.48,-99.6 467.48,-99.6 467.48,-8 65.48,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<polygon fill="none" stroke="black" points="97.79,-52.8 97.79,-87.6 137.15,-87.6 137.15,-52.8 97.79,-52.8"></polygon>
<polygon fill="none" stroke="black" points="137.15,-52.8 137.15,-87.6 176.51,-87.6 176.51,-52.8 137.15,-52.8"></polygon>
<polygon fill="none" stroke="black" points="176.51,-52.8 176.51,-87.6 230.31,-87.6 230.31,-52.8 176.51,-52.8"></polygon>
<text text-anchor="start" x="185.51" y="-67" font-family="Arial" font-size="14.00">Byte</text>
<text text-anchor="start" x="213.52" y="-67" font-family="Arial" baseline-shift="sub" font-size="14.00">2</text>
<text text-anchor="start" x="238.31" y="-66" font-family="Arial" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="257.98,-52.8 257.98,-87.6 302,-87.6 302,-52.8 257.98,-52.8"></polygon>
<polygon fill="none" stroke="black" points="302,-52.8 302,-87.6 346.02,-87.6 346.02,-52.8 302,-52.8"></polygon>
<polygon fill="none" stroke="black" points="346.02,-52.8 346.02,-87.6 390.04,-87.6 390.04,-52.8 346.02,-52.8"></polygon>
<text text-anchor="start" x="398.04" y="-66" font-family="Arial" font-size="14.00">Stream</text>
<text text-anchor="start" x="105.79" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="113.58" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">00</text>
<text text-anchor="start" x="145.15" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="152.93" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">01</text>
<text text-anchor="start" x="191.73" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="199.51" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">02</text>
<text text-anchor="start" x="265.98" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="273.76" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">L-3</text>
<text text-anchor="start" x="310" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="317.78" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">L-2</text>
<text text-anchor="start" x="354.02" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="361.8" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">L-1</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="62.48" y="-141.4" font-family="Arial" font-size="14.00" fill="lightgray">SeekOrigin.Begin</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="lightgray" d="M70.51,-127.79C75.36,-118.58 82.17,-107.03 90.31,-96.96"></path>
<polygon fill="lightgray" stroke="lightgray" points="92.73,-99.52 96.78,-89.73 87.51,-94.85 92.73,-99.52"></polygon>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="213.48" y="-141.4" font-family="Arial" font-size="14.00">SeekOrigin.Begin+2</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" d="M204.69,-127.63C199.53,-118.48 192.39,-107.03 184.09,-96.98"></path>
<polygon fill="black" stroke="black" points="186.82,-94.79 177.52,-89.72 181.63,-99.49 186.82,-94.79"></polygon>
</g>
</g>
</svg>
</p><p></p>
</div>
<div class="col-sm-6 my-auto">
<p><strong>Caso de desplazamiento 3</strong>:</p>
<ol>
<li>
<p><strong><code>fichero.Seek(-2, SeekOrigin.Current);</code></strong> Desde <strong>donde me encuentre</strong>, me desplazo <strong>2 bytes</strong> a la <strong>izquierda</strong>, de tal manera que me quedo para escribir o leer sobre el primer byte el <strong>byte 0</strong>.</p>
</li>
<li>
<p><strong><code>fichero.Seek(3, SeekOrigin.Current);</code></strong> Desde <strong>donde me encuentre</strong>, me desplazo <strong>3 bytes</strong> a la derecha, de tal manera que me quedo para escribir o leer sobre el <strong>byte 5</strong>.</p>
</li>
</ol>
</div>
<div class="col-sm-6">
<p></p><p class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="260pt" height="100pt" viewBox="0.00 0.00 260.00 100.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.5 0.5) rotate(0) translate(0.93 181.8)">
<title>G</title>
<polygon fill="white" stroke="none" points="-0.93,18.2 -0.93,-181.8 519.07,-181.8 519.07,18.2 -0.93,18.2"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="108.14,-8 108.14,-99.6 510.14,-99.6 510.14,-8 108.14,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<polygon fill="none" stroke="black" points="140.22,-52.8 140.22,-87.6 194.02,-87.6 194.02,-52.8 140.22,-52.8"></polygon>
<text text-anchor="start" x="149.22" y="-67" font-family="Arial" font-size="14.00">Byte</text>
<text text-anchor="start" x="177.24" y="-67" font-family="Arial" baseline-shift="sub" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="194.02,-52.8 194.02,-87.6 233.38,-87.6 233.38,-52.8 194.02,-52.8"></polygon>
<text text-anchor="start" x="209.81" y="-66" font-family="Arial" font-size="14.00"> &nbsp;</text>
<polygon fill="none" stroke="black" points="233.38,-52.8 233.38,-87.6 272.74,-87.6 272.74,-52.8 233.38,-52.8"></polygon>
<text text-anchor="start" x="249.17" y="-66" font-family="Arial" font-size="14.00"> &nbsp;</text>
<polygon fill="none" stroke="black" points="272.74,-52.8 272.74,-87.6 312.1,-87.6 312.1,-52.8 272.74,-52.8"></polygon>
<text text-anchor="start" x="288.53" y="-66" font-family="Arial" font-size="14.00"> &nbsp;</text>
<polygon fill="none" stroke="black" points="312.1,-52.8 312.1,-87.6 351.46,-87.6 351.46,-52.8 312.1,-52.8"></polygon>
<text text-anchor="start" x="327.89" y="-66" font-family="Arial" font-size="14.00"> &nbsp;</text>
<polygon fill="none" stroke="black" points="351.46,-52.8 351.46,-87.6 405.26,-87.6 405.26,-52.8 351.46,-52.8"></polygon>
<text text-anchor="start" x="360.46" y="-67" font-family="Arial" font-size="14.00">Byte</text>
<text text-anchor="start" x="388.47" y="-67" font-family="Arial" baseline-shift="sub" font-size="14.00">5</text>
<text text-anchor="start" x="413.26" y="-66" font-family="Arial" font-size="14.00">...</text>
<text text-anchor="start" x="440.93" y="-66" font-family="Arial" font-size="14.00">Stream</text>
<text text-anchor="start" x="155.45" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="163.23" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">00</text>
<text text-anchor="start" x="202.02" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="209.81" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">01</text>
<text text-anchor="start" x="241.38" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="249.17" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">02</text>
<text text-anchor="start" x="280.74" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="288.53" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">03</text>
<text text-anchor="start" x="320.1" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="327.89" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">04</text>
<text text-anchor="start" x="366.68" y="-33.2" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="374.46" y="-33.2" font-family="Arial" baseline-shift="sub" font-size="14.00">05</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="74.14" y="-141.4" font-family="Arial" font-size="14.00">SeekOrigin.Current-2</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="black" d="M95.75,-127.79C106.56,-119.09 119.9,-107.92 132.05,-96.51"></path>
<polygon fill="black" stroke="black" points="134.38,-99.12 139.14,-89.65 129.52,-94.09 134.38,-99.12"></polygon>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="234.14" y="-141.4" font-family="Arial" font-size="14.00" fill="lightgray">SeekOrigin.Current</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="lightgray" d="M228.21,-127.77C225.89,-118.74 224.43,-107.61 227.49,-98.36"></path>
<polygon fill="lightgray" stroke="lightgray" points="230.42,-100.26 232.6,-89.9 224.43,-96.64 230.42,-100.26"></polygon>
</g>
<!-- p3 -->
<g id="node4" class="node">
<title>p3</title>
<text text-anchor="middle" x="396.14" y="-141.4" font-family="Arial" font-size="14.00">SeekOrigin.Current+3</text>
</g>
<!-- p3&#45;&gt;cluster0_stream -->
<g id="edge3" class="edge">
<title>p3-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" d="M384.15,-127.61C377.49,-118.59 368.69,-107.26 359.37,-96.95"></path>
<polygon fill="black" stroke="black" points="361.92,-94.55 352.5,-89.7 356.84,-99.36 361.92,-94.55"></polygon>
</g>
</g>
</svg>
</p><p></p>
</div>
</div>
<h5 id="recorriendo-un-filestream-hasta-el-final">Recorriendo un FileStream hasta el final </h5>
<p>Veamos a través de un ejemplo simple, varias formas de recorrer leyendo un <strong><code>FileStream</code></strong> hasta el final de la secuencia.</p>
<p><strong>Caso 1:</strong></p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">FileStream</span> fs <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> buffer <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span><span class="token string">"Lorem ipsum dolor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Definimos un buffer de 3 bytes para las lecturas</span>
    <span class="token comment">// esto es, podremos leer de tres en tres bytes con fs.read()</span>
    <span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> datos <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-byte">byte</span></span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword keyword-int">int</span></span> bytesLeidos<span class="token punctuation">;</span>
    <span class="token keyword keyword-do">do</span>
    <span class="token punctuation">{</span>
        bytesLeidos <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>datos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> datos<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bytesLeidos<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>datos<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>bytesLeidos <span class="token operator">&gt;=</span> datos<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>En el código anterior, leeré el stream mientras se llene el buffer de 3 bytes en cada lectura. En el momento que lea menos de 3 es que he llegado al final de la secuencia.</p>
<div class="admonition danger">
<p class="admonition-title">Peligro</p>
<p>No deberíamos recorrer en ningún caso el buffer con un <strong><code>foreach</code></strong> ya que siempre recorrerá 3 que es la longitud del buffer y podríamos haber leído solo 2 y por tanto podría mostrarme bytes que realmente no he leído y que están en el buffer de lecturas anteriores.</p>
</div>
<div style="page-break-after:always;"></div>
<p><strong>Caso 2:</strong></p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    fs<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>Begin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Vuelvo al principio para volver a recorrerla.</span>
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span>Position <span class="token operator">&lt;</span> fs<span class="token punctuation">.</span>Length<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        bytesLeidos <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>datos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> datos<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bytesLeidos<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>datos<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><p>Recorreremos la secuencia, mientras la <strong>posición</strong> en la que nos encontramos sea menor que la <strong>longitud</strong> de la misma.</p>
<p><strong>Caso 3:</strong></p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    fs<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>Begin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Vuelvo al principio para volver a recorrerla.</span>
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword keyword-int">int</span></span> _byte<span class="token punctuation">;</span>
    <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>_byte <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>_byte</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>Voy <strong>leyendo byte a byte</strong> mientras el valor de byte leído sea distinto de -1 o positivo. Esta opción es mucho más ineficiente en términos temporales que leer bloques de bytes con Read().</p>
<h4 id="pasando-el-flujo-por-un-decorator-stream">Pasando el flujo por un '<em>Decorator Stream</em>' </h4>
<p>Aunque este tipo de streams no los vamos a ver en profundidad en este curso por falta de tiempo. Básicamente, un <strong><a href="https://es.wikipedia.org/wiki/Decorator_(patr%C3%B3n_de_dise%C3%B1o)">decorator</a></strong> en POO es un patrón de diseño que añade funcionalidad a un objetos sin necesidad de utilizar el mecanismo de heréncia.</p>
<h5 id="ejemplo-de-decorator-stream-usando-bufferedstream">Ejemplo de '<em>Decorator Stream</em>' usando BufferedStream </h5>
<p>La funcionalidad que agrega una capa de almacenamiento en buffer a las operaciones de lectura y escritura para otra secuencia (la cual '<em>envuelve</em>'). Aunque <strong><code>FileStream</code></strong> ya tiene un buffer de escritura intermedio por defecto, nosotros <strong>podremos ampliarlo o reducirlo</strong> mediante esta capa de abstracción.</p>
<p></p><p align="center" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="550pt" height="100pt" viewBox="0.00 0.00 550.00 100.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.5 0.5) rotate(0) translate(-10.88 200)">
<title>G</title>
<polygon fill="white" stroke="none" points="10.88,0 10.88,-200 1110.88,-200 1110.88,0 10.88,0"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-12 8,-156 168,-156 168,-12 8,-12"></polygon>
<text text-anchor="middle" x="88" y="-125" font-family="Arial" font-size="30.00">Datos</text>
</g>
<g id="clust2" class="cluster">
<title>clusterG</title>
<polygon fill="none" stroke="#104e8b" points="288.41,-8 288.41,-192 821.36,-192 821.36,-8 288.41,-8"></polygon>
<text text-anchor="middle" x="554.88" y="-161" font-family="Arial" font-size="30.00" fill="#104e8b">Clases para el manejo de streams</text>
</g>
<g id="clust3" class="cluster">
<title>cluster2</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="293.41,-13 293.41,-143 477.41,-143 477.41,-13 293.41,-13"></polygon>
<text text-anchor="middle" x="385.41" y="-121" font-family="Arial" font-size="20.00" fill="#104e8b">Decorator Streams</text>
</g>
<g id="clust4" class="cluster">
<title>cluster3</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="595.83,-13 595.83,-143 816.36,-143 816.36,-13 595.83,-13"></polygon>
<text text-anchor="middle" x="706.09" y="-121" font-family="Arial" font-size="20.00" fill="#104e8b">Backing Store Streams</text>
</g>
<g id="clust5" class="cluster">
<title>cluster4</title>
<polygon fill="none" stroke="none" points="929.77,-12 929.77,-156 1113.77,-156 1113.77,-12 929.77,-12"></polygon>
<text text-anchor="middle" x="1021.77" y="-125" font-family="Arial" font-size="30.00">Dispositivos</text>
</g>
<!-- Bytes -->
<g id="node1" class="node">
<title>Bytes</title>
<polygon fill="none" stroke="black" points="154,-104 16,-104 16,-20 160,-20 160,-98 154,-104"></polygon>
<polyline fill="none" stroke="black" points="154,-104 154,-98"></polyline>
<polyline fill="none" stroke="black" points="160,-98 154,-98"></polyline>
<text text-anchor="middle" x="88" y="-68" font-family="Arial" font-size="20.00">Bytes sin</text>
<text text-anchor="middle" x="88" y="-44" font-family="Arial" font-size="20.00">transformar</text>
</g>
<!-- BufferedStream -->
<g id="node2" class="node">
<title>BufferedStream</title>
<polygon fill="#4f94cd" stroke="#4f94cd" points="457.41,-90.8 313.41,-90.8 313.41,-33.2 457.41,-33.2 457.41,-90.8"></polygon>
<text text-anchor="middle" x="385.41" y="-57.2" font-family="Arial" font-size="16.00" fill="white">BufferedStream</text>
</g>
<!-- Bytes&#45;&gt;BufferedStream -->
<g id="edge1" class="edge">
<title>Bytes-&gt;BufferedStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M174.92,-62C174.92,-62 298.43,-62 298.43,-62"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="174.92,-58.5 164.92,-62 174.92,-65.5 174.92,-58.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="298.43,-65.5 308.43,-62 298.43,-58.5 298.43,-65.5"></polygon>
<text text-anchor="middle" x="236.71" y="-67.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- FileStream -->
<g id="node3" class="node">
<title>FileStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="777.59,-90.8 633.59,-90.8 633.59,-33.2 777.59,-33.2 777.59,-90.8"></polygon>
<text text-anchor="middle" x="705.59" y="-57.2" font-family="Arial" font-size="16.00" fill="white">FileStream</text>
</g>
<!-- BufferedStream&#45;&gt;FileStream -->
<g id="edge2" class="edge">
<title>BufferedStream-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M472.21,-62C472.21,-62 618.78,-62 618.78,-62"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="472.21,-58.5 462.21,-62 472.21,-65.5 472.21,-58.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="618.78,-65.5 628.78,-62 618.78,-58.5 618.78,-65.5"></polygon>
<text text-anchor="middle" x="534.12" y="-67.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- Fichero -->
<g id="node4" class="node">
<title>Fichero</title>
<polygon fill="none" stroke="black" points="1093.77,-92 953.77,-92 949.77,-88 949.77,-32 1089.77,-32 1093.77,-36 1093.77,-92"></polygon>
<polyline fill="none" stroke="black" points="1089.77,-88 949.77,-88"></polyline>
<polyline fill="none" stroke="black" points="1089.77,-88 1089.77,-32"></polyline>
<polyline fill="none" stroke="black" points="1089.77,-88 1093.77,-92"></polyline>
<text text-anchor="middle" x="1021.77" y="-56" font-family="Arial" font-size="20.00">Fichero</text>
</g>
<!-- FileStream&#45;&gt;Fichero -->
<g id="edge3" class="edge">
<title>FileStream-&gt;Fichero</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M792.27,-62C792.27,-62 934.85,-62 934.85,-62"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="792.27,-58.5 782.27,-62 792.27,-65.5 792.27,-58.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="934.85,-65.5 944.85,-62 934.85,-58.5 934.85,-65.5"></polygon>
<text text-anchor="middle" x="873.06" y="-67.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
</g>
</svg>
</p><p></p>
<div style="page-break-after:always;"></div>
<div class="box_bg_lightgray">
<p>🎓 <strong>Caso de estudio:</strong></p>
<ol>
<li>Descarga el código del caso de estudio desde <strong><a href="./assets/ejemplos/bufferedstream_ejemplo.cs">este enlace</a></strong> y ejecútalo para ver los tiempos de escritura con y sin <strong><code>BufferedStream</code></strong>.</li>
<li>Prueba a ver que sucede si aumentamos la capacidad de  almacenaje del <strong><code>BufferedStream</code></strong> de <strong>100</strong> a <strong>1000000</strong>.</li>
<li>Prueba a ver que sucede si hacemos un <strong><code>Flush()</code></strong> después  de cada escritura.</li>
</ol>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Stopwatch</span> cronometro <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    cronometro<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileStream</span> fichero <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"prueba.txt"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Voy escribiendo bytes y cuando se llene el buffer del FileStream que yo no controlo</span>
    <span class="token comment">// se realizará un volcado (flush) del mismo en el disco.</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        fichero<span class="token punctuation">.</span><span class="token function">WriteByte</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fichero<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cronometro<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Sin BufferedStream milisegundos = </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">cronometro<span class="token punctuation">.</span>ElapsedMilliseconds</span><span class="token punctuation">}</span></span><span class="token string">ms"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    cronometro<span class="token punctuation">.</span><span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cronometro<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fichero <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"prueba.txt"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Añado un decorador que me añade la posibilidad de gestionar un buffer de forma</span>
    <span class="token comment">// 'transparente' antes del mandar los bytes al FileStream.</span>
    <span class="token comment">// Le añado una capacidad de almacenaje en memoria antes de volcado de 100 bytes</span>
    <span class="token comment">// que es bastante menor que la que tiene el FileStream por defecto. Lo cual </span>
    <span class="token comment">// ralentizará muchísimo la escritura porque se realizarán más volcados o (flush). </span>
    <span class="token comment">// en el disco que es una operación extremádamente costosa.                     </span>
    <span class="token class-name">BufferedStream</span> ficheroBuff <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span>fichero<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        ficheroBuff<span class="token punctuation">.</span><span class="token function">WriteByte</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ficheroBuff<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cronometro<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Sin BufferedStream milisegundos = </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">cronometro<span class="token punctuation">.</span>ElapsedMilliseconds</span><span class="token punctuation">}</span></span><span class="token string">ms"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div> <!-- fin caso de estudio -->
<div style="page-break-after:always;"></div>
<h4 id="transformando-el-flujo-con-un-stream-adapter">Transformando el flujo con un '<em>Stream Adapter</em>' </h4>
<p>Un <strong><a href="https://es.wikipedia.org/wiki/Adaptador_(patr%C3%B3n_de_dise%C3%B1o)">adaptador</a></strong> en POO es un patrón de diseño que básicamente se utiliza para ampliar y/o transformar el interfaz de las operaciones sobre una determinada clase.</p>
<p><strong>¿Por qué usar Stream Adapters?</strong></p>
<p>La forma de acceder a ficheros a nivel de Byte no es muy conveniente, en tanto que generalmente, en las aplicaciones no suele trabajarse directamente con bytes sino con objetos más complejos formados por múltiples bytes y/o cadenas de texto. Por esto, en <strong><code>System.IO</code></strong> se han incluido tipos que encapsulan <strong><code>FileStream</code></strong> a través de una agregación y les proporcionan una serie de métodos mejorados con los que se simplifica la lectura y escritura de datos de cualquier tipo en ficheros.</p>
<p><strong>Ideas principales:</strong></p>
<ul>
<li>Trabajar con <strong>arrays de bytes</strong> (buffers) es poco útil además de engorroso.</li>
<li>Son una capa de abstracción para manejar de forma más cómoda los tipos datos que usamos en nuestros programas.</li>
<li>'<em>Envuelven</em>' otros streams de almacenamiento abiertos como por ejemplo <strong><code>FileStream</code></strong>.</li>
</ul>
<h5 id="stream-adapters-binarywriter-y-binaryreader">Stream Adapters BinaryWriter y BinaryReader </h5>
<p>Básicamente escriben o leen tipos básicos del lenguaje en una secuencia y también escriben o leen cadenas en una <strong>codificación específica</strong>.</p>
<p></p><p align="center" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="550pt" height="130pt" viewBox="0.00 0.00 550.00 130.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.45 0.45) rotate(0) translate(-6.54 282.44)">
<title>G</title>
<polygon fill="white" stroke="none" points="6.54,6.44 6.54,-282.44 1228.76,-282.44 1228.76,6.44 6.54,6.44"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-54 8,-198 182.27,-198 182.27,-54 8,-54"></polygon>
<text text-anchor="middle" x="95.13" y="-167" font-family="Arial" font-size="30.00">Datos</text>
</g>
<g id="clust2" class="cluster">
<title>clusterG</title>
<polygon fill="none" stroke="#104e8b" points="401.95,-8 401.95,-268 934.89,-268 934.89,-8 401.95,-8"></polygon>
<text text-anchor="middle" x="668.42" y="-237" font-family="Arial" font-size="30.00" fill="#104e8b">Clases para el manejo de streams</text>
</g>
<g id="clust3" class="cluster">
<title>cluster1</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="406.95,-13 406.95,-219 590.95,-219 590.95,-13 406.95,-13"></polygon>
<text text-anchor="middle" x="498.95" y="-197" font-family="Arial" font-size="20.00" fill="#104e8b">Stream Adapters</text>
</g>
<g id="clust4" class="cluster">
<title>cluster3</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="709.36,-43 709.36,-173 929.89,-173 929.89,-43 709.36,-43"></polygon>
<text text-anchor="middle" x="819.62" y="-151" font-family="Arial" font-size="20.00" fill="#104e8b">Backing Store Streams</text>
</g>
<g id="clust5" class="cluster">
<title>cluster4</title>
<polygon fill="none" stroke="none" points="1043.3,-42 1043.3,-186 1227.3,-186 1227.3,-42 1043.3,-42"></polygon>
<text text-anchor="middle" x="1135.3" y="-155" font-family="Arial" font-size="30.00">Dispositivos</text>
</g>
<!-- Bytes -->
<g id="node1" class="node">
<title>Bytes</title>
<polygon fill="none" stroke="black" points="168.27,-146 16,-146 16,-62 174.27,-62 174.27,-140 168.27,-146"></polygon>
<polyline fill="none" stroke="black" points="168.27,-146 168.27,-140"></polyline>
<polyline fill="none" stroke="black" points="174.27,-140 168.27,-140"></polyline>
<text text-anchor="middle" x="95.13" y="-110" font-family="Arial" font-size="20.00">Tipos básicos</text>
<text text-anchor="middle" x="95.13" y="-86" font-family="Arial" font-size="20.00">del CLR.</text>
</g>
<!-- BinaryWriter -->
<g id="node2" class="node">
<title>BinaryWriter</title>
<polygon fill="#36648b" stroke="#36648b" points="570.95,-166.8 426.95,-166.8 426.95,-109.2 570.95,-109.2 570.95,-166.8"></polygon>
<text text-anchor="middle" x="498.95" y="-133.2" font-family="Arial" font-size="16.00" fill="white">BinaryWriter</text>
</g>
<!-- Bytes&#45;&gt;BinaryWriter -->
<g id="edge1" class="edge">
<title>Bytes-&gt;BinaryWriter</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M174.56,-110.64C242.93,-116.42 341.91,-124.8 412.33,-130.76"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="411.67,-134.21 421.93,-131.57 412.26,-127.24 411.67,-134.21"></polygon>
<text text-anchor="middle" x="300.61" y="-155.5" font-family="Arial" font-size="19.00" fill="#1874cd">int, char, double,</text>
<text text-anchor="middle" x="300.61" y="-132.7" font-family="Arial" font-size="19.00" fill="#1874cd">bool, string, etc...</text>
</g>
<!-- BinaryReader -->
<g id="node3" class="node">
<title>BinaryReader</title>
<polygon fill="#36648b" stroke="#36648b" points="570.95,-90.8 426.95,-90.8 426.95,-33.2 570.95,-33.2 570.95,-90.8"></polygon>
<text text-anchor="middle" x="498.95" y="-57.2" font-family="Arial" font-size="16.00" fill="white">BinaryReader</text>
</g>
<!-- Bytes&#45;&gt;BinaryReader -->
<g id="edge2" class="edge">
<title>Bytes-&gt;BinaryReader</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M188.92,-93.48C202.13,-92.02 215.54,-90.55 228.27,-89.2 295.53,-82.04 372.29,-74.35 426.66,-68.97"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="188.79,-89.97 179.23,-94.55 189.56,-96.93 188.79,-89.97"></polygon>
<text text-anchor="middle" x="300.61" y="-94.9" font-family="Arial" font-size="19.00" fill="#1874cd">Tipos básicos</text>
</g>
<!-- FileStream -->
<g id="node4" class="node">
<title>FileStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="891.12,-120.8 747.12,-120.8 747.12,-63.2 891.12,-63.2 891.12,-120.8"></polygon>
<text text-anchor="middle" x="819.12" y="-87.2" font-family="Arial" font-size="16.00" fill="white">FileStream</text>
</g>
<!-- BinaryWriter&#45;&gt;FileStream -->
<g id="edge3" class="edge">
<title>BinaryWriter-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M571.35,-127.68C619.06,-120.78 682.08,-111.67 732.49,-104.38"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="732.79,-107.87 742.19,-102.98 731.79,-100.95 732.79,-107.87"></polygon>
<text text-anchor="middle" x="647.65" y="-124.82" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- BinaryReader&#45;&gt;FileStream -->
<g id="edge4" class="edge">
<title>BinaryReader-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M585.55,-70.07C635.95,-74.82 698.96,-80.76 746.68,-85.26"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="586.16,-66.61 575.87,-69.16 585.5,-73.58 586.16,-66.61"></polygon>
<text text-anchor="middle" x="647.65" y="-83.6" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- Fichero -->
<g id="node5" class="node">
<title>Fichero</title>
<polygon fill="none" stroke="black" points="1207.3,-122 1067.3,-122 1063.3,-118 1063.3,-62 1203.3,-62 1207.3,-66 1207.3,-122"></polygon>
<polyline fill="none" stroke="black" points="1203.3,-118 1063.3,-118"></polyline>
<polyline fill="none" stroke="black" points="1203.3,-118 1203.3,-62"></polyline>
<polyline fill="none" stroke="black" points="1203.3,-118 1207.3,-122"></polyline>
<text text-anchor="middle" x="1135.3" y="-86" font-family="Arial" font-size="20.00">Fichero</text>
</g>
<!-- FileStream&#45;&gt;Fichero -->
<g id="edge5" class="edge">
<title>FileStream-&gt;Fichero</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M905.65,-92C950.08,-92 1004.21,-92 1048.65,-92"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="905.96,-88.5 895.96,-92 905.96,-95.5 905.96,-88.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1048.48,-95.5 1058.48,-92 1048.48,-88.5 1048.48,-95.5"></polygon>
<text text-anchor="middle" x="986.6" y="-97.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
</g>
</svg>
</p><p></p>
<p>Sus método de escritura <strong><code>Write</code></strong> y lectura <strong><code>Read&lt;Tipo&gt;</code></strong> '<em>adaptarán</em>' los Write y Read de FileStream permitiendo escribir y leer respectivamente los tipos básicos definidos en el lenguaje, <strong><code>int</code></strong>, <strong><code>short</code></strong>, <strong><code>string</code></strong> etc.</p>
<p>Estos tipos básicos se transformarán en una secuencia de bytes <strong>tal y como los guarda internamente en memoria .NET</strong>. Por tanto, si hacemos un <strong><code>Write</code></strong> de una <strong>cadena</strong> la escribirá en disco guardando la marca de fin de cadena para saber hasta donde tiene que leer en un posterior <strong><code>ReadString</code></strong> del adaptador de lectura.</p>
<div style="page-break-after:always;"></div>
<p><strong>Adaptador <code>BinaryWriter</code></strong></p>
<p>El constructor básico será <strong><code>BinaryWriter(Stream streamAdaptado, Encoding codificacionCadenas)</code></strong></p>
<p>Veamos un <strong>ejemplo básico de uso</strong> escribiendo un tipo <strong><code>int</code></strong> (entero) en la secuencia.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"ejemplo.bin"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Lo pasamos a un objeto adaptador como una agregación, indicándo que las cadenas las codifique cómo UTF-8. </span>
<span class="token comment">// Aunque es posible hacerlo, ya no deberíamos usar el fs porque ahora es responsabilidad del BinaryWriter.</span>
<span class="token class-name">BinaryWriter</span> bw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">BinaryWriter</span><span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> valor <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment">// El Write de bw espera todos los tipos básicos del lenguaje y los adaptará</span>
<span class="token comment">// a la secuencia de bytes correspondiente para pasárselos al fs que adapta.</span>
bw<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>valor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// El Close de BinaryWriter cerrará el stream subyacente al que está adaptando.</span>
bw<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Una  implementación simplificada de lo que haría el <strong><code>Write</code></strong> del <strong><code>BinaryWriter</code></strong> en la <code>línea 11</code> sería la siguiente...</p>
<div class="row">
<div class="col-sm-6 my-auto">
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">BinaryWriter</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name">Stream</span> streamAdaptado<span class="token punctuation">;</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name">Encoding</span> codificacionCadenas<span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Write</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> valor<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Adapto el entero a un array de bits.</span>
        <span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> bytes <span class="token operator">=</span> BitConverter<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>valor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Lo escribo en el flujo que estoy adaptando.</span>
        streamAdaptado<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytes<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<div class="col-sm-6 my-auto">
<p></p><p align="center" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="250pt" height="70pt" viewBox="0.00 0.00 250.00 70.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.55 0.55) rotate(0) translate(10.87 115.94)">
<title>G</title>
<polygon fill="white" stroke="none" points="-10.87,11.34 -10.87,-115.94 443.67,-115.94 443.67,11.34 -10.87,11.34"></polygon>
<!-- bw -->
<g id="node1" class="node">
<title>bw</title>
<ellipse fill="none" stroke="black" cx="23.38" cy="-61.8" rx="23.38" ry="23.38"></ellipse>
<text text-anchor="middle" x="23.38" y="-57.6" font-family="Arial" font-size="14.00">bw</text>
</g>
<!-- obw -->
<g id="node2" class="node">
<title>obw</title>
<polygon fill="none" stroke="black" points="90.76,-61.8 90.76,-100.6 236.44,-100.6 236.44,-61.8 90.76,-61.8"></polygon>
<text text-anchor="start" x="101.76" y="-77" font-family="Arial" font-size="14.00"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BinaryWriter &nbsp;&nbsp;&nbsp;</text>
<polygon fill="none" stroke="black" points="90.76,-23 90.76,-61.8 236.44,-61.8 236.44,-23 90.76,-23"></polygon>
<text text-anchor="start" x="122.71" y="-38.2" font-family="Arial" font-size="14.00">streamAdaptado</text>
</g>
<!-- bw&#45;&gt;obw -->
<g id="edge1" class="edge">
<title>bw-&gt;obw</title>
<path fill="none" stroke="black" d="M47.21,-61.8C54.32,-61.8 62.65,-61.8 71.52,-61.8"></path>
<polygon fill="black" stroke="black" points="71.47,-65.3 81.47,-61.8 71.47,-58.3 71.47,-65.3"></polygon>
</g>
<!-- ofs -->
<g id="node3" class="node">
<title>ofs</title>
<polygon fill="none" stroke="black" points="288.44,-42.8 288.44,-81.6 424.8,-81.6 424.8,-42.8 288.44,-42.8"></polygon>
<text text-anchor="start" x="299.44" y="-58" font-family="Arial" font-size="14.00"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileStream &nbsp;&nbsp;&nbsp;</text>
<polygon fill="none" stroke="black" points="288.44,-4 288.44,-42.8 424.8,-42.8 424.8,-4 288.44,-4"></polygon>
<text text-anchor="start" x="350.79" y="-19.2" font-family="Arial" font-size="14.00">...</text>
</g>
<!-- obw&#45;&gt;ofs -->
<g id="edge2" class="edge">
<title>obw:stream-&gt;ofs</title>
<path fill="none" stroke="black" d="M226.44,-42.4C240.25,-42.4 254.88,-42.42 269.15,-42.46"></path>
<polygon fill="black" stroke="black" points="268.96,-45.96 278.97,-42.48 268.98,-38.96 268.96,-45.96"></polygon>
</g>
</g>
</svg>
</p><p></p>
</div>
</div>
<p>De hecho, si ahora leyésemos la secuencia de bytes en '<em>bruto</em>' de lo que se ha grabado en en fichero con el siguiente código...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"ejemplo.bin"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Reservo espacio para leer los 4 bytes (32 bits) resultado de guardar el entero.</span>
<span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> bytesInt <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-byte">byte</span></span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// Los leo con un FileStream normal.</span>
fs<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>bytesInt<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytesInt<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Algunos Sistemas Operativos guardan los bytes a la inversa en memoria, </span>
<span class="token comment">// por tanto tengo que preguntar si lo están haciendo así para invertirlos. </span>
<span class="token comment">// Si tines curiosidad en saber el porqué puedes leer esta entrada de la </span>
<span class="token comment">// Wikipedia https://es.wikipedia.org/wiki/Endianness aunque no es objetivo de este curso.</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>BitConverter<span class="token punctuation">.</span>IsLittleEndian<span class="token punctuation">)</span>
    Array<span class="token punctuation">.</span><span class="token function">Reverse</span><span class="token punctuation">(</span>bytesInt<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Muestro cada uno de los bytes leídos.</span>
<span class="token comment">// Nos mostrará 0000000A que es el 10 en hexadecimal guardado con 32 bits.</span>
Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"Valor guardado en hexadecimal: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-byte">byte</span></span> _byte <span class="token keyword keyword-in">in</span> bytesInt<span class="token punctuation">)</span> 
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_byte</span><span class="token format-string"><span class="token punctuation">:</span>X2</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Algo similar hará para el resto de tipos básicos y en el caso concreto de las cadenas realizaremos un proceso parecido utilizando la codificación indicada (<strong>Si no la indicamos en el constructor por defecto será UTF-8</strong>). Las codificaciones pueden ser ...</p>
<table>
<thead>
<tr>
<th style="text-align:left">Propiedad</th>
<th style="text-align:left">Formato que representa el objeto devuelto</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>ASCII</strong></td>
<td style="text-align:left">ASCII (7 bits por carácter)</td>
</tr>
<tr>
<td style="text-align:left"><strong>Unicode</strong></td>
<td style="text-align:left">Unicode (16 bits por carácter) usando notación little-endian</td>
</tr>
<tr>
<td style="text-align:left"><strong>BigEndianUnicode</strong></td>
<td style="text-align:left">Unicode (16 bits por carácter) usando notación big-endian</td>
</tr>
<tr>
<td style="text-align:left"><strong>UTF8</strong></td>
<td style="text-align:left">UTF8 (16 bits por carácter en grupos de 8 bits)</td>
</tr>
<tr>
<td style="text-align:left"><strong>UTF7</strong></td>
<td style="text-align:left">UTF7(16 bits por carácter en grupos de 7 bits)</td>
</tr>
<tr>
<td style="text-align:left"><strong>Default</strong></td>
<td style="text-align:left">Juego de caracteres usado por defecto en el sistema.</td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Importante</p>
<p>Es importante tener en cuenta que la codificación a usar al leer los caracteres de un fichero de texto debe ser la misma que la que se usó para escribirlos, pues si no podrían obtenerse resultados extraños.<br>
Además, aunque binary reader permita guardar y leer cadenas. Al guardarse tal y como se almacenan en memoria, su uso no estará indicado para leer y escribir ficheros de texto <strong><code>.txt</code></strong> para ser abiertos posteriormente por un editor como el <strong>notepad</strong>.</p>
</div>
<p><strong>Adaptador <code>BinaryReader</code></strong></p>
<p>El constructor básico será <strong><code>BinaryReader(Stream streamAdaptado, Encoding codificacionCadenas)</code></strong></p>
<p>Realizará el proceso inverso al <strong>BinaryWriter</strong> y tendrémos un método de lectura específico para la adaptar la lectura de cada tipo básico.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"ejemplo.bin"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BinaryReader</span> br <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">BinaryReader</span><span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Leemos un entero de 4 bytes (32 bits) a partir de la posición donde se encuentre</span>
<span class="token comment">// el descriptor del fichero actualmente.</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> valor <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">ReadInt32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"El valor guardado como ulong es: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">valor</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
br<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Si nos fijamos el los <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.binaryreader#methods">métodos de lectura definidos por la clase</a></strong>, todos leerán los tipos definidos en el lenguaje y al leer cualquier tipo, el descriptor del flujo avanzará en el mismo. Sin embargo habrá un caso especial de dos métodos que se complementan y comentaremos a continuación.</p>
<p><strong><code>char ReadChar()</code></strong>: Leerá un caracter del flujo y <strong>avanzará el descriptor</strong>. Si el descriptor se encuentra al final del mismo, se producirá una excepción. Además, el número de bytes que avanza el descriptor, dependerá de la codificación de caracteres indicada. Por ejemplo <strong>1 byte</strong> para <strong>UTF7</strong> y <strong>2 bytes</strong> para <strong>Unicode</strong>.</p>
<p></p><p align="center" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="550pt" height="125pt" viewBox="0.00 0.00 550.00 125.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.7 0.7) rotate(0) translate(122.2 179.69)">
<title>G</title>
<polygon fill="white" stroke="none" points="-122.2,-1.11 -122.2,-179.69 663.51,-179.69 663.51,-1.11 -122.2,-1.11"></polygon>
<text text-anchor="middle" x="270.65" y="-164.2" font-family="Arial" font-size="14.00">Ejemplo descriptor con ReadChar() y codificación UTF7</text>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-8 8,-83.6 504,-83.6 504,-8 8,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<text text-anchor="start" x="48.1" y="-41.6" font-family="Arial" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="67.77,-20 67.77,-71.6 85.77,-71.6 85.77,-20 67.77,-20"></polygon>
<polygon fill="none" stroke="black" points="85.77,-20 85.77,-71.6 134.13,-71.6 134.13,-20 85.77,-20"></polygon>
<text text-anchor="start" x="94.77" y="-50" font-family="Arial" font-size="14.00">0x63</text>
<text text-anchor="start" x="103.78" y="-33.2" font-family="Arial" font-size="14.00">'c'</text>
<polygon fill="none" stroke="black" points="134.13,-20 134.13,-71.6 183.26,-71.6 183.26,-20 134.13,-20"></polygon>
<text text-anchor="start" x="143.13" y="-50" font-family="Arial" font-size="14.00">0x6F</text>
<text text-anchor="start" x="152.13" y="-33.2" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="183.26,-20 183.26,-71.6 233.17,-71.6 233.17,-20 183.26,-20"></polygon>
<text text-anchor="start" x="192.26" y="-50" font-family="Arial" font-size="14.00">0x6E</text>
<text text-anchor="start" x="201.64" y="-33.2" font-family="Arial" font-size="14.00">'n'</text>
<polygon fill="none" stroke="black" points="233.17,-20 233.17,-71.6 251.17,-71.6 251.17,-20 233.17,-20"></polygon>
<text text-anchor="start" x="259.17" y="-41.6" font-family="Arial" font-size="14.00">...</text>
<text text-anchor="start" x="302.83" y="-41.6" font-family="Arial" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="322.5,-20 322.5,-71.6 340.5,-71.6 340.5,-20 322.5,-20"></polygon>
<polygon fill="none" stroke="black" points="340.5,-20 340.5,-71.6 388.86,-71.6 388.86,-20 340.5,-20"></polygon>
<text text-anchor="start" x="349.5" y="-50" font-family="Arial" font-size="14.00">0x63</text>
<text text-anchor="start" x="358.51" y="-33.2" font-family="Arial" font-size="14.00">'c'</text>
<polygon fill="none" stroke="black" points="388.86,-20 388.86,-71.6 437.99,-71.6 437.99,-20 388.86,-20"></polygon>
<text text-anchor="start" x="397.86" y="-50" font-family="Arial" font-size="14.00">0x6F</text>
<text text-anchor="start" x="406.86" y="-33.2" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="437.99,-20 437.99,-71.6 487.9,-71.6 487.9,-20 437.99,-20"></polygon>
<text text-anchor="start" x="446.99" y="-50" font-family="Arial" font-size="14.00">0x6E</text>
<text text-anchor="start" x="456.38" y="-33.2" font-family="Arial" font-size="14.00">'n'</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="106" y="-131" font-family="Arial" font-size="14.00" fill="lightgray">Antes</text>
<text text-anchor="middle" x="106" y="-114.2" font-family="Arial" font-size="14.00" fill="lightgray">ReadChar()</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="lightgray" d="M113.08,-106.04C116.44,-98.21 121,-89.21 126.78,-81.28"></path>
<polygon fill="lightgray" stroke="lightgray" points="129.36,-83.65 133.15,-73.75 124.02,-79.12 129.36,-83.65"></polygon>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="213" y="-139.4" font-family="Arial" font-size="14.00">Después</text>
<text text-anchor="middle" x="213" y="-122.6" font-family="Arial" font-size="14.00">ReadChar()</text>
<text text-anchor="middle" x="213" y="-105.8" font-family="Arial" font-size="14.00">retorna 'o'</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" d="M201.08,-97.85C198.09,-92.22 194.57,-86.39 190.53,-81.04"></path>
<polygon fill="black" stroke="black" points="193.42,-79.03 184.24,-73.75 188.12,-83.61 193.42,-79.03"></polygon>
</g>
<!-- p3 -->
<g id="node4" class="node">
<title>p3</title>
<text text-anchor="middle" x="487" y="-139.4" font-family="Arial" font-size="14.00" fill="red">ReadChar()</text>
<text text-anchor="middle" x="487" y="-122.6" font-family="Arial" font-size="14.00" fill="red">al final del flujo</text>
<text text-anchor="middle" x="487" y="-105.8" font-family="Arial" font-size="14.00" fill="red">ERROR</text>
</g>
<!-- p3&#45;&gt;cluster0_stream -->
<g id="edge3" class="edge">
<title>p3-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="red" d="M494.89,-97.61C495.34,-92.48 495.12,-87.25 493.69,-82.51"></path>
<polygon fill="red" stroke="red" points="496.73,-80.78 488.66,-73.91 490.68,-84.31 496.73,-80.78"></polygon>
</g>
</g>
</svg>
</p><p></p>
<p><strong><code>int PeekChar()</code></strong>: Mirará el siguiente caracter del flujo <strong>sin avanzar el descriptor</strong>. Si el descriptor se encuentra al final de la secuencia, devolverá -<strong>1</strong> (Por esa razón retorna un <strong><code>int</code></strong> en lugar de un <strong><code>char</code></strong> como el otro método).</p>
<p></p><p align="center" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="550pt" height="125pt" viewBox="0.00 0.00 550.00 125.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.7 0.7) rotate(0) translate(122.2 179.69)">
<title>G</title>
<polygon fill="white" stroke="none" points="-122.2,-1.11 -122.2,-179.69 663.51,-179.69 663.51,-1.11 -122.2,-1.11"></polygon>
<text text-anchor="middle" x="270.65" y="-164.2" font-family="Arial" font-size="14.00">Ejemplo descriptor con PeekChar() y codificación UTF7</text>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-8 8,-83.6 504,-83.6 504,-8 8,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<text text-anchor="start" x="48.1" y="-41.6" font-family="Arial" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="67.77,-20 67.77,-71.6 85.77,-71.6 85.77,-20 67.77,-20"></polygon>
<polygon fill="none" stroke="black" points="85.77,-20 85.77,-71.6 134.13,-71.6 134.13,-20 85.77,-20"></polygon>
<text text-anchor="start" x="94.77" y="-50" font-family="Arial" font-size="14.00">0x63</text>
<text text-anchor="start" x="103.78" y="-33.2" font-family="Arial" font-size="14.00">'c'</text>
<polygon fill="none" stroke="black" points="134.13,-20 134.13,-71.6 183.26,-71.6 183.26,-20 134.13,-20"></polygon>
<text text-anchor="start" x="143.13" y="-50" font-family="Arial" font-size="14.00">0x6F</text>
<text text-anchor="start" x="152.13" y="-33.2" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="183.26,-20 183.26,-71.6 233.17,-71.6 233.17,-20 183.26,-20"></polygon>
<text text-anchor="start" x="192.26" y="-50" font-family="Arial" font-size="14.00">0x6E</text>
<text text-anchor="start" x="201.64" y="-33.2" font-family="Arial" font-size="14.00">'n'</text>
<polygon fill="none" stroke="black" points="233.17,-20 233.17,-71.6 251.17,-71.6 251.17,-20 233.17,-20"></polygon>
<text text-anchor="start" x="259.17" y="-41.6" font-family="Arial" font-size="14.00">...</text>
<text text-anchor="start" x="302.83" y="-41.6" font-family="Arial" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="322.5,-20 322.5,-71.6 340.5,-71.6 340.5,-20 322.5,-20"></polygon>
<polygon fill="none" stroke="black" points="340.5,-20 340.5,-71.6 388.86,-71.6 388.86,-20 340.5,-20"></polygon>
<text text-anchor="start" x="349.5" y="-50" font-family="Arial" font-size="14.00">0x63</text>
<text text-anchor="start" x="358.51" y="-33.2" font-family="Arial" font-size="14.00">'c'</text>
<polygon fill="none" stroke="black" points="388.86,-20 388.86,-71.6 437.99,-71.6 437.99,-20 388.86,-20"></polygon>
<text text-anchor="start" x="397.86" y="-50" font-family="Arial" font-size="14.00">0x6F</text>
<text text-anchor="start" x="406.86" y="-33.2" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="437.99,-20 437.99,-71.6 487.9,-71.6 487.9,-20 437.99,-20"></polygon>
<text text-anchor="start" x="446.99" y="-50" font-family="Arial" font-size="14.00">0x6E</text>
<text text-anchor="start" x="456.38" y="-33.2" font-family="Arial" font-size="14.00">'n'</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="73" y="-131" font-family="Arial" font-size="14.00" fill="lightgray">Antes</text>
<text text-anchor="middle" x="73" y="-114.2" font-family="Arial" font-size="14.00" fill="lightgray">PeekChar()</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="lightgray" d="M97.2,-106.07C106.11,-98.55 116.37,-89.61 125.94,-80.55"></path>
<polygon fill="lightgray" stroke="lightgray" points="128.31,-83.13 133.05,-73.65 123.43,-78.11 128.31,-83.13"></polygon>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="196" y="-139.4" font-family="Arial" font-size="14.00">Después</text>
<text text-anchor="middle" x="196" y="-122.6" font-family="Arial" font-size="14.00">PeekChar()</text>
<text text-anchor="middle" x="196" y="-105.8" font-family="Arial" font-size="14.00">retorna 0x6F ('o')</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="black" d="M138.67,-97.7C133.27,-93.03 129.68,-88.06 129.44,-83.01"></path>
<polygon fill="black" stroke="black" points="132.59,-84.53 133.51,-73.98 126.21,-81.66 132.59,-84.53"></polygon>
</g>
<!-- p3 -->
<g id="node4" class="node">
<title>p3</title>
<text text-anchor="middle" x="487" y="-139.4" font-family="Arial" font-size="14.00">PeekChar()</text>
<text text-anchor="middle" x="487" y="-122.6" font-family="Arial" font-size="14.00">al final del flujo</text>
<text text-anchor="middle" x="487" y="-105.8" font-family="Arial" font-size="14.00">retorna -1</text>
</g>
<!-- p3&#45;&gt;cluster0_stream -->
<g id="edge3" class="edge">
<title>p3-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" d="M494.89,-97.61C495.34,-92.48 495.12,-87.25 493.69,-82.51"></path>
<polygon fill="black" stroke="black" points="496.73,-80.78 488.66,-73.91 490.68,-84.31 496.73,-80.78"></polygon>
</g>
</g>
</svg>
</p><p></p>
<p>Por ejemplo, en el siguiente código leemos byte a byte de un <strong>fichero de texto</strong> que se guardó como UTF7 y mostramos la representación en caracter de dicho byte.<br>
<strong>Utilizamos <code>PeekChar()</code> para detectar el final del fichero</strong>. Si fuera un <strong>fichero en binario</strong> esta lectura no tendría mucho sentido pues obtendríamos caracteres no representables por consola.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BinaryReader</span> br <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-while">while</span><span class="token punctuation">(</span>br<span class="token punctuation">.</span><span class="token function">PeekChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>br<span class="token punctuation">.</span><span class="token function">ReadChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           
br<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="box_bg_lightgray">
<p><strong>Ejemplo:</strong> (Puedes descargar el código completo desde <strong><a href="assets/ejemplos/inventario_binary_ejemplo.cs">este enlace</a></strong>)</p>
<p>Aunque es poco común en la programación "<em>moderna</em>" el <strong>uso de ficheros de datos en binario sin transformar</strong>, veamos un ejemplo didáctico donde usaremos <strong><code>BinaryWriter</code></strong> y <strong><code>BinaryReader</code></strong> para crear una pequeña base de datos a modo de inventario de productos con registros de tamaño fijo. Esto es una aproximación muy básica a cómo funcionan los <strong>SGBD</strong> actuales y que su extendida adopción a partir de mediados de los 90 hizo que el manejo de archivos planos de datos en binario cayera en desuso.</p>
<p>Imagina que tienes un archivo de datos donde cada "<strong><code>Producto</code></strong>" ocupa exactamente el mismo espacio (por ejemplo, 76 Bytes). Gracias a <strong><code>Seek</code></strong>, <strong>no necesitas leer todo el archivo para encontrar el producto</strong>; puedes <strong>saltar directamente a su posición física</strong> en el disco instantáneamente a partir de una índice con una fórmula sencilla....</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name"><span class="token keyword keyword-long">long</span></span> posicion <span class="token operator">=</span> indice <span class="token operator">*</span> Producto<span class="token punctuation">.</span>RecordSizeBytes<span class="token punctuation">;</span>
</code></pre><p><strong>Paso 1</strong>: Primero definimos el registro "<strong><code>Producto</code></strong>" como un <strong>record class</strong> con las propiedades que tendrá cada producto en nuestro inventario. Además, definimos una constante <strong><code>RecordSizeBytes</code></strong> que nos indicará el <strong>tamaño en bytes fijo</strong> que ocupará cada registro en el fichero.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-record">record</span> <span class="token class-name"><span class="token keyword keyword-class">class</span></span> <span class="token function">Producto</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> Id<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> Nombre<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-double">double</span></span> Precio<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Tamaño fijo en bytes (4 bytes ID + 64 bytes Nombre + 8 bytes Precio = 76 bytes)</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> RecordSizeBytes <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">64</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-override">override</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token interpolation-string"><span class="token string">$"ID: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Id<span class="token punctuation">,</span><span class="token number">04</span></span><span class="token format-string"><span class="token punctuation">:</span>D</span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Nombre<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">32</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Precio<span class="token punctuation">,</span><span class="token number">8</span></span><span class="token format-string"><span class="token punctuation">:</span>F2</span><span class="token punctuation">}</span></span><span class="token string"> EUR"</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>Paso 2</strong>: Implementamos el método estático <strong><code>EscribirProducto</code></strong> que recibirá un índice y un objeto <strong><code>Producto</code></strong> y lo escribirá en la posición correspondiente del fichero de datos.</p>
<pre data-role="codeBlock" data-info="csharp {highlight=[11, 15]}" class="language-csharp csharp" data-line="11,15"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> FILE_PATH <span class="token operator">=</span> <span class="token string">"inventario.dat"</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">EscribirProducto</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> indice<span class="token punctuation">,</span> <span class="token class-name">Producto</span> producto<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-using">using</span> <span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span>FILE_PATH<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>OpenOrCreate<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-using">using</span> <span class="token class-name">BinaryWriter</span> writer <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// SEEK: Movemos el puntero al lugar exacto del índice</span>
        fs<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span>indice <span class="token operator">*</span> Producto<span class="token punctuation">.</span>RecordSizeBytes<span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>Begin<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Aseguramos que el nombre ocupa exactamente 32 caracteres</span>
        <span class="token comment">// como cada caracter en UTF-8 ocupa 2 bytes, serán 64 bytes en total.</span>
        <span class="token class-name"><span class="token keyword keyword-string">string</span></span> nombreFijo <span class="token operator">=</span> producto<span class="token punctuation">.</span>Nombre<span class="token punctuation">.</span><span class="token function">PadRight</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token range operator">..</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        writer<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>producto<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4 bytes</span>
        writer<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>nombreFijo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 64 bytes</span>
        writer<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>producto<span class="token punctuation">.</span>Precio<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8 bytes</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">









<div aria-hidden="true" class="line-highlight" data-range="11" data-start="11">
</div></div><div class="line-highlight-wrapper">













<div aria-hidden="true" class="line-highlight" data-range="15" data-start="15">
</div></div></pre><p><strong>Paso 3</strong>: Implementamos el método estático <strong><code>LeerProducto</code></strong> que recibirá un índice y devolverá el objeto <strong><code>Producto</code></strong> leído en la posición correspondiente del fichero de datos o <strong><code>null</code></strong> si no existe el fichero o el registro.</p>
<pre data-role="codeBlock" data-info="csharp {highlight=[14, 18]}" class="language-csharp csharp" data-line="14,18"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> FILE_PATH <span class="token operator">=</span> <span class="token string">"inventario.dat"</span><span class="token punctuation">;</span>

    <span class="token comment">// ... código anterior ...</span>

    <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">Producto<span class="token punctuation">?</span></span> <span class="token function">LeerProducto</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> indice<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>File<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>FILE_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-using">using</span> <span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span>FILE_PATH<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-using">using</span> <span class="token class-name">BinaryReader</span> reader <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword keyword-long">long</span></span> posicion <span class="token operator">=</span> indice <span class="token operator">*</span> Producto<span class="token punctuation">.</span>RecordSizeBytes<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>posicion <span class="token operator">&lt;</span> fs<span class="token punctuation">.</span>Length<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// SEEK: Saltamos directamente al registro deseado sin leer los anteriores</span>
            fs<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span>posicion<span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>Begin<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name"><span class="token keyword keyword-int">int</span></span> id <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadInt32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword keyword-string">string</span></span> nombre <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword keyword-double">double</span></span> precio <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">Producto</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> nombre<span class="token punctuation">,</span> precio<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-else">else</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"El registro </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">indice</span><span class="token punctuation">}</span></span><span class="token string"> no existe."</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">












<div aria-hidden="true" class="line-highlight" data-range="14" data-start="14">
</div></div><div class="line-highlight-wrapper">
















<div aria-hidden="true" class="line-highlight" data-range="18" data-start="18">
</div></div></pre><p><strong>Paso 4</strong>: Finalmente, en el método <strong><code>Main</code></strong> escribimos algunos productos en el fichero y luego los leemos para mostrarlos por consola.</p>
<pre data-role="codeBlock" data-info="csharp {highlight=6}" class="language-csharp csharp" data-line="6"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">EscribirProducto</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">Producto</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span> <span class="token string">"Laptop Gaming"</span><span class="token punctuation">,</span> <span class="token number">1200.50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">EscribirProducto</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">Producto</span><span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span> <span class="token string">"Mouse Optico"</span><span class="token punctuation">,</span> <span class="token number">25.99</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Saltamos posiciones a propósito</span>
    <span class="token function">EscribirProducto</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">Producto</span><span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">,</span> <span class="token string">"Monitor 4K"</span><span class="token punctuation">,</span> <span class="token number">450.00</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"--- Datos guardados ---"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword keyword-var">var</span></span> producto1 <span class="token operator">=</span> <span class="token function">LeerProducto</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Leer el monitor</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>producto1 <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"[Registro 5] </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">producto1</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name"><span class="token keyword keyword-var">var</span></span> producto2 <span class="token operator">=</span> <span class="token function">LeerProducto</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Leer el mouse</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>producto2 <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"[Registro 1] </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">producto2</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">




<div aria-hidden="true" class="line-highlight" data-range="6" data-start="6">
</div></div></pre><p>Fíjate que al guardar el producto con índice <strong>5</strong> hemos dejado un hueco entre los registros <strong>1</strong> y <strong>5</strong>. Los primeros SGBD en la década de los 90 usaban un fichero con los índices de los registros <strong>para evitar leer estos huecos</strong> y localizar rápidamente los registros en el fichero de datos.</p>
<p><img src="./assets/imagenes/registros.svg" alt="nombre" style="display:block;margin:0 auto;width:100%;max-width:550px;"></p>
</div> <!-- fin ejemplo -->
<div style="page-break-after:always;"></div>
<h5 id="stream-adapters-streamwriter-y-streamreader">Stream Adapters StreamWriter y StreamReader </h5>
<p></p><p align="center" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 12.2.0 (20241103.1931)
 -->
<!-- Title: G Pages: 1 -->
<svg width="550pt" height="140pt" viewBox="0.00 0.00 550.00 140.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.5 0.5) rotate(0) translate(-11.94 278)">
<title>G</title>
<polygon fill="white" stroke="none" points="11.94,2 11.94,-278 1111.94,-278 1111.94,2 11.94,2"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-54 8,-198 168,-198 168,-54 8,-54"></polygon>
<text text-anchor="middle" x="88" y="-167" font-family="Arial" font-size="30.00">Datos</text>
</g>
<g id="clust2" class="cluster">
<title>clusterG</title>
<polygon fill="none" stroke="#104e8b" points="290.52,-8 290.52,-268 823.46,-268 823.46,-8 290.52,-8"></polygon>
<text text-anchor="middle" x="556.99" y="-237" font-family="Arial" font-size="30.00" fill="#104e8b">Clases para el manejo de streams</text>
</g>
<g id="clust3" class="cluster">
<title>cluster1</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="295.52,-13 295.52,-219 479.52,-219 479.52,-13 295.52,-13"></polygon>
<text text-anchor="middle" x="387.52" y="-197" font-family="Arial" font-size="20.00" fill="#104e8b">Stream Adapters</text>
</g>
<g id="clust4" class="cluster">
<title>cluster3</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="597.93,-43 597.93,-173 818.46,-173 818.46,-43 597.93,-43"></polygon>
<text text-anchor="middle" x="708.2" y="-151" font-family="Arial" font-size="20.00" fill="#104e8b">Backing Store Streams</text>
</g>
<g id="clust5" class="cluster">
<title>cluster4</title>
<polygon fill="none" stroke="none" points="931.88,-42 931.88,-186 1115.88,-186 1115.88,-42 931.88,-42"></polygon>
<text text-anchor="middle" x="1023.88" y="-155" font-family="Arial" font-size="30.00">Dispositivos</text>
</g>
<!-- Bytes -->
<g id="node1" class="node">
<title>Bytes</title>
<polygon fill="none" stroke="black" points="154,-146 16,-146 16,-62 160,-62 160,-140 154,-146"></polygon>
<polyline fill="none" stroke="black" points="154,-146 154,-140"></polyline>
<polyline fill="none" stroke="black" points="160,-140 154,-140"></polyline>
<text text-anchor="middle" x="88" y="-110" font-family="Arial" font-size="20.00">Texto</text>
<text text-anchor="middle" x="88" y="-86" font-family="Arial" font-size="20.00">codificado</text>
</g>
<!-- StreamWriter -->
<g id="node2" class="node">
<title>StreamWriter</title>
<polygon fill="#36648b" stroke="#36648b" points="459.52,-166.8 315.52,-166.8 315.52,-109.2 459.52,-109.2 459.52,-166.8"></polygon>
<text text-anchor="middle" x="387.52" y="-133.2" font-family="Arial" font-size="16.00" fill="white">StreamWriter</text>
</g>
<!-- Bytes&#45;&gt;StreamWriter -->
<g id="edge1" class="edge">
<title>Bytes-&gt;StreamWriter</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M160.26,-112.14C202.44,-116.96 256.15,-123.1 300.66,-128.19"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="300.22,-131.66 310.55,-129.32 301.01,-124.71 300.22,-131.66"></polygon>
<text text-anchor="middle" x="237.76" y="-128.74" font-family="Arial" font-size="19.00" fill="#1874cd">Texto</text>
</g>
<!-- StreamReader -->
<g id="node3" class="node">
<title>StreamReader</title>
<polygon fill="#36648b" stroke="#36648b" points="459.52,-90.8 315.52,-90.8 315.52,-33.2 459.52,-33.2 459.52,-90.8"></polygon>
<text text-anchor="middle" x="387.52" y="-57.2" font-family="Arial" font-size="16.00" fill="white">StreamReader</text>
</g>
<!-- Bytes&#45;&gt;StreamReader -->
<g id="edge2" class="edge">
<title>Bytes-&gt;StreamReader</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M174.66,-91.91C219.13,-85.63 272.85,-78.05 315.06,-72.09"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="174.17,-88.44 164.76,-93.31 175.15,-95.37 174.17,-88.44"></polygon>
<text text-anchor="middle" x="237.76" y="-91.21" font-family="Arial" font-size="19.00" fill="#1874cd">Texto</text>
</g>
<!-- FileStream -->
<g id="node4" class="node">
<title>FileStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="779.7,-120.8 635.7,-120.8 635.7,-63.2 779.7,-63.2 779.7,-120.8"></polygon>
<text text-anchor="middle" x="707.7" y="-87.2" font-family="Arial" font-size="16.00" fill="white">FileStream</text>
</g>
<!-- StreamWriter&#45;&gt;FileStream -->
<g id="edge3" class="edge">
<title>StreamWriter-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M459.92,-127.68C507.64,-120.78 570.65,-111.67 621.06,-104.38"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="621.36,-107.87 630.76,-102.98 620.36,-100.95 621.36,-107.87"></polygon>
<text text-anchor="middle" x="536.22" y="-124.82" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- StreamReader&#45;&gt;FileStream -->
<g id="edge4" class="edge">
<title>StreamReader-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M474.12,-70.07C524.52,-74.82 587.53,-80.76 635.25,-85.26"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="474.73,-66.61 464.44,-69.16 474.07,-73.58 474.73,-66.61"></polygon>
<text text-anchor="middle" x="536.22" y="-83.6" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- Fichero -->
<g id="node5" class="node">
<title>Fichero</title>
<polygon fill="none" stroke="black" points="1095.88,-122 955.88,-122 951.88,-118 951.88,-62 1091.88,-62 1095.88,-66 1095.88,-122"></polygon>
<polyline fill="none" stroke="black" points="1091.88,-118 951.88,-118"></polyline>
<polyline fill="none" stroke="black" points="1091.88,-118 1091.88,-62"></polyline>
<polyline fill="none" stroke="black" points="1091.88,-118 1095.88,-122"></polyline>
<text text-anchor="middle" x="1023.88" y="-86" font-family="Arial" font-size="20.00">Fichero</text>
</g>
<!-- FileStream&#45;&gt;Fichero -->
<g id="edge5" class="edge">
<title>FileStream-&gt;Fichero</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M794.22,-92C838.65,-92 892.78,-92 937.23,-92"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="794.53,-88.5 784.53,-92 794.53,-95.5 794.53,-88.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="937.05,-95.5 947.05,-92 937.05,-88.5 937.05,-95.5"></polygon>
<text text-anchor="middle" x="875.17" y="-97.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
</g>
</svg>
</p><p></p>
<p>Están diseñados para escribir y leer texto como salida en una codificación determinada. Por tanto <strong>están pensados para trabajar solo con archivos de texto</strong> y no archivos con datos en binario.</p>
<p>Tendremos pues <strong>dos adaptadores principales</strong>:</p>
<ol>
<li>
<p><strong><code>StreamWriter</code></strong> utiliza de forma <strong>predeterminada</strong> una instancia de <strong>UTF8</strong> Encoding, a menos que se especifique lo contrario. Además, <strong>se añadirá a la cabecera del archivo</strong> de texto <strong>2 bytes</strong> con la codificación de caracteres utilizada. Estos bytes se denominarán <strong>BOM</strong> (<strong>Byte Order Mark</strong>).</p>
</li>
<li>
<p><strong><code>StreamReader</code></strong> la forma de controlar que se ha llegado al final de fichero. Es cuando una lectura <strong>devuelve null en lugar de un <code>string</code></strong> o a través de la propiedad <strong><code>EndOfStream</code></strong>.</p>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Cuidado</p>
<p>No podemos en ningún caso basarnos en el atributo <strong><code>Position</code></strong> de su <strong><code>FileStream</code></strong> <strong>base</strong> pues su valor no lo controlaremos <strong>Tampoco podremos desplazarnos por el <code>FileStream</code> al que adapta con un <code>Seek</code></strong> 💀.</p>
</div>
<p>Por tanto, una vez adaptemos un <strong><code>FileStream</code></strong> con un <strong><code>StreamWriter</code></strong> o <strong><code>StreamReader</code></strong> <strong>ya no podremos usarlo</strong>, pues deja de estar bajo nuestro control.</p>
<p><strong>Adaptador</strong> <strong><code>StreamWriter</code></strong></p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Unicode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Escribimos dos líneas de texto con la codificación de salto de línea específica</span>
<span class="token comment">// del Sistema Operativo donde estemos ejecutando.</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Línea de texto con salto al final codificada en Unicode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Podemos escribir cualquier caracter Unicode. Fuera de esta codificación ya no </span>
<span class="token comment">// serian bien interpretados los siguiente caracteres.</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"限定桶「冬凪」「高雅」キャンペーン掲載"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// El Close de StreamWriter cerrará el stream subyacente al que está adaptando.</span>
sw<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Cómo una vez adaptado <strong><code>StreamWriter</code></strong> ya no tiene sentido usar el <strong><code>FileStream</code></strong>, nos ofrece un constructor para hacer la adaptación de forma completamente transparente, abriendo el fichero directamente en modo escritura para creación o añadir al final. Por ejemplo, el siguiente código sería equivalente al anterior.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> AÑADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> AÑADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Unicode<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// UTF-16</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Línea de texto con salto al final codificada en Unicode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"限定桶「冬凪」「高雅」キャンペーン掲載"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sw<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Si abrimos el fichero con un editor de texto, lo podremos leer claramente con los saltos de línea correspondiente. Pero si lo <strong>abrimos con un editor hexadecimal</strong> como el plugin de VSCode Hex Editor de Microsoft para ver que secuencia de bytes ha escrito nos encontraremos que cada carácter ocupa <strong>2 bytes</strong> (16 bits).</p>
<p><img src="assets/imagenes/utf16.png" alt="alt text"></p>
<p>Donde <strong><code>FF FE</code></strong> serán los <strong><code>bytes de BOM</code></strong> indicando que los caracteres a continuación están codificados en Unicode (UTF-16), esto es, cada caracter está codificado con 16 bits (2 bytes). Así pues, el caracter <strong><code>'L'</code></strong> se ha adaptado a la secuencia de bytes <strong><code>4C 00</code></strong>.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p><strong><code>FF FE</code></strong> es el BOM por defecto de <strong>UTF-16</strong> en <strong>Little Endian</strong> (UTF-16 LE). Si fuera <strong>UTF-16</strong> en <strong>Big Endian</strong> (UTF-16 BE) sería <strong><code>FE FF</code></strong> y el caracter <strong><code>'L'</code></strong> del ejemplo anterior se codificaría <strong><code>00 4C</code></strong>. Si fuera <strong>UTF8</strong> el BOM sería <strong><code>EF BB BF</code></strong> y aunque parezca que no es necesario porque UTF-8 solo ocupa un byte esto no es así porque algunos símbolos pueden ocupar más de un byte.</p>
<p>Este tema del BOM es más complejo de lo que en este tema se ha intentado resumir y simplificar, por lo que puede ser un poco confuso ya es el resultado de diferentes convenios a lo largo del tiempo. Puedes ahondar más en el tema en los siguientes enlaces:</p>
<ul>
<li><strong><a href="https://es.wikipedia.org/wiki/Marca_de_orden_de_bytes">Marca de orden de bytes en Wikipedia</a></strong>.</li>
<li><strong><a href="https://datatracker.ietf.org/doc/html/rfc3629">RFC-3629 de la IETF</a></strong></li>
</ul>
</div>
<p>Además, si nos fijamos en el correspondiente hexadecimal, los caracteres que que definen el salto de línea en los Sistemas Windows <strong><code>0D 00 0A 00</code></strong>. Donde, <strong><code>0D 00</code></strong> esl <em>Carriage Return</em> (<strong>CR</strong>) y <strong><code>0A 00</code></strong> es el <em>Line Feed</em> (<strong>LF</strong>) codificados en Unicode. (También aparecen al final del fichero porque hemos escrito 2 líneas).</p>
<p>Dependiendo del SO este <strong><a href="https://es.wikipedia.org/wiki/Nueva_l%C3%ADnea">salto de línea</a></strong> o <strong><code>\n</code></strong> se codificará de diferente manera.</p>
<table>
<thead>
<tr>
<th style="text-align:left">SO</th>
<th style="text-align:left">Caracter/es</th>
<th style="text-align:left">Hexadecimal</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Windows</td>
<td style="text-align:left">CR+LF</td>
<td style="text-align:left"><strong><code>0D 0A</code></strong></td>
</tr>
<tr>
<td style="text-align:left">Linux, Unix, Android, iOS, MacOS X</td>
<td style="text-align:left">LF</td>
<td style="text-align:left"><strong><code>0A</code></strong></td>
</tr>
<tr>
<td style="text-align:left">Hasta Mac OS 9 (Ya no se usa)</td>
<td style="text-align:left">CR</td>
<td style="text-align:left"><strong><code>0D</code></strong></td>
</tr>
</tbody>
</table>
<p>Si usamos otra codificación como <strong>UTF-8</strong>, <strong>La mayoría</strong> de los caracteres ocuparían un solo byte, pero <strong>algunos caracteres especiales</strong> ocuparían más de un byte. De esta manera el fichero ocupará menos espacio en disco si es un texto en inglés o español, donde la mayoría de los caracteres ocupan un solo byte y el segundo se rellenaría a ceros como en el ejemplo de antes donde <strong><code>00 4C = L</code></strong> en UTF-16 y <strong><code>4C = L</code></strong> en UTF-8.</p>
<p>Por <strong>ejemplo</strong>, si guardamos en <strong>UTF-8</strong> ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> AÑADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword keyword-using">using</span> <span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> AÑADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// UTF-8</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Línea de texto con salto al final codificada en Unicode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Podremos escribir también caracteres de más de 1 byte "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"con la codificación UTF8 como emoticonos 😃"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><img src="assets/imagenes/utf8.png" alt="alt text"></p>
<p>Ahora tendremos la siguiente secuencia de bytes en el fichero, en la cual ya no tenemos tantos bytes a <strong><code>00</code></strong>.</p>
<p>Fíjate que los bytes de BOM para representar UTF8 ahora son los que se comentaban en la nota anterior <strong><code>EF BB BF</code></strong> y los saltos de línea si has ejecutado en un SO Windows son <strong><code>0D 0A</code></strong>. Sin embargo, el carater que representaba el emoticono 😃 ocupará <strong>4 bytes</strong> en UTF-8 <strong><code>F0 9F 98 83</code></strong> y en la lectura C# sabrá por el BOM que tiene que leer los 4.Para nosotros, todo esto es <strong>'<em>transparente</em>'</strong> si usamos <strong><code>StreamWriter</code></strong>.</p>
<p>Aunque en los ejemplos hemos usado el método <strong><code>WriteLine(string texto)</code></strong> que escribe con un salto de línea al final, también podemos usar <strong><code>Write(string texto)</code></strong> para escribir un texto <strong>sin</strong> salto de línea al final.</p>
<p><strong>Adaptador</strong> <strong><code>StreamReader</code></strong></p>
<p>Hará el proceso inverso al <strong><code>StreamWriter</code></strong> y me ayudará a leer flujos de texto de forma <strong>trasparente</strong> a la la codificación usada para los caracteres y los saltos de línea.</p>
<p>Tendremos varias posibilidades de lectura de caracteres con este adaptador:</p>
<ol>
<li>
<p><strong>De uno en uno</strong>: El método <strong>int Read()</strong> devuelve el próximo carácter del flujo como <strong>entero</strong>, o un –1 si se ha llegado a su final.</p>
<p>Por si sólo quisiésemos consultar el carácter actual pero no pasar al siguiente también se ha incluido un método <strong><code>int Peek()</code></strong>.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// Abrimos la secuencia.</span>
<span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>            
<span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-bool">bool</span></span> AUTODETECTAR_CODIFICACION_BOM <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// Adaptamos la secuencia para leer texto codificado. </span>
<span class="token comment">// Si el fichero contiene BOM lo leerá con la codificación indicada en el mismo.</span>
<span class="token comment">// sino contiene BOM lo leerá con la codificación indicada por nosotros.</span>
<span class="token class-name">StreamReader</span> sr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamReader</span><span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Unicode<span class="token punctuation">,</span> AUTODETECTAR_CODIFICACION_BOM<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Leo carácter a carácter y lo muestro.</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> c<span class="token punctuation">;</span>
<span class="token keyword keyword-while">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> sr<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
sr<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></li>
<li>
<p><strong>Por grupos</strong>: El método <strong>int Read(out char[] caracteres, int inicio, int nCaracteres)</strong> lee un grupo de <strong><code>n</code></strong> caracteres y los almacena a partir de la posición inicio en la tabla que se le indica.<br>
El valor que devuelve es el número de caracteres que se hayan leído, que puede ser inferior a <strong><code>n</code></strong> si el flujo tenía menos caracteres de los indicados o un –1 si se ha llegado al final del flujo. Podemos decir que es un método análogo al <strong><code>Read</code></strong> del <strong><code>FileStream</code></strong>.</p>
</li>
<li>
<p><strong>Por líneas:</strong> El método <strong><code>string ReadLine()</code></strong> devuelve la cadena de texto correspondiente a la <strong>siguiente línea</strong> del flujo o null si se ha llegado a su final. La cadena devuelta no incluirá al final el caracter de salto de línea correspondiente. Puede ser una opción interesante si se trata de un <strong>fichero de texto muy grande o desconocemos su tamaño</strong>.</p>
 <div style="page-break-after:always;"></div>
 <div class="box_bg_lightgray">
<p><strong>Ejemplo:</strong></p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-bool">bool</span></span> AUTODETECTAR_CODIFICACION_BOM <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token class-name">StreamReader</span> sr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Unicode<span class="token punctuation">,</span> AUTODETECTAR_CODIFICACION_BOM<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Leo línea a línea hasta final de fichero y la muestro por consola.</span>
<span class="token keyword keyword-while">while</span><span class="token punctuation">(</span><span class="token operator">!</span>sr<span class="token punctuation">.</span>EndOfStream<span class="token punctuation">)</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>sr<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sr<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </div> <!-- fin ejemplo -->
</li>
<li>
<p><strong>Por completo:</strong> Un método muy útil es <strong><code>string ReadToEnd()</code></strong>, que nos devuelve una cadena con todo el texto que hubiese desde la posición actual del flujo sobre el que se aplica hasta el final del mismo (o null si ya estábamos en su final).</p>
<div class="admonition warning">
<p class="admonition-title">Cuidado</p>
<p>Si el <strong>fichero es muy grande</strong>, podemos obtener un error de <strong>memoria insuficiente</strong>.<br>
En la cadena se incluirán los saltos de línea con la codificación dependiente de la plataforma.</p>
</div>
 <div class="box_bg_lightgray">
<p><strong>Ejemplo:</strong></p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-bool">bool</span></span> AUTODETECTAR_CODIFICACION_BOM <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>           
<span class="token class-name">StreamReader</span> sr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Unicode<span class="token punctuation">,</span> AUTODETECTAR_CODIFICACION_BOM<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Muestro todo el texto pero antes, cambio cualquier posible salto de línea como CRLF o CR por LF.</span>
Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span>sr<span class="token punctuation">.</span><span class="token function">ReadToEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"\r"</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sr<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </div> <!-- fin ejemplo -->
</li>
</ol>
<div style="page-break-after:always;"></div>
<h2 id="manejo-de-excepciones-con-ficheros-y-streams">Manejo de excepciones con ficheros y streams </h2>
<p>Como ya se vió al hablar de la cláusula <strong><code>finally</code></strong> al manejar excepciones. Uno de los casos donde el uso de excepciones se hace casi imprescindible, es la manejo de ficheros. Esto es, porque se pueden producir multitud de errores como:</p>
<ul>
<li>Rutas de acceso (path) no válidas.</li>
<li>Carencia de premisos de acceso.</li>
<li>Estar el acceso bloqueado por otro usuario.</li>
<li>Problemas de disco devueltos por el Sistema Operativo.</li>
<li>etc.</li>
</ul>
<p>Además, si no hacemos un <strong><code>Close()</code></strong> tras una excepción, puede que dejemos el recurso abierto y bloqueado para su acceso por otros usuarios o borrado.</p>
<p>Veamos <strong>a través de un ejemplo</strong> cual es la <strong>mejor forma de abordarlo</strong> en C#. Para ello, imaginemos una función que encapsula una escritura en disco de las que hemos realizado en los puntos anteriores y que va a realizar una gestión de excepciones tradicional de las que vimos en el tema anterior.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Debo declarar el id aquí para que esté accesible desde el bloque finally.</span>
    <span class="token class-name">StreamWriter<span class="token punctuation">?</span></span> sw <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-try">try</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> AÑADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span><span class="token string">@".\\NOEXISTE\\ejemplo.txt"</span><span class="token punctuation">,</span> AÑADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Línea de texto con salto al final codificada en Unicode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Ya no hago el Close() aquí pues se hace en el finally</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// En este ejemplo solo captura las excepciones de entrada y salida y las muestro.</span>
    <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Creando ejemplo.txt </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">e<span class="token punctuation">.</span>Message</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-finally">finally</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// El cierre solo lo hago aquí y solo si logré abrir el Stream</span>
        <span class="token comment">// y he finalizado correctamente el proceso o el error se produjo</span>
        <span class="token comment">// una vez abierto, durante el proceso de escritura.</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>sw <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
            sw<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Como podemos apreciar de la implementación anterior hemos tenido que añadir muchos bloques de control. No obstante, lo normal sería hacer solo el bloque <strong><code>finally</code></strong> y el control de errores en en un módulo superior como.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">StreamWriter<span class="token punctuation">?</span></span> sw <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-try">try</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> AÑADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span><span class="token string">@".\\NOEXISTE\\ejemplo.txt"</span><span class="token punctuation">,</span> AÑADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Línea de texto con salto al final codificada en Unicode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-finally">finally</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>sw <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
            sw<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-try">try</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Aquí podemos llamar a otros módulos que puede generar también IOException</span>
        <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">?</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            e <span class="token operator">=</span> e<span class="token punctuation">.</span>InnerException<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Cómo vemos el <strong><code>finally</code></strong> lo tenemos que hacer en el módulo donde se hace la apertura del fichero y aunque hemos quitado el <strong><code>catch</code></strong> el código sigue siendo algo engorroso. Por esa razón, el lenguaje C# añade una cláusula que nos permitirá hacer el código anterior de forma simplificada.<br>
La cláusula es <strong><code>using</code></strong> y <strong>aunque la explicaremos en más profundidad en temas posteriores</strong>. Lo que hará básicamente, es definir un bloque de uso de un <strong><code>Stream</code></strong> para el cual, si ocurre cualquier excepción <strong>nos asegurará el cierre del mismo</strong>.<br>
El código del anterior de <strong><code>EscribeFichero()</code></strong> se puede reescribir de la siguiente manera y sería equivalente al anterior pero más simplificado y que será la forma de uso más común en los ejemplos de uso de Streams en la documentación oficial de Microsoft o cundo busquemos el uso de Streams en C# por Internet.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> AÑADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-using">using</span> <span class="token punctuation">(</span><span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token string">@".\\NOEXISTE\\ejemplo.txt"</span><span class="token punctuation">,</span> AÑADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// sw estará accesible solo en este bloque y nos asegurará su cierre ante un error.</span>
        sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Línea de texto con salto al final codificada en Unicode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// No tenemos que cerrar el Stream porque ya lo hace el using. (NOS ASEGURA SU CIERRE)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Sin embargo, a partir de C# 8 ha simplificado aún más el <strong><a href="https://docs.microsoft.com/es-es/dotnet/csharp/whats-new/csharp-8#using-declarations">uso de la cláusula <code>using</code></a></strong> de tal manera que ahora podremos hacer un código equivalente los dos anteriores del método <strong><code>EscribeFichero()</code></strong> de la siguiente forma...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> AÑADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-using">using</span> <span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token string">@".\\NOEXISTE\\ejemplo.txt"</span><span class="token punctuation">,</span> AÑADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Línea de texto con salto al final codificada en Unicode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// sw será accesible en todo el método y además nos asegura su cierre </span>
    <span class="token comment">// al salir del ámbito del mismo ya sea porque finaliza correctamente o porque</span>
    <span class="token comment">// se ha producido algún error.</span>
<span class="token punctuation">}</span>
</code></pre><p>Está sintaxis además nos permitirá relanzar la excepción de forma sencilla sin tener que añadir el bloque <strong><code>finally</code></strong> y asegurándonos el cierre cuando relancemos la excepción.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-try">try</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> AÑADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-using">using</span> <span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token string">@".\\NOEXISTE\\ejemplo.txt"</span><span class="token punctuation">,</span> AÑADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Línea de texto con salto al final codificada en Unicode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">IOException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Creando ejemplo.txt"</span></span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div style="page-break-after:always;"></div>
<h2 id="serilización-y-deserialización-a-csv">Serilización y deserialización a CSV </h2>
<p>Los archivos CSV (del inglés <strong><a href="https://es.wikipedia.org/wiki/Valores_separados_por_comas">Comma-Separated Values</a></strong>) son un tipo de documento en formato abierto sencillo para representar datos en forma de tabla, en las que las columnas se separan por comas (o punto y coma en donde la coma es el separador decimal: Chile, Perú, Argentina, España, Brasil...) y las filas por saltos de línea.</p>
<p>El formato CSV es muy sencillo y no indica un juego de caracteres concreto, ni cómo van situados los bytes, ni el formato para el salto de línea. <strong>Estos puntos deben indicarse muchas veces al abrir el archivo, por ejemplo, con una hoja de cálculo</strong>.</p>
<p>El <strong>formato CSV no está estandarizado</strong>. La idea básica de separar los campos con una coma es muy clara, pero se vuelve complicada cuando el valor del campo también contienen comillas dobles o saltos de línea. Las implementaciones de CSV pueden no manejar esos datos, o usar comillas de otra clase para envolver el campo. Pero esto no resuelve el problema: algunos campos también necesitan embeber estas comillas, así que las implementaciones de CSV pueden incluir caracteres o secuencias de escape.</p>
<div class="row">
<div class="col-sm-7">
<p>Además, se suele crear un primer registro de cabeceras que indica el nombre de los campos de cada columna:</p>
</div>
<div class="col-sm-5">
<pre data-role="codeBlock" data-info="txt" class="language-txt txt"><code>idpro,descrip,precio
1,productoA,50.0
2,productoB,90.0
3,productoC,40.0
</code></pre></div>
</div>
<h3 id="separadores-de-campos-alternativos">Separadores de campos alternativos </h3>
<p>Además, el término "CSV" también denota otros formatos de valores separados por delimitadores que usan delimitadores diferentes a la coma (como los valores separados por tabuladores). Un delimitador que no está presente en los valores de los campos (como un tabulador) mantiene el formato simple. Estos archivos separados por delimitadores alternativos reciben en algunas ocasiones la extensión aunque este uso sea incorrecto.</p>
<div class="row">
<div class="col-sm-7">
<p>Esto puede causar problemas en el intercambio de datos, por ello muchas aplicaciones que usan archivos CSV tienen opciones para cambiar el carácter delimitador.<br>
Por ejemplo, un separador muy utilizado es el carácter '<strong><code>|</code></strong>'</p>
</div>
<div class="col-sm-5">
<pre data-role="codeBlock" data-info="txt" class="language-txt txt"><code>idpro|descrip|precio
1|productoA|50.0
2|productoB|90.0
3|productoC|40.0
</code></pre></div>
</div>
<p>Este tipo de archivos puede abrirse y crearse desde hojas de cálculo. Crea un archivo denominado coches.csv con el siguiente contenido y ábrelo con la hoja de cálculo Calc.</p>
<pre data-role="codeBlock" data-info="txt" class="language-txt txt"><code>Año,Marca,Modelo,Descripción,Precio
1997,Ford,E350,"ac, abs, moon",3000.00
1999,Chevy,Venture,Extended Edition,4900.00
1999,Chevy,Venture,"Extended Edition, Very Large",5000.00
1996,Jeep,Grand Cherokee,"MUST SELL! air, moon roof, loaded",4799.00
</code></pre><p>Verás que lo representa en una tabla con las columnas correspondientes.</p>
<table>
<thead>
<tr>
<th>Año</th>
<th>Marca</th>
<th>Modelo</th>
<th>Descripción</th>
<th>Precio</th>
</tr>
</thead>
<tbody>
<tr>
<td>1997</td>
<td>Ford</td>
<td>E350</td>
<td>ac, abs, moon</td>
<td>3000.00</td>
</tr>
<tr>
<td>1999</td>
<td>Chevy</td>
<td>Venture</td>
<td>Extended Edition</td>
<td>4900.00</td>
</tr>
<tr>
<td>1999</td>
<td>Chevy</td>
<td>Venture</td>
<td>Extended Edition, Very Large</td>
<td>5000.00</td>
</tr>
<tr>
<td>1996</td>
<td>Jeep</td>
<td>Grand Cherokee</td>
<td>MUST SELL! air, moon roof, loaded</td>
<td>4799.00</td>
</tr>
</tbody>
</table>
<h3 id="csv-desde-csharp">CSV desde CSharp </h3>
<p>Como sucede en otros lenguajes de programación, en C# no existe una clase específica para gestionar ficheros CSV. No obstante, usando las clases de <strong><code>StreamWriter</code></strong> y <strong><code>StreamReader</code></strong> podemos crear nuestras propias clases para gestionar este tipo de ficheros. Además, en cualquier lenhuage existen librerías de terceros que nos facilitan la gestión de este tipo de ficheros.</p>
<p>Veamos pues, a través de una ejemplo esando <strong><code>StreamWriter</code></strong>, <strong><code>StreamReader</code></strong> y excepciones, cómo podríamos gestionar un fichero CSV con datos de alumnos. Puedes descargar el código completo desde <strong><a href="assets/ejemplos/alumnos_csv_ejemplo.cs">este enlace</a></strong></p>
<div class="row">
<div class="col-sm-7">
<p>Vamos a escribir un programa que gestione datos de <strong>Alumnos</strong> y los almacene en un <strong>fichero CSV</strong> con la siguiente estructura:</p>
</div>
<div class="col-sm-5 my-auto">
<pre data-role="codeBlock" data-info="csv" class="language-csv csv"><code><span class="token value">Nia</span><span class="token punctuation">,</span><span class="token value">Apellidos</span><span class="token punctuation">,</span><span class="token value">Nombre</span>
<span class="token value">1</span><span class="token punctuation">,</span><span class="token value">"Sánchez López"</span><span class="token punctuation">,</span><span class="token value">"María Jesús"</span>
<span class="token value">2</span><span class="token punctuation">,</span><span class="token value">"Pérez Reverte"</span><span class="token punctuation">,</span><span class="token value">"Juan José"</span>
</code></pre></div>
</div>
<p><strong>Veamos pues los pasos necesarios para implementar la gestión de este fichero CSV:</strong></p>
<p><strong>Paso 1</strong>: Definiremos la clase <strong><code>AlumnoEntity</code></strong> cuya <strong>única responsabilidad</strong> será gestionar los datos de la entidad <strong>Alumno</strong>.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">AlumnoEntity</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-long">long</span></span> Nia <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> Apellidos <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> Nombre <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword keyword-public">public</span> <span class="token function">AlumnoEntity</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-long">long</span></span> nia<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> apellidos<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> nombre<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Nia <span class="token operator">=</span> nia<span class="token punctuation">;</span>
        Apellidos <span class="token operator">=</span> apellidos<span class="token punctuation">;</span>
        Nombre <span class="token operator">=</span> nombre<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-override">override</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Nia<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">8</span></span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Apellidos<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">32</span></span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Nombre<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">32</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>Paso 2</strong>: Definiremos la clase estática <strong><code>AlumnoCSV</code></strong> que contendrá los métodos necesarios para gestionar el fichero CSV.</p>
<p>Definimos primero el método privado <strong><code>Lee(StreamReader sr)</code></strong> que leerá un registro del fichero CSV y lo devolverá como objeto de <strong><code>AlumnoEntity</code></strong>. Esta función procesará una línea del fichero CSV, dividiéndola con un <strong><code>Split</code></strong> por el separador definido. Para ello, supone que en los campos de texto que pueden contener el separados. Además, como los campos de texto pueden contener comillas dobles, hacemos un <strong><code>Trim</code></strong> para eliminarlas.</p>
<pre data-role="codeBlock" data-info="csharp { highlight=[9,14] }" class="language-csharp csharp" data-line="9,14"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">AlumnoCSV</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> SEP <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">AlumnoEntity</span> <span class="token function">Lee</span><span class="token punctuation">(</span><span class="token class-name">StreamReader</span> sr<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-string">string</span></span> linea <span class="token operator">=</span> sr<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
        <span class="token operator">??</span> <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">NullReferenceException</span><span class="token punctuation">(</span><span class="token string">"No se ha podido leer Alumno en el CSV"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       
        <span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> campos <span class="token operator">=</span> linea<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>SEP<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>campos<span class="token punctuation">.</span>Length <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FormatException</span><span class="token punctuation">(</span><span class="token string">"El formato del CSV no es válido"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> campos<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            campos<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> campos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token char">'"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">AlumnoEntity</span><span class="token punctuation">(</span>
                          <span class="token named-parameter punctuation">nia</span><span class="token punctuation">:</span> <span class="token keyword keyword-long">long</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>campos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token named-parameter punctuation">apellidos</span><span class="token punctuation">:</span> campos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                          <span class="token named-parameter punctuation">nombre</span><span class="token punctuation">:</span> campos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">







<div aria-hidden="true" class="line-highlight" data-range="9" data-start="9">
</div></div><div class="line-highlight-wrapper">












<div aria-hidden="true" class="line-highlight" data-range="14" data-start="14">
</div></div></pre><p>A continuación, implementamos el método <strong><code>Lee(string ruta)</code></strong> que abrirá el fichero CSV y devolverá una <strong>secuencia perezosa (<code>IEnumerable&lt;AlumnoEntity&gt;</code>)</strong> con todos los registros del mismo como objetos de tipo <strong><code>AlumnoEntity</code></strong>. Para ello, usaremos el método privado anterior. Fíjate además que, al principio, <strong>saltamos la primera línea del fichero que contiene la cabecera con los nombres de las columnas</strong>.</p>
<pre data-role="codeBlock" data-info="csharp { highlight=8 }" class="language-csharp csharp" data-line="8"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">AlumnoCSV</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ... código omitido por brevedad</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>AlumnoEntity<span class="token punctuation">&gt;</span></span> <span class="token function">Lee</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> ruta<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-using">using</span> <span class="token class-name">FileStream</span> stream <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>ruta<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-using">using</span> <span class="token class-name">StreamReader</span> sr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>       
        sr<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Saltamos las columnas de la cabecera</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>sr<span class="token punctuation">.</span>EndOfStream<span class="token punctuation">)</span> <span class="token keyword keyword-yield">yield</span> <span class="token keyword keyword-return">return</span> <span class="token function">Lee</span><span class="token punctuation">(</span>sr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">






<div aria-hidden="true" class="line-highlight" data-range="8" data-start="8">
</div></div></pre><p>Implementamos ahora un método de extensión <strong><code>Guarda(this AlumnoEntity alumno, string ruta)</code></strong> que añadirá un nuevo registro al final del fichero CSV. Fíjate que si estmos añadiendo el primer registro, tendremos que escribir antes la <strong>cabecera con los nombres de las columnas</strong>. Además, usamos el mismo separador definido en la lectura y añadimos las comillas dobles a los campos de texto.</p>
<pre data-role="codeBlock" data-info="csharp { highlight=[10,12] }" class="language-csharp csharp" data-line="10,12"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">AlumnoCSV</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ... código omitido por brevedad</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Guarda</span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span> <span class="token class-name">AlumnoEntity</span> alumno<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> ruta<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-using">using</span> <span class="token class-name">FileStream</span> stream <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>ruta<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Append<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-using">using</span> <span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>stream<span class="token punctuation">.</span>Length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Nia</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">SEP</span><span class="token punctuation">}</span></span><span class="token string">Apellidos</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">SEP</span><span class="token punctuation">}</span></span><span class="token string">Nombre"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">alumno<span class="token punctuation">.</span>Nia</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">SEP</span><span class="token punctuation">}</span></span><span class="token string">\"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">alumno<span class="token punctuation">.</span>Apellidos</span><span class="token punctuation">}</span></span><span class="token string">\"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">SEP</span><span class="token punctuation">}</span></span><span class="token string">\"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">alumno<span class="token punctuation">.</span>Nombre</span><span class="token punctuation">}</span></span><span class="token string">\""</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sw<span class="token punctuation">.</span><span class="token function">Flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><div class="line-highlight-wrapper">








<div aria-hidden="true" class="line-highlight" data-range="10" data-start="10">
</div></div><div class="line-highlight-wrapper">










<div aria-hidden="true" class="line-highlight" data-range="12" data-start="12">
</div></div></pre><p>Por último, implementamos el método <strong><code>Busca(long nia, string ruta)</code></strong> que buscará un alumno por su NIA en el fichero CSV y devolverá el objeto <strong><code>AlumnoEntity</code></strong> correspondiente o <strong><code>null</code></strong> si no lo encuentra. Para ello, usaremos el método privado de lectura de registros.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">AlumnoCSV</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ... código omitido por brevedad</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">AlumnoEntity<span class="token punctuation">?</span></span> <span class="token function">Busca</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-long">long</span></span> nia<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> ruta<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">AlumnoEntity<span class="token punctuation">?</span></span> alumno <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-using">using</span> <span class="token class-name">FileStream</span> stream <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>ruta<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-using">using</span> <span class="token class-name">StreamReader</span> sr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>

        sr<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>sr<span class="token punctuation">.</span>EndOfStream <span class="token operator">&amp;&amp;</span> alumno <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">AlumnoEntity</span> a <span class="token operator">=</span> <span class="token function">Lee</span><span class="token punctuation">(</span>sr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>nia <span class="token operator">==</span> a<span class="token punctuation">.</span>Nia<span class="token punctuation">)</span>
                alumno <span class="token operator">=</span> a<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> alumno<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>Paso 3</strong>: Vamos a implementar el programa principal basándonos en el código anterior.</p>
<p>Esta implementación, ya es más trivial y solo requiere de unos pocos métodos para gestionar el menú, la lectura de opciones y las diferentes funcionalidades.</p>
<p>Primero, implementamos el método <strong><code>Menu()</code></strong> que mostrará las opciones del menú por consola.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">""</span>"
                <span class="token number">1</span> <span class="token operator">-</span> Introduce Alumno<span class="token punctuation">.</span>
                <span class="token number">2</span> <span class="token operator">-</span> Mostrar Alumnos<span class="token punctuation">.</span>
                <span class="token number">3</span> <span class="token operator">-</span> Buscar Alumno<span class="token punctuation">.</span>
                <span class="token number">4</span> <span class="token operator">-</span> Salir<span class="token punctuation">.</span>
                <span class="token string">""</span>"<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>En segundo lugar, implementamos el método <strong><code>Lee()</code></strong> que leerá la opción del menú seleccionada por el usuario y validará que es correcta.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ... código omitido por brevedad</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-int">int</span></span> <span class="token function">Lee</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-bool">bool</span> válida<span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword keyword-int">int</span></span> o <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-do">do</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"Introduce una opción: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            válida <span class="token operator">=</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-out">out</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> valor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>válida<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                válida <span class="token operator">=</span> valor <span class="token operator">&gt;=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> valor <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>válida<span class="token punctuation">)</span>
                o <span class="token operator">=</span> valor<span class="token punctuation">;</span>
            <span class="token keyword keyword-else">else</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Opción incorrecta!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>válida<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Implementamos ahora el método <strong><code>IntroduceAlumno(string fichero)</code></strong> que pedirá los datos del alumno por consola y lo guardará en el fichero CSV usando el método de extensión definido anteriormente.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ... código omitido por brevedad</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">IntroduceAlumno</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> fichero<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"NIA: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword keyword-long">long</span></span> nia <span class="token operator">=</span> <span class="token keyword keyword-long">long</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"Nombre: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword keyword-string">string</span></span> nombre <span class="token operator">=</span> Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">""</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"Apellido: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword keyword-string">string</span></span> apellido <span class="token operator">=</span> Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">""</span><span class="token punctuation">;</span>

        <span class="token class-name">AlumnoEntity</span> alumno <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>nia<span class="token punctuation">,</span> apellido<span class="token punctuation">,</span>  nombre<span class="token punctuation">)</span><span class="token punctuation">;</span>
        alumno<span class="token punctuation">.</span><span class="token function">Guarda</span><span class="token punctuation">(</span>fichero<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Datos guardados."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Implementamos el método <strong><code>BuscaAlumno(string fichero)</code></strong> que pedirá el NIA del alumno a buscar y mostrará sus datos si lo encuentra o un mensaje indicándolo si no existe.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ... código omitido por brevedad</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">BuscaAlumno</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> fichero<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-string">string</span></span> salida<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>fichero<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"NIA a buscar: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword keyword-long">long</span></span> nia <span class="token operator">=</span> <span class="token keyword keyword-long">long</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">AlumnoEntity<span class="token punctuation">?</span></span> a <span class="token operator">=</span> AlumnoCSV<span class="token punctuation">.</span><span class="token function">Busca</span><span class="token punctuation">(</span>nia<span class="token punctuation">,</span> fichero<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>a <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
                salida <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"Los datos del alumno con nia </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">nia</span><span class="token punctuation">}</span></span><span class="token string"> son:\n</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">a</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
            <span class="token keyword keyword-else">else</span>
                salida <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"No existe ningún alumno de nia </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">nia</span><span class="token punctuation">}</span></span><span class="token string">."</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-else">else</span>
            salida <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"El fichero de datos </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">fichero</span><span class="token punctuation">}</span></span><span class="token string"> aún no se ha creado."</span></span><span class="token punctuation">;</span>

        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>salida<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>El programa principal <strong><code>Main()</code></strong> implementa el típico bucle del menú y llama a los métodos anteriores según la opción seleccionada. Además, gestiona las excepciones que puedan producirse durante la ejecución.</p>
<div class="contenedor">
    <div class="fondo">
        <div class="abre_comilla">"</div>
        <div class="cierra_comilla">"</div>
        <div class="cita">Most good programmers do programming not because they expect to get paid or get adulation by the public, but because it is fun to program.</div>
        <div class="autor">- Linus Torvalds.</div>
    </div>
</div>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ... código omitido por brevedad</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> FICHERO <span class="token operator">=</span> <span class="token string">"alumnos.csv"</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword keyword-int">int</span></span> opcionMenu <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-do">do</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword keyword-bool">bool</span></span> fin <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-try">try</span>
            <span class="token punctuation">{</span>
                <span class="token function">Menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                opcionMenu <span class="token operator">=</span> <span class="token function">Lee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>opcionMenu<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword keyword-case">case</span> <span class="token number">1</span><span class="token punctuation">:</span>
                        <span class="token function">IntroduceAlumno</span><span class="token punctuation">(</span>FICHERO<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-case">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
                        <span class="token class-name"><span class="token keyword keyword-string">string</span></span> salida<span class="token punctuation">;</span>
                        salida <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>FICHERO<span class="token punctuation">)</span> 
                                 <span class="token punctuation">?</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> AlumnoCSV<span class="token punctuation">.</span><span class="token function">Lee</span><span class="token punctuation">(</span>FICHERO<span class="token punctuation">)</span><span class="token punctuation">)</span> 
                                 <span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">$"El fichero de datos </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">FICHERO</span><span class="token punctuation">}</span></span><span class="token string"> aún no se ha creado."</span></span><span class="token punctuation">;</span>
                        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>salida<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-case">case</span> <span class="token number">3</span><span class="token punctuation">:</span>
                        <span class="token function">BuscaAlumno</span><span class="token punctuation">(</span>FICHERO<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-case">case</span> <span class="token number">4</span><span class="token punctuation">:</span>
                        fin <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Se ha producido un error: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">e<span class="token punctuation">.</span>Message</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>fin<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"Pulsa una tecla..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>opcionMenu <span class="token operator">!=</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div style="page-break-after:always;"></div>
<h2 id="anexo-i-ejemplo-de-lectura-binaria-opcional">Anexo I: Ejemplo de lectura binaria opcional </h2>
<p>En este anexo vamos a ver un ejemplo de uso de lectura binaria adicional para extraer las etiquetas de información que pueden tener los archivos de audio en formato <strong>mp3</strong> antiguos. <strong>Este ejemplo es complementario al tema y no es obligatorio su estudio. Simplemente es por si te interesa profundizar en el manejo de ficheros binarios</strong>.</p>
<p>Puedes descrargar el código completo del ejemplo y los recursos necesarios para seguirlo en el <strong><a href="assets/ficheros_caso_de_estudio.zip">siguiente enlace</a></strong>.</p>
<p>Imaginemos que tenemos una serie de archivos de audio en formato <strong>mp3</strong> en la carpeta <strong><code>C:\Musica</code></strong>. Si los examinamos con el explorador de archivos de Windows (<strong>Mostrando las columnas adecuadas</strong>). Podemos ver que nos muestra cierta información de Título, Álbum, etc.</p>
<p><img src="./assets/imagenes/mp3_lista_ficheros.png" alt="nombre" style="display:block;margin:0 auto;width:100%;max-width:550px;"></p>
<div class="row">
<div class="col-sm-6 my-auto">
<p>Es más <strong>podemos editar y modificar esta información</strong> a través del propio Windows 10 a través de la pestaña <strong>Detalles</strong>, haciendo click con el botón derecho sobre el fichero y seleccionando la opción del menú contextual <strong>Propiedades</strong>.</p>
<p>Hay varias formas de guardar estas etiquetas de información en un archivo mp3 pero la usada para estos es la más simple y se denomina <strong>TAGID3V1</strong>.</p>
<p><strong>¿Cómo se guarda la información del TAGID3V1?</strong></p>
<p>De estar incluida esta información, será al final del archivo:<br>
Se añaden 128 bytes fijos:</p>
</div>
<div class="col-sm-6 my-auto">
<p><img src="./assets/imagenes/mp3_editar_info.png" alt="nombre" style="display:block;margin:0 auto;width:100%;max-width:300px;"></p>
</div>
</div>
<ul>
<li><strong><code>TagID</code></strong>: 3 caracteres <strong>fijos</strong> 'T', 'A' y 'G'<br>
Estos bytes me indicarán si en esos 128 bytes del final del mp3 realmente hay información del TAGID3V1 o es simple codificación de audio.</li>
<li><strong><code>Título</code></strong>: 30 caracteres</li>
<li><strong><code>Artista</code></strong>: 30 caracteres</li>
<li><strong><code>Álbum</code></strong>: 30 caracteres</li>
<li><strong><code>Año</code></strong>: 4 caracteres</li>
<li><strong><code>Comentario</code></strong>: 30 caracteres</li>
<li><strong><code>Género</code></strong>: 1 byte<br>
Será un índice natural entre 0 y 79 codificado en 1byte de tal manera que:ç...<br>
0 → BLUES, 1 → CLASSIC ROCK, … , 79 →  HARD ROCK y si hubiera un valor superior a 79 se calificaría como OTHERS.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Importante</p>
<p>Si te fijas 3 + 30 + 30 + 30 + 4 + 30 + 1 = <strong>128</strong>.</p>
</div>
<p>Si examinamos el código en binario del final del fichero editado en el diálogo anterior tendremos:</p>
<pre data-role="codeBlock" data-info="txt" class="language-txt txt"><code>...
0040b020: FF FF FF 54 41 47 41 20 4B 69 6E 64 20 4F 66 20    ...TAGA.Kind.Of.
0040b030: 4D 61 67 69 63 20 20 20 20 20 20 20 20 20 20 20    Magic...........
0040b040: 20 20 20 20 51 75 65 65 6E 20 20 20 20 20 20 20    ....Queen.......
0040b050: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20    ................
0040b060: 20 20 44 45 53 43 4F 4E 4F 43 49 44 4F 20 20 20    ..DESCONOCIDO...
0040b070: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20    ................
0040b080: 31 39 36 36 20 20 20 20 20 20 20 20 20 20 20 20    1966............
0040b090: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20    ................
0040b0a0: 20 20 0C
</code></pre><p><strong>Veamos los pasos a seguir para implementar la lectura de esta información en C#:</strong></p>
<p><strong>Paso 1</strong>: Vamos a definir una clase en C# denominada <strong><code>TagId3v1</code></strong>, para leer esta información en los ficheros. En ella en primer lugar <strong>definiremos constantes</strong> para los tamaños reservados para cada dato según la especificación anterior y un array '<strong><code>generosTagID3v1</code></strong>' de solo lectura con los nombres de los géneros conforme a la especificación de TAGID3V1.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-record">record</span> <span class="token class-name"><span class="token keyword keyword-class">class</span></span> TagId3V1
<span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_TAG_ID <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_TITULO <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_ARTISTA <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_ALBUM <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> BYTES_AÑO <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_COMENTARIO <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_GENERO <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> TOTAL_BYTES <span class="token operator">=</span> BYTES_TAG_ID <span class="token operator">+</span> BYTES_TITULO <span class="token operator">+</span> BYTES_ARTISTA <span class="token operator">+</span>
                            BYTES_ALBUM <span class="token operator">+</span> BYTES_AÑO <span class="token operator">+</span> BYTES_COMENTARIO <span class="token operator">+</span> BYTES_GENERO<span class="token punctuation">;</span>
</code></pre><pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-readonly">readonly</span> <span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> generosTagID3v1 <span class="token operator">=</span> 
    <span class="token punctuation">[</span>
        <span class="token string">"BLUES"</span><span class="token punctuation">,</span> <span class="token string">"CLASSIC ROCK"</span><span class="token punctuation">,</span> <span class="token string">"COUNTRY"</span><span class="token punctuation">,</span> <span class="token string">"DANCE"</span><span class="token punctuation">,</span> <span class="token string">"DISCO"</span><span class="token punctuation">,</span> <span class="token string">"FUNK"</span><span class="token punctuation">,</span> <span class="token string">"GRUNGE"</span><span class="token punctuation">,</span> <span class="token string">"HIP-HOP"</span><span class="token punctuation">,</span> <span class="token string">"JAZZ"</span><span class="token punctuation">,</span> 
        <span class="token string">"METAL"</span><span class="token punctuation">,</span> <span class="token string">"NEW AGE"</span><span class="token punctuation">,</span> <span class="token string">"OLDIES"</span><span class="token punctuation">,</span> <span class="token string">"OTHER"</span><span class="token punctuation">,</span> <span class="token string">"POP"</span><span class="token punctuation">,</span> <span class="token string">"R&amp;B"</span><span class="token punctuation">,</span> <span class="token string">"RAP"</span><span class="token punctuation">,</span> <span class="token string">"REGGAE"</span><span class="token punctuation">,</span> <span class="token string">"ROCK"</span><span class="token punctuation">,</span> <span class="token string">"TECHNO"</span><span class="token punctuation">,</span> 
        <span class="token string">"INDUSTRIAL"</span><span class="token punctuation">,</span> <span class="token string">"ALTERNATIVE"</span><span class="token punctuation">,</span> <span class="token string">"SKA"</span><span class="token punctuation">,</span> <span class="token string">"DEATH METAL"</span><span class="token punctuation">,</span> <span class="token string">"PRANKS"</span><span class="token punctuation">,</span> <span class="token string">"SOUNDTRACK"</span><span class="token punctuation">,</span>
        <span class="token string">"EURO-TECHNO"</span><span class="token punctuation">,</span> <span class="token string">"AMBIENT"</span><span class="token punctuation">,</span> <span class="token string">"TRIP-HOP"</span><span class="token punctuation">,</span> <span class="token string">"VOCAL"</span><span class="token punctuation">,</span> <span class="token string">"JAZZ+FUNK"</span><span class="token punctuation">,</span> <span class="token string">"FUSION"</span><span class="token punctuation">,</span> <span class="token string">"TRANCE"</span><span class="token punctuation">,</span> 
        <span class="token string">"CLASSICAL"</span><span class="token punctuation">,</span> <span class="token string">"INSTRUMENTAL"</span><span class="token punctuation">,</span> <span class="token string">"ACID"</span><span class="token punctuation">,</span> <span class="token string">"HOUSE"</span><span class="token punctuation">,</span> <span class="token string">"GAME"</span><span class="token punctuation">,</span> <span class="token string">"SOUND CLIP"</span><span class="token punctuation">,</span> <span class="token string">"GOSPEL"</span><span class="token punctuation">,</span> <span class="token string">"NOISE"</span><span class="token punctuation">,</span> 
        <span class="token string">"ALTERN ROCK"</span><span class="token punctuation">,</span> <span class="token string">"BASS"</span><span class="token punctuation">,</span> <span class="token string">"SOUL"</span><span class="token punctuation">,</span> <span class="token string">"PUNK"</span><span class="token punctuation">,</span> <span class="token string">"SPACE"</span><span class="token punctuation">,</span> <span class="token string">"MEDITATIVE"</span><span class="token punctuation">,</span> <span class="token string">"INSTRUMENTAL POP"</span><span class="token punctuation">,</span> 
        <span class="token string">"INSTRUMENTAL ROCK"</span><span class="token punctuation">,</span> <span class="token string">"ETHNIC"</span><span class="token punctuation">,</span> <span class="token string">"GOTHIC"</span><span class="token punctuation">,</span> <span class="token string">"DARKWAVE"</span><span class="token punctuation">,</span> <span class="token string">"TECHNO-INDUSTRIAL"</span><span class="token punctuation">,</span> <span class="token string">"ELECTRONIC"</span><span class="token punctuation">,</span>
        <span class="token string">"POP-FOLK"</span><span class="token punctuation">,</span> <span class="token string">"EURODANCE"</span><span class="token punctuation">,</span> <span class="token string">"DREAM"</span><span class="token punctuation">,</span> <span class="token string">"SOUTHERN ROCK"</span><span class="token punctuation">,</span> <span class="token string">"COMEDY"</span><span class="token punctuation">,</span> <span class="token string">"CULT"</span><span class="token punctuation">,</span> <span class="token string">"GANGSTA"</span><span class="token punctuation">,</span> <span class="token string">"TOP 40"</span><span class="token punctuation">,</span> 
        <span class="token string">"CHRISTIAN POP"</span><span class="token punctuation">,</span> <span class="token string">"POP/FUNK"</span><span class="token punctuation">,</span> <span class="token string">"JUNGLE"</span><span class="token punctuation">,</span> <span class="token string">"NATIVE AMERICAN"</span><span class="token punctuation">,</span> <span class="token string">"CABARET"</span><span class="token punctuation">,</span> <span class="token string">"NEW WAVE"</span><span class="token punctuation">,</span> 
        <span class="token string">"PSYCHADELIC"</span><span class="token punctuation">,</span> <span class="token string">"RAVE"</span><span class="token punctuation">,</span> <span class="token string">"SHOWTUNES"</span><span class="token punctuation">,</span> <span class="token string">"TRAILER"</span><span class="token punctuation">,</span> <span class="token string">"LO-FI"</span><span class="token punctuation">,</span> <span class="token string">"TRIBAL"</span><span class="token punctuation">,</span> <span class="token string">"ACID PUNK"</span><span class="token punctuation">,</span> <span class="token string">"ACID JAZZ"</span><span class="token punctuation">,</span> 
        <span class="token string">"POLKA"</span><span class="token punctuation">,</span> <span class="token string">"RETRO"</span><span class="token punctuation">,</span> <span class="token string">"MUSICAL"</span><span class="token punctuation">,</span> <span class="token string">"ROCK &amp; ROLL"</span><span class="token punctuation">,</span> <span class="token string">"HARD ROCK"</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>Paso 2</strong>: A continuacíon vamos a añadir a la clase <strong><code>TagId3v1</code></strong> las <strong>propiedades públicas</strong> para acceder a los campos del TAGID3V1. Puesto</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-record">record</span> <span class="token class-name"><span class="token keyword keyword-class">class</span></span> TagId3V1
<span class="token punctuation">{</span>
    <span class="token comment">// ... código omitido por abreviar</span>

    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> Titulo <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> Artista <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> Album <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-ushort">ushort</span> Año <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-byte">byte</span></span> Genero <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> Comentario <span class="token punctuation">{</span> <span class="token keyword keyword-get">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> EtiquetaGenero <span class="token operator">=&gt;</span> Genero <span class="token operator">&gt;=</span> <span class="token number">80</span> <span class="token punctuation">?</span> <span class="token string">"OTHER"</span> <span class="token punctuation">:</span> generosTagID3v1<span class="token punctuation">[</span>Genero<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>Paso 3</strong>: <strong>Constructor privado</strong> que reciba todos los campos (excepto, claro está, el array de géneros). El hecho de que sea privado es porque no quiero que nadie pueda crear instáncias de la clase directamente. Más adelante implementaremos un método factoría estático que se encargue de leer el TAGID3V1 de un fichero y crear la instáncia correspondiente.</p>
<p>Además, vamos a invalidar el método <strong><code>ToString</code></strong> para que muestre los datos del objeto.</p>
<div class="row">
<div class="col-sm-6 my-auto">
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-record">record</span> <span class="token class-name"><span class="token keyword keyword-class">class</span></span> TagId3V1
<span class="token punctuation">{</span>
   <span class="token comment">// ... código omitido por abreviar</span>
   <span class="token keyword keyword-private">private</span> <span class="token function">TagId3V1</span><span class="token punctuation">(</span>
               <span class="token class-name"><span class="token keyword keyword-string">string</span></span> titulo<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> artista<span class="token punctuation">,</span> 
               <span class="token class-name"><span class="token keyword keyword-string">string</span></span> album<span class="token punctuation">,</span> <span class="token keyword keyword-ushort">ushort</span> año<span class="token punctuation">,</span> 
               <span class="token class-name"><span class="token keyword keyword-byte">byte</span></span> genero<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> comentario<span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
       Titulo <span class="token operator">=</span> titulo<span class="token punctuation">;</span>
       Artista <span class="token operator">=</span> artista<span class="token punctuation">;</span>
       Album <span class="token operator">=</span> album<span class="token punctuation">;</span>
       Año <span class="token operator">=</span> año<span class="token punctuation">;</span>
       Genero <span class="token operator">=</span> genero<span class="token punctuation">;</span>
       Comentario <span class="token operator">=</span> comentario<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
</code></pre></div>
<div class="col-sm-6">
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-override">override</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token interpolation-string"><span class="token string">$""</span></span>"
                <span class="token punctuation">{</span><span class="token string">"Titulo:"</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>Titulo<span class="token punctuation">}</span>
                <span class="token punctuation">{</span><span class="token string">"Artista:"</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>Artista<span class="token punctuation">}</span>
                <span class="token punctuation">{</span><span class="token string">"Album:"</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>Album<span class="token punctuation">}</span>
                <span class="token punctuation">{</span><span class="token string">"Año:"</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>Año<span class="token punctuation">}</span>
                <span class="token punctuation">{</span><span class="token string">"Genero:"</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>EtiquetaGenero<span class="token punctuation">}</span>
                <span class="token punctuation">{</span><span class="token string">"Comentario:"</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">}</span> <span class="token punctuation">{</span>Comentario<span class="token punctuation">}</span>
                <span class="token string">""</span>"<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
</div>
<p><strong>Paso 4</strong>: Sería interesante implementar un método de clase público <strong><code>HayTAG</code></strong> que <strong>reciba un fichero</strong> y me devuelva un boolenao indicándome si el fichero contiene un TAGIDID3 válido. Una posible implementación sería...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-record">record</span> <span class="token class-name"><span class="token keyword keyword-class">class</span></span> TagId3V1
<span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-bool">bool</span></span> <span class="token function">HayTAG</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> rutaFichero<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-using">using</span> <span class="token class-name">FileStream</span> stream <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>rutaFichero<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">,</span> FileShare<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-using">using</span> <span class="token class-name">BinaryReader</span> streamRB <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword keyword-bool">bool</span></span> hayTAG <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token comment">// Habrá TAG si como mínimo el fichero mide más de los 128 bytes que ocupa el mismo.</span>
        hayTAG <span class="token operator">=</span> stream<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> TOTAL_BYTES<span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>hayTAG<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Se que ocupa esos bytes y me desplazo donde en teoría está el principio del TAG</span>
            stream<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token operator">-</span>TOTAL_BYTES<span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>End<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Leo los 3 caracteres del TAG y los transformo a cadena.</span>
            <span class="token class-name"><span class="token keyword keyword-string">string</span></span> tag <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>streamRB<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_TAG_ID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            hayTAG <span class="token operator">=</span> tag <span class="token operator">==</span> <span class="token string">"TAG"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> hayTAG<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>Paso 5</strong>: Vamos a crear un método de método de clase <strong><code>LeeTAG</code></strong> y que reciba la <strong>ubicación de una fichero fichero mp3</strong> y que genere una excepción <strong><code>TagId3v1Exception</code></strong> si no hay tag y si lo hay, lo lea devolviendo una instancia de la clase <strong><code>TagId3v1</code></strong> con los datos del mismo.<br>
Si durante la lectura se genera una excepción. Esta se relanzará '<em>envuelta</em>' en un <strong><code>TagId3v1Exception</code></strong> que indique de que fichero se estaba intentando leer el TAG.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token comment">// Definiremos la clase con la excepción personalizada fuera de la clase TagId3v1</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">TagId3v1Exception</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Exception</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token function">TagId3v1Exception</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> message<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword keyword-base">base</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token function">TagId3v1Exception</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> message<span class="token punctuation">,</span> <span class="token class-name">Exception</span> innerException<span class="token punctuation">)</span> 
    <span class="token punctuation">:</span> <span class="token keyword keyword-base">base</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> innerException<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-record">record</span> <span class="token class-name"><span class="token keyword keyword-class">class</span></span> TagId3V1
<span class="token punctuation">{</span>
    <span class="token comment">// ... código omitido por abreviar</span>

    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">TagId3V1</span> <span class="token function">LeeTAG</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> rutaFichero<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-string">string</span></span> error <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"El fichero </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">rutaFichero</span><span class="token punctuation">}</span></span><span class="token string"> no tiene información válida de TagId3v1"</span></span><span class="token punctuation">;</span>
        <span class="token comment">// Si llamo a este método es porque estoy seguro de que hay 'tag' para leer</span>
        <span class="token comment">// en caso contrario generaré una excepción.</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">HayTAG</span><span class="token punctuation">(</span>rutaFichero<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">TagId3v1Exception</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-using">using</span> <span class="token class-name">FileStream</span> stream <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>rutaFichero<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-using">using</span> <span class="token class-name">BinaryReader</span> streamBR <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-try">try</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Me sitúo al principio del título justo después de los bytes ['T']['A']['G']</span>
            stream<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span>BYTES_TAG_ID <span class="token operator">-</span> TOTAL_BYTES<span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>End<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Como pude haber espácios hasta rellenar lo que ocupa cada valor </span>
            <span class="token comment">// los recorto con el método Trim</span>
            <span class="token class-name"><span class="token keyword keyword-string">string</span></span> titulo <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span></span><span class="token punctuation">(</span>streamBR<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_TITULO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword keyword-string">string</span></span> artista <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span></span><span class="token punctuation">(</span>streamBR<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_ARTISTA<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword keyword-string">string</span></span> album <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span></span><span class="token punctuation">(</span>streamBR<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_ALBUM<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-ushort">ushort</span> año <span class="token operator">=</span> <span class="token keyword keyword-ushort">ushort</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span></span><span class="token punctuation">(</span>streamBR<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_AÑO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword keyword-string">string</span></span> comentario <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span></span><span class="token punctuation">(</span>streamBR<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_COMENTARIO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword keyword-byte">byte</span></span> genero <span class="token operator">=</span> streamBR<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">TagId3V1</span><span class="token punctuation">(</span>titulo<span class="token punctuation">,</span> artista<span class="token punctuation">,</span> album<span class="token punctuation">,</span> año<span class="token punctuation">,</span> genero<span class="token punctuation">,</span> comentario<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">TagId3v1Exception</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div style="page-break-after:always;"></div>
<p><strong>Paso 6</strong>: Vamos ahora a realizar un pequeño programa principal, usando métodos de la clase TagId3v ...</p>
<p>Leeremos todos archivos mp3 que encuentre en el directorio <strong><code>C:\Musica</code></strong> y mostrará la información del TAGID3V1 si la tuviera y "<em>No contiene información</em>" en caso contrario.</p>
<p>Además, controlaremos cualquier <strong><code>TagId3v1Exception</code></strong> que se produzca al leer un fichero, nos recuperaremos y continuaremos intentado leer el siguiente.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> ficheros <span class="token operator">=</span> Directory<span class="token punctuation">.</span><span class="token function">GetFiles</span><span class="token punctuation">(</span><span class="token string">@"C:\Musica"</span><span class="token punctuation">,</span> <span class="token string">"*.mp3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-var">var</span></span> fichero <span class="token keyword keyword-in">in</span> ficheros<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-try">try</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Información del fichero </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">fichero</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword keyword-string">string</span></span> informacion <span class="token operator">=</span> <span class="token punctuation">(</span>TagId3V1<span class="token punctuation">.</span><span class="token function">HayTAG</span><span class="token punctuation">(</span>fichero<span class="token punctuation">)</span> 
                                    <span class="token punctuation">?</span> TagId3V1<span class="token punctuation">.</span><span class="token function">LeeTAG</span><span class="token punctuation">(</span>fichero<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                                    <span class="token punctuation">:</span> <span class="token string">"\tNo contiene información."</span>
                                        <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>informacion<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">TagId3v1Exception</span> e<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
      
      
    
    
    
    
    
    
  
    </body></html>