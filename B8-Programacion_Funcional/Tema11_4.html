<!DOCTYPE html><html><head>
      <title>Introducci&#xF3;n a la Programaci&#xF3;n Funcional</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
.markdown-preview.markdown-preview {
  background-color: #FFFF;
}

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <style>/* 
Añade 

@import "../EstilosPersonalizadosMarkdownEnhanced.less"

justo después del front matter 
*/
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v18/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
.contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.fondo {
  background: url(https://programacioniesbalmis.github.io/Imagenes/BannersMoodle/banner.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}
</style>
<h1 class="mume-header undefined" id="tema-114">Tema 11.4</h1>

<p>Descargar estos apuntes en <a href="./Tema11_4.pdf">pdf</a> o <a href="./Tema11_4.html">html</a></p>
<h2 class="mume-header undefined" id="%C3%ADndice">&#xCD;ndice</h2>

<ol>
<li><a href="#introducci%C3%B3n-a-la-programaci%C3%B3n-funcional">Introducci&#xF3;n a la Programaci&#xF3;n Funcional</a>
<ol>
<li><a href="#c%C3%A1lculo-lambda">C&#xE1;lculo Lambda</a>
<ol>
<li><a href="#definici%C3%B3n-de-expresi%C3%B3n-lambda">Definici&#xF3;n de Expresi&#xF3;n Lambda</a></li>
<li><a href="#expresiones-lambda-en-c">Expresiones Lambda en C#</a></li>
</ol>
</li>
<li><a href="#clausuras-en-csharp">Clausuras en CSharp</a>
<ol>
<li><a href="#variables-externas-capturadas">Variables Externas Capturadas</a></li>
</ol>
</li>
<li><a href="#patr%C3%B3n-map-filter-fold">Patr&#xF3;n Map-Filter-Fold</a>
<ol>
<li><a href="#map-o-select">Map (o Select)</a></li>
<li><a href="#filter-o-where">Filter (o Where)</a></li>
<li><a href="#fold-o-aggregate">Fold (o Aggregate)</a></li>
<li><a href="#combinando-las-tres-operaciones">Combinando las tres operaciones</a></li>
</ol>
</li>
<li><a href="#otras-operaciones-funcionales-declarativas-en-c">Otras operaciones funcionales declarativas en C#</a>
<ol>
<li><a href="#orderbyorderbydescending">OrderBy/OrderByDescending</a></li>
<li><a href="#distinct">Distinct</a></li>
<li><a href="#groupby">GroupBy</a>
<ol>
<li><a href="#resultado-del-grupby-en-un-nuevo-tipo-de-datos">Resultado del GrupBy en un nuevo tipo de datos</a></li>
<li><a href="#resultado-del-grupby-en-un-diccionario">Resultado del GrupBy en un diccionario</a></li>
</ol>
</li>
<li><a href="#zip">Zip</a></li>
<li><a href="#flatmap-o-aplanado">FlatMap o Aplanado</a></li>
</ol>
</li>
</ol>
</li>
</ol>
<div style="page-break-after:always;"></div>
<h2 class="mume-header" id="introducci%C3%B3n-a-la-programaci%C3%B3n-funcional">Introducci&#xF3;n a la Programaci&#xF3;n Funcional</h2>

<p>La <strong>programaci&#xF3;n funcional</strong> es un <strong>paradigma de programaci&#xF3;n declarativa</strong> basado en el uso de <strong>funciones matem&#xE1;ticas</strong>, en contraste con la programaci&#xF3;n <strong>imperativa</strong>, que enfatiza los cambios de estado mediante la mutaci&#xF3;n de variables.</p>
<p>Existen lenguaje de programaci&#xF3;n funcionales puros como por ejemplo <strong><a href="https://es.wikipedia.org/wiki/Haskell">Haskell</a></strong> y <strong><a href="https://es.wikipedia.org/wiki/Clojure">Clojure</a></strong>. Sin embargo, el paradigma funcional ha ido cogiendo cada vez m&#xE1;s peso en la programaci&#xF3;n moderna. Tanto es as&#xED;, que lenguajes imperativos y orientados a objetos tradicionales como <strong>C++</strong>, <strong>Java</strong>, <strong>C#</strong> o <strong>PHP</strong> han incluido caracter&#xED;sticas de la programaci&#xF3;n funcional en su sint&#xE1;xis o potenciando las que ya ten&#xED;an lenguajes como <strong>JavaScript</strong>, <strong>Python</strong>. Adem&#xE1;s, los lenguajes multi-paradigma de nueva creaci&#xF3;n como <strong>Scala</strong>, <strong>Go</strong>, <strong>F#</strong> o <strong>Kotlin</strong> (este &#xFA;ltimo en menor medida) se han dise&#xF1;ado para que tenga m&#xE1;s peso la programaci&#xF3;n funcional que la orientada a objetos e imperativa.</p>
<p>Simplificando y a grandes rasgos podemos decir que <strong>se basa en los siguientes pilares</strong> matem&#xE1;ticos:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Lambda_calculus">C&#xE1;lculo Lambda</a>.</li>
<li><a href="https://en.wikipedia.org/wiki/Closure_(computer_programming)">Clausuras</a>.</li>
<li><a href="https://en.wikipedia.org/wiki/Category_theory">Teor&#xED;a de categor&#xED;as</a> y m&#xE1;s en concreto el concepto de <a href="https://en.wikipedia.org/wiki/Functor">functor</a> y su aplicaci&#xF3;n a las ciencias de la computaci&#xF3;n a trav&#xE9;s de:
<ul>
<li><a href="https://en.wikipedia.org/wiki/Monad_(category_theory)">M&#xF3;nadas</a>.</li>
<li><a href="https://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science)">Covarianza y Contravarianza.</a></li>
</ul>
</li>
<li><a href="https://en.wikipedia.org/wiki/Recursion">Recursi&#xF3;n o Recursividad</a> (Formar&#xED;a parte del C&#xE1;lculo Lambda).</li>
</ul>
<p>C&#xF3;mo se puede observar, su bases son bastante &#xE1;mplias y llevar&#xED;a bastante ahondar todos estos conceptos. Por esta raz&#xF3;n, este tema pretende ser m&#xE9;ramente introductor&#xED;o y por tanto en &#xE9;l solo vamos a abordar algunos conceptos a trav&#xE9;s del lenguaje C#. Estos conceptos ser&#xE1;n extrapolables a otros lenguajes ya que como hemos comentados todos utilizan, en mayor o medida, dicho paradigma.</p>
<h3 class="mume-header" id="c%C3%A1lculo-lambda">C&#xE1;lculo Lambda</h3>

<p>Es uno de los pilares de la programaci&#xF3;n funcional. Est&#xE9; fue formulado por el matem&#xE1;tico-l&#xF3;gico norteamericano <strong>Alonzo Church</strong> y consiste en &apos;<em>...un sistema formal dise&#xF1;ado para investigar la definici&#xF3;n de funci&#xF3;n, la noci&#xF3;n de aplicaci&#xF3;n de funciones y la recursi&#xF3;n...</em>&apos;.</p>
<p>Se basa en una definici&#xF3;n de funci&#xF3;n alternativa a la tradicional que dentro del contexto de las ciencias de computaci&#xF3;n denominaremos: <strong>&apos;<em>Expresi&#xF3;n Lambda</em>&apos;</strong>.</p>
<h4 class="mume-header" id="definici%C3%B3n-de-expresi%C3%B3n-lambda">Definici&#xF3;n de Expresi&#xF3;n Lambda</h4>

<p>Para entender lo que es, vamos ver el concepto de funci&#xF3;n dependiendo de &#xE1;mbito de conocimiento...</p>
<ol>
<li>
<p>En <strong>matem&#xE1;tica tradicional</strong> las funciones se representan con un nombre <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span> o <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span></p>
<table>
<thead>
<tr>
<th>Definici&#xF3;n</th>
<th>Explicaci&#xF3;n</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>x</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">f(x)=x+2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></td>
<td>Un par&#xE1;metro.</td>
</tr>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>o</mi><mi>w</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>x</mi><mi>y</mi></msup></mrow><annotation encoding="application/x-tex">pow(x, y)=x^y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span></span></span></span></span></span></span></td>
<td>Dos par&#xE1;metros.</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>En la <strong>teor&#xED;a matem&#xE1;tica del c&#xE1;lculo lambda</strong> (<em>&#x3BB;-calculus</em>) esta misma funci&#xF3;n <strong>se expresar&#xED;a sin nombre</strong>, solo los par&#xE1;metros que entran y la expresi&#xF3;n que la representa.</p>
<table>
<thead>
<tr>
<th>Definici&#xF3;n</th>
<th>Explicaci&#xF3;n</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>&#x3BB;</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>x</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">&#x3BB;x.x+2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">&#x3BB;</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></td>
<td>Un par&#xE1;metro (definici&#xF3;n) y equivale a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>x</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">f(x)=x+2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>.</td>
</tr>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>&#x3BB;</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>x</mi><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mn>10</mn><mo>=</mo><mn>12</mn></mrow><annotation encoding="application/x-tex">(&#x3BB;x.x+2)10=12</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">&#x3BB;</span><span class="mord mathnormal">x</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mord">10</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">12</span></span></span></span></td>
<td>Un par&#xE1;metro (aplicaci&#xF3;n de una valor) y equivale a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mn>10</mn><mo stretchy="false">)</mo><mo>=</mo><mn>10</mn><mo>+</mo><mn>2</mn><mo>=</mo><mn>12</mn></mrow><annotation encoding="application/x-tex">f(10)=10+2=12</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord">10</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">12</span></span></span></span>.</td>
</tr>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>&#x3BB;</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><msup><mi>x</mi><mi>y</mi></msup></mrow><annotation encoding="application/x-tex">&#x3BB;(x,y).x^y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">&#x3BB;</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mord">.</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span></span></span></span></span></span></span></td>
<td>Dos par&#xE1;metros.</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>&#x270B; En <strong>ciencias de computaci&#xF3;n</strong> se expresar&#xE1; a trav&#xE9;s de una <strong>funci&#xF3;n an&#xF3;nima o expresi&#xF3;n lambda</strong>.</p>
<table>
<thead>
<tr>
<th>Definici&#xF3;n</th>
<th>Explicaci&#xF3;n</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>&#x2192;</mo><mi>x</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">x &#x2192; x+2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&#x2192;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></td>
<td>Un par&#xE1;metro (definici&#xF3;n) y equivale a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>x</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">f(x)=x+2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>.</td>
</tr>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo>&#x2192;</mo><mi>x</mi><mo>+</mo><mn>2</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>10</mn><mo stretchy="false">)</mo><mo>=</mo><mn>12</mn></mrow><annotation encoding="application/x-tex">(x &#x2192; x+2)(10) = 12</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&#x2192;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">10</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">12</span></span></span></span></td>
<td>Un par&#xE1;metro (aplicaci&#xF3;n de un valor) y equivale a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mn>10</mn><mo stretchy="false">)</mo><mo>=</mo><mn>10</mn><mo>+</mo><mn>2</mn><mo>=</mo><mn>12</mn></mrow><annotation encoding="application/x-tex">f(10)=10+2=12</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord">10</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">10</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">12</span></span></span></span>.</td>
</tr>
<tr>
<td><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>&#x2192;</mo><msup><mi>x</mi><mi>y</mi></msup></mrow><annotation encoding="application/x-tex">(x,y) &#x2192; x^y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&#x2192;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6644em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span></span></span></span></span></span></span></td>
<td>Dos par&#xE1;metros.</td>
</tr>
</tbody>
</table>
</li>
</ol>
<p>Esta &#xFA;ltima, forma de definir funciones de forma an&#xF3;nima y como expresiones, es la que usaremos el la gran mayor&#xED;a de lenguajes de programaci&#xF3;n y aunque vamos a ver el caso concreto de C#, la forma de hacelos ser&#xE1; muy similar en otros lenguajes. Por<br>
ejemplo, si ya las hemos usado en JavaScript, su sintaxis nos ser&#xE1; muy familiar.</p>
<h4 class="mume-header" id="expresiones-lambda-en-c">Expresiones Lambda en C#</h4>

<p>Una <strong>&#x3BB;-expresi&#xF3;n</strong> en C# es un <strong>m&#xE9;todo an&#xF3;nimo</strong> (sin nombre) que se ha de declarar/definir y asignar inmediatamente, sobre una instancia de un <strong>delegado</strong>.</p>
<p>Las &#x3BB;-expresi&#xF3;n puede ser usadas en alguno estos escenarios en C#:</p>
<ol>
<li>
<p>Definir cuerpos de expresi&#xF3;n dentro de una clase (<strong>Esto ya lo hemos usado</strong>).</p>
<blockquote>
<p>&#x1F4CC; <strong>Nota:</strong> Por ejemplo, un cuerpo de expresi&#xF3;n es una expresi&#xF3;n lambda.</p>
</blockquote>
</li>
<li>
<p>Pasar como argumento a otra funci&#xF3;n.</p>
</li>
<li>
<p>Como tipo de retorno de una funci&#xF3;n, esto es, &apos;<em>Una funci&#xF3;n que retorna otra funci&#xF3;n</em>.</p>
</li>
<li>
<p>Asignaci&#xF3;n a instancias de delegados parametrizados.</p>
</li>
</ol>
<p>La representaci&#xF3;n general de una expresi&#xF3;n lambda sigue el  siguiente formato general...</p>
<p><strong><code>(par&#xE1;metros) =&gt; sentencia o {bloque de sentencias con return si funci&#xF3;n}</code></strong></p>
<p>Vamos a describir que es cada cosa:</p>
<ol>
<li>
<p><strong><code>(par&#xE1;metros)</code></strong>: Lista de par&#xE1;metros separada por comas.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">Pow</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Se debe dejar los par&#xE9;ntesis vac&#xED;os <strong><code>()</code></strong> si no hay par&#xE1;metros.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Hola&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Si solo hay <strong>un par&#xE1;metro</strong>, los par&#xE9;ntesis se pueden obviar.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token comment">// Suponiendo que s es de tipo string la expresi&#xF3;n lambda siguiente</span>
<span class="token comment">// se evaluar&#xE1; a tipo delegado Func&lt;string, int&gt; esto es, una funci&#xF3;n an&#xF3;nima</span>
<span class="token comment">// que recibe un string y retorna un int.</span>
s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>Lenght<span class="token punctuation">;</span>
</pre></li>
<li>
<p><strong><code>=&gt;</code></strong>: Este es el <strong>operador</strong> que se encarga de mapear los par&#xE1;metros a la expresi&#xF3;n o al conjunto de sentencias del bloque.</p>
</li>
<li>
<p>La parte derecha, tras el operador <strong><code>=&gt;</code></strong>, puede ser una &#xFA;nica sentencia en forma de expresi&#xF3;n que se eval&#xFA;e a lo que retorna la funci&#xF3;n como en lo ejemplo anteriores o de forma menos habitual, un bloque de instrucciones. En este &#xFA;ltimo caso la sint&#xE1;xis ser&#xE1; equivalente a la de las funciones tradicionales y tratando de sangrar el c&#xF3;digo y escribirla en varias l&#xED;neas para mayor claridad.</p>
<pre data-role="codeBlock" data-info="csharp {highlight=4}" class="language-csharp" data-line="4"><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
<span class="token punctuation">{</span> 
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Calculando </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">x</span><span class="token punctuation">}</span></span><span class="token string"> elevado a </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">y</span><span class="token punctuation">}</span></span><span class="token string">)&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-return">return</span> Math<span class="token punctuation">.</span><span class="token function">Pow</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// F&#xED;jate que ahora s&#xED; debemos usar return.</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">


<div aria-hidden="true" class="line-highlight" data-range="4" data-start="4">
</div></div></pre></li>
</ol>
<p>Las expresiones lambda anteriores anteriores de forma an&#xE1;loga a lo que suceder&#xED;a con la expresi&#xF3;n <strong><code>int x = 3 + 4</code></strong>, deberemos asignarla a algo. Puesto que los tipos que referencian a funciones son los objetos delegado, deberemos asignarlo a alg&#xFA;n identificador de objeto delegado parametrizado o no. Es m&#xE1;s, <strong>ser&#xE1; completamente necesario para deducir los tipos de los par&#xE1;metros de entrada y de retorno</strong>.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token comment">// x es double y retorna double</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-double">double</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">&gt;</span></span> cubo <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">*</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>

<span class="token comment">// x , y son enteros y retorna entero</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> suma <span class="token operator">=</span> <span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> o1 <span class="token operator">+</span> o2<span class="token punctuation">;</span> 

<span class="token comment">// ERROR no s&#xE9; deducir los tipos de forma impl&#xED;cita.</span>
<span class="token comment">// Esto solo ser&#xED;a v&#xE1;lido en un lenguaje d&#xE9;bilmente tipado como JavaScript.</span>
<span class="token class-name"><span class="token keyword keyword-var">var</span></span> suma <span class="token operator">=</span> <span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> o1 <span class="token operator">+</span> o2<span class="token punctuation">;</span>
</pre><h3 class="mume-header" id="clausuras-en-csharp">Clausuras en CSharp</h3>

<p>Para entender el concepto de <strong><a href="https://es.wikipedia.org/wiki/Clausura_(inform%C3%A1tica)">clausura</a></strong>, vamos a ver los siguiente definici&#xF3;n del lenguaje C#.</p>
<h4 class="mume-header" id="variables-externas-capturadas">Variables Externas Capturadas</h4>

<p>En el cuerpo de expresi&#xF3;n de una expresi&#xF3;n lambda, podemos incluir referencias a variables locales y a los par&#xE1;metros de un m&#xE9;todo. A estas referencias se les conoce como <strong>variables externas capturadas</strong>.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Variable local factor, su alcance o scope es la el m&#xE9;todo A</span>
    <span class="token comment">// fuera del mismo la variable dejar&#xE1; de existir.</span>
    <span class="token class-name"><span class="token keyword keyword-int">int</span></span> factor <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> 

    <span class="token comment">// factor es una variable externa capturada en la expresi&#xF3;n lambda pues </span>
    <span class="token comment">// est&#xE1; siendo usada en un &#xE1;mbito m&#xE1;s cercano.</span>
    <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> producto <span class="token operator">=</span> n <span class="token operator">=&gt;</span> n <span class="token operator">*</span> factor<span class="token punctuation">;</span>

    <span class="token comment">// Como hago una invocaci&#xF3;n del delegado dentro del scope de A</span>
    <span class="token comment">// factor sigue existiendo y valiendo 3 por lo que al ejecutarse</span>
    <span class="token comment">// el cuerpo de expresi&#xF3;n de la funci&#xF3;n lambda a la que referencia</span>
    <span class="token comment">// se mostrar&#xE1; 5 * 3 = 15</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">producto</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><p>A las <strong>expresiones lambda</strong> que est&#xE1;n integradas por variables externas capturadas se les llama <strong>clausuras</strong>.</p>
<p>Este tipo de variables, se eval&#xFA;an en el momento en que se llama a la expresi&#xF3;n Lambda de tal manera que si reescribi&#xE9;ramos el c&#xF3;digo anterior as&#xED; ...</p>
<pre data-role="codeBlock" data-info="csharp {highlight=5}" class="language-csharp" data-line="5"><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-int">int</span></span> factor <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> 
    <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> producto <span class="token operator">=</span> n <span class="token operator">=&gt;</span> n <span class="token operator">*</span> factor<span class="token punctuation">;</span>
    factor <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token comment">// Ahora mostrar&#xE1; 5 * 10 = 50 porque eval&#xFA;a el valor de factor en</span>
    <span class="token comment">// el momento de la llama a la funci&#xF3;n an&#xF3;nima.</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">producto</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Mostrar&#xE1; 50</span>
<span class="token punctuation">}</span>
<div class="line-highlight-wrapper">



<div aria-hidden="true" class="line-highlight" data-range="5" data-start="5">
</div></div></pre><p>La referencia y el valor a una variable capturada, <strong>est&#xE1; disponible mientras el &#xE1;mbito de la expresi&#xF3;n lambda</strong> est&#xE9; al alcance de su ejecuci&#xF3;n. Esto es, a pesar de encontrarnos fuera el &#xE1;mbito de definici&#xF3;n de la variable externa capturada, se guarda una referencia y siempre estar&#xE1; accesible para la expresi&#xF3;n lambda.</p>
<p>Pero, en nuestro ejemplo <strong><code>producto</code></strong> que es la referencia a nuestra expresi&#xF3;n lambda y <strong><code>factor</code></strong> que es la variable externa capturada, tienen el mismo &#xE1;mbito de ejecuci&#xF3;n que es el m&#xE9;todo <strong><code>A</code></strong>, esto es, ambas referencias existen en el heap mientras estoy ejecutando <strong><code>A</code></strong> y al finalizar el m&#xE9;todo desaparecen. Entonces... <strong>&#xBF;C&#xF3;mo puede extenderse el &#xE1;mbito de ejecuci&#xF3;n de <strong><code>producto</code></strong> m&#xE1;s all&#xE1; del &#xE1;mbito de existencia de <strong><code>factor</code></strong>?</strong></p>
<p>La respuesta es, mediante <strong>funciones de orden superior</strong> o <strong>HOF</strong> (<a href="https://en.wikipedia.org/wiki/Higher-order_function">High-Order Functions</a>). Las HOF en el &#x3BB;-c&#xE1;lculo podemos resumir que <strong>son funciones que reciben como par&#xE1;metro o retornan otra funci&#xF3;n</strong>.</p>
<p>&#xBF;C&#xF3;mo pasamos por par&#xE1;metro o devolvemos una funci&#xF3;n en C#?. La respuesta ser&#xED;a a trav&#xE9;s de un tipo delegado. Entonces, cuando vimos los delegados ... &#xBF;Aquellos m&#xE9;todos que recib&#xED;an un delegado eran HOF?. La respuesta es <strong>s&#xED;</strong>.</p>
<p>&#xBF;C&#xF3;mo redactaremos el c&#xF3;digo anterior para que el m&#xE9;todo <strong><code>A</code></strong> sea una HOF y la funci&#xF3;n lambda (clausura) tenga un alcance de ejecuci&#xF3;n m&#xE1;s all&#xE1; de su &#xE1;mbito de definici&#xF3;n?. Una posible propuesta ser&#xED;a la siguiente ...</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token comment">// Ahora el m&#xE9;todo A es HOF porque retorna una funci&#xF3;n</span>
<span class="token keyword keyword-static">static</span> <span class="token return-type class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-int">int</span></span> factor <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> n <span class="token operator">=&gt;</span> n <span class="token operator">*</span> factor<span class="token punctuation">;</span>    
<span class="token punctuation">}</span>

<span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-var">var</span></span> producto <span class="token operator">=</span> <span class="token function">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// A() ha desvuelto el control a Main y se supone que la variable local factor</span>
    <span class="token comment">// ya ha desaparecido. Sin embargo, la clausura que la capturaba a&#xFA;n est&#xE1; </span>
    <span class="token comment">// referenciada por el delegado producto y por tanto a&#xFA;n la podemos ejecutar.</span>
    <span class="token comment">// Al no desaparecer el alcance de ejecuci&#xF3;n la variable capturada factor a&#xFA;n</span>
    <span class="token comment">// no ha desaparecido de la memoria y tendr&#xE1; el &#xFA;ltimo valor que se le asign&#xF3;</span>
    <span class="token comment">// que es 3.</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">producto</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Mostrar&#xE1; 15</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><div style="page-break-after:always;"></div>
<blockquote>
<p>&#x1F4E3; <strong>Resumen:</strong></p>
<p>Es momento de realizar una breve recapitulaci&#xF3;n de conceptos...</p>
<p>En programaci&#xF3;n funcional (&#x3BB;-c&#xE1;lculo) se denominan funciones de orden superior (HOF), aquellas que:</p>
<ol>
<li>Reciben como par&#xE1;metro otra funci&#xF3;n <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>r</mi><mn>1</mn></msub><mo>&#x2192;</mo><msub><mi>r</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>&#x2192;</mo><msub><mi>r</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">(r_1 &#x2192; r_2) &#x2192; r_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&#x2192;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&#x2192;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>Devuelven como par&#xE1;metro otra funci&#xF3;n <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mn>1</mn></msub><mo>&#x2192;</mo><mo stretchy="false">(</mo><msub><mi>r</mi><mn>2</mn></msub><mo>&#x2192;</mo><msub><mi>r</mi><mn>3</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">r_1 &#x2192; (r_2 &#x2192; r_3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&#x2192;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&#x2192;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li>
<li>O ambas cosas <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>r</mi><mn>1</mn></msub><mo>&#x2192;</mo><msub><mi>r</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo>&#x2192;</mo><mo stretchy="false">(</mo><msub><mi>r</mi><mn>3</mn></msub><mo>&#x2192;</mo><msub><mi>r</mi><mn>4</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(r_1 &#x2192; r_2) &#x2192; (r_3 &#x2192; r_4)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&#x2192;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&#x2192;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&#x2192;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>.</li>
</ol>
<p>En C# lo ser&#xE1;n a aquellas funciones que reciban o devuelvan un delegado, o ambas cosas.</p>
<ol>
<li>
<p>Reciben un delegado...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> func1 <span class="token operator">=</span> d <span class="token operator">=&gt;</span> d <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> func2 <span class="token operator">=</span> <span class="token punctuation">(</span>func<span class="token punctuation">,</span> d<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">func</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">// func2 es una HOF</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> a <span class="token operator">=</span> <span class="token function">func2</span><span class="token punctuation">(</span>func1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a = func1(3) + 2 = (3 + 1) + 2 = 6</span>
</pre></li>
<li>
<p>Devuelven un delegado...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> suma <span class="token operator">=</span> op1 <span class="token operator">=&gt;</span> op2 <span class="token operator">=&gt;</span> op1 <span class="token operator">+</span> op2<span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> a <span class="token operator">=</span>  <span class="token function">suma</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a = (op2 =&gt; 3 + op2)(2) = 3 + 2 = 5</span>
</pre></li>
</ol>
</blockquote>
<p>Veamos un par de ejemplo de uso de este concepto de clausura con una utilidad m&#xE1;s concreta pero simplemente para que terminemos de entender el concepto y la terminolog&#xED;a ...</p>
<div style="page-break-after:always;"></div>
<p><strong>Ejemplo 1:</strong> Definiremos una HOF <strong><code>Contador()</code></strong> que me devuelva una clausura que al llamarla me devuelva un contador capturado incrementado.</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token keyword keyword-static">static</span> <span class="token return-type class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> <span class="token function">Contador</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">++</span>i<span class="token punctuation">;</span> <span class="token comment">// Devuelvo la clausura que captura el contador i..</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token comment">// Cada cuenta captura una variable i local diferente por lo que </span>
    <span class="token comment">// llevar&#xE1;n cuentas independientes</span>
    <span class="token class-name"><span class="token keyword keyword-var">var</span></span> cuenta1 <span class="token operator">=</span> <span class="token function">Contador</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Creo un contador</span>
    <span class="token class-name"><span class="token keyword keyword-var">var</span></span> cuenta2 <span class="token operator">=</span> <span class="token function">Contador</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Creo un segundo contador contador</span>

    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">cuenta1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Muestra 1</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">cuenta2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Muestra 1 por ser otro contador</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">cuenta2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Muestra 2</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">cuenta2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Muestra 3</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">cuenta1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Muestra 2</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p><strong>Ejemplo 2:</strong> Definiremos una HOF <strong><code>Potencia(double y)</code></strong> que me permita definir otras funciones que calculen potencias con un</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token keyword keyword-class">class</span> <span class="token class-name">Ejemplo</span>
<span class="token punctuation">{</span>
    <span class="token comment">// HOF que devuelve una clausura que captura el par&#xE1;metro de entrada &apos;y&apos;.</span>
    <span class="token comment">// F&#xED;jate que estemos definiendo un cuerpo de expresi&#xF3;n que se eval&#xFA;a una </span>
    <span class="token comment">// clausura que dada una base &apos;x&apos; calcula &apos;x&apos; elevado a la variable capturada &apos;y&apos;.</span>
    <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-double">double</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">&gt;</span></span> <span class="token function">Potencia</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-double">double</span></span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">Pow</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Definimos una funci&#xF3;n que calcula cuadrados pas&#xE1;ndole el exponente a capturar.</span>
    <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-readonly">readonly</span> <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-double">double</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">&gt;</span></span> Cuadrado <span class="token operator">=</span> <span class="token function">Potencia</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Definici&#xF3;n an&#xE1;loga para capturar el cubo.</span>
    <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-readonly">readonly</span> <span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-double">double</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span><span class="token punctuation">&gt;</span></span> Cubo <span class="token operator">=</span> <span class="token function">Potencia</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">Cuadrado</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// x = 10 elevado a y = 2 mostrar&#xE1; 100</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">Cubo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// x = 10 elevado a y = 3 mostrar&#xE1; 1000</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><div style="page-break-after:always;"></div>
<p>Si vamos al principio del tema donde defin&#xED;amos lo que era la programaci&#xF3;n funcional, dec&#xED;amos que:</p>
<blockquote>
<p>&apos;<em>La <strong>programaci&#xF3;n funcional</strong> es un <strong>paradigma de programaci&#xF3;n declarativa</strong> basado</em>&apos; ...</p>
</blockquote>
<p>Para entender un poco mejor a que se refiere con &apos;<em>programaci&#xF3;n declarativa</em>&apos;, vamos a comparar y resumir de forma sencilla la diferencia entre la programaci&#xF3;n imperativa y declarativa. Diremos que, en la <strong>imperativa</strong> le decimos nosotros al ordenador <strong>&apos;<em>c&#xF3;mo tiene que hacer algo</em>&apos;</strong> mediante una secuencia de instrucciones que ser&#xED;a m&#xE1;s o menos lo que hemos hecho hasta ahora. Sin embargo, en la <strong>declarativa</strong> le decimos al ordenador <strong>&apos;<em>lo que tiene que hacer</em>&apos;</strong>, proporcion&#xE1;ndole &#xFA;nicamente las estrategias para hacerlo. Por poner un ejemplo, el lenguaje SQL ser&#xED;a claramente declarativo ya que en &#xE9;l, le decimos al SGBD por ejemplo que seleccione n-tuplas que cumplan un criterio y les aplique una estrategia de agrupaci&#xF3;n, pero <strong>&apos;<em>no le indicamos c&#xF3;mo tiene que hacerlo</em>&apos;</strong>, de hecho no sabemos c&#xF3;mo lo hace internamente.</p>
<p>Sin entrar en aspectos m&#xE1;s te&#xF3;ricos o formales matem&#xE1;ticos como quiz&#xE1; hemos hecho al hablar del &#x3BB;-c&#xE1;lculo, diremos que la gran mayor&#xED;a de lenguajes modernos proporcionan una serie de m&#xE9;todos para trabajar sobre secuencias de datos de forma similar a c&#xF3;mo lo har&#xED;amos en SQL aplicando programaci&#xF3;n funcional.</p>
<p>En C# estos m&#xE9;todos para trabajar con secuencias (<strong><code>IEnumerable&lt;T&gt;</code></strong>) est&#xE1;n definidos como <a href="https://docs.microsoft.com/es-es/dotnet/api/system.linq.enumerable">m&#xE9;todos de extensi&#xF3;n</a> en <strong><code>System.Linq</code></strong> como ya comentamos al hablar de este tipo de m&#xE9;todos.</p>
<p>Entre ellos podremos destacar: <strong><code>Select</code></strong>, <strong><code>Where</code></strong>, <strong><code>Agreggate</code></strong>, <strong><code>GroupBy</code></strong>, <strong><code>Distinct</code></strong>, <strong><code>ElementAt</code></strong>, <strong><code>Join</code></strong>, <strong><code>GroupJoin</code></strong>, <strong><code>OrderBy</code></strong>, <strong><code>Reverse</code></strong>, <strong><code>SelectMany</code></strong>, etc.</p>
<div style="page-break-after:always;"></div>
<h3 class="mume-header" id="patr%C3%B3n-map-filter-fold">Patr&#xF3;n Map-Filter-Fold</h3>

<p>Es un patr&#xF3;n funcional utilizado en numerosos lenguajes tan populares como JavaScriprt(&gt;ES6), Java(&gt;8), C#, Python, Scala, Swift, Kotlin, etc y que permite hacer operaciones declarativas sobre secuencias de elementos de forma an&#xE1;loga a SQL.</p>
<blockquote>
<p>&#x1F4CC; <strong>Nota 1:</strong> Detr&#xE1;s de este patr&#xF3;n hay una gran teor&#xED;a matem&#xE1;tica aunque nosotros la vamos a obviar y vamos a tratar de explicar las operaciones de forma m&#xE1;s did&#xE1;ctica. Si quieres profundizar en el tema puedes seguir los enlaces en el tema.</p>
</blockquote>
<blockquote>
<p>&#x1F4CC; <strong>Nota 2:</strong> Durante el resto del tema vamos a utilizar la siguiente notaci&#xF3;n para representar secuencias (colecciones) y objetos...</p>
<ul>
<li><strong>Corchetes</strong> para secuencias <strong>[</strong> e1, e2, e3, ..., en <strong>]</strong> o <strong>Sec[</strong> e1, e2 <strong>]</strong></li>
<li><strong>Llaves</strong> para objetos <strong>{</strong> Propiedad1=valor1, Porpiedad2=valor2 <strong>}</strong></li>
</ul>
</blockquote>
<h4 class="mume-header" id="map-o-select">Map (o Select)</h4>

<p><strong><a href="https://en.wikipedia.org/wiki/Map_(higher-order_function)">Map</a></strong> es una HOF que aplica una funci&#xF3;n &#xFA;nica de &apos;<em>mapeo</em>&apos; o <strong>transformaci&#xF3;n</strong> a cada elemento de la secuencia y devuelve una nueva secuencia que contiene los resultados de la transformaci&#xF3;n en el mismo orden de la secuencia de entrada.</p>
<p>A lo largo de este tema vamos a ejemplificar los conceptos de forma gen&#xE9;rica con emojis, porque realmente es un concepto abstracto y estos nos ayudar&#xE1;n a entender la abstracci&#xF3;n de forma did&#xE1;ctica.<br>
Supongamos que representamos <strong>map</strong> con la expresi&#xF3;n <strong>map = (A &#x2192; B) &#xD7; Sec[A] &#x2192; Sec[B]</strong> donde:</p>
<ul>
<li><strong>A</strong> son productos en crudo o sin procesar.<br>
Ej. el ma&#xED;z &#x1F33D;.</li>
<li><strong>B</strong> son productos cocinados o procesados.<br>
Ej. las palomitas de ma&#xED;z &#x1F37F;.</li>
<li><strong>A &#x2192; B</strong> ser&#xED;a la funci&#xF3;n que cocina o <strong>transforma</strong> un producto en crudo en un producto cocinado y la podemos llamar por ejemplo <strong>cook</strong>. Esta funci&#xF3;n se pasar&#xE1; como par&#xE1;metro a la funci&#xF3;n <strong>map</strong> (por eso <strong>map</strong> es una HOF).<br>
Ej. <strong>cook(&#x1F33D;) &#x2192; &#x1F37F;</strong>.</li>
<li><strong>Sec[A]</strong> seria la secuencia de <strong>entrada</strong> de la funci&#xF3;n <strong>map</strong> de productos en crudo.<br>
Ej. [&#x1F42E;, &#x1F41F;, &#x1F360;, &#x1F414;, &#x1F33D;]</li>
<li><strong>Sec[B]</strong> seria la secuencia de <strong>salida</strong> de la funci&#xF3;n <strong>map</strong> de productos ya cocinados o procesados por la funci&#xF3;n <strong>cook</strong>.<br>
Ej. [&#x1F354;, &#x1F365;, &#x1F35F;, &#x1F357;, &#x1F37F;]</li>
</ul>
<p>Con lo cual podr&#xED;amos decir que, <strong>map = cook &#xD7; ProductosCrudos &#x2192; ProductosCocinados</strong>. Esto es, map dada una secuencia de productos en crudo le aplica a cada producto la <strong>funci&#xF3;n de transformaci&#xF3;n</strong> cocinar y me dar&#xE1; como resultado una secuencia de productos cocinados.<br>
Ej. <strong>[&#x1F42E;, &#x1F41F;, &#x1F360;, &#x1F414;, &#x1F33D;].map(cook) &#x2192; [&#x1F354;, &#x1F365;, &#x1F35F;, &#x1F357;, &#x1F37F;]</strong></p>
<p>En C# lo aplicaremos a trav&#xE9;s del m&#xE9;todo extensor <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.linq.enumerable.select">Select</a></strong> ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token comment">// Se aplica a secuencia de entrada IEnumerable&lt;A&gt;</span>
<span class="token comment">// A cada elemento de la secuencia de entrada se le aplica el &apos;mapeo&apos; A =&gt; B</span>
<span class="token comment">// Retorna una secuencia de salida IEnumerable&lt;B&gt; con los </span>
<span class="token comment">// elementos de la secuencia de entrada mapeados.</span>
<span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>B<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">Select</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>A<span class="token punctuation">,</span> B<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword keyword-this">this</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>A<span class="token punctuation">&gt;</span></span> source<span class="token punctuation">,</span> <span class="token class-name">Func<span class="token punctuation">&lt;</span>A<span class="token punctuation">,</span> B<span class="token punctuation">&gt;</span></span> mapeoDeAenB<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Veamos su uso a trav&#xE9;s de un ejemplo sencillo donde transformamos una secuencia de n&#xFA;meros reales en su equivalente entero. &apos;<em>Mapeando</em>&apos; de real a entero cada uno de elementos de la secuencia de entrada.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token comment">// Dada la siguiente secuencia de n&#xFA;meros reales</span>
<span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> reales <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.5</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">8.7</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Aplicamos la funci&#xF3;n ToInt32 que cumple con el tipo delegado Func&lt;double, int&gt;</span>
<span class="token comment">// para transformar la secuencia a enteros.</span>
<span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> enteros <span class="token operator">=</span> reales<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>Convert<span class="token punctuation">.</span>ToInt32<span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">,</span> enteros<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4 class="mume-header" id="filter-o-where">Filter (o Where)</h4>

<p><strong><a href="https://en.wikipedia.org/wiki/Filter_(higher-order_function)">Filter</a></strong> es una HOF que aplica un predicado a cada elemento de la secuencia de entrada y devuelve una secuencia de salida con los elementos en la secuencia que cumplen el predicado.</p>
<p>Supongamos que representamos <strong>filter</strong> con la expresi&#xF3;n <strong>filter = (A &#x2192; bool) &#xD7; Sec[A] &#x2192; Sec[A&apos;]</strong> donde:</p>
<ul>
<li><strong>A</strong> son productos cocinados o preparados.<br>
Ej. una hamburguesa &#x1F354;.</li>
<li><strong>A &#x2192; bool</strong> ser&#xED;a el predicado que eval&#xFA;a si los elementos de <strong>A</strong> cumplen un determinado criterio o no. Este predicado se pasar&#xE1; como par&#xE1;metro a la funci&#xF3;n <strong>filter</strong>.<br>
Ej. <strong>isVegetarian(&#x1F354;) &#x2192; false</strong>.</li>
<li><strong>Sec[A]</strong> seria la secuencia de <strong>entrada</strong> de la funci&#xF3;n <strong>filter</strong> de productos ya cocinados.<br>
Ej.  [&#x1F354;, &#x1F365;, &#x1F35F;, &#x1F357;, &#x1F37F;]</li>
<li><strong>Sec[A&apos;]</strong> seria la secuencia de <strong>salida</strong> de la funci&#xF3;n <strong>filter</strong> de productos ya cocinados que cumplen el predicado <strong>isVegetarian</strong>, esto es, <em><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mo mathvariant="normal" lspace="0em" rspace="0em">&#x2032;</mo></msup><mo>&#x2286;</mo><mi>A</mi></mrow><annotation encoding="application/x-tex">A&apos; \subseteq A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879em;vertical-align:-0.136em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">&#x2032;</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&#x2286;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span></em>.<br>
Ej. [&#x1F35F;, &#x1F37F;]</li>
</ul>
<p>Con lo cual podr&#xED;amos decir que, <strong>filter = isVegetarian &#xD7; ProductosCocinados &#x2192; ProductosCocinadosVegetarianos</strong>. Esto es, filter dada una secuencia de productos ya cocinados me devolver&#xE1; aquellos que sean vegetarianos.<br>
Ej. <strong>[&#x1F354;, &#x1F365;, &#x1F35F;, &#x1F357;, &#x1F37F;].filter(isVegetarian) &#x2192; [&#x1F35F;, &#x1F37F;]</strong></p>
<p>En C# lo aplicaremos a trav&#xE9;s del m&#xE9;todo extensor <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.linq.enumerable.where">Where</a></strong> ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token comment">// Dada la siguiente secuencia de enteros.</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> enteros <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Filtramos aquellos que sean pares...</span>
<span class="token comment">// 1. Definimos el predicado para ver si un n&#xFA;mero es par.</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-bool">bool</span><span class="token punctuation">&gt;</span></span> esPar <span class="token operator">=</span> n <span class="token operator">=&gt;</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">// 2. Aplicamos el predicado a la funci&#xF3;n where</span>
<span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> enterosPares <span class="token operator">=</span> enteros<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>esPar<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">,</span> enterosPares<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4 class="mume-header" id="fold-o-aggregate">Fold (o Aggregate)</h4>

<p><strong><a href="https://en.wikipedia.org/wiki/Fold_(higher-order_function)">Fold</a></strong> es una HOF tambi&#xE9;n conocida como <strong>reduce</strong>, <strong>aggregate</strong>, <strong>accumulate</strong>, etc. que &apos;<em>combina</em>&apos; los elementos de la secuencia de entrada reduci&#xE9;ndolos a un &#xFA;nico elemento de retorno. Para obtener este elemento de retorno necesitaremos una funci&#xF3;n binaria que combine los elementos de la secuencia en dicho elemento de retorno que normalmente tendr&#xE1; un estado inicial.</p>
<p>Supongamos que representamos <strong>fold</strong> con la expresi&#xF3;n <strong>fold = (B &#xD7; A &#x2192; B) &#xD7; Sec[A] &#xD7; B &#x2192; B</strong> donde:</p>
<ul>
<li>
<p><strong>B</strong> es el elemento de retorno el cual tomar&#xE1; un valor inicial.<br>
Ej. Pepe que <strong>inicialmente</strong> est&#xE1; hambriento y cansado &#x1F62B; pero puede tener otros estados como satisfecho &#x1F60B;</p>
</li>
<li>
<p><strong>A</strong> son los productos cocinados o preparados.<br>
Ej. la hamburguesa de vacuno &#x1F354;</p>
</li>
<li>
<p><strong>Sec[A]</strong> obviamente es una secu&#xE9;ncia de productos cocinados o preparados.<br>
Ej. [&#x1F354;, &#x1F365;, &#x1F35F;, &#x1F357;, &#x1F37F;]</p>
</li>
<li>
<p><strong>B &#xD7; A &#x2192; B</strong> funci&#xF3;n binaria que combina <strong>B</strong> con <strong>A</strong> y se eval&#xFA;a a <strong>B</strong>.<br>
Ej. En nuestro ejemplo, esta funci&#xF3;n de combinaci&#xF3;n puede ser <strong>eat(&#x1F62B;, &#x1F354;) &#x2192; &#x1F60B;</strong> donde el resultado de combinar a &#x1F62B;(Pepe hambriento) con la &#x1F354; (hamburguesa) ser&#xED;a &#x1F60B;(Pepe satisfecho). Ojo!, que tambi&#xE9;n puede pasar que al comer (combinar), el estado de pepe no cambie y siga hambriento <strong>eat(&#x1F62B;, &#x1F354;) &#x2192; &#x1F62B;</strong></p>
<blockquote>
<p>&#x1F4A1; <strong>Tip:</strong> En otras palabras, <strong>eat</strong> es una funci&#xF3;n de plegado (<strong>fold</strong>), reducci&#xF3;n (<strong>reduce</strong>), agregaci&#xF3;n (<strong>aggregate</strong>), etc. de la hamburguesa sobre Pepe y que me da como resultado al propio Pepe con menos hambre o saciado...</p>
</blockquote>
</li>
</ul>
<p>Con lo cual podr&#xED;amos decir que, <strong>fold = come &#xD7; ProductosCocinados &#xD7; PepeHambriento &#x2192; PepeSatisfecho</strong>. Esto es, fold dado un Pepe hambriento y una secuencia de productos cocinados, me devolver&#xE1; un Pepe satisfecho.<br>
Ej. <strong>[&#x1F35F;, &#x1F37F;].fold(&#x1F62B;, eat) &#x2192; &#x1F60B;</strong></p>
<p>En C# lo aplicaremos a trav&#xE9;s de las sobrecargas del m&#xE9;todo extensor <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.linq.enumerable.aggregate">Aggregate</a></strong> ...</p>
<blockquote>
<p>&#x1F4CC; <strong>Nota:</strong> <strong><code>System.Linq</code></strong> nos proporciona muchas funciones de agregaci&#xF3;n ya implementadas como m&#xE9;todos de extension sobre secuencias tales como: <strong>Sum</strong>, <strong>Max</strong>, <strong>Min</strong>, <strong>Average</strong>, o <strong>Count</strong>.</p>
</blockquote>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token comment">// Dada la siguiente secuencia de notas enteras</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> notas <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Cuenta las notas mayores o iguales a 5.</span>
<span class="token comment">// 1. Definimos la funci&#xF3;n binaria de agregaci&#xF3;n que vamos apasar a Aggregate....</span>
<span class="token comment">//    c -&gt; Es el contador.</span>
<span class="token comment">//    n -&gt; Es un elemento de la secuencia (una nota).</span>
<span class="token comment">//    Se eval&#xFA;a a la cuenta incremetada o sin incrementar dependiendo de</span>
<span class="token comment">//    si nota &gt;= 5 o no.</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span><span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">&gt;</span></span> cuentaAprobados <span class="token operator">=</span> <span class="token punctuation">(</span>c<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> n <span class="token operator">&gt;=</span> <span class="token number">5</span> <span class="token punctuation">?</span> c <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">:</span> c<span class="token punctuation">;</span>

<span class="token comment">// 2. Aplicamos la HOF de agregaci&#xF3;n, pas&#xE1;ndole el valor inicial de la cuenta y </span>
<span class="token comment">//    la funci&#xF3;n agregadora.</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> aprobados <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> cuentaAprobados<span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Total aprobados: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">aprobados</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong><code>Aggregate</code></strong> por defecto recorrer&#xE1; la secuencia de izquierda a derecha y para el caso anterior de contar aprobados nos dar&#xED;a igual. Sin embargo, muchos lenguajes funcionales ofrecen ambas posibilidades:</p>
<ul>
<li><strong><code>foldl</code></strong>: (fold left) Recorre como <strong><code>Aggregate</code></strong> de izquierda a derecha.</li>
<li><strong><code>foldr</code></strong>: (fold right) Recorre la secuencia de derecha a izquierda.</li>
</ul>
<p>Veamos una ejemplo de como hacerlo en C#. Para ello, vamos a suponer que queremos implementar el m&#xE9;todo de utilidad definido en la clase <strong><code>String</code></strong> y que hemos usado muchas veces a lo largo del curso. <strong><code>string.Join(string? separador, IEnumerable&lt;string?&gt; textos)</code></strong>.</p>
<p>Si nos fijamos cumple con <strong>(B &#xD7; A &#x2192; B) &#xD7; Sec[A] &#xD7; B &#x2192; B</strong> pero ahora no obtendremos el mismo resultado si hacemos <strong><code>foldl</code></strong> o <strong><code>foldr</code></strong> ...</p>
<ul>
<li>
<p><strong>A</strong> Ser&#xE1;n una palabra (<strong><code>String</code></strong>) a concatenar.</p>
</li>
<li>
<p><strong>Sec[A]</strong> Ser&#xE1; la secuencia de palabras a concatenar.</p>
</li>
<li>
<p><strong>B</strong> Ahora el tipo <em>&apos;agregador&apos;</em> ser&#xED;a un <strong><code>StringBuilder</code></strong> donde vamos a concatenar todas las palabras con el separador adecuado.</p>
<ol>
<li>Valor inicial ser&#xE1; <strong><code>new StringBuilder(palabras.Length &gt; 0 ? palabras.First() : &quot;&quot;</code></strong>, esto es, un <strong><code>StringBuilder</code></strong> vac&#xED;o si la secuencia esta vac&#xED;a o uno que contenga la primera palabra de la misma si contiene alguna.</li>
<li>Valor final ser&#xE1; el <strong><code>StringBuilder</code></strong> inicial <strong><code>B</code></strong> al que le he concatenado todas las palabras por la derecha.</li>
</ol>
</li>
<li>
<p><strong>(B &#xD7; A &#x2192; B)</strong> La funci&#xF3;n binaria de agregaci&#xF3;n ser&#xE1; de tipo <strong><code>Func&lt;StringBuilder, string, StringBuilder&gt;</code></strong> y recibir&#xE1; el <strong><code>StringBuilder</code></strong> <strong><code>B</code></strong> con lo que llevo de la cadena concatenada, la siguiente palabra <strong>A</strong> a concatenar con el separador y retornar&#xE1; el <strong><code>StringBuilder</code></strong> <strong>B</strong> con la palabra concatenada por la derecha.</p>
</li>
</ul>
<blockquote>
<p>&#x1F4E3; <strong>Resumen:</strong> Podemos resumir de forma simple que <strong><code>Join</code></strong> se comporta como <strong><code>foldl</code></strong> porque entra una secuencia de cadenas y devuelve un &#xFA;nico tipo resultado de concatenar las cadenas con un separador determinado.<br>
La &#xFA;nica diferencia es que <strong><code>Join</code></strong> devuelve un <strong><code>string</code></strong> y nosotros vamos a devolver un <strong><code>StringBuilder</code></strong> por eficiencia.</p>
</blockquote>
<p>Veamos pues nuestra propuesta de implementaci&#xF3;n de <strong><code>Join</code></strong> con un <strong><code>Aggregate</code></strong> (<strong><code>foldr</code></strong>) en C# ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token comment">// Definimos la secuencia</span>
<span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> palabras <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;Once&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;upon&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;time&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Definimos el separador que ser&#xE1; una variable capturada en la funci&#xF3;n lambda.</span>
<span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> separador <span class="token operator">=</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Funci&#xF3;n lambda agregadora concatena...</span>
<span class="token comment">//  Si la palabra a concatenar no es nula y no coincide con el valor inicial de la </span>
<span class="token comment">//  concatenaci&#xF3;n o en otras palabras es la primera palabra de la secuencia la </span>
<span class="token comment">//  concatenamos con el valor del separador capturado.</span>
<span class="token class-name">Func<span class="token punctuation">&lt;</span>StringBuilder<span class="token punctuation">,</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">,</span> StringBuilder<span class="token punctuation">&gt;</span></span> concatena <span class="token operator">=</span> 
<span class="token punctuation">(</span>f<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>p <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span> <span class="token operator">&amp;&amp;</span> f<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> p <span class="token punctuation">?</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">separador</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">p</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">StringBuilder</span> frase <span class="token operator">=</span> palabras<span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span>
                        <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span>palabras<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">?</span> palabras<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                        concatena<span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>frase<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Mostrar&#xE1; &quot;Once upon a time&quot;</span>
</pre><p>pero...&#xBF;y si quisi&#xE9;ramos hacer un <strong><code>foldr</code></strong> en C#?. Ser&#xED;a &apos;<em>tan simple</em>&apos; como <strong>invertir la secuencia de entrada</strong> con <strong><code>Reverse()</code></strong> y el lugar de tomar la primera ocurrencia (<strong><code>First</code></strong>) de la secuencia para inicializar nuestro <strong><code>StringBuilder</code></strong>, tomar&#xED;amos la &#xFA;ltima <strong><code>Last</code></strong>.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name">StringBuilder</span> frase <span class="token operator">=</span> palabras
                    <span class="token punctuation">.</span><span class="token function">Reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span>
                        <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span>palabras<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">?</span> palabras<span class="token punctuation">.</span><span class="token function">Last</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                        concatena<span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>frase<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Mostrar&#xE1; &quot;time a upon Once&quot;</span>
</pre><p><strong><code>Aggregate</code></strong> adem&#xE1;s tiene varias sobrecargas y vamos a comentar una de ellas que nos puede ser interesante en este caso.</p>
<p>Si vamos a ver la definici&#xF3;n de <strong><code>Aggregate</code></strong> para el uso anterior tendremos el siguiente interfaz que ya deber&#xED;amos entender...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token comment">// TSource es la parametrizaci&#xF3;n de A</span>
<span class="token comment">// TAccumulate es la parametrizaci&#xF3;n de B</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">TResult</span> <span class="token generic-method"><span class="token function">Aggregate</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TSource<span class="token punctuation">,</span> TAccumulate<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
        <span class="token keyword keyword-this">this</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">&gt;</span></span> source<span class="token punctuation">,</span>               <span class="token comment">// Sec[A]</span>
        <span class="token class-name">TAccumulate</span> seed<span class="token punctuation">,</span>                               <span class="token comment">// B (inicial)</span>
        <span class="token class-name">Func<span class="token punctuation">&lt;</span>TAccumulate<span class="token punctuation">,</span> TSource<span class="token punctuation">,</span> TAccumulate<span class="token punctuation">&gt;</span></span> func<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// B &#xD7; A &#x2192; B</span>
</pre><p>Sin embargo, tenemos tambi&#xE9;n la sobrecarga ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">TResult</span> <span class="token generic-method"><span class="token function">Aggregate</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TSource<span class="token punctuation">,</span> TAccumulate<span class="token punctuation">,</span> TResult<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
        <span class="token keyword keyword-this">this</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">&gt;</span></span> source<span class="token punctuation">,</span> 
        <span class="token class-name">TAccumulate</span> seed<span class="token punctuation">,</span> 
        <span class="token class-name">Func<span class="token punctuation">&lt;</span>TAccumulate<span class="token punctuation">,</span> TSource<span class="token punctuation">,</span> TAccumulate<span class="token punctuation">&gt;</span></span> func<span class="token punctuation">,</span> 
        <span class="token class-name">Func<span class="token punctuation">&lt;</span>TAccumulate<span class="token punctuation">,</span> TResult<span class="token punctuation">&gt;</span></span> resultSelector<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>donde aparece otra nuevo tipo parametrizado <strong><code>TResult</code></strong> y funci&#xF3;n de entrada <strong><code>Func&lt;TAccumulate, TResult&gt; resultSelector</code></strong> que una vez realizado todo el proceso de <strong>&apos;<em>fold</em>&apos;</strong> me transformar&#xE1; (mapear&#xE1;) mi <strong><code>TAccumulate</code></strong> final en un <strong><code>TResult</code></strong>.</p>
<p>En nuestro ejemplo, al definir el <strong><code>TAccumulate</code></strong> como un <strong><code>StringBuilder</code></strong> por optimizaci&#xF3;n, el resultado del <strong><code>Aggregate</code></strong> ser&#xE1; un <strong><code>StringBuilder</code></strong> y no un <strong><code>string</code></strong> como nos proporcionar&#xED;a el <strong><code>string.Join(...)</code></strong>. Pero la funci&#xF3;n de mapeo <strong><code>Func&lt;TAccumulate, TResult&gt; resultSelector</code></strong> nos permitir&#xE1; convertir el <strong><code>StringBuilder</code></strong> a un <strong><code>string</code></strong> con <strong><code>sb =&gt; sb.ToString()</code></strong> y ser&#xE1; lo que terminar&#xE1; devolviendo <strong><code>Aggregate</code></strong>.</p>
<p>Nuestra expresi&#xF3;n equivalente al <strong><code>Join</code></strong> haciendo un <strong><code>Aggregate</code></strong> (<strong><code>foldl</code></strong>) finalmente quedar&#xED;a ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> palabras <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;Once&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;upon&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;time&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> separador <span class="token operator">=</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Con Join</span>
<span class="token class-name"><span class="token keyword keyword-string">string</span></span> frase <span class="token operator">=</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>separador<span class="token punctuation">,</span> palabras<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Con Aggregate</span>
<span class="token class-name"><span class="token keyword keyword-string">string</span></span> frase <span class="token operator">=</span> palabras<span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span>palabras<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">?</span> palabras<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token punctuation">(</span>f<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> f<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> p <span class="token operator">&amp;&amp;</span> p <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span> <span class="token punctuation">?</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">separador</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">p</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    sb <span class="token operator">=&gt;</span> sb<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>frase<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>&#x270B; <strong>Importante:</strong> F&#xED;jate que en esta ocasi&#xF3;n hemos pasado las funciones de agregaci&#xF3;n y mapeo directamente a <strong><code>Aggregate</code></strong> en lugar de asignarlas previamente a un delegado. Esto es posible porque <strong>C# es capaz de deducir los tipos</strong> de <strong><code>(f, p) =&gt;</code></strong> y de <strong><code>sb =&gt;</code></strong> a partir del tipo de la secuencia <strong><code>palabras</code></strong> y el tipo del objeto que le pasamos como acumulador.</p>
</blockquote>
<blockquote>
<p>&#x1F4CC; <strong>Nota:</strong> Obviamente en este caso, es much&#xED;simo m&#xE1;s simple utilizar la funci&#xF3;n ya implementada <strong><code>Join</code></strong>. Pero hemos puesto este ejemplo, adem&#xE1;s de para ver el concepto de <strong><code>foldl</code></strong> y <strong><code>foldr</code></strong>, para entender la potencia de esta funci&#xF3;n si entendemos bien lo potente que es esta operaci&#xF3;n conceptualmente.<br>
De momento la hemos usado para cosas tan diferentes como: que Pepe coma &#x1F60B;, contar aprobados o concatenar palabras con un separador.</p>
</blockquote>
<h4 class="mume-header" id="combinando-las-tres-operaciones">Combinando las tres operaciones</h4>

<p>Podemos combinar dichas operaciones para realizar nuestro proceso en una &#xFA;nica funci&#xF3;n de forma declarativa.</p>
<p>Imaginemos nuestro ejemplo en que queremos alimentar a Pepe, que recordemos que es vegetariano y partimos de un mont&#xF3;n de productor en crudo. Podr&#xED;amos hacer...</p>
<p><strong>[&#x1F42E;, &#x1F41F;, &#x1F360;, &#x1F414;, &#x1F33D;].map(cook).filter(isVegetarian).fold(&#x1F62B;, eat) &#x2192; &#x1F60B;</strong></p>
<p>Esto equivaldr&#xED;a a las operaciones anteriores de forma encadenada. Donde la secuencia de salida de una funci&#xF3;n pasa a ser la de entrada de la siguiente [&#x1F42E;, &#x1F41F;, &#x1F360;, &#x1F414;, &#x1F33D;] &#x2192; [&#x1F354;, &#x1F365;, &#x1F35F;, &#x1F357;, &#x1F37F;] &#x2192; [&#x1F35F;, &#x1F37F;] &#x2192; &#x1F60B;</p>
<p>Sin embargo es importante preguntarnos si el orden de aplicaci&#xF3;n es eficiente. F&#xED;jate que en este caso, hemos tenido que <em>&apos;cocinar&apos;</em> todos los alimentos aunque realmente Pepe solo se ha comido dos de ellos. Este proceso hubiera sido much&#xED;simo m&#xE1;s eficiente si hubieramos cocinado solo aquellos que <em>&apos;son vegetales&apos;</em> [&#x1F42E;, &#x1F41F;, &#x1F360;, &#x1F414;, &#x1F33D;] &#x2192; [&#x1F360;, &#x1F33D;] &#x2192; [&#x1F35F;, &#x1F37F;] &#x2192; &#x1F60B;, esto es, haciendo el filtrado antes que la transformaci&#xF3;n ...</p>
<p><strong>[&#x1F42E;, &#x1F41F;, &#x1F360;, &#x1F414;, &#x1F33D;].filter(isVegetarian).map(cook).fold(&#x1F62B;, eat) &#x2192; &#x1F60B;</strong></p>
<blockquote>
<p>&#x1F4CC; <strong>Nota:</strong> Esto &#xFA;ltimo ser&#xED;a posible solo si la funci&#xF3;n de filtrado ahora tuviese como conjunto <strong>A</strong> a los productos crudos o una <strong>abstracci&#xF3;n</strong> de ambos,  es decir, si se pudiera saber si un productos &apos;<strong>es vegetal</strong>&apos; independientemente de si est&#xE1; cocinado o no <strong>isVegetarian(&#x1F33D;) &#x2192; true</strong> y <strong>isVegetarian(&#x1F37F;) &#x2192; true</strong></p>
</blockquote>
<p><strong>Ejemplo:</strong> Imaginemos que queremos saber el total de aprobados de una lista de notas con decimales.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token comment">// Select (map):      Transforma de double a double sin decimales. </span>
<span class="token comment">//                    Puesto que Math.Round tiene varias sobrecargas, deberemos indicar </span>
<span class="token comment">//                    mediante un cast que queremos una funci&#xF3;n del tipo A &#x2192; B</span>
<span class="token comment">//</span>
<span class="token comment">// Where (filter):    Filtramos aquellas notas que que cumplen el predicado n &gt;= 5d</span>
<span class="token comment">//</span>
<span class="token comment">// Aggregate (fold):  Vamos a llevar una cuenta en c empezando en 0d y al final del proceso </span>
<span class="token comment">//                    convertimos la cuenta real en un valor entero. Esto &#xFA;ltimo no ser&#xED;a </span>
<span class="token comment">//                    necesario, si el valor inicial de la cuenta hubiera sido un literal </span>
<span class="token comment">//                    entero, pero lo hacemos as&#xED; para ves un ejemplo de uso de resultSelector.</span>

<span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> notas <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">6.7</span><span class="token punctuation">,</span> <span class="token number">8.7</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> aprobados <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Func<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>Math<span class="token punctuation">.</span>Round<span class="token punctuation">)</span>
                     <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">&gt;=</span> <span class="token number">5d</span><span class="token punctuation">)</span>
                     <span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span><span class="token number">0d</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>c<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> c <span class="token operator">=&gt;</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Aprobados: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">aprobados</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Puesto que cosas como contar elementos en usa secuencia, acumular en una suma, buscar un m&#xE1;ximo, etc. son casos t&#xED;picos de fold, ya vienen predefinidos en C# y no tendr&#xED;amos que implementarlos a trav&#xE9;s de Aggregate</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name"><span class="token keyword keyword-int">int</span></span> aprobados <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Func<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>Math<span class="token punctuation">.</span>Round<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n <span class="token operator">&gt;=</span> <span class="token number">5d</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>F&#xED;jate que es bastante similar a SQL, una posible consulta para hacer lo mismo en SQL.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token function">ROUND</span><span class="token punctuation">(</span>nota<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> aprobados <span class="token keyword keyword-FROM">FROM</span> notas <span class="token keyword keyword-where">where</span> <span class="token function">ROUND</span><span class="token punctuation">(</span>nota<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">5</span><span class="token punctuation">;</span>
</pre><p>En este caso no podemos filtrar antes de hacer el mapeo puesto que el resultado ser&#xED;a diferente. Piensa que <strong><code>4.6</code></strong> despu&#xE9;s del <strong><code>Round</code></strong> ser&#xE1; <strong><code>5</code></strong> y contar&#xE1; como aprobado.</p>
<div style="page-break-after:always;"></div>
<blockquote>
<p>&#x1F680; <strong>Ampliaci&#xF3;n:</strong></p>
<p>C&#xF3;mo hemos dicho este patr&#xF3;n existir&#xE1; de forma similar en otros lenguajes y seguramente sin saber la sintaxis de otros lenguajes seguramente podemos entender el c&#xF3;digo equivalente en lenguajes tan populares como:</p>
<p><strong>JavaScript:</strong></p>
<pre data-role="codeBlock" data-info="JavaScript" class="language-javascript"><span class="token keyword keyword-let">let</span> notas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">6.7</span><span class="token punctuation">,</span> <span class="token number">8.7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword keyword-let">let</span> aprobados <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token property-access">round</span><span class="token punctuation">)</span>
                     <span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">n</span> <span class="token arrow operator">=&gt;</span> n <span class="token operator">&gt;=</span> <span class="token number">5</span><span class="token punctuation">)</span>
                     <span class="token punctuation">.</span><span class="token method function property-access">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Aprobados: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>aprobados<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong>Kotlin:</strong></p>
<pre data-role="codeBlock" data-info="Kotlin" class="language-kotlin"><span class="token keyword keyword-val">val</span> notas <span class="token operator">=</span> <span class="token function">doubleArrayOf</span><span class="token punctuation">(</span><span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">6.7</span><span class="token punctuation">,</span> <span class="token number">8.7</span><span class="token punctuation">)</span>
<span class="token keyword keyword-val">val</span> aprobados <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span>
                     <span class="token punctuation">.</span><span class="token function">filter</span> <span class="token punctuation">{</span> it <span class="token operator">&gt;=</span> <span class="token number">5</span> <span class="token punctuation">}</span>
                     <span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> acc<span class="token punctuation">,</span> _ <span class="token operator">-&gt;</span> acc <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Aprobados: <span class="token interpolation variable">$aprobados</span>&quot;</span><span class="token punctuation">)</span>
</pre><p><strong>Python:</strong></p>
<pre data-role="codeBlock" data-info="Python" class="language-python"><span class="token keyword keyword-from">from</span> functools <span class="token keyword keyword-import">import</span> <span class="token builtin">reduce</span>
notas <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1.3</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">6.7</span><span class="token punctuation">,</span> <span class="token number">8.7</span><span class="token punctuation">]</span>
aprobados <span class="token operator">=</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword keyword-lambda">lambda</span> c<span class="token punctuation">,</span> n<span class="token punctuation">:</span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> 
                    <span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token keyword keyword-lambda">lambda</span> n<span class="token punctuation">:</span> n <span class="token operator">&gt;=</span> <span class="token number">5</span><span class="token punctuation">,</span> 
                            <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">round</span><span class="token punctuation">,</span> notas<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword keyword-print">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&apos;Aprobados: </span><span class="token interpolation"><span class="token punctuation">{</span>aprobados<span class="token punctuation">}</span></span><span class="token string">&apos;</span></span><span class="token punctuation">)</span>
</pre></blockquote>
<div style="page-break-after:always;"></div>
<h3 class="mume-header" id="otras-operaciones-funcionales-declarativas-en-c">Otras operaciones funcionales declarativas en C#</h3>

<p>Ya hemos visto que <strong><code>Select</code></strong>, <strong><code>Where</code></strong>, <strong><code>Aggregate</code></strong>, <strong><code>Count</code></strong> y sin duda estas operaciones como hemos mencionado nos deben <em>&apos;sonar&apos;</em> de SQL. Pero..., &#xBF;Existen otras operaciones equivalentes a las que podemos encontrar en SQL?.</p>
<p>la respuesta es <strong>s&#xED;</strong> y vamos ver algunas de ellas ...</p>
<h4 class="mume-header" id="orderbyorderbydescending">OrderBy/OrderByDescending</h4>

<p>Ordena de manera ascendente/descendente los elementos de una secuencia en funci&#xF3;n de una clave.</p>
<blockquote>
<p>&#x1F4CC; <strong>Nota:</strong> Los tipos deben ser <strong>comparables</strong>. Si no lo son, necesitar&#xE1; de un objeto que implemente el interfaz <strong><code>IComparer&lt;T&gt;</code></strong> entre dos elementos del tipo de la clave por la que hemos decidido ordenar.</p>
</blockquote>
<h4 class="mume-header" id="distinct">Distinct</h4>

<p>Elimina valores repetidos en una secuencia.</p>
<blockquote>
<p>&#x1F4CC; <strong>Nota:</strong> El tipo de datos de la secuencia deber&#xE1; implementar <strong><code>IEquatable</code></strong> para poder comparar en igualdad los elemento de la secuencia o deberemos pasarle un objeto que implemente un interfaz de comparaci&#xF3;n.</p>
</blockquote>
<p><strong>Ejemplo:</strong> Imaginemos que queremos saber la mayor nota redondeada de la siguiente secuencia...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> notas <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">7.2</span><span class="token punctuation">,</span> <span class="token number">7.6</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">8.7</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Pod&#xED;amos usar un <strong><code>Aggregate</code></strong> para obtener el m&#xE1;ximo o usar la funci&#xF3;n <strong><code>Max</code></strong> que hace la operaci&#xF3;n espec&#xED;fica de la siguiente forma.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name"><span class="token keyword keyword-int">int</span></span> notaMayor <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span>
                        <span class="token keyword keyword-double">double</span><span class="token punctuation">.</span>MinValue<span class="token punctuation">,</span> 
                        <span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> n <span class="token operator">&gt;</span> <span class="token class-name">m <span class="token punctuation">?</span></span> n <span class="token punctuation">:</span> m<span class="token punctuation">,</span> 
                        n <span class="token operator">=&gt;</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">Round</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// o tambi&#xE9;n                         </span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> notaMayor <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">Round</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;La nota redondeada mayor es </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">notaMayor</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>En este caso tambi&#xE9;n ser&#xED;a bastante similar a un posible consulta en SQL.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span><span class="token function">ROUND</span><span class="token punctuation">(</span>nota<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> notaMayor <span class="token keyword keyword-FROM">FROM</span> notas<span class="token punctuation">;</span>
</pre><p>Aunque m&#xE1;s ineficiente, tambi&#xE9;n podr&#xED;amos usar <strong><code>Distinct</code></strong> y <strong><code>OrderBy</code></strong> de la siguiente manera ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> notas <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">7.2</span><span class="token punctuation">,</span> <span class="token number">7.6</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">8.7</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> notaMayor <span class="token operator">=</span> notas<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">Round</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   
                      <span class="token comment">// 1. Redondeamos las notas de la secuencia a su valor entero.</span>
                      <span class="token punctuation">.</span><span class="token function">Distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                                    
                      <span class="token comment">// 2. Eliminamos de la secuencia las notas repetidas.</span>
                      <span class="token punctuation">.</span><span class="token function">OrderByDescending</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n<span class="token punctuation">)</span>                     
                      <span class="token comment">// 3. Ordenamos la secuencia de en orden descendiente, esto es, </span>
                      <span class="token comment">// la nota mayor es la primera.</span>
                      <span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                      
                      <span class="token comment">// 4. Obtenemos el primer elemento de la secuencia.</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;La nota redondeada mayor es </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">notaMayor</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>F&#xED;jate que aunque es un poco m&#xE1;s enrevesada, tambi&#xE9;n tenemos una equivalencia en SQL.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword keyword-SELECT">SELECT</span> <span class="token keyword keyword-DISTINCT">DISTINCT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span>nota<span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> notaMayor <span class="token keyword keyword-FROM">FROM</span> notas <span class="token keyword keyword-ORDER">ORDER</span> <span class="token keyword keyword-BY">BY</span> notaMayor <span class="token keyword keyword-DESC">DESC</span> <span class="token keyword keyword-LIMIT">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>
</pre><div style="page-break-after:always;"></div>
<h4 class="mume-header" id="groupby">GroupBy</h4>

<p>Agrupa los elementos de una secuencia seg&#xFA;n una funci&#xF3;n del selector de claves especificada y crea un valor de resultado a partir de cada grupo y su clave. Los elementos de cada grupo se proyectan utilizando una funci&#xF3;n determinada.</p>
<p>Existen diferentes sobrecargas posibles para usar la agrupaci&#xF3;n. Nosotros vamos a usar esta pues es la m&#xE1;s &apos;<em>intuitiva</em>&apos;...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>TResult<span class="token punctuation">&gt;</span></span> <span class="token function">GroupBy</span><span class="token punctuation">(</span>
                    <span class="token keyword keyword-this">this</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">&gt;</span></span> source<span class="token punctuation">,</span>
                    <span class="token class-name">Func<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">,</span> TKey<span class="token punctuation">&gt;</span></span> keySelector<span class="token punctuation">,</span> 
                    <span class="token class-name">Func<span class="token punctuation">&lt;</span>TKey<span class="token punctuation">,</span> IEnumerable<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">&gt;</span><span class="token punctuation">,</span> TResult<span class="token punctuation">&gt;</span></span> resultSelector<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Veamos como interpretarla:</p>
<ul>
<li><strong><code>keySelector</code></strong> ser&#xE1; la funci&#xF3;n del selector de claves por las que agrupar&#xE9; la secuencia:
<ul>
<li><strong>Recibe</strong>: <code>TSource</code> que es el tipo de la secuencia a procesar.</li>
<li><strong>Devuelve</strong>:  <code>TKey</code> tipo la clave resultado del mapeo de TSource por que que voy a agrupar.</li>
</ul>
</li>
<li><strong><code>resultSelector</code></strong> ser&#xE1; la funci&#xF3;n que proyecta los elemento de cada grupo con su clave:
<ul>
<li><strong>Recibe</strong>: <code>Tkey</code> con la clave por la que agrupo y la agrupaci&#xF3;n de los objetos <code>TSource</code> para esa clave.</li>
<li><strong>Devuelve</strong>: <code>TResult</code> con lo que quiero producir en la nueva secuencia resultado de la agrupaci&#xF3;n.</li>
</ul>
</li>
</ul>
<p>Bueno, hasta ahora ha sido una definici&#xF3;n muy formal, pero vamos ha hacerlo con un ejemplo m&#xE1;s sencillo para entenderlo. Supongamos nuestro array de notas anterior...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name"><span class="token keyword keyword-double">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> notas <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">,</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">7.2</span><span class="token punctuation">,</span> <span class="token number">7.6</span><span class="token punctuation">,</span> <span class="token number">5.6</span><span class="token punctuation">,</span> <span class="token number">8.7</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre><p>Queremos agrupar el valor de las notas sin decimales y contabilizar el n&#xFA;mero de apariciones de las mismas.</p>
<p>Si estuvi&#xE9;ramos en MySQL una posible consulta para resolverlo ser&#xED;a...</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword keyword-SELECT">SELECT</span> FLOOR<span class="token punctuation">(</span>nota<span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> notaRedondeada<span class="token punctuation">,</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword keyword-AS">AS</span> veces 
<span class="token keyword keyword-FROM">FROM</span> notas <span class="token keyword keyword-GROUP">GROUP</span> <span class="token keyword keyword-BY">BY</span> notaRedondeada <span class="token keyword keyword-ORDER">ORDER</span> <span class="token keyword keyword-BY">BY</span> notaRedondeada<span class="token punctuation">;</span>
</pre><p>El equivalente utilizando la programaci&#xF3;n funcional y el <strong><code>GroupBy</code></strong> de C# ser&#xED;a ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name"><span class="token keyword keyword-string">string</span></span> salida <span class="token operator">=</span> <span class="token string">&quot;notaRedondeada veces\n&quot;</span> <span class="token operator">+</span> 
notas<span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>
        nota <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">Floor</span><span class="token punctuation">(</span>nota<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>nota<span class="token punctuation">,</span> elementosConMismaNota<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                <span class="token keyword keyword-new">new</span>
                <span class="token punctuation">{</span>
                    NotaAgrupada <span class="token operator">=</span> nota<span class="token punctuation">,</span>
                    Veces <span class="token operator">=</span> elementosConMismaNota<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>datoAgrupado <span class="token operator">=&gt;</span> datoAgrupado<span class="token punctuation">.</span>NotaAgrupada<span class="token punctuation">)</span>
     <span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span>texto<span class="token punctuation">,</span> datoAgrupado<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                texto <span class="token operator">+=</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">datoAgrupado<span class="token punctuation">.</span>NotaAgrupada<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">14</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">datoAgrupado<span class="token punctuation">.</span>Veces<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">5</span></span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>salida<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>&#x270B; <strong>Importante:</strong> F&#xED;jate que aunque <strong><code>string salida = ...</code></strong> es una &#xFA;nica expresi&#xF3;n, hemos ido introduciendo saltos de l&#xED;nea e indentado el c&#xF3;digo para que sea legible y modificable nuestra expresi&#xF3;n funcional. De otra manera el c&#xF3;digo ser&#xED;a pr&#xE1;cticamente ilegible y dif&#xED;cil de modificar para un programador humano.</p>
</blockquote>
<p>Si comentamos el c&#xF3;digo anterior podr&#xED;amos decir que:</p>
<ol>
<li>
<p>Nuestra funci&#xF3;n selectora (<code>Func&lt;TSource, TKey&gt; keySelector</code>) es:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp">nota <span class="token operator">=&gt;</span> Math<span class="token punctuation">.</span><span class="token function">Floor</span><span class="token punctuation">(</span>nota<span class="token punctuation">)</span>
</pre><p>Siendo <code>TSource</code> los <strong>doubles</strong> de la secuencia de entrada con el identificador <strong><code>nota</code></strong>.<br>
Siendo <code>TKey</code> el <strong>double</strong> resultado de quedarnos con la parte entera de la nota <strong><code>Math.Floor(nota)</code></strong>.<br>
Todos los elementos de la lista de entrada que produzcan la misma clave <code>TKey</code>, estar&#xE1;n en el mismo grupo y por tanto se agrupar&#xE1;n en una secuencia. En nuestro caso las claves generadas ser&#xE1;n ...<br>
<code>[ 1, 3.4, 4.3, 4.6, 4.3, 7.2, 7.6, 5.6, 8.7 ]</code> &#x2192; <code>[ 1, 3, 4, 5, 7, 8 ]</code></p>
</li>
<li>
<p>Nuestra funci&#xF3;n des proyecci&#xF3;n (<code>Func&lt;TKey, IEnumerable&lt;TSource&gt;, TResult&gt; resultSelector</code>) es:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token punctuation">(</span>nota<span class="token punctuation">,</span> elementosConMismaNota<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span>
                <span class="token punctuation">{</span>
                    NotaAgrupada <span class="token operator">=</span> nota<span class="token punctuation">,</span>
                    Veces <span class="token operator">=</span> elementosConMismaNota<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
</pre><p>Siendo <code>TKey</code> el <strong>double</strong> con la clave que recordemos es el resultado de aplicar <code>Floor</code> a la nota.<br>
Siendo <code>IEnumerable&lt;TSource&gt;</code> una nueva secuencia con los elementos de la secuencia original, esto es, las notas con decimales <strong>agrupadas a esa clave</strong>. Esto es, los elementos que generaron esa clave.<br>
As&#xED; pues, tendr&#xE9; las siguientes parejas de <strong>(clave, agrupaci&#xF3;n)</strong> en <code>(TKey, IEnumerable&lt;TSource&gt;)</code> en nuestro caso <strong><code>(nota, elementosConMismaNota)</code></strong></p>
<pre data-role="codeBlock" data-info="json" class="language-json">(<span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token number">1</span> <span class="token punctuation">]</span>)
(<span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token number">3.4</span> <span class="token punctuation">]</span>)
(<span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token number">4.3</span><span class="token punctuation">,</span> <span class="token number">4.6</span><span class="token punctuation">,</span> <span class="token number">4.3</span> <span class="token punctuation">]</span>)
(<span class="token number">7</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token number">7.2</span><span class="token punctuation">,</span> <span class="token number">7.6</span> <span class="token punctuation">]</span>)
(<span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token number">5.6</span> <span class="token punctuation">]</span>)
(<span class="token number">8</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token number">8.7</span> <span class="token punctuation">]</span>)
</pre><p>Siendo <code>TResult</code> la <strong>proyecci&#xF3;n</strong> resultante de gestionar los pares (clave, agrupaci&#xF3;n) anteriores. En nuestro caso objetos de la &apos;<em>an&#xF3;nimos</em>&apos; con dos propiedades <strong><code>NotaAgrupada</code></strong> y <strong><code>Veces</code></strong> que tendr&#xE1; la cuenta de cada secuencia de notas agrupadas con la clave.<br>
Por tanto el resultado final ser&#xE1; la secuencia de <code>TResult</code> siguiente...</p>
<pre data-role="codeBlock" data-info="json" class="language-json"><span class="token punctuation">[</span> 
  <span class="token punctuation">{</span> NotaAgrupada = <span class="token number">1</span><span class="token punctuation">,</span> Veces = <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> NotaAgrupada = <span class="token number">3</span><span class="token punctuation">,</span> Veces = <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">{</span> NotaAgrupada = <span class="token number">4</span><span class="token punctuation">,</span> Veces = <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> NotaAgrupada = <span class="token number">7</span><span class="token punctuation">,</span> Veces = <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">{</span> NotaAgrupada = <span class="token number">5</span><span class="token punctuation">,</span> Veces = <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> NotaAgrupada = <span class="token number">8</span><span class="token punctuation">,</span> Veces = <span class="token number">1</span> <span class="token punctuation">}</span> 
<span class="token punctuation">]</span>
</pre></li>
<li>
<p>La funci&#xF3;n</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>datoAgrupado <span class="token operator">=&gt;</span> datoAgrupado<span class="token punctuation">.</span>NotaAgrupada<span class="token punctuation">)</span>
</pre><p>aplicada a la secuencia anterior de objetos an&#xF3;nimos producir&#xE1; la misma secuencia pero ordenada por la propiedad <strong><code>NotaAgrupada</code></strong>.</p>
</li>
<li>
<p>La funci&#xF3;n</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>texto<span class="token punctuation">,</span> datoAgrupado<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
          texto <span class="token operator">+=</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">datoAgrupado<span class="token punctuation">.</span>NotaAgrupada<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">14</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">datoAgrupado<span class="token punctuation">.</span>Veces<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">5</span></span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Genera una cadena con los pares nota sin decimales y veces que aparece alineados y separados por un salto de l&#xED;nea.</p>
</li>
</ol>
<div style="page-break-after:always;"></div>
<p><strong>Ejemplo:</strong> Veamos un ejemplo algo m&#xE1;s elaborado usando una secuencia con un tipo algo m&#xE1;s complejo que un double. Para ello, supongamos la siguiente clase inmutable que define los datos de un empleado de una determinada empresa...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-enum">enum</span> <span class="token class-name">Ciudad</span> <span class="token punctuation">{</span> Elche<span class="token punctuation">,</span> Alicante <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-record">record</span> <span class="token class-name">Empleado</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> Nombre<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> Edad<span class="token punctuation">,</span> <span class="token class-name">Ciudad</span> Ciudad<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-override">override</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Nombre<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">9</span></span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Edad<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span></span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">Ciudad</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><p>Ahora definimos una clase de utilidad que me devuelva una secuencia de empleados de forma <em>&apos;perezosa&apos;</em>...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">Empleados</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span></span> DepartamentoDeVentas
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-get">get</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-yield">yield</span> <span class="token keyword keyword-return">return</span>
            <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">Nombre</span><span class="token punctuation">:</span> <span class="token string">&quot;Xusa&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Edad</span><span class="token punctuation">:</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Ciudad</span><span class="token punctuation">:</span> Ciudad<span class="token punctuation">.</span>Alicante<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-yield">yield</span> <span class="token keyword keyword-return">return</span>
            <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">Nombre</span><span class="token punctuation">:</span> <span class="token string">&quot;Simon&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Edad</span><span class="token punctuation">:</span> <span class="token number">51</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Ciudad</span><span class="token punctuation">:</span> Ciudad<span class="token punctuation">.</span>Alicante<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-yield">yield</span> <span class="token keyword keyword-return">return</span>
            <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">Nombre</span><span class="token punctuation">:</span> <span class="token string">&quot;Carmen&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Edad</span><span class="token punctuation">:</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Ciudad</span><span class="token punctuation">:</span> Ciudad<span class="token punctuation">.</span>Elche<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-yield">yield</span> <span class="token keyword keyword-return">return</span>
            <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">Nombre</span><span class="token punctuation">:</span> <span class="token string">&quot;Juanjo&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Edad</span><span class="token punctuation">:</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Ciudad</span><span class="token punctuation">:</span> Ciudad<span class="token punctuation">.</span>Elche<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-yield">yield</span> <span class="token keyword keyword-return">return</span>
            <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">Nombre</span><span class="token punctuation">:</span> <span class="token string">&quot;Emy&quot;</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Edad</span><span class="token punctuation">:</span> <span class="token number">52</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">Ciudad</span><span class="token punctuation">:</span> Ciudad<span class="token punctuation">.</span>Elche<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Queremos obtener un array con los nombres de los empleados mayores de 40 a&#xF1;os sin repeticiones y ordenados por nombre.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> nombres <span class="token operator">=</span> Empleados<span class="token punctuation">.</span>DepartamentoDeVentas
                            <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Edad <span class="token operator">&gt;</span> <span class="token number">40</span><span class="token punctuation">)</span>  <span class="token comment">// Filtramos por edad.</span>
                            <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Nombre<span class="token punctuation">)</span>    <span class="token comment">// Proyectamos la propiedad Nombre </span>
                                                      <span class="token comment">// a una nueva secuencia.</span>
                            <span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>n <span class="token operator">=&gt;</span> n<span class="token punctuation">)</span>          <span class="token comment">// Ordenamos por nombre.</span>
                            <span class="token punctuation">.</span><span class="token function">Distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>               <span class="token comment">// Eliminamos repetidos.</span>
                            <span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// Pasamos la secuencia a array.</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">,</span> nombres<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Supongamos que ahora queremos obtener los empleados mayores de 40 a&#xF1;os agrupados por ciudad usando <strong><code>GroupBy</code></strong>.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name"><span class="token keyword keyword-var">var</span></span> empleadosXCiudad <span class="token operator">=</span> Empleados<span class="token punctuation">.</span>DepartamentoDeVentas
                                <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Edad <span class="token operator">&gt;</span> <span class="token number">40</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Ciudad<span class="token punctuation">,</span> 
                                         <span class="token punctuation">(</span>c<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span>Ciudad <span class="token operator">=</span> c<span class="token punctuation">,</span> Empleados <span class="token operator">=</span> g<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>El tipo de <strong><code>empleadosXCiudad</code></strong> debe ser impl&#xED;cito (<strong><code>var</code></strong>) pues la secuencia que estamos creando es de un tipo impl&#xED;cito (<strong><code>new {Ciudad = c, Empleados = g}</code></strong>) que estamos definiendo en la funci&#xF3;n de proyecci&#xF3;n del <strong><code>GroupBy</code></strong>.</p>
<p>Ahora queremos mostrar los datos de la siguiente manera con los empleados ordenados por edad ....</p>
<pre data-role="codeBlock" data-info="txt" class="language-txt">Alicante:
        Xusa     45 Alicante
        Juanjo   51 Alicante
Elche:
        Juanjo   45 Elche
        Emy      52 Elche
</pre><p>Aunque la secuencia sea de un tipo impl&#xED;cito podremos componer una cadena con la salida deseada.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name">StringBuilder</span> salida <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-var">var</span></span> eXc <span class="token keyword keyword-in">in</span> empleadosXCiudad<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    salida<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">eXc<span class="token punctuation">.</span>Ciudad</span><span class="token punctuation">}</span></span><span class="token string">:\n&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Empleado</span> e <span class="token keyword keyword-in">in</span> eXc<span class="token punctuation">.</span>Empleados<span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Edad<span class="token punctuation">)</span><span class="token punctuation">)</span>
        salida<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;\t</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">e</span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>salida<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><blockquote>
<p>&#x1F4CC; <strong>Nota</strong>: Al ser la secuencia de un tipo impl&#xED;cito o an&#xF3;nimo, solo podremos recorrer la secuiencia en el mismo &#xE1;mbito de uso de tipo. Si intent&#xE1;ramos encapsular el la obtenci&#xF3;n de la secuencia en una funci&#xF3;n, no podr&#xED;amos devolverla como tal, sino que deber&#xED;amos encapsularla en un tipo de datos o clase que la contuviera.</p>
<p>Lo mismo suceder&#xED;a si quisieramos encapsular el c&#xF3;digo que muestra los datos en pantalla. No sabr&#xED;amos de que tipo asignarle a la secuencia que pasar&#xED;amos como par&#xE1;metro.</p>
</blockquote>
<div style="page-break-after:always;"></div>
<h5 class="mume-header" id="resultado-del-grupby-en-un-nuevo-tipo-de-datos">Resultado del GrupBy en un nuevo tipo de datos</h5>

<p>Supongamos que hubi&#xE9;ramos querido encapsular la obtenci&#xF3;n de <strong><code>empleadosXCiudad</code></strong> en una funci&#xF3;n y hacer el mismo proceso modularizado. Puesto que la secuencia es de un tipo an&#xF3;nimo, nos hubi&#xE9;ramos visto obligados ha definir una nueva clase con una propiedad <strong><code>Ciudad</code></strong> del tipo enumerado y otra <strong><code>Empleados</code></strong> como secuencia de objetos empleados por ejemplo.</p>
<blockquote>
<p>&#x270B; <strong>Importante</strong>: Al este tipo de datos o clase que definimos para obtener el resultado de una consulta y que &#xFA;nicamente tienen como misi&#xF3;n transportar los datos de la consulta, se les denomina <strong><code>DTO</code></strong> <a href="https://es.wikipedia.org/wiki/Objeto_de_transferencia_de_datos">Data Transfer Object</a> y deben ser inmutables y tener la m&#xED;nima funcionalidad posible. Por eso el modificador <strong><code>record</code></strong> es el m&#xE1;s adecuado para definirlos.</p>
</blockquote>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token comment">// Definimos el tipo.</span>
<span class="token keyword keyword-record">record</span> <span class="token class-name">EmpleadosPorCiudadDto</span><span class="token punctuation">(</span><span class="token class-name">Ciudad</span> Ciudad<span class="token punctuation">,</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span></span> Empleados<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Podemos definir un valor de retorno con un tipo concreto para la secuencia.</span>
<span class="token comment">// En este caso hemos quitado la restricci&#xF3;n de mayores de 40 por simplificar.</span>
<span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>EmpleadosPorCiudadDto<span class="token punctuation">&gt;</span></span> <span class="token function">EmpleadosVentasPorCiudad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
Empleados<span class="token punctuation">.</span>DepartamentoDeVentas
            <span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Ciudad<span class="token punctuation">,</span>
                     <span class="token punctuation">(</span>c<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">EmpleadosPorCiudadDto</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">Ciudad</span><span class="token punctuation">:</span> c<span class="token punctuation">,</span> <span class="token named-parameter punctuation">Empleados</span><span class="token punctuation">:</span> g<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Al tener un tipo concreto, tambi&#xE9;n podemos modularizar la composici&#xF3;n de la salida.</span>
<span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">ATexto</span><span class="token punctuation">(</span><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>EmpleadosPorCiudadDto<span class="token punctuation">&gt;</span></span> empleadosXCiudad<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">StringBuilder</span> salida <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-var">var</span></span> eXc <span class="token keyword keyword-in">in</span> empleadosXCiudad<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        salida<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">eXc<span class="token punctuation">.</span>Ciudad</span><span class="token punctuation">}</span></span><span class="token string">:\n&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Empleado</span> e <span class="token keyword keyword-in">in</span> eXc<span class="token punctuation">.</span>Empleados<span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Edad<span class="token punctuation">)</span><span class="token punctuation">)</span>
            salida<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;\t</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">e</span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> salida<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Posteriormente hacer la llamada a las funciones.</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">ATexto</span><span class="token punctuation">(</span><span class="token function">EmpleadosVentasPorCiudad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     
</pre><p>En este caso no hemos filtrado por edad como hac&#xED;amos en el caso inicial. Pero si quisieramos hacerlo a posteiori, podr&#xED;amos hacerlo de la siguiente manera...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name"><span class="token keyword keyword-var">var</span></span> empleadosXCiudad <span class="token operator">=</span> <span class="token function">EmpleadosVentasPorCiudad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Mapeamos al mismo DTO pero filtrando la propiedad Empleados por edad.</span>
<span class="token comment">// F&#xED;jate que al ser inmutable EmpleadosPorCiudadDto, </span>
<span class="token comment">// para no tener que crear un nuevo objeto copiando propiedad a propiedad.</span>
<span class="token comment">// Usamos el operador with para crear una nueva instancia </span>
<span class="token comment">// con la propiedad Empleados filtrada.</span>
<span class="token class-name"><span class="token keyword keyword-var">var</span></span> empleadosXCiudadMas40 <span class="token operator">=</span> empleadosXCiudad<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>
    eXc <span class="token operator">=&gt;</span> eXc <span class="token keyword keyword-with">with</span> <span class="token punctuation">{</span> Empleados <span class="token operator">=</span> eXc<span class="token punctuation">.</span>Empleados<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Edad <span class="token operator">&gt;</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">ATexto</span><span class="token punctuation">(</span>empleadosXCiudadMas40<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     
</pre><h5 class="mume-header" id="resultado-del-grupby-en-un-diccionario">Resultado del GrupBy en un diccionario</h5>

<p>Pero, &#xBF;Habr&#xED;a la posibilidad de retornar la agrupaci&#xF3;n por clave sin tener que definir el tipo <strong><code>EmpleadosPorCiudadDto</code></strong>?. Podr&#xED;amos utilizar la posibilidad de transformar cualquier secuencia a las colecciones definidas en el lenguaje.</p>
<p>Por ejemplo vamos a definir la misma funci&#xF3;n <strong><code>EmpleadosVentasPorCiudad</code></strong> pero en lugar de retornar <strong><code>IEnumerable&lt;EmpleadosPorCiudadDto&gt;</code></strong> ahora retornar&#xE1; <strong><code>Dictionary&lt;Ciudad, List&lt;Empleado&gt;&gt;</code></strong> y as&#xED; no tendr&#xED;amos que definir el tipo.</p>
<p>Es f&#xE1;cil e inmediato transformar una secuencia a un array o una lista.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span></span> secuencia <span class="token operator">=</span> <span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">;</span>

<span class="token class-name">Empleado<span class="token punctuation">[</span><span class="token punctuation">]</span></span> arrayEmpleados <span class="token operator">=</span> secuencia<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span></span> listaEmpleados <span class="token operator">=</span> secuencia<span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Pero si queremos crear un diccionario, deber&#xED;amos poder indicarle de donde sacamos las claves y los valores asociados infiriendo en ambos casos los tipos parametrizados en el diccionario. Una vez m&#xE1;s nos ayudar&#xE1;n la funciones de orden superior (HOF) para hacerlo en este caso podemos usar la siguiente definici&#xF3;n de <strong><code>ToDictionary</code></strong>...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">Dictionary<span class="token punctuation">&lt;</span>TKey<span class="token punctuation">,</span> TElement<span class="token punctuation">&gt;</span></span> 
<span class="token generic-method"><span class="token function">ToDictionary</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TSource<span class="token punctuation">,</span> TKey<span class="token punctuation">,</span> TElement<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
                <span class="token keyword keyword-this">this</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">&gt;</span></span> source<span class="token punctuation">,</span>
                <span class="token class-name">Func<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">,</span> TKey<span class="token punctuation">&gt;</span></span> keySelector<span class="token punctuation">,</span> 
                <span class="token class-name">Func<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">,</span> TElement<span class="token punctuation">&gt;</span></span> elementSelector<span class="token punctuation">)</span> <span class="token keyword keyword-where">where</span> <span class="token class-name">TKey</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword keyword-notnull">notnull</span></span><span class="token punctuation">;</span>
</pre><p>Donde <strong><code>Func&lt;TSource, TKey&gt; keySelector</code></strong> nos ayudar&#xE1; a decidir que propiedad ser&#xE1; la clave del tipo an&#xF3;nimo de entrada <strong><code>TSource</code></strong> y <strong><code>Func&lt;TSource, TElement&gt; elementSelector)</code></strong> har&#xE1; el proceso an&#xE1;logo para el valor asociado a la clave. Quedando la funci&#xF3;n anterior.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">Dictionary<span class="token punctuation">&lt;</span>Ciudad<span class="token punctuation">,</span> List<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">EmpleadosVentasPorCiudad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
Empleados<span class="token punctuation">.</span>DepartamentoDeVentas
          <span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Ciudad<span class="token punctuation">,</span>
                <span class="token punctuation">(</span>c<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span> Ciudad <span class="token operator">=</span> c<span class="token punctuation">,</span> Empleados <span class="token operator">=</span> g <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">ToDictionary</span><span class="token punctuation">(</span>eXc <span class="token operator">=&gt;</span> eXc<span class="token punctuation">.</span>Ciudad<span class="token punctuation">,</span> eXc <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>eXc<span class="token punctuation">.</span>Empleados<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Por &#xFA;ltimo, queremos poder filtrar los empleados de ventas que queremos agrupar por ciudad por cualquier predicado. Una vez m&#xE1;s podremos aplicar programaci&#xF3;n funcional y pasar la estrategia de filtrado como par&#xE1;metro.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token comment">// En este caso no necesitamos un tipo concreto, podemos usar un diccionario.</span>
<span class="token comment">// y mejoramos la funcionalidad anterior para que admita un filtro mediante una HOF.</span>
<span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">Dictionary<span class="token punctuation">&lt;</span>Ciudad<span class="token punctuation">,</span> List<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> 
<span class="token function">EmpleadosVentasPorCiudad</span><span class="token punctuation">(</span><span class="token class-name">Func<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">,</span> <span class="token keyword keyword-bool">bool</span><span class="token punctuation">&gt;</span></span> filtroEmpleado<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
Empleados<span class="token punctuation">.</span>DepartamentoDeVentas
          <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>filtroEmpleado<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Ciudad<span class="token punctuation">,</span>
                <span class="token punctuation">(</span>c<span class="token punctuation">,</span> g<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span> Ciudad <span class="token operator">=</span> c<span class="token punctuation">,</span> Empleados <span class="token operator">=</span> g <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">ToDictionary</span><span class="token punctuation">(</span>eXc <span class="token operator">=&gt;</span> eXc<span class="token punctuation">.</span>Ciudad<span class="token punctuation">,</span> eXc <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>eXc<span class="token punctuation">.</span>Empleados<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">ATexto</span><span class="token punctuation">(</span><span class="token class-name">Dictionary<span class="token punctuation">&lt;</span>Ciudad<span class="token punctuation">,</span> List<span class="token punctuation">&lt;</span>Empleado<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> empleadosXCiudad<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">StringBuilder</span> salida <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> <span class="token punctuation">(</span>cuidad<span class="token punctuation">,</span> empleados<span class="token punctuation">)</span> <span class="token keyword keyword-in">in</span> empleadosXCiudad<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        salida<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">cuidad</span><span class="token punctuation">}</span></span><span class="token string">:\n&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Empleado</span> e <span class="token keyword keyword-in">in</span> empleados<span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Edad<span class="token punctuation">)</span><span class="token punctuation">)</span>
            salida<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;\t</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">e</span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> salida<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-var">var</span> empleadosVentasPorCiudadDeMasDe40A&#xF1;os <span class="token operator">=</span> 
    <span class="token function">EmpleadosVentasPorCiudad</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>Edad <span class="token operator">&gt;</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">ATexto</span><span class="token punctuation">(</span>empleadosVentasPorCiudadDeMasDe40A&#xF1;os<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><div style="page-break-after:always;"></div>
<h4 class="mume-header" id="zip">Zip</h4>

<p>Se trata de una <a href="https://en.wikipedia.org/wiki/Zipping_(computer_science)">operaci&#xF3;n t&#xED;pica en los lenguajes funcionales</a> al permitirnos manejar el concepto de tupla y que por tanto podemos <a href="https://docs.microsoft.com/es-es/dotnet/api/system.linq.enumerable.zip">encontrar tambi&#xE9;n en C#</a> ya que tambi&#xE9;n nos los permite.</p>
<p>B&#xE1;sicamente realiza una correspondencia un&#xED;voca entre los elementos de <strong>dos</strong> o m&#xE1;s secuencias iterables, produciendo una <strong>nueva secuencia de tuplas</strong> resultado de dicha correspondencia. Obviamente, su nombre viene de la analog&#xED;a de cerrar una cremallera.</p>
<p>Supongamos <strong>Sec[A]</strong> = [&#x1F42E;, &#x1F41F;, &#x1F360;, &#x1F414;, &#x1F33D;] y <strong>Sec[B]</strong> = [&#x1F354;, &#x1F365;, &#x1F35F;, &#x1F357;, &#x1F37F;]</p>
<p><strong>zip(Sec[A], Sec[B])</strong> = [ <strong>(</strong>&#x1F42E;, &#x1F354;<strong>)</strong>, <strong>(</strong>&#x1F41F;, &#x1F365;<strong>)</strong> , <strong>(</strong>&#x1F360;, &#x1F35F;<strong>)</strong>, <strong>(</strong>&#x1F414;, &#x1F357;<strong>)</strong>, <strong>(</strong>&#x1F33D;, &#x1F37F;<strong>)</strong> ]</p>
<p><strong>Ejemplo:</strong> Supongamos que tenemos dos arrays. Uno con nombres de pa&#xED;s y otro su poblaci&#xF3;n en millones de habitantes. Queremos mostrar una correlaci&#xF3;n entre ambos arrays por pantalla en forma de texto. Una aproximaci&#xF3;n funcional a la soluci&#xF3;n desde C# podr&#xED;a ser...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> paises <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;China&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;India&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Estados Unidos&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Indonesia&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> poblaciones <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1391</span><span class="token punctuation">,</span> <span class="token number">1364</span><span class="token punctuation">,</span> <span class="token number">327</span><span class="token punctuation">,</span> <span class="token number">264</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword keyword-string">string</span></span> salida  <span class="token operator">=</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">,</span>
                 paises<span class="token punctuation">.</span><span class="token function">Zip</span><span class="token punctuation">(</span>poblaciones<span class="token punctuation">)</span>
                       <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> <span class="token interpolation-string"><span class="token string">$&quot;Poblaci&#xF3;n </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">t<span class="token punctuation">.</span>First</span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">t<span class="token punctuation">.</span>Second</span><span class="token punctuation">}</span></span><span class="token string"> millones.&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>salida<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Mostrar&#xE1; por pantalla...</p>
<pre data-role="codeBlock" data-info="txt" class="language-txt">Poblaci&#xF3;n China 1391 millones.        
Poblaci&#xF3;n India 1364 millones.        
Poblaci&#xF3;n Estados Unidos 327 millones.
Poblaci&#xF3;n Indonesia 264 millones.
</pre><p>F&#xED;jate que la funci&#xF3;n <strong><code>paises.Zip(poblaciones)</code></strong> me genera una secuencia de tuplas del tipo <strong><code>(string , int)</code></strong> &#x2192; <code>[(&quot;China&quot;, 1391), (India, 1364)], ... ]</code> y posteriormente en la funci&#xF3;n de mapeo genera una nueva secuencia de cadenas componiendo los elementos de la tupla <strong>t</strong>.</p>
<div style="page-break-after:always;"></div>
<blockquote>
<p>&#x1F4CC; <strong>Nota:</strong> La operaci&#xF3;n inversa <strong>Unzip</strong> no est&#xE1; definida en el lenguaje porque se puede realizar f&#xE1;cilmente con un mapeo...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-string">string</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span> datos <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token string">&quot;China&quot;</span><span class="token punctuation">,</span> <span class="token number">1391</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;India&quot;</span><span class="token punctuation">,</span> <span class="token number">1364</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;Estados Unidos&quot;</span><span class="token punctuation">,</span> <span class="token number">327</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;Indonesia&quot;</span><span class="token punctuation">,</span> <span class="token number">264</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> paises <span class="token operator">=</span> datos<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>Item1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> poblacion <span class="token operator">=</span> datos<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>Item2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></blockquote>
<p>Si quisieramos hacer un <strong><code>Zip</code></strong> de tres secuencias o m&#xE1;s secuencias, podr&#xED;amos aplicar la funci&#xF3;n varias veces. En el siguiente ejemplo vamos acombinar los varires de tres vectores en una tupla de tres elementos correpondientes a coordenas en el espacio.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> v1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> v2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> v3 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> x<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> y<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> z<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span> agrupacion <span class="token operator">=</span> v1
    <span class="token comment">// Combinamos v1 con v2</span>
    <span class="token punctuation">.</span><span class="token function">Zip</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> <span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token comment">// Combinamos las tuplas resultantes con v3</span>
    <span class="token punctuation">.</span><span class="token function">Zip</span><span class="token punctuation">(</span>v3<span class="token punctuation">,</span> <span class="token punctuation">(</span>t12<span class="token punctuation">,</span> d3<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>t12<span class="token punctuation">.</span>d1<span class="token punctuation">,</span> t12<span class="token punctuation">.</span>d2<span class="token punctuation">,</span> d3<span class="token punctuation">)</span><span class="token punctuation">)</span>  
    <span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token keyword keyword-var">var</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token keyword keyword-in">in</span> agrupacion<span class="token punctuation">)</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;(</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">x</span><span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">y</span><span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">z</span><span class="token punctuation">}</span></span><span class="token string">)&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><div style="page-break-after:always;"></div>
<h4 class="mume-header" id="flatmap-o-aplanado">FlatMap o Aplanado</h4>

<p>La operaci&#xF3;n de aplanado es otra de las funciones t&#xED;picas de la programaci&#xF3;n funcional que vamos a encontrar en todos los lenguajes funcionales y otros como JavaScript, Java o C#. A este tipo de HOF se le conoce como <strong><a href="https://es.wikipedia.org/wiki/M%C3%B3nada_(programaci%C3%B3n_funcional)">m&#xF3;nada</a></strong> porque cumple ciertas operaciones matem&#xE1;ticas en la que no vamos a entrar por estar fuera del tema, pero que si has visto la <strong><a href="https://es.wikipedia.org/wiki/M%C3%B3nada_(programaci%C3%B3n_funcional)#Definici%C3%B3n_Formal">definici&#xF3;n formal</a></strong> del enlace anterior seguramente no te hayas enterado de nada si no tienes una profunda base matem&#xE1;tica del la teor&#xED;a de categor&#xED;as.</p>
<p>Pero siguiendo la analog&#xED;a que hemos usado en el tema, podemos definirla como:<br>
<strong>flatMap = Sec[A] x (A &#x2192; Sec[B]) &#x2192; Sec[B]</strong></p>
<p>Donde dada una <strong>Sec[A]</strong> le vamos a aplicar una funci&#xF3;n <strong>A &#x2192; Sec[B]</strong> donde para cada elemento de <strong>A</strong> produce una secuencia de <strong>B</strong> <strong>Sec[B]</strong> y el resultado ser&#xE1; una <strong>Sec[B]</strong> resultado de <strong>unir</strong> todas los <strong>Sec[B]</strong> producidos por cada <strong>A</strong>.</p>
<p><strong>&#xBF;Sigue sin quedar claro?</strong>. No pasa nada, vamos a verlo a trav&#xE9;s de un ejemplo sencillo, pero esta vez en lugar de usar iconos, vamos a usar enteros y programa sencillo en C#.</p>
<p>En primer lugar comentaremos que la funci&#xF3;n equivalente en C# que m&#xE1;s se aproxima a esta definici&#xF3;n b&#xE1;sica de <strong>FlatMap</strong> es <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.linq.enumerable.selectmany#system-linq-enumerable-selectmany-2(system-collections-generic-ienumerable((-0))-system-func((-0-system-collections-generic-ienumerable((-1)))))">SelectMany</a></strong> y en concreto la sobrecarga siguiente:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>B<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">SelectMany</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>A<span class="token punctuation">,</span> B<span class="token punctuation">&gt;</span></span></span> <span class="token punctuation">(</span>
                            <span class="token keyword keyword-this">this</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>TSource<span class="token punctuation">&gt;</span></span> source<span class="token punctuation">,</span>
                            <span class="token class-name">Func<span class="token punctuation">&lt;</span>A<span class="token punctuation">,</span> IEnumerable<span class="token punctuation">&lt;</span>B<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Supongamos la siguiente de representaci&#xF3;n donde tenemos el t&#xED;pico array de arrays o tabla dentada. En el fondo, podemos considerarlo como una secuencia de secuencias (sub-secuencias) de enteros:</p>
<p align="center" style="zoom:0.7"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="680pt" height="231pt" viewBox="0.00 0.00 680.00 231.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 227)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-227 676,-227 676,4 -4,4"/>
<!-- ot1 -->
<g id="node1" class="node">
<title>ot1</title>
<polygon fill="none" stroke="#000000" points="42,-185 42,-219 76,-219 76,-185 42,-185"/>
<polygon fill="none" stroke="#000000" points="76,-185 76,-219 110,-219 110,-185 76,-185"/>
<polygon fill="none" stroke="#000000" points="110,-185 110,-219 144,-219 144,-185 110,-185"/>
<polygon fill="none" stroke="#000000" points="144,-185 144,-219 178,-219 178,-185 144,-185"/>
</g>
<!-- ot11 -->
<g id="node2" class="node">
<title>ot11</title>
<polygon fill="none" stroke="#000000" points="11,-72 11,-106 44,-106 44,-72 11,-72"/>
<text text-anchor="start" x="19.7174" y="-84.4" font-family="Arial" font-size="14.00" fill="#000000">11</text>
<polygon fill="none" stroke="#000000" points="11,-38 11,-72 44,-72 44,-38 11,-38"/>
<text text-anchor="start" x="19.7174" y="-50.4" font-family="Arial" font-size="14.00" fill="#000000">22</text>
</g>
<!-- ot1&#45;&gt;ot11 -->
<g id="edge1" class="edge">
<title>ot1:c-&gt;ot11:n</title>
<path fill="none" stroke="#000000" d="M52.981,-184.6955C46.3185,-165.5407 35.8115,-135.3331 30.4284,-119.8565"/>
<polygon fill="#000000" stroke="#000000" points="27,-110 34.5355,-117.9666 28.6426,-114.7225 30.2853,-119.445 30.2853,-119.445 30.2853,-119.445 28.6426,-114.7225 26.035,-120.9233 27,-110 27,-110"/>
</g>
<!-- ot12 -->
<g id="node3" class="node">
<title>ot12</title>
<polygon fill="none" stroke="#000000" points="66,-89 66,-123 99,-123 99,-89 66,-89"/>
<text text-anchor="start" x="74.7174" y="-101.4" font-family="Arial" font-size="14.00" fill="#000000">34</text>
<polygon fill="none" stroke="#000000" points="66,-55 66,-89 99,-89 99,-55 66,-55"/>
<text text-anchor="start" x="74.7174" y="-67.4" font-family="Arial" font-size="14.00" fill="#000000">35</text>
<polygon fill="none" stroke="#000000" points="66,-21 66,-55 99,-55 99,-21 66,-21"/>
<text text-anchor="start" x="74.7174" y="-33.4" font-family="Arial" font-size="14.00" fill="#000000">29</text>
</g>
<!-- ot1&#45;&gt;ot12 -->
<g id="edge2" class="edge">
<title>ot1:c-&gt;ot12:n</title>
<path fill="none" stroke="#000000" d="M90.5039,-184.9813C88.3487,-170.2869 85.3059,-149.5399 83.5046,-137.2589"/>
<polygon fill="#000000" stroke="#000000" points="82,-127 87.9036,-136.2411 82.7256,-131.9471 83.4512,-136.8942 83.4512,-136.8942 83.4512,-136.8942 82.7256,-131.9471 78.9989,-137.5472 82,-127 82,-127"/>
</g>
<!-- ot13 -->
<g id="node4" class="node">
<title>ot13</title>
<polygon fill="none" stroke="#000000" points="121,-55 121,-89 154,-89 154,-55 121,-55"/>
<text text-anchor="start" x="129.7174" y="-67.4" font-family="Arial" font-size="14.00" fill="#000000">10</text>
</g>
<!-- ot1&#45;&gt;ot13 -->
<g id="edge3" class="edge">
<title>ot1:c-&gt;ot13:n</title>
<path fill="none" stroke="#000000" d="M128.5625,-184.9688C130.6719,-161.9766 134.3633,-121.7402 136.0771,-103.0591"/>
<polygon fill="#000000" stroke="#000000" points="137,-93 140.5675,-103.3693 136.5432,-97.9791 136.0863,-102.9582 136.0863,-102.9582 136.0863,-102.9582 136.5432,-97.9791 131.6051,-102.547 137,-93 137,-93"/>
</g>
<!-- ot14 -->
<g id="node5" class="node">
<title>ot14</title>
<polygon fill="none" stroke="#000000" points="176,-106 176,-140 209,-140 209,-106 176,-106"/>
<text text-anchor="start" x="184.7174" y="-118.4" font-family="Arial" font-size="14.00" fill="#000000">17</text>
<polygon fill="none" stroke="#000000" points="176,-72 176,-106 209,-106 209,-72 176,-72"/>
<text text-anchor="start" x="184.7174" y="-84.4" font-family="Arial" font-size="14.00" fill="#000000">14</text>
<polygon fill="none" stroke="#000000" points="176,-38 176,-72 209,-72 209,-38 176,-38"/>
<text text-anchor="start" x="184.7174" y="-50.4" font-family="Arial" font-size="14.00" fill="#000000">30</text>
<polygon fill="none" stroke="#000000" points="176,-4 176,-38 209,-38 209,-4 176,-4"/>
<text text-anchor="start" x="184.7174" y="-16.4" font-family="Arial" font-size="14.00" fill="#000000">31</text>
</g>
<!-- ot1&#45;&gt;ot14 -->
<g id="edge4" class="edge">
<title>ot1:c-&gt;ot14:n</title>
<path fill="none" stroke="#000000" d="M170.1334,-184.9118C175.7056,-174.4863 182.6066,-161.5747 187.1477,-153.0784"/>
<polygon fill="#000000" stroke="#000000" points="192,-144 191.2549,-154.9405 189.6431,-148.4097 187.2862,-152.8193 187.2862,-152.8193 187.2862,-152.8193 189.6431,-148.4097 183.3175,-150.6981 192,-144 192,-144"/>
</g>
<!-- otFlat -->
<g id="node6" class="node">
<title>otFlat</title>
<polygon fill="none" stroke="#000000" points="334,-185 334,-219 367,-219 367,-185 334,-185"/>
<text text-anchor="start" x="342.7174" y="-197.4" font-family="Arial" font-size="14.00" fill="#000000">11</text>
<polygon fill="none" stroke="#000000" points="367,-185 367,-219 400,-219 400,-185 367,-185"/>
<text text-anchor="start" x="375.7174" y="-197.4" font-family="Arial" font-size="14.00" fill="#000000">22</text>
<polygon fill="none" stroke="#000000" points="400,-185 400,-219 433,-219 433,-185 400,-185"/>
<text text-anchor="start" x="408.7174" y="-197.4" font-family="Arial" font-size="14.00" fill="#000000">34</text>
<polygon fill="none" stroke="#000000" points="433,-185 433,-219 466,-219 466,-185 433,-185"/>
<text text-anchor="start" x="441.7174" y="-197.4" font-family="Arial" font-size="14.00" fill="#000000">35</text>
<polygon fill="none" stroke="#000000" points="466,-185 466,-219 499,-219 499,-185 466,-185"/>
<text text-anchor="start" x="474.7174" y="-197.4" font-family="Arial" font-size="14.00" fill="#000000">29</text>
<polygon fill="none" stroke="#000000" points="499,-185 499,-219 532,-219 532,-185 499,-185"/>
<text text-anchor="start" x="507.7174" y="-197.4" font-family="Arial" font-size="14.00" fill="#000000">10</text>
<polygon fill="none" stroke="#000000" points="532,-185 532,-219 565,-219 565,-185 532,-185"/>
<text text-anchor="start" x="540.7174" y="-197.4" font-family="Arial" font-size="14.00" fill="#000000">17</text>
<polygon fill="none" stroke="#000000" points="565,-185 565,-219 598,-219 598,-185 565,-185"/>
<text text-anchor="start" x="573.7174" y="-197.4" font-family="Arial" font-size="14.00" fill="#000000">14</text>
<polygon fill="none" stroke="#000000" points="598,-185 598,-219 631,-219 631,-185 598,-185"/>
<text text-anchor="start" x="606.7174" y="-197.4" font-family="Arial" font-size="14.00" fill="#000000">30</text>
<polygon fill="none" stroke="#000000" points="631,-185 631,-219 664,-219 664,-185 631,-185"/>
<text text-anchor="start" x="639.7174" y="-197.4" font-family="Arial" font-size="14.00" fill="#000000">31</text>
</g>
<!-- ot1&#45;&gt;otFlat -->
<g id="edge5" class="edge">
<title>ot1-&gt;otFlat</title>
<path fill="none" stroke="#0000ff" d="M186.3897,-202C223.5977,-202 270.0867,-202 315.7463,-202"/>
<polygon fill="none" stroke="#0000ff" points="315.7799,-205.5001 325.7798,-202 315.7798,-198.5001 315.7799,-205.5001"/>
<text text-anchor="middle" x="256" y="-209.2" font-family="Arial" font-size="14.00" fill="#0000ff">Flat o Aplanado</text>
</g>
</g>
</svg>
</p><p>Si te fijas en el diagrama podemos ver que la operaci&#xF3;n de flat consiste en generar una nueva secuencia con datos de las sub-secuencias de entrada. El efecto es como si estuvi&#xE9;ramos &apos;<em>aplanando</em>&apos; la tabla dentada.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> jagged <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">{</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">{</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">{</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// SelectMany = int[][] &#x2192; (int[] &#x2192; int[]) &#x2192; int[]</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> flat <span class="token operator">=</span> jagged<span class="token punctuation">.</span><span class="token function">SelectMany</span><span class="token punctuation">(</span>v <span class="token operator">=&gt;</span> v<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">,</span> flat<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Mostrar&#xE1; por pantalla: 11, 22, 34, 25, 29, 10, 17, 14, 30, 31</span>
</pre><p>Vemos un ejemplo m&#xE1;s ilustrativo de este tipo de operaci&#xF3;n con tipos m&#xE1;s elaborados.</p>
<p>Supongamos que la siguiente t&#xED;pica relaci&#xF3;n de cardinalidad uno a varios entre <strong><code>Autor</code></strong> y <strong><code>Libro</code></strong>. Donde suponemos que un autor ha escrito uno o varios libros y que modelizaremos de la siguiente manera...</p>
<p align="center" style="zoom:1"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" contentscripttype="application/ecmascript" contentstyletype="text/css" height="102px" preserveAspectRatio="none" style="width:377px;height:102px;background:#FFFFFF;" version="1.1" viewBox="0 0 377 102" width="377px" zoomAndPan="magnify"><defs><filter height="300%" id="fq8r543bijr7j" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[7b7d686d3dc2c644927357cb508758fd]
class Autor--><rect codeline="13" fill="#FFFFFF" filter="url(#fq8r543bijr7j)" height="81.5078" id="Autor" style="stroke:#000000;stroke-width:1.5;" width="167" x="7" y="7"/><ellipse cx="72.25" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><path d="M75.0156,18.875 Q75.1719,18.6563 75.3594,18.5469 Q75.5469,18.4375 75.7656,18.4375 Q76.1406,18.4375 76.375,18.6953 Q76.6094,18.9531 76.6094,19.5625 L76.6094,21.0156 Q76.6094,21.625 76.375,21.8906 Q76.1406,22.1563 75.7656,22.1563 Q75.4219,22.1563 75.2188,21.9531 Q75.0156,21.7656 74.9063,21.25 Q74.8594,20.8906 74.6719,20.7031 Q74.3438,20.3281 73.7344,20.1094 Q73.125,19.8906 72.5,19.8906 Q71.7344,19.8906 71.1016,20.2188 Q70.4688,20.5469 69.9766,21.2969 Q69.4844,22.0469 69.4844,23.0781 L69.4844,24.1719 Q69.4844,25.4063 70.375,26.2266 Q71.2656,27.0469 72.8594,27.0469 Q73.7969,27.0469 74.4531,26.7969 Q74.8438,26.6406 75.2656,26.2031 Q75.5313,25.9375 75.6797,25.8594 Q75.8281,25.7813 76.0313,25.7813 Q76.3594,25.7813 76.6172,26.0391 Q76.875,26.2969 76.875,26.6406 Q76.875,26.9844 76.5313,27.3906 Q76.0313,27.9688 75.2344,28.2969 Q74.1563,28.75 72.8594,28.75 Q71.3438,28.75 70.1406,28.125 Q69.1563,27.625 68.4688,26.5547 Q67.7813,25.4844 67.7813,24.2031 L67.7813,23.0469 Q67.7813,21.7188 68.3984,20.5703 Q69.0156,19.4219 70.1094,18.8047 Q71.2031,18.1875 72.4375,18.1875 Q73.1719,18.1875 73.8203,18.3516 Q74.4688,18.5156 75.0156,18.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="28" x="92.75" y="27.9102">Autor</text><line style="stroke:#000000;stroke-width:1.5;" x1="8" x2="173" y1="39" y2="39"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="131" x="13" y="54.4189">-nombre : string {readOnly}</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="155" x="13" y="68.2549">-nacionalidad : string {readOnly}</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="148" x="13" y="82.0908">-muerte : DateTime  {readOnly}</text><!--MD5=[a48731e35e4efcfa96e52c126b9a7dad]
class Libro--><rect codeline="20" fill="#FFFFFF" filter="url(#fq8r543bijr7j)" height="81.5078" id="Libro" style="stroke:#000000;stroke-width:1.5;" width="129" x="234" y="7"/><ellipse cx="280.25" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><path d="M283.0156,18.875 Q283.1719,18.6563 283.3594,18.5469 Q283.5469,18.4375 283.7656,18.4375 Q284.1406,18.4375 284.375,18.6953 Q284.6094,18.9531 284.6094,19.5625 L284.6094,21.0156 Q284.6094,21.625 284.375,21.8906 Q284.1406,22.1563 283.7656,22.1563 Q283.4219,22.1563 283.2188,21.9531 Q283.0156,21.7656 282.9063,21.25 Q282.8594,20.8906 282.6719,20.7031 Q282.3438,20.3281 281.7344,20.1094 Q281.125,19.8906 280.5,19.8906 Q279.7344,19.8906 279.1016,20.2188 Q278.4688,20.5469 277.9766,21.2969 Q277.4844,22.0469 277.4844,23.0781 L277.4844,24.1719 Q277.4844,25.4063 278.375,26.2266 Q279.2656,27.0469 280.8594,27.0469 Q281.7969,27.0469 282.4531,26.7969 Q282.8438,26.6406 283.2656,26.2031 Q283.5313,25.9375 283.6797,25.8594 Q283.8281,25.7813 284.0313,25.7813 Q284.3594,25.7813 284.6172,26.0391 Q284.875,26.2969 284.875,26.6406 Q284.875,26.9844 284.5313,27.3906 Q284.0313,27.9688 283.2344,28.2969 Q282.1563,28.75 280.8594,28.75 Q279.3438,28.75 278.1406,28.125 Q277.1563,27.625 276.4688,26.5547 Q275.7813,25.4844 275.7813,24.2031 L275.7813,23.0469 Q275.7813,21.7188 276.3984,20.5703 Q277.0156,19.4219 278.1094,18.8047 Q279.2031,18.1875 280.4375,18.1875 Q281.1719,18.1875 281.8203,18.3516 Q282.4688,18.5156 283.0156,18.875 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="28" x="300.75" y="27.9102">Libro</text><line style="stroke:#000000;stroke-width:1.5;" x1="235" x2="362" y1="39" y2="39"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="117" x="240" y="54.4189">-titulo : string {readOnly}</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="97" x="240" y="68.2549">-a&#xF1;o : int {readOnly}</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="117" x="240" y="82.0908">-paginas : int {readOnly}</text><!--MD5=[68315527efe0e3dab3e7f21743c1acda]
reverse link Autor to Libro--><path codeline="9" d="M187.3,48 C203.11,48 219.15,48 233.91,48 " fill="none" id="Autor-backto-Libro" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#FFFFFF" points="174.1,48,180.1,52,186.1,48,180.1,44,174.1,48" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="182.1295" y="62.2715">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="221.1527" y="62.4689">*</text><!--MD5=[0d96a1cd5dc5c044c5277700efab0da4]
@startuml

left to right direction
skinparam classAttributeIconSize 0
skinparam ArrowColor Black
skinparam PackageBackgroundColor WhiteSmoke
skinparam ClassBorderColor Black
skinparam ClassBackgroundColor Transparent

Autor "1" o- - "*" Libro

hide class methods

class Autor
{
    - nombre : string {readOnly}
    - nacionalidad : string {readOnly}
    - muerte : DateTime  {readOnly}
}

class Libro
{
    - titulo : string {readOnly}
    - año : int {readOnly}
    - paginas : int {readOnly}
}

@enduml

PlantUML version 1.2021.12(Tue Oct 05 18:01:58 CEST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: es
Country: ES
--></g></svg></p><blockquote>
<p>&#x1F4CC; <strong>Nota:</strong> Para simplificar, puedes descargarte el c&#xF3;digo de las clases y la carga inicial de datos del siguiente c&#xF3;digo <a href="https://programacioniesbalmis.github.io/B8-Programacion_Funcional/DatosAutoresTema_11_4_ejemplo.cs">DatosAutoresTema_11_4.cs</a>.</p>
</blockquote>
<p>El programa generar&#xE1; una <strong>secuencia de autores</strong> que mostrar&#xE1; al ejecutarse y que<br>
contendr&#xE1; los siguientes autores:</p>
<pre data-role="codeBlock" data-info="txt" class="language-txt">Nombre: William Shakespeare
Nacionalidad: Inglesa
Muerte: 03/05/1616
Libros:
        Titulo: Macbeth                                A&#xF1;o: 1623  P&#xE1;ginas: 128
        Titulo: La tempestad                           A&#xF1;o: 1611  P&#xE1;ginas: 160
</pre><pre data-role="codeBlock" data-info="txt" class="language-txt">Nombre: Miguel de Cervantes
Nacionalidad: Espa&#xF1;ola
Muerte: 22/06/1616
Libros:
        Titulo: Don Quijote de la Mancha               A&#xF1;o: 1605  P&#xE1;ginas: 1376
        Titulo: La Galatea                             A&#xF1;o: 1585  P&#xE1;ginas: 664
        Titulo: Los trabajos de Persiles y Sigismunda  A&#xF1;o: 1617  P&#xE1;ginas: 888
        Titulo: Novelas ejemplares                     A&#xF1;o: 1613  P&#xE1;ginas: 1160
</pre><pre data-role="codeBlock" data-info="txt" class="language-txt">Nombre: Fernando de Rojas
Nacionalidad: Espa&#xF1;ola
Muerte: 07/02/1541
Libros:
        Titulo: La Celestina                           A&#xF1;o: 1500  P&#xE1;ginas: 160
</pre><p>Con las funciones que hemos visto hasta el momento podr&#xED;amos hacer consultas sobre los autores. Por ejemplo, para ver aquellos autores que han publicado alg&#xFA;n libro en el siglo XVII podr&#xED;amos hacer...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>Autor<span class="token punctuation">&gt;</span></span> autoresConLibrosPublicadosDuranteSigloXVII <span class="token operator">=</span>
Datos<span class="token punctuation">.</span>Autores<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Libros<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>l <span class="token operator">=&gt;</span> l<span class="token punctuation">.</span>A&#xF1;o <span class="token operator">&gt;</span> <span class="token number">1600</span> <span class="token operator">&amp;&amp;</span> l<span class="token punctuation">.</span>A&#xF1;o <span class="token operator">&lt;</span> <span class="token number">1701</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Pero, si quisi&#xE9;ramos obtener los libros publicados en el siglo XVII a partir de la secuencia de autores. Ahora tendr&#xED;amos un caso de uso de <strong><code>SelectMany</code></strong> (Flat Map):</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token comment">// IEnumerable&lt;Autor&gt; x (Autor &#x2192; IEnumerable&lt;Libro&gt;) &#x2192; IEnumerable&lt;Libro&gt;</span>
<span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>Libro<span class="token punctuation">&gt;</span></span> librosSigloXVII <span class="token operator">=</span>
Datos<span class="token punctuation">.</span>Autores<span class="token punctuation">.</span><span class="token function">SelectMany</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Libros<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>l <span class="token operator">=&gt;</span> l<span class="token punctuation">.</span>A&#xF1;o <span class="token operator">&gt;</span> <span class="token number">1600</span> <span class="token operator">&amp;&amp;</span> l<span class="token punctuation">.</span>A&#xF1;o <span class="token operator">&lt;</span> <span class="token number">1701</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Incluso podr&#xED;amos <strong>generar una correlaci&#xF3;n</strong> entre <strong><code>Libros</code></strong> y <strong><code>Autor</code></strong> proyectando cada libro que cumple la condici&#xF3;n a una nueva secuencia de objetos an&#xF3;nimos o DTO que tuviese datos del autor del libro.</p>
<p>Por ejemplo, si quisi&#xE9;semos obtener una vista libro, autor y n&#xFA;mero de p&#xE1;ginas de aquellos libros que tienen menos de mil p&#xE1;ginas y crear una secuencia tipada con un DTO podr&#xED;amos hacer por ejemplo...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-record">record</span> <span class="token class-name">LibroDto</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> Libro<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> Autor<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> Paginas<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// IEnumerable&lt;Autor&gt; x (Autor &#x2192; IEnumerable&lt;LibroDto&gt;) &#x2192; IEnumerable&lt;LibroDto&gt;</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>LibroDto<span class="token punctuation">&gt;</span></span> <span class="token function">LibrosDeMenosdeMilPaginas</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    Datos<span class="token punctuation">.</span>Autores<span class="token punctuation">.</span><span class="token function">SelectMany</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Libros
                                   <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>l <span class="token operator">=&gt;</span> l<span class="token punctuation">.</span>Paginas <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">)</span>
                                   <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>l <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">LibroDto</span><span class="token punctuation">(</span>
                                    <span class="token named-parameter punctuation">Libro</span><span class="token punctuation">:</span> l<span class="token punctuation">.</span>Titulo<span class="token punctuation">,</span> <span class="token named-parameter punctuation">Autor</span><span class="token punctuation">:</span> a<span class="token punctuation">.</span>Nombre<span class="token punctuation">,</span> <span class="token named-parameter punctuation">Paginas</span><span class="token punctuation">:</span> l<span class="token punctuation">.</span>Paginas<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Una vez tenemos la secuencia de salida con los objetos an&#xF3;nimos de la proyecci&#xF3;n. </span>
    <span class="token comment">// Podemos mostrarla en forma de tabla de la siguiente forma ...</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>LibroDto<span class="token punctuation">&gt;</span></span> datos<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> separadorDato<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    datos<span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span>separadorDato<span class="token punctuation">,</span> 
                    <span class="token punctuation">(</span>salida<span class="token punctuation">,</span> tupla<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> 
                    salida <span class="token operator">+=</span> <span class="token interpolation-string"><span class="token string">$&quot;Libro: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">tupla<span class="token punctuation">.</span>Libro</span><span class="token punctuation">}</span></span><span class="token string">\nAutor: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">tupla<span class="token punctuation">.</span>Autor</span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span> <span class="token operator">+</span>
                              <span class="token interpolation-string"><span class="token string">$&quot;Paginas: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">tupla<span class="token punctuation">.</span>Paginas</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">separadorDato</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><p>Posteriormente si ejecutamos ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp">Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>LibroDto<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>LibroDto<span class="token punctuation">.</span><span class="token function">LibrosDeMenosdeMilPaginas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> SeparadorDato<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Generando la siguiente salida por consola...</p>
<pre data-role="codeBlock" data-info="txt" class="language-txt">--------------------------------------------------------------------------------
Libro: Macbeth
Autor: William Shakespeare
Paginas: 128
--------------------------------------------------------------------------------
Libro: La tempestad
Autor: William Shakespeare
Paginas: 160
--------------------------------------------------------------------------------
Libro: La Galatea
Autor: Miguel de Cervantes
Paginas: 664
--------------------------------------------------------------------------------
Libro: Los trabajos de Persiles y Sigismunda
Autor: Miguel de Cervantes
Paginas: 888
--------------------------------------------------------------------------------
Libro: La Celestina
Autor: Fernando de Rojas
Paginas: 160
--------------------------------------------------------------------------------
</pre><div style="page-break-after:always;"></div>
<blockquote>
<p>&#x1F393; <strong>Caso de estudio:</strong></p>
<p>Vamos a realizar varias consultas sobre el c&#xF3;digo del ejemplo anterior donde tenemos libros por autor.<br>
&#x270B; <strong>Intenta pensarlas sin mirar la propuesta de soluci&#xF3;n.</strong></p>
<ol>
<li>
<p>Autores con <strong>m&#xE1;s de un</strong> libro.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name"><span class="token keyword keyword-var">var</span></span> snapshot <span class="token operator">=</span> Datos<span class="token punctuation">.</span>Autores<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Libros<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span>SeparadorDato<span class="token punctuation">,</span>
                              <span class="token punctuation">(</span>salida<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> salida <span class="token operator">+=</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">a</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">SeparadorDato</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></li>
<li>
<p>Total de libros escritos por escritores Espa&#xF1;oles.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name"><span class="token keyword keyword-var">var</span></span> totalLibros <span class="token operator">=</span> Datos<span class="token punctuation">.</span>Autores<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Nacionalidad <span class="token operator">==</span> <span class="token string">&quot;Espa&#xF1;ola&quot;</span><span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>t<span class="token punctuation">,</span> a<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> t <span class="token operator">+=</span> a<span class="token punctuation">.</span>Libros<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Otra opci&#xF3;n m&#xE1;s legible utilizando SelectMany ser&#xED;a...</span>
<span class="token class-name"><span class="token keyword keyword-var">var</span></span> totalLibros <span class="token operator">=</span> Datos<span class="token punctuation">.</span>Autores<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Nacionalidad <span class="token operator">==</span> <span class="token string">&quot;Espa&#xF1;ola&quot;</span><span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">SelectMany</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Libros<span class="token punctuation">)</span>
                               <span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Hay </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">totalLibros</span><span class="token punctuation">}</span></span><span class="token string"> escritos por espa&#xF1;oles&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></li>
<li>
<p>Muestra el <strong>nombre del autor</strong> y <strong>a&#xF1;o de la muerte</strong> agrupando los autores por siglo en el que murieron en orden ascendente de siglo.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name"><span class="token keyword keyword-var">var</span></span> snapShot <span class="token operator">=</span>
Datos<span class="token punctuation">.</span>Autores<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span> Autor <span class="token operator">=</span> a<span class="token punctuation">.</span>Nombre<span class="token punctuation">,</span> A&#xF1;oMuerte <span class="token operator">=</span> a<span class="token punctuation">.</span>Muerte<span class="token punctuation">.</span>Year <span class="token punctuation">}</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>A&#xF1;oMuerte<span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>A&#xF1;oMuerte <span class="token operator">/</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
                      <span class="token punctuation">(</span>siglo<span class="token punctuation">,</span> autores<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword keyword-new">new</span> <span class="token punctuation">{</span> Siglo <span class="token operator">=</span> siglo<span class="token punctuation">,</span> Autores <span class="token operator">=</span> autores <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>snapShot<span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span>SeparadorDato<span class="token punctuation">,</span> <span class="token punctuation">(</span>salida<span class="token punctuation">,</span> aXs<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
salida <span class="token operator">+=</span> <span class="token interpolation-string"><span class="token string">$&quot;Siglo: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">aXs<span class="token punctuation">.</span>Siglo</span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span> 
<span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">aXs<span class="token punctuation">.</span>Autores<span class="token punctuation">.</span><span class="token function">Aggregate</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> 
                           <span class="token punctuation">(</span>t<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token operator">=&gt;</span> t <span class="token operator">+=</span> <span class="token interpolation-string"><span class="token string">$&quot;\t</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">a<span class="token punctuation">.</span>Autor</span><span class="token punctuation">}</span></span><span class="token string"> muerto en </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">a<span class="token punctuation">.</span>A&#xF1;oMuerte</span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span><span class="token punctuation">)</span>
    </span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span> <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">SeparadorDato</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>&#x270B; <strong>Importante:</strong> Aunque en este caso hemos utilizado programaci&#xF3;n funcional para mostrar el resultado. Este ser&#xED;a el t&#xED;pico caso donde <strong>por legibilidad</strong> y <strong>claridad de c&#xF3;digo</strong> ser&#xED;a m&#xE1;s interesante usar el esquema tradicional de componer un <strong><code>StringBuilder</code></strong> con bucles.</p>
</li>
</ol>
</blockquote>
<div style="page-break-after:always;"></div>
<blockquote>
<ol start="4">
<li>
<p>Numero <strong>total de p&#xE1;ginas escritas</strong> por <strong>William Shakespeare</strong>.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name"><span class="token keyword keyword-var">var</span></span> totalPaginas <span class="token operator">=</span>
Datos<span class="token punctuation">.</span>Autores<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Nombre <span class="token operator">==</span> <span class="token string">&quot;William Shakespeare&quot;</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">SelectMany</span><span class="token punctuation">(</span>a <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>Libros<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>l <span class="token operator">=&gt;</span> l<span class="token punctuation">.</span>Paginas<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;William Shakespeare escribi&#xF3; </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">totalPaginas</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></li>
</ol>
</blockquote>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>