<!DOCTYPE html><html><head>
      <title>Programaci√≥n 1¬∫ DAM Tema 8.2</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v19/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
.markdown-preview.markdown-preview .contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.markdown-preview.markdown-preview .fondo {
  background: url(https://programacioniesbalmis.github.io/Imagenes/BannersMoodle/banner.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.markdown-preview.markdown-preview .cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.markdown-preview.markdown-preview .abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.markdown-preview.markdown-preview .cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.markdown-preview.markdown-preview .autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="tema-82">Tema 8.2 </h1>
<p>Descargar estos apuntes en <a href="./Tema8_2.pdf">pdf</a> o <a href="./Tema8_2.html">html</a></p>
<h2 id="√≠ndice">√çndice </h2>

<div class="md-toc">
<details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#flujos-de-datos-en-serie-o-streams" class="md-toc-link"><p>Flujos de datos en serie o streams</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#conceptos-generales-sobre-streams" class="md-toc-link"><p>Conceptos generales sobre Streams</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#operaciones-y-nomenclatura-relacionada-con-streams" class="md-toc-link"><p>Operaciones y nomenclatura relacionada con Streams</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#apertura-open" class="md-toc-link">
            <p>Apertura (Open)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#cierre-close" class="md-toc-link">
            <p>Cierre (Close)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#lectura-read-y-escritura-write" class="md-toc-link">
            <p>Lectura (Read) y Escritura (Write)</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#volcado-flush" class="md-toc-link">
            <p>Volcado (Flush)</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#streams-en-csharp" class="md-toc-link"><p>Streams en CSharp</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#lectura-y-escritura-de-ficheros-sin-transformar" class="md-toc-link"><p>Lectura y escritura de ficheros sin transformar</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#apertura-y-cierre-de-un-fichero-con-filestream" class="md-toc-link">
            <p>Apertura y Cierre de un fichero con FileStream</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#escritura-de-un-fichero-con-filestream" class="md-toc-link">
            <p>Escritura de un fichero con FileStream</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#lectura-de-un-fichero-con-filestream" class="md-toc-link">
            <p>Lectura de un fichero con FileStream</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#longitud-y-posici√≥n-en-el-stream" class="md-toc-link">
            <p>Longitud y Posici√≥n en el Stream</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#desplaz√°ndonos-por-el-stream" class="md-toc-link">
            <p>Desplaz√°ndonos por el Stream</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#recorriendo-un-filestream-hasta-el-final" class="md-toc-link">
            <p>Recorriendo un FileStream hasta el final</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#pasando-el-flujo-por-un-decorator-stream" class="md-toc-link"><p>Pasando el flujo por un '<em>Decorator Stream</em>'</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ejemplo-de-decorator-stream-usando-bufferedstream" class="md-toc-link">
            <p>Ejemplo de '<em>Decorator Stream</em>' usando BufferedStream</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#transformando-el-flujo-con-un-stream-adapter" class="md-toc-link"><p>Transformando el flujo con un '<em>Stream Adapter</em>'</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#stream-adapters-binarywriter-y-binaryreader" class="md-toc-link">
            <p>Stream Adapters BinaryWriter y BinaryReader</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#mortar_board-caso-de-estudio-de-lectura-en-binario-con-binaryreader" class="md-toc-link">
            <p>üéì Caso de estudio de lectura en binario con BinaryReader</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#stream-adapters-streamwriter-y-streamreader" class="md-toc-link">
            <p>Stream Adapters StreamWriter y StreamReader</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#manejo-de-excepciones-con-ficheros" class="md-toc-link">
            <p>Manejo de excepciones con ficheros</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#mortar_board-caso-de-estudio-de-streamwriter-streamreader-y-excepciones" class="md-toc-link">
            <p>üéì Caso de estudio de StreamWriter, StreamReader y excepciones</p>

          </a></div>
</div>
<div style="page-break-after:always;"></div>
<h2 id="flujos-de-datos-en-serie-o-streams">Flujos de datos en serie o streams </h2>
<h3 id="conceptos-generales-sobre-streams">Conceptos generales sobre Streams </h3>
<p>La lectura y escritura de un archivo son hechas usando un concepto gen√©rico llamado <strong>stream</strong>.</p>
<p>Los <strong>stream</strong> son <strong>flujos de datos</strong> <strong>secuenciales</strong> que se utilizan para la <strong>transferencia de informaci√≥n de un punto a otro</strong>.</p>
<p>Los datos del stream se agrupan de forma b√°sica en una <strong>secuencia de bytes</strong>....</p>
<p></p><p align="center" style="zoom:1" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: G Pages: 1 -->
<svg width="476pt" height="141pt" viewBox="0.00 0.00 476.00 140.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 136.8)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-136.8 472,-136.8 472,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-8 8,-124.8 460,-124.8 460,-8 8,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<polygon fill="none" stroke="black" points="23.68,-20 23.68,-54.8 79.82,-54.8 79.82,-20 23.68,-20"></polygon>
<text text-anchor="start" x="32.68" y="-33.2" font-family="Arial" font-size="14.00">byte 0</text>
<polygon fill="none" stroke="black" points="79.82,-20 79.82,-54.8 135.96,-54.8 135.96,-20 79.82,-20"></polygon>
<text text-anchor="start" x="88.82" y="-33.2" font-family="Arial" font-size="14.00">byte 1</text>
<polygon fill="none" stroke="black" points="135.96,-20 135.96,-54.8 192.1,-54.8 192.1,-20 135.96,-20"></polygon>
<text text-anchor="start" x="144.96" y="-33.2" font-family="Arial" font-size="14.00">byte 2</text>
<polygon fill="none" stroke="black" points="192.1,-20 192.1,-54.8 248.23,-54.8 248.23,-20 192.1,-20"></polygon>
<text text-anchor="start" x="201.1" y="-33.2" font-family="Arial" font-size="14.00">byte 3</text>
<polygon fill="none" stroke="black" points="248.23,-20 248.23,-54.8 304.37,-54.8 304.37,-20 248.23,-20"></polygon>
<text text-anchor="start" x="257.23" y="-33.2" font-family="Arial" font-size="14.00">byte 4</text>
<polygon fill="none" stroke="black" points="304.37,-20 304.37,-54.8 360.51,-54.8 360.51,-20 304.37,-20"></polygon>
<text text-anchor="start" x="313.37" y="-33.2" font-family="Arial" font-size="14.00">byte 5</text>
<polygon fill="none" stroke="black" points="360.51,-20 360.51,-54.8 416.65,-54.8 416.65,-20 360.51,-20"></polygon>
<text text-anchor="start" x="369.51" y="-33.2" font-family="Arial" font-size="14.00">byte 6</text>
<text text-anchor="start" x="424.65" y="-33.2" font-family="Arial" font-size="14.00">...</text>
</g>
<!-- posici√≥n -->
<g id="node2" class="node">
<title>posici√≥n</title>
<text text-anchor="middle" x="192" y="-94.6" font-family="Arial" font-size="14.00">posici√≥n</text>
</g>
<!-- posici√≥n&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>posici√≥n-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" d="M192,-81C192,-81 192,-65.91 192,-65.91"></path>
<polygon fill="black" stroke="black" points="195.5,-65.91 192,-55.91 188.5,-65.91 195.5,-65.91"></polygon>
</g>
</g>
</svg>
</p><p></p>
<p>Los stream pueden ser transferidos en <strong>dos posibles direcciones</strong>:</p>
<ol>
<li>Si los datos son transferidos desde una fuente externa al programa, entonces se habla de <strong>'<em>leer desde el stream</em>'</strong>.</li>
<li>Si los datos son transferidos desde el programa a alguna fuente externa, entonces se habla de <strong>'<em>escribir al stream</em>'</strong>.</li>
</ol>
<p>Frecuentemente, la fuente externa ser√° un <strong>archivo</strong>, pero no es absolutamente necesario. Las fuentes de informaci√≥n externas  pueden ser de diversos tipos. Algunas posibilidades incluyen:</p>
<ul>
<li>Leer o escribir datos a una red utilizando alg√∫n protocolo de red, donde la intenci√≥n es que estos datos sean recibidos o enviados por otro computador.</li>
<li>Lectura o escritura a un √°rea de memoria.</li>
<li>La Consola.</li>
<li>La Impresora.</li>
<li>Otros ...</li>
</ul>
<blockquote>
<p>üì£ <strong>Resumen:</strong> Por tanto, podemos considerar un <strong>flujo</strong> o <strong>stream</strong> como una <strong>secuencia bytes</strong> sobre la que podemos leer o escribir. Un fichero es un tipo espec√≠fico de <strong>stream</strong>.</p>
</blockquote>
<div style="page-break-after:always;"></div>
<h4 id="operaciones-y-nomenclatura-relacionada-con-streams">Operaciones y nomenclatura relacionada con Streams </h4>
<h5 id="apertura-open">Apertura (Open) </h5>
<p>Adem√°s de memoria, muchos flujos necesitan recursos extra. Por ejemplo, las conexiones de red crean sockets y los ficheros crean descriptores de ficheros en el sistema operativo.</p>
<p>En ocasiones, este proceso de apertura puede devolver errores o excepciones normalmente generadas por el SO como podr√≠an ser:</p>
<ul>
<li>Falta de permisos de acceso.</li>
<li>Bloqueo o uso por parte de otro programa.</li>
<li>El SO no puede crear m√°s descriptores o '<em>manejadores</em>' de ficheros.</li>
<li>Otros ...</li>
</ul>
<blockquote>
<p>üì£ <strong>Resumen:</strong> Por tanto, al proceso de reservar, adquirir o bloquear estos recursos se denomina <strong>'<em>apertura</em>'</strong> y tras crear un flujo de datos diremos que lo estamos <strong>'<em>abriendo</em>'</strong>.</p>
</blockquote>
<h5 id="cierre-close">Cierre (Close) </h5>
<p>C√≥mo hemos comentado, si en el proceso de apertura necesitamos reservar, adquirir o bloquear recursos. Necesitaremos realizar el proceso opuesto de <strong>'<em>liberaci√≥n</em>'</strong> de los mismos.</p>
<p>Deberemos llevar especial cuidado que este proceso de cierre se haga tambi√©n si se ha producido alg√∫n error. Por tanto, si usamos excepciones, el <strong>'<em>cierre</em>'</strong> de un flujo deber√≠a ir en un bloque <strong><code>finally</code></strong>.</p>
<blockquote>
<p>üì£ <strong>Resumen:</strong> Por tanto, tras finalizar el trabajo con el flujo de datos deberemos <strong>'<em>cerrarlo</em>'</strong>.</p>
</blockquote>
<h5 id="lectura-read-y-escritura-write">Lectura (Read) y Escritura (Write) </h5>
<p>Son las operaciones b√°sicas sobre flujos y por tanto en su forma m√°s b√°sica transferir√°n bytes. Sin embargo en ocasiones estos bytes se pueden '<em>agrupar</em>' en la lectura para obtener tipos m√°s manejables y por tanto tambi√©n puede suceder el proceso inverso en el proceso de escritura.</p>
<h5 id="volcado-flush">Volcado (Flush) </h5>
<p>Muchos flujos, en especial los que manejan ficheros, trabajan internamente con buffers donde se almacena temporalmente los bytes que se solicita <strong>escribir</strong>, hasta que su n√∫mero alcance una cierta cantidad, momento en que son verdaderamente escritos todos a la vez en el flujo.<br>
Esto se hace porque las <strong>escrituras</strong> en flujos suelen ser <strong>operaciones lentas</strong>, e interesa que se hagan el menor n√∫mero de veces posible.<br>
Sin embargo, hay ocasiones en que puede interesar asegurarse de que en un cierto instante se haya realizado el <strong>'<em>volcado</em>'</strong> real de los bytes en un flujo. En esos casos puede forzarse el volcado mediante la operaci√≥n <strong>Flush</strong>, que vac√≠a por completo su buffer interno en el flujo.</p>
<blockquote>
<p>üì£ <strong>Resumen:</strong> Por tanto, la operaci√≥n de <strong>escritura</strong> en ficheros se realiza sobre un buffer de memoria RAM el cual se <strong>'<em>volcar√°</em>'</strong> en el soporte de almacenamiento por bloques para optimizar, ya sea de forma transparente o forzada.</p>
</blockquote>
<div style="page-break-after:always;"></div>
<h3 id="streams-en-csharp">Streams en CSharp </h3>
<p>En C# los archivos, directorios y flujos con ficheros, se manejan con clases del las BCL definidas en el namespace: <strong><code>System.IO</code></strong></p>
<p><strong>Todos los flujos de datos</strong> en C# heredan de la clase <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.stream?view=net-5.0">Stream</a></strong> que implementa las operaciones b√°sicas antes descritas.</p>
<p>En el diagrama siguiente podemos ver de forma <strong>resumida</strong> c√≥mo ha dise√±ado .NET sus clases para manejo de flujos.</p>
<blockquote>
<p><strong>Nota:</strong> Estos patrones de dise√±o y clases son an√°logos en otros lenguajes OO.</p>
</blockquote>
<p></p><p align="center" style="zoom:0.4" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: G Pages: 1 -->
<svg width="1402pt" height="496pt" viewBox="0.00 0.00 1402.24 496.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 492)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-492 1398.24,-492 1398.24,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-8 8,-404 168,-404 168,-8 8,-8"></polygon>
<text text-anchor="middle" x="88" y="-373" font-family="Arial" font-size="30.00">Datos</text>
</g>
<g id="clust2" class="cluster">
<title>clusterG</title>
<polygon fill="none" stroke="#104e8b" points="352.83,-48 352.83,-480 1093.83,-480 1093.83,-48 352.83,-48"></polygon>
<text text-anchor="middle" x="723.33" y="-449" font-family="Arial" font-size="30.00" fill="#104e8b">Clases para el manejo de streams</text>
</g>
<g id="clust3" class="cluster">
<title>cluster1</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="357.83,-73 357.83,-431 541.83,-431 541.83,-73 357.83,-73"></polygon>
<text text-anchor="middle" x="449.83" y="-409" font-family="Arial" font-size="20.00" fill="#104e8b">Stream Adapters</text>
</g>
<g id="clust4" class="cluster">
<title>cluster2</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="610.83,-73 610.83,-431 794.83,-431 794.83,-73 610.83,-73"></polygon>
<text text-anchor="middle" x="702.83" y="-409" font-family="Arial" font-size="20.00" fill="#104e8b">Decorator Streams</text>
</g>
<g id="clust5" class="cluster">
<title>cluster3</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="868.83,-149 868.83,-431 1088.83,-431 1088.83,-149 868.83,-149"></polygon>
<text text-anchor="middle" x="978.83" y="-409" font-family="Arial" font-size="20.00" fill="#104e8b">Backing Store Streams</text>
</g>
<g id="clust6" class="cluster">
<title>cluster4</title>
<polygon fill="none" stroke="none" points="1202.24,-149 1202.24,-443 1386.24,-443 1386.24,-149 1202.24,-149"></polygon>
<text text-anchor="middle" x="1294.24" y="-412" font-family="Arial" font-size="30.00">Dispositivos</text>
</g>
<!-- Texto -->
<g id="node1" class="node">
<title>Texto</title>
<polygon fill="none" stroke="black" points="154,-352 16,-352 16,-268 160,-268 160,-346 154,-352"></polygon>
<polyline fill="none" stroke="black" points="154,-352 154,-346"></polyline>
<polyline fill="none" stroke="black" points="160,-346 154,-346"></polyline>
<text text-anchor="middle" x="88" y="-316" font-family="Arial" font-size="20.00">Texto en</text>
<text text-anchor="middle" x="88" y="-292" font-family="Arial" font-size="20.00">UTF-8</text>
</g>
<!-- StreamWriter -->
<g id="node4" class="node">
<title>StreamWriter</title>
<polygon fill="#36648b" stroke="#36648b" points="521.83,-378.8 377.83,-378.8 377.83,-321.2 521.83,-321.2 521.83,-378.8"></polygon>
</g>
<!-- Texto&#45;&gt;StreamWriter -->
<g id="edge1" class="edge">
<title>Texto-&gt;StreamWriter</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M160.35,-336.6C160.35,-336.6 363.06,-336.6 363.06,-336.6"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="363.06,-340.1 373.06,-336.6 363.06,-333.1 363.06,-340.1"></polygon>
<text text-anchor="middle" x="268.91" y="-324.7" font-family="Arial" font-size="19.00" fill="#1874cd">string</text>
</g>
<!-- Tipos -->
<g id="node2" class="node">
<title>Tipos</title>
<polygon fill="none" stroke="black" points="154,-250 16,-250 16,-118 160,-118 160,-244 154,-250"></polygon>
<polyline fill="none" stroke="black" points="154,-250 154,-244"></polyline>
<polyline fill="none" stroke="black" points="160,-244 154,-244"></polyline>
<text text-anchor="start" x="34" y="-214" font-family="Arial" font-size="20.00">int</text>
<text text-anchor="start" x="34" y="-190" font-family="Arial" font-size="20.00">double</text>
<text text-anchor="start" x="34" y="-166" font-family="Arial" font-size="20.00">string</text>
<text text-anchor="start" x="34" y="-142" font-family="Arial" font-size="20.00">...</text>
</g>
<!-- BinaryWriter -->
<g id="node6" class="node">
<title>BinaryWriter</title>
<polygon fill="#36648b" stroke="#36648b" points="521.83,-150.8 377.83,-150.8 377.83,-93.2 521.83,-93.2 521.83,-150.8"></polygon>
</g>
<!-- Tipos&#45;&gt;BinaryWriter -->
<g id="edge2" class="edge">
<title>Tipos-&gt;BinaryWriter</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M160.35,-134.4C160.35,-134.4 363.06,-134.4 363.06,-134.4"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="363.06,-137.9 373.06,-134.4 363.06,-130.9 363.06,-137.9"></polygon>
<text text-anchor="middle" x="268.91" y="-150.7" font-family="Arial" font-size="19.00" fill="#1874cd">tipos b√°sicos</text>
</g>
<!-- Bytes -->
<g id="node3" class="node">
<title>Bytes</title>
<polygon fill="none" stroke="black" points="154,-100 16,-100 16,-16 160,-16 160,-94 154,-100"></polygon>
<polyline fill="none" stroke="black" points="154,-100 154,-94"></polyline>
<polyline fill="none" stroke="black" points="160,-94 154,-94"></polyline>
<text text-anchor="middle" x="88" y="-64" font-family="Arial" font-size="20.00">Bytes sin</text>
<text text-anchor="middle" x="88" y="-40" font-family="Arial" font-size="20.00">transformar</text>
</g>
<!-- DeflateStream -->
<g id="node8" class="node">
<title>DeflateStream</title>
<polygon fill="#4f94cd" stroke="#4f94cd" points="774.83,-378.8 630.83,-378.8 630.83,-321.2 774.83,-321.2 774.83,-378.8"></polygon>
</g>
<!-- StreamWriter&#45;&gt;DeflateStream -->
<g id="edge5" class="edge">
<title>StreamWriter-&gt;DeflateStream</title>
<path fill="none" stroke="none" stroke-width="3" d="M522.32,-350C522.32,-350 616.21,-350 616.21,-350"></path>
<polygon fill="none" stroke="none" stroke-width="3" points="616.21,-353.5 626.21,-350 616.21,-346.5 616.21,-353.5"></polygon>
</g>
<!-- StreamReader -->
<g id="node5" class="node">
<title>StreamReader</title>
<polygon fill="#36648b" stroke="#36648b" points="521.83,-302.8 377.83,-302.8 377.83,-245.2 521.83,-245.2 521.83,-302.8"></polygon>
</g>
<!-- StreamReader&#45;&gt;Texto -->
<g id="edge3" class="edge">
<title>StreamReader-&gt;Texto</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M377.47,-285.4C377.47,-285.4 174.77,-285.4 174.77,-285.4"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="174.77,-281.9 164.77,-285.4 174.77,-288.9 174.77,-281.9"></polygon>
</g>
<!-- BinaryReader -->
<g id="node7" class="node">
<title>BinaryReader</title>
<polygon fill="#36648b" stroke="#36648b" points="521.83,-226.8 377.83,-226.8 377.83,-169.2 521.83,-169.2 521.83,-226.8"></polygon>
</g>
<!-- BinaryReader&#45;&gt;Tipos -->
<g id="edge4" class="edge">
<title>BinaryReader-&gt;Tipos</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M377.47,-198C377.47,-198 174.77,-198 174.77,-198"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="174.77,-194.5 164.77,-198 174.77,-201.5 174.77,-194.5"></polygon>
</g>
<!-- FileStream -->
<g id="node13" class="node">
<title>FileStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="1050.83,-378.8 906.83,-378.8 906.83,-321.2 1050.83,-321.2 1050.83,-378.8"></polygon>
</g>
<!-- DeflateStream&#45;&gt;FileStream -->
<g id="edge6" class="edge">
<title>DeflateStream-&gt;FileStream</title>
<path fill="none" stroke="none" stroke-width="3" d="M774.98,-350C774.98,-350 892.07,-350 892.07,-350"></path>
<polygon fill="none" stroke="none" stroke-width="3" points="892.07,-353.5 902.07,-350 892.07,-346.5 892.07,-353.5"></polygon>
</g>
<!-- GZipStream -->
<g id="node9" class="node">
<title>GZipStream</title>
<polygon fill="#4f94cd" stroke="#4f94cd" points="774.83,-302.8 630.83,-302.8 630.83,-245.2 774.83,-245.2 774.83,-302.8"></polygon>
</g>
<!-- CryptoStream -->
<g id="node10" class="node">
<title>CryptoStream</title>
<polygon fill="#4f94cd" stroke="#4f94cd" points="774.83,-226.8 630.83,-226.8 630.83,-169.2 774.83,-169.2 774.83,-226.8"></polygon>
</g>
<!-- BufferedStream -->
<g id="node11" class="node">
<title>BufferedStream</title>
<polygon fill="#4f94cd" stroke="#4f94cd" points="774.83,-150.8 630.83,-150.8 630.83,-93.2 774.83,-93.2 774.83,-150.8"></polygon>
</g>
<!-- c1 -->
<g id="node12" class="node">
<title>c1</title>
<ellipse fill="black" stroke="black" cx="449.83" cy="-53" rx="0.36" ry="0.36"></ellipse>
</g>
<!-- Fichero -->
<g id="node16" class="node">
<title>Fichero</title>
<polygon fill="none" stroke="black" points="1366.24,-378.8 1226.24,-378.8 1222.24,-374.8 1222.24,-321.2 1362.24,-321.2 1366.24,-325.2 1366.24,-378.8"></polygon>
<polyline fill="none" stroke="black" points="1362.24,-374.8 1222.24,-374.8"></polyline>
<polyline fill="none" stroke="black" points="1362.24,-374.8 1362.24,-321.2"></polyline>
<polyline fill="none" stroke="black" points="1362.24,-374.8 1366.24,-378.8"></polyline>
</g>
<!-- FileStream&#45;&gt;Fichero -->
<g id="edge7" class="edge">
<title>FileStream-&gt;Fichero</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M1065.73,-350C1065.73,-350 1207.4,-350 1207.4,-350"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1065.73,-346.5 1055.73,-350 1065.73,-353.5 1065.73,-346.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1207.4,-353.5 1217.4,-350 1207.4,-346.5 1207.4,-353.5"></polygon>
<text text-anchor="middle" x="1145.53" y="-355.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- MemoryStream -->
<g id="node14" class="node">
<title>MemoryStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="1050.83,-302.8 906.83,-302.8 906.83,-245.2 1050.83,-245.2 1050.83,-302.8"></polygon>
</g>
<!-- Memoria -->
<g id="node17" class="node">
<title>Memoria</title>
<polygon fill="none" stroke="black" points="1366.24,-302.8 1226.24,-302.8 1222.24,-298.8 1222.24,-245.2 1362.24,-245.2 1366.24,-249.2 1366.24,-302.8"></polygon>
<polyline fill="none" stroke="black" points="1362.24,-298.8 1222.24,-298.8"></polyline>
<polyline fill="none" stroke="black" points="1362.24,-298.8 1362.24,-245.2"></polyline>
<polyline fill="none" stroke="black" points="1362.24,-298.8 1366.24,-302.8"></polyline>
</g>
<!-- MemoryStream&#45;&gt;Memoria -->
<g id="edge8" class="edge">
<title>MemoryStream-&gt;Memoria</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M1065.73,-274C1065.73,-274 1207.4,-274 1207.4,-274"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1065.73,-270.5 1055.73,-274 1065.73,-277.5 1065.73,-270.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1207.4,-277.5 1217.4,-274 1207.4,-270.5 1207.4,-277.5"></polygon>
<text text-anchor="middle" x="1145.53" y="-279.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- NetworkStream -->
<g id="node15" class="node">
<title>NetworkStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="1050.83,-226.8 906.83,-226.8 906.83,-169.2 1050.83,-169.2 1050.83,-226.8"></polygon>
</g>
<!-- Red -->
<g id="node18" class="node">
<title>Red</title>
<polygon fill="none" stroke="black" points="1366.24,-226.8 1226.24,-226.8 1222.24,-222.8 1222.24,-169.2 1362.24,-169.2 1366.24,-173.2 1366.24,-226.8"></polygon>
<polyline fill="none" stroke="black" points="1362.24,-222.8 1222.24,-222.8"></polyline>
<polyline fill="none" stroke="black" points="1362.24,-222.8 1362.24,-169.2"></polyline>
<polyline fill="none" stroke="black" points="1362.24,-222.8 1366.24,-226.8"></polyline>
</g>
<!-- NetworkStream&#45;&gt;Red -->
<g id="edge9" class="edge">
<title>NetworkStream-&gt;Red</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M1065.73,-198C1065.73,-198 1207.4,-198 1207.4,-198"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1065.73,-194.5 1055.73,-198 1065.73,-201.5 1065.73,-194.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1207.4,-201.5 1217.4,-198 1207.4,-194.5 1207.4,-201.5"></polygon>
<text text-anchor="middle" x="1145.53" y="-203.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
</g>
</svg>
</p><p></p>
<p>Si nos fijamos, tendremos de derecha a izquierda ...</p>
<ul>
<li>Una serie de <strong>dispositivos</strong> donde vamos a realizar las operaciones de lectura y escritura.</li>
<li>Una serie de clases denominadas <strong>Backing Store Streams</strong> que ser√°n las que hereden de <strong><code>Stream</code></strong> y hagan las operaciones del lectura y escritura en los dispositivos. En concreto, <strong>para ficheros usaremos</strong> la subclase de stream <strong><code>FileStream</code></strong>.</li>
<li>Una serie de clases denominadas <strong>Decorator Streams</strong> que transformar√°n una secuencia de <strong>bytes</strong> en otra secuencia de <strong>bytes</strong> y cuyo uso ser√° opcional si queremos hacer operaciones como compresi√≥n, cifrado, etc. En este, tema veremos un case de uso <strong><code>BufferedStream</code></strong> pero no profundizaremos en su uso.</li>
<li>‚úã <strong>Importante:</strong> Una serie de clases denominadas <strong>Stream Adapters</strong> adapter que adaptar√°n, en ambos sentidos, <strong>tipos de datos b√°sicos</strong> manejables por los programas a secuencias de <strong>bytes</strong> manejables por los streams.<br>
<strong>Nota:</strong> Si los datos que manejamos en el programa son directamente <strong>bytes sin transformar</strong> nos saltaremos estas clases para manejar directamente '<em>Decorator Streams</em>' o '<em>Backing Store Streams</em>'</li>
</ul>
<p>Podremos realizar correspondencias, entre los diferentes bloques de clases, dependiendo de flujo de datos que queramos manejar y lo que queramos hacer teniendo en cuenta los datos.</p>
<div style="page-break-after:always;"></div>
<h4 id="lectura-y-escritura-de-ficheros-sin-transformar">Lectura y escritura de ficheros sin transformar </h4>
<p>Escribiremos y leeremos bloques de <strong>bytes</strong>. Por tanto, solo necesitaremos usar la clase <strong><code>FileStream</code></strong> y por tanto estaremos usando la siguiente combinaci√≥n...</p>
<p></p><p align="center" style="zoom:0.4" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: G Pages: 1 -->
<svg width="1078pt" height="208pt" viewBox="0.00 0.00 1077.83 208.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 204)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-204 1073.83,-204 1073.83,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-12 8,-156 168,-156 168,-12 8,-12"></polygon>
<text text-anchor="middle" x="88" y="-125" font-family="Arial" font-size="30.00">Datos</text>
</g>
<g id="clust2" class="cluster">
<title>clusterG</title>
<polygon fill="none" stroke="#104e8b" points="293.41,-8 293.41,-192 764.41,-192 764.41,-8 293.41,-8"></polygon>
<text text-anchor="middle" x="528.91" y="-161" font-family="Arial" font-size="30.00" fill="#104e8b">Clases para el manejo de streams</text>
</g>
<g id="clust3" class="cluster">
<title>cluster3</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="418.41,-13 418.41,-143 638.41,-143 638.41,-13 418.41,-13"></polygon>
<text text-anchor="middle" x="528.41" y="-121" font-family="Arial" font-size="20.00" fill="#104e8b">Backing Store Streams</text>
</g>
<g id="clust4" class="cluster">
<title>cluster4</title>
<polygon fill="none" stroke="none" points="877.83,-13 877.83,-155 1061.83,-155 1061.83,-13 877.83,-13"></polygon>
<text text-anchor="middle" x="969.83" y="-124" font-family="Arial" font-size="30.00">Dispositivos</text>
</g>
<!-- Bytes -->
<g id="node1" class="node">
<title>Bytes</title>
<polygon fill="none" stroke="black" points="154,-104 16,-104 16,-20 160,-20 160,-98 154,-104"></polygon>
<polyline fill="none" stroke="black" points="154,-104 154,-98"></polyline>
<polyline fill="none" stroke="black" points="160,-98 154,-98"></polyline>
<text text-anchor="middle" x="88" y="-68" font-family="Arial" font-size="20.00">Bytes sin</text>
<text text-anchor="middle" x="88" y="-44" font-family="Arial" font-size="20.00">transformar</text>
</g>
<!-- FileStream -->
<g id="node2" class="node">
<title>FileStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="600.41,-90.8 456.41,-90.8 456.41,-33.2 600.41,-33.2 600.41,-90.8"></polygon>
</g>
<!-- Bytes&#45;&gt;FileStream -->
<g id="edge1" class="edge">
<title>Bytes-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M174.77,-62C174.77,-62 441.6,-62 441.6,-62"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="174.77,-58.5 164.77,-62 174.77,-65.5 174.77,-58.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="441.6,-65.5 451.6,-62 441.6,-58.5 441.6,-65.5"></polygon>
<text text-anchor="middle" x="236.71" y="-67.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- Fichero -->
<g id="node3" class="node">
<title>Fichero</title>
<polygon fill="none" stroke="black" points="1041.83,-90.8 901.83,-90.8 897.83,-86.8 897.83,-33.2 1037.83,-33.2 1041.83,-37.2 1041.83,-90.8"></polygon>
<polyline fill="none" stroke="black" points="1037.83,-86.8 897.83,-86.8"></polyline>
<polyline fill="none" stroke="black" points="1037.83,-86.8 1037.83,-33.2"></polyline>
<polyline fill="none" stroke="black" points="1037.83,-86.8 1041.83,-90.8"></polyline>
</g>
<!-- FileStream&#45;&gt;Fichero -->
<g id="edge2" class="edge">
<title>FileStream-&gt;Fichero</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M615.35,-62C615.35,-62 882.85,-62 882.85,-62"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="615.35,-58.5 605.35,-62 615.35,-65.5 615.35,-58.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="882.85,-65.5 892.85,-62 882.85,-58.5 882.85,-65.5"></polygon>
<text text-anchor="middle" x="821.12" y="-67.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
</g>
</svg>
</p><p></p>
<h5 id="apertura-y-cierre-de-un-fichero-con-filestream">Apertura y Cierre de un fichero con FileStream </h5>
<p>La forma de abrirlo o crearlo m√°s com√∫n de encontrar en la mayor√≠a de lenguajes es usando el constructor...</p>
<p><strong>public <a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.filestream.-ctor?view=net-5.0#System_IO_FileStream__ctor_System_String_System_IO_FileMode_System_IO_FileAccess_">FileStream</a>(string path, FileMode mode, FileAccess access)</strong></p>
<ul>
<li>
<p><strong><code>string path</code></strong>: Ubicaci√≥n del fichero sobre el que queremos abrir un flujo.</p>
</li>
<li>
<p><strong><code>FileMode mode</code></strong>: Enum con las posibilidades de apertura del fichero.</p>
<ul>
<li><strong><code>Append</code></strong>: Abre el archivo si existe y realiza una b√∫squeda hasta el final del mismo, o crea un archivo nuevo.</li>
<li><strong><code>Create</code></strong>: Especifica que el sistema operativo debe crear un archivo nuevo. Si el archivo ya existe, se sobrescribir√°.</li>
<li><strong><code>CreateNew</code></strong>: Especifica que el sistema operativo debe crear un archivo nuevo. Si el archivo ya existe hay una excepci√≥n.</li>
<li><strong><code>Open</code></strong>: Especifica que el sistema operativo debe abrir un archivo existente.</li>
<li><strong><code>OpenOrCreate</code></strong>: Especifica que el sistema operativo debe abrir un archivo si ya existe; en caso contrario, debe crearse uno nuevo.</li>
<li><strong><code>Truncate</code></strong>: Especifica que el sistema operativo debe abrir un archivo existente. Una vez abierto, debe truncarse el archivo para que su tama√±o sea de cero bytes.</li>
</ul>
</li>
<li>
<p><strong><code>FileAccess access</code></strong>: Enum con el tipo de operaci√≥n que vamos a realizar.</p>
<ul>
<li><strong><code>Read</code></strong>: Acceso de lectura al archivo.</li>
<li><strong><code>ReadWrite</code></strong>: Acceso de lectura y escritura al archivo.</li>
<li><strong><code>Write</code></strong>: Acceso de escritura al archivo.</li>
</ul>
</li>
</ul>
<p>El cierre del fichero lo haremos a trav√©s de...</p>
<p><strong>public void Stream.<a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.stream.close?view=net-5.0">Close</a>()</strong></p>
<ul>
<li>Libera el descriptor o manejador del fichero creado por el SO.</li>
<li>Hace un <strong><code>Flush()</code></strong> del buffer del <strong><code>Stream</code></strong> en el dispositivo si lo hemos abierto para escritura y hay escrituras pendientes de guardar.</li>
<li>En el lenguaje C#, esta tarea la hace el m√©todo <strong><code>Dispose()</code></strong> con el que todo flujo cuenta como <strong>est√°ndar recomendado</strong> para liberar recursos de manera determinista. Sin embargo, por analog√≠a con otros lenguajes a la clase <strong><code>Stream</code></strong> tambi√©n dispone de un m√©todo <strong><code>Close()</code></strong> que hace lo mismo.</li>
</ul>
<div style="page-break-after:always;"></div>
<p><strong>Ejemplo b√°sico de uso</strong>:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-using">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO</span><span class="token punctuation">;</span>
<span class="token keyword keyword-namespace">namespace</span> <span class="token namespace">Ejemplo</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// El siguiente programa crea o sobrescribe el archivo ejemplo.txt en el</span>
        <span class="token comment">// directorio donde me estoy ejecutando.</span>
        <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">FileStream</span> fichero <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span>
                                        <span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span>      <span class="token comment">// Nombre del fichero</span>
                                        FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span>    <span class="token comment">// Lo creo o sobrescribo si existe</span>
                                        FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Solo puedo escribir en √©l.</span>
            fichero<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h5 id="escritura-de-un-fichero-con-filestream">Escritura de un fichero con FileStream </h5>
<p>La forma escribir m√°s com√∫n, herencia del lenguaje C es el m√©todo...</p>
<p><strong>public override void fileStream.<a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.filestream.write?view=net-5.0#System_IO_FileStream_Write_System_Byte___System_Int32_System_Int32_">Write</a>(byte[] array, int offset, int count)</strong></p>
<ul>
<li><strong><code>byte[] array</code></strong>: Buffer que contiene los datos a escribir.</li>
<li><strong><code>int offset</code></strong>: Desplazamiento en bytes de base cero de array donde se comienzan a copiar los datos en la secuencia actual.</li>
<li><strong>int count</strong>: N√∫mero m√°ximo de bytes que se deben escribir.</li>
</ul>
<p><strong>Ejemplo b√°sico de uso</strong>:</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Escribo 3 bytes con el valor en hexadecimal del </span>
<span class="token comment">// d√≠gito '0' en UTF-8 al principio del stream.</span>
<span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> datos <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x30</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>datos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> datos<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Volcamos a disco el buffer de manera forzada.</span>
fs<span class="token punctuation">.</span><span class="token function">Flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Cerramos el stream.</span>
fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p></p><p align="center" style="zoom:0.8" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: G Pages: 1 -->
<svg width="350pt" height="203pt" viewBox="0.00 0.00 350.00 203.40" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 199.4)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-199.4 346,-199.4 346,4 -4,4"></polygon>
<text text-anchor="middle" x="171" y="-178.8" font-family="Arial" font-size="14.00">El descriptor se se desplzar√° por el Stream</text>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-8 8,-115 334,-115 334,-8 8,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<polygon fill="none" stroke="black" points="40.5,-52 40.5,-103 88.5,-103 88.5,-52 40.5,-52"></polygon>
<text text-anchor="start" x="49.32" y="-81.4" font-family="Arial" font-size="14.00">0x30</text>
<text text-anchor="start" x="57.93" y="-64.6" font-family="Arial" font-size="14.00">'0'</text>
<polygon fill="none" stroke="black" points="88.5,-52 88.5,-103 136.5,-103 136.5,-52 88.5,-52"></polygon>
<text text-anchor="start" x="97.32" y="-81.4" font-family="Arial" font-size="14.00">0x30</text>
<text text-anchor="start" x="105.93" y="-64.6" font-family="Arial" font-size="14.00">'0'</text>
<polygon fill="none" stroke="black" points="136.5,-52 136.5,-103 184.5,-103 184.5,-52 136.5,-52"></polygon>
<text text-anchor="start" x="145.32" y="-81.4" font-family="Arial" font-size="14.00">0x30</text>
<text text-anchor="start" x="153.93" y="-64.6" font-family="Arial" font-size="14.00">'0'</text>
<polygon fill="none" stroke="black" points="184.5,-52 184.5,-103 202.5,-103 202.5,-52 184.5,-52"></polygon>
<polygon fill="none" stroke="black" points="202.5,-52 202.5,-103 220.5,-103 220.5,-52 202.5,-52"></polygon>
<polygon fill="none" stroke="black" points="220.5,-52 220.5,-103 238.5,-103 238.5,-52 220.5,-52"></polygon>
<polygon fill="none" stroke="black" points="238.5,-52 238.5,-103 256.5,-103 256.5,-52 238.5,-52"></polygon>
<text text-anchor="start" x="264.44" y="-73.3" font-family="Arial" font-size="14.00">Stream</text>
<text text-anchor="start" x="52.82" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="60.61" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">00</text>
<text text-anchor="start" x="100.82" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="108.61" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">01</text>
<text text-anchor="start" x="148.82" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="156.61" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">02</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="40" y="-154" font-family="Arial" font-size="14.00" fill="lightgray">antes</text>
<text text-anchor="middle" x="40" y="-137.2" font-family="Arial" font-size="14.00" fill="lightgray">Write</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="lightgray" d="M41.75,-129.09C41.75,-129.09 41.75,-115.01 41.75,-115.01"></path>
<polygon fill="lightgray" stroke="lightgray" points="45.25,-115.01 41.75,-105.01 38.25,-115.01 45.25,-115.01"></polygon>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="185" y="-154" font-family="Arial" font-size="14.00">despu√©s</text>
<text text-anchor="middle" x="185" y="-137.2" font-family="Arial" font-size="14.00">Write</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" d="M185,-129.09C185,-129.09 185,-115.01 185,-115.01"></path>
<polygon fill="black" stroke="black" points="188.5,-115.01 185,-105.01 181.5,-115.01 188.5,-115.01"></polygon>
</g>
</g>
</svg>
</p><p></p>
<div style="page-break-after:always;"></div>
<p><strong>public override void fileStream.<a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.filestream.writebyte?view=net-5.0">WriteByte</a>(byte byte)</strong></p>
<p>Est√© m√©todo ser√° an√°logo al anterior pero escribir√° solo 1 byte en el flujo desplazando el descriptor una posici√≥n.</p>
<h5 id="lectura-de-un-fichero-con-filestream">Lectura de un fichero con FileStream </h5>
<p>La forma escribir m√°s com√∫n, herencia del lenguaje C es el m√©todo...</p>
<p><strong>public override int <a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.filestream.read?view=net-5.0#System_IO_FileStream_Read_System_Byte___System_Int32_System_Int32_">Read</a>(byte[] array, int offset, int count)</strong></p>
<ul>
<li><strong><code>byte[] array</code></strong>: Array a rellenar con los bytes le√≠dos.<br>
‚úã <strong>Debe estar predimensionado con el espacio suficiente</strong>. Adem√°s, esta dimensi√≥n puede ser mayor al n√∫mero de bytes a leer.</li>
<li><strong><code>int offset</code></strong>: Desplazamiento de bytes en el par√°metro array donde debe comenzar la lectura.</li>
<li><strong><code>int count</code></strong>: N√∫mero m√°ximo de bytes que se pueden leer.</li>
<li><strong>Devuelve:</strong> un entero con <strong>el n√∫mero de bytes le√≠dos</strong>.</li>
</ul>
<p><strong>Ejemplo b√°sico de uso</strong>:</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token class-name">FileStream</span> fichero <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span>
        <span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> 
        FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span>      <span class="token comment">// Abro un fichero existente (sino error)</span>
        FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Lo abro espec√≠ficamente para lectura.</span>

<span class="token comment">// Como voy a leer los 3 bytes que escrib√≠ en el ejemplo anterior</span>
<span class="token comment">// creo un array con esp√°cio de 3 como m√≠nimo.</span>
<span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> datos <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-byte">byte</span></span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Leo desde el principio datos.Length = 3 bytes y los a√±ado del array datos </span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> bytesLeidos <span class="token operator">=</span> fichero<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>datos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> datos<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// C√≥mo no se lo que ha le√≠do realmente porque en el fichero a lo </span>
<span class="token comment">// mejor solo hab√≠a 2 bytes. En lugar de recorrer con un foreach</span>
<span class="token comment">// recorro hasta el n√∫mero de bytes le√≠dos que me ha devuelto el m√©todo.</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bytesLeidos<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">datos<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span><span class="token format-string"><span class="token punctuation">:</span>X</span><span class="token punctuation">}</span></span><span class="token string"> "</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fichero<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p><strong>public override int fileStream.<a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.filestream.readbyte?view=net-5.0">ReadByte</a>()</strong></p>
<p>Lee un byte del archivo y avanza la posici√≥n de lectura un byte. Devuelve, el byte, convertido en un int, o <strong>-1 si se ha alcanzado el final de la secuencia</strong>.</p>
<div style="page-break-after:always;"></div>
<h5 id="longitud-y-posici√≥n-en-el-stream">Longitud y Posici√≥n en el Stream </h5>
<ul>
<li><strong>long Length</strong>: N√∫mero de bytes almacenados en el flujo (tama√±o del flujo).<br>
En ficheros, el tama√±o en bytes el fichero.</li>
<li><strong>long Position</strong>: N√∫mero del <strong>byte actual</strong> en el flujo <strong>empezando en 0</strong>.<br>
En ficheros, la posici√≥n actual <strong>donde se encuentra el descriptor</strong> de lectura o escritura del fichero.</li>
</ul>
<p><strong>Ejemplo b√°sico</strong>:</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Paso la cadena a un array de 17 bytes para poder</span>
<span class="token comment">// escribirla con un FileStream.</span>
<span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> buffer <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span><span class="token string">"Lorem ipsum dolor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Longitud Fichero: "</span> <span class="token operator">+</span> fs<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Mostrar√° 17</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Posicion descriptor lectura: "</span> <span class="token operator">+</span> fs<span class="token punctuation">.</span>Position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Devolver√° un 0</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p></p><p align="center" style="zoom:0.5" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: G Pages: 1 -->
<svg width="828pt" height="170pt" viewBox="0.00 0.00 828.00 170.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 166)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-166 824,-166 824,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-8 8,-98 812,-98 812,-8 8,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<text text-anchor="start" x="32.44" y="-64.8" font-family="Arial" font-size="14.00"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</text>
<polygon fill="none" stroke="black" points="71.5,-52 71.5,-86 110.5,-86 110.5,-52 71.5,-52"></polygon>
<text text-anchor="start" x="84.43" y="-64.4" font-family="Arial" font-size="14.00">'L'</text>
<polygon fill="none" stroke="black" points="110.5,-52 110.5,-86 149.5,-86 149.5,-52 110.5,-52"></polygon>
<text text-anchor="start" x="123.43" y="-64.4" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="149.5,-52 149.5,-86 188.5,-86 188.5,-52 149.5,-52"></polygon>
<text text-anchor="start" x="164" y="-64.4" font-family="Arial" font-size="14.00">'r'</text>
<polygon fill="none" stroke="black" points="188.5,-52 188.5,-86 227.5,-86 227.5,-52 188.5,-52"></polygon>
<text text-anchor="start" x="201.43" y="-64.4" font-family="Arial" font-size="14.00">'e'</text>
<polygon fill="none" stroke="black" points="227.5,-52 227.5,-86 266.5,-86 266.5,-52 227.5,-52"></polygon>
<text text-anchor="start" x="238.5" y="-64.4" font-family="Arial" font-size="14.00">'m'</text>
<polygon fill="none" stroke="black" points="266.5,-52 266.5,-86 305.5,-86 305.5,-52 266.5,-52"></polygon>
<text text-anchor="start" x="281.38" y="-64.4" font-family="Arial" font-size="14.00">' '</text>
<polygon fill="none" stroke="black" points="305.5,-52 305.5,-86 344.5,-86 344.5,-52 305.5,-52"></polygon>
<text text-anchor="start" x="320.77" y="-64.4" font-family="Arial" font-size="14.00">'i'</text>
<polygon fill="none" stroke="black" points="344.5,-52 344.5,-86 383.5,-86 383.5,-52 344.5,-52"></polygon>
<text text-anchor="start" x="357.43" y="-64.4" font-family="Arial" font-size="14.00">'p'</text>
<polygon fill="none" stroke="black" points="383.5,-52 383.5,-86 422.5,-86 422.5,-52 383.5,-52"></polygon>
<text text-anchor="start" x="396.83" y="-64.4" font-family="Arial" font-size="14.00">'s'</text>
<polygon fill="none" stroke="black" points="422.5,-52 422.5,-86 461.5,-86 461.5,-52 422.5,-52"></polygon>
<text text-anchor="start" x="435.43" y="-64.4" font-family="Arial" font-size="14.00">'u'</text>
<polygon fill="none" stroke="black" points="461.5,-52 461.5,-86 500.5,-86 500.5,-52 461.5,-52"></polygon>
<text text-anchor="start" x="472.5" y="-64.4" font-family="Arial" font-size="14.00">'m'</text>
<polygon fill="none" stroke="black" points="500.5,-52 500.5,-86 539.5,-86 539.5,-52 500.5,-52"></polygon>
<text text-anchor="start" x="515.38" y="-64.4" font-family="Arial" font-size="14.00">' '</text>
<polygon fill="none" stroke="black" points="539.5,-52 539.5,-86 578.5,-86 578.5,-52 539.5,-52"></polygon>
<text text-anchor="start" x="552.43" y="-64.4" font-family="Arial" font-size="14.00">'d'</text>
<polygon fill="none" stroke="black" points="578.5,-52 578.5,-86 617.5,-86 617.5,-52 578.5,-52"></polygon>
<text text-anchor="start" x="591.43" y="-64.4" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="617.5,-52 617.5,-86 656.5,-86 656.5,-52 617.5,-52"></polygon>
<text text-anchor="start" x="632.77" y="-64.4" font-family="Arial" font-size="14.00">'l'</text>
<polygon fill="none" stroke="black" points="656.5,-52 656.5,-86 695.5,-86 695.5,-52 656.5,-52"></polygon>
<text text-anchor="start" x="669.43" y="-64.4" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="695.5,-52 695.5,-86 734.5,-86 734.5,-52 695.5,-52"></polygon>
<text text-anchor="start" x="710" y="-64.4" font-family="Arial" font-size="14.00">'r'</text>
<text text-anchor="start" x="742.44" y="-64.8" font-family="Arial" font-size="14.00">Stream</text>
<text text-anchor="start" x="79.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="87.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">00</text>
<text text-anchor="start" x="118.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="126.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">01</text>
<text text-anchor="start" x="157.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="165.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">02</text>
<text text-anchor="start" x="196.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="204.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">03</text>
<text text-anchor="start" x="235.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="243.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">04</text>
<text text-anchor="start" x="274.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="282.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">05</text>
<text text-anchor="start" x="313.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="321.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">06</text>
<text text-anchor="start" x="352.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="360.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">07</text>
<text text-anchor="start" x="391.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="399.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">08</text>
<text text-anchor="start" x="430.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="438.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">09</text>
<text text-anchor="start" x="469.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="477.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">10</text>
<text text-anchor="start" x="508.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="516.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">11</text>
<text text-anchor="start" x="547.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="555.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">12</text>
<text text-anchor="start" x="586.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="594.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">13</text>
<text text-anchor="start" x="625.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="633.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">14</text>
<text text-anchor="start" x="664.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="672.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">15</text>
<text text-anchor="start" x="703.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="711.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">16</text>
</g>
<!-- p -->
<g id="node2" class="node">
<title>p</title>
<text text-anchor="middle" x="71" y="-139.8" font-family="Arial" font-size="14.00">fs.Position = 0</text>
</g>
<!-- p&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="black" d="M71,-126.28C71,-126.28 71,-97.51 71,-97.51"></path>
<polygon fill="black" stroke="black" points="74.5,-97.51 71,-87.51 67.5,-97.51 74.5,-97.51"></polygon>
</g>
<!-- l -->
<g id="node3" class="node">
<title>l</title>
<text text-anchor="middle" x="735" y="-139.8" font-family="Arial" font-size="14.00">fs.Length = 17</text>
</g>
<!-- l&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>l-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M735,-126.28C735,-109.23 735,-86 735,-86"></path>
</g>
</g>
</svg>
</p><p></p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token class-name"><span class="token keyword keyword-char">char</span></span> c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>fs<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c = 'L'</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Posici√≥n descriptor lectura: "</span> <span class="token operator">+</span> fs<span class="token punctuation">.</span>Position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Devolver√° un 1</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></pre><p></p><p align="center" style="zoom:0.5" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: G Pages: 1 -->
<svg width="828pt" height="170pt" viewBox="0.00 0.00 828.00 170.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 166)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-166 824,-166 824,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-8 8,-98 812,-98 812,-8 8,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<text text-anchor="start" x="32.44" y="-64.8" font-family="Arial" font-size="14.00"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</text>
<polygon fill="none" stroke="black" points="71.5,-52 71.5,-86 110.5,-86 110.5,-52 71.5,-52"></polygon>
<text text-anchor="start" x="84.43" y="-64.4" font-family="Arial" font-size="14.00">'L'</text>
<polygon fill="none" stroke="black" points="110.5,-52 110.5,-86 149.5,-86 149.5,-52 110.5,-52"></polygon>
<text text-anchor="start" x="123.43" y="-64.4" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="149.5,-52 149.5,-86 188.5,-86 188.5,-52 149.5,-52"></polygon>
<text text-anchor="start" x="164" y="-64.4" font-family="Arial" font-size="14.00">'r'</text>
<polygon fill="none" stroke="black" points="188.5,-52 188.5,-86 227.5,-86 227.5,-52 188.5,-52"></polygon>
<text text-anchor="start" x="201.43" y="-64.4" font-family="Arial" font-size="14.00">'e'</text>
<polygon fill="none" stroke="black" points="227.5,-52 227.5,-86 266.5,-86 266.5,-52 227.5,-52"></polygon>
<text text-anchor="start" x="238.5" y="-64.4" font-family="Arial" font-size="14.00">'m'</text>
<polygon fill="none" stroke="black" points="266.5,-52 266.5,-86 305.5,-86 305.5,-52 266.5,-52"></polygon>
<text text-anchor="start" x="281.38" y="-64.4" font-family="Arial" font-size="14.00">' '</text>
<polygon fill="none" stroke="black" points="305.5,-52 305.5,-86 344.5,-86 344.5,-52 305.5,-52"></polygon>
<text text-anchor="start" x="320.77" y="-64.4" font-family="Arial" font-size="14.00">'i'</text>
<polygon fill="none" stroke="black" points="344.5,-52 344.5,-86 383.5,-86 383.5,-52 344.5,-52"></polygon>
<text text-anchor="start" x="357.43" y="-64.4" font-family="Arial" font-size="14.00">'p'</text>
<polygon fill="none" stroke="black" points="383.5,-52 383.5,-86 422.5,-86 422.5,-52 383.5,-52"></polygon>
<text text-anchor="start" x="396.83" y="-64.4" font-family="Arial" font-size="14.00">'s'</text>
<polygon fill="none" stroke="black" points="422.5,-52 422.5,-86 461.5,-86 461.5,-52 422.5,-52"></polygon>
<text text-anchor="start" x="435.43" y="-64.4" font-family="Arial" font-size="14.00">'u'</text>
<polygon fill="none" stroke="black" points="461.5,-52 461.5,-86 500.5,-86 500.5,-52 461.5,-52"></polygon>
<text text-anchor="start" x="472.5" y="-64.4" font-family="Arial" font-size="14.00">'m'</text>
<polygon fill="none" stroke="black" points="500.5,-52 500.5,-86 539.5,-86 539.5,-52 500.5,-52"></polygon>
<text text-anchor="start" x="515.38" y="-64.4" font-family="Arial" font-size="14.00">' '</text>
<polygon fill="none" stroke="black" points="539.5,-52 539.5,-86 578.5,-86 578.5,-52 539.5,-52"></polygon>
<text text-anchor="start" x="552.43" y="-64.4" font-family="Arial" font-size="14.00">'d'</text>
<polygon fill="none" stroke="black" points="578.5,-52 578.5,-86 617.5,-86 617.5,-52 578.5,-52"></polygon>
<text text-anchor="start" x="591.43" y="-64.4" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="617.5,-52 617.5,-86 656.5,-86 656.5,-52 617.5,-52"></polygon>
<text text-anchor="start" x="632.77" y="-64.4" font-family="Arial" font-size="14.00">'l'</text>
<polygon fill="none" stroke="black" points="656.5,-52 656.5,-86 695.5,-86 695.5,-52 656.5,-52"></polygon>
<text text-anchor="start" x="669.43" y="-64.4" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="695.5,-52 695.5,-86 734.5,-86 734.5,-52 695.5,-52"></polygon>
<text text-anchor="start" x="710" y="-64.4" font-family="Arial" font-size="14.00">'r'</text>
<text text-anchor="start" x="742.44" y="-64.8" font-family="Arial" font-size="14.00">Stream</text>
<text text-anchor="start" x="79.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="87.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">00</text>
<text text-anchor="start" x="118.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="126.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">01</text>
<text text-anchor="start" x="157.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="165.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">02</text>
<text text-anchor="start" x="196.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="204.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">03</text>
<text text-anchor="start" x="235.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="243.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">04</text>
<text text-anchor="start" x="274.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="282.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">05</text>
<text text-anchor="start" x="313.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="321.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">06</text>
<text text-anchor="start" x="352.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="360.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">07</text>
<text text-anchor="start" x="391.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="399.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">08</text>
<text text-anchor="start" x="430.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="438.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">09</text>
<text text-anchor="start" x="469.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="477.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">10</text>
<text text-anchor="start" x="508.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="516.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">11</text>
<text text-anchor="start" x="547.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="555.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">12</text>
<text text-anchor="start" x="586.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="594.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">13</text>
<text text-anchor="start" x="625.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="633.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">14</text>
<text text-anchor="start" x="664.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="672.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">15</text>
<text text-anchor="start" x="703.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="711.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">16</text>
</g>
<!-- p -->
<g id="node2" class="node">
<title>p</title>
<text text-anchor="middle" x="110" y="-139.8" font-family="Arial" font-size="14.00">fs.Position = 1</text>
</g>
<!-- p&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="black" d="M110,-126.28C110,-126.28 110,-97.51 110,-97.51"></path>
<polygon fill="black" stroke="black" points="113.5,-97.51 110,-87.51 106.5,-97.51 113.5,-97.51"></polygon>
</g>
<!-- l -->
<g id="node3" class="node">
<title>l</title>
<text text-anchor="middle" x="735" y="-139.8" font-family="Arial" font-size="14.00">fs.Length = 17</text>
</g>
<!-- l&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>l-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M735,-126.28C735,-109.23 735,-86 735,-86"></path>
</g>
</g>
</svg>
</p><p></p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>fs<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c = 'o'</span>
c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>fs<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c = 'r'</span>
c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>fs<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c = 'e'</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Posici√≥n descriptor lectura: "</span> <span class="token operator">+</span> fs<span class="token punctuation">.</span>Position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Devolver√° un 4</span>
fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p></p><p align="center" style="zoom:0.5" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: G Pages: 1 -->
<svg width="828pt" height="170pt" viewBox="0.00 0.00 828.00 170.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 166)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-166 824,-166 824,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-8 8,-98 812,-98 812,-8 8,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<text text-anchor="start" x="32.44" y="-64.8" font-family="Arial" font-size="14.00"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</text>
<polygon fill="none" stroke="black" points="71.5,-52 71.5,-86 110.5,-86 110.5,-52 71.5,-52"></polygon>
<text text-anchor="start" x="84.43" y="-64.4" font-family="Arial" font-size="14.00">'L'</text>
<polygon fill="none" stroke="black" points="110.5,-52 110.5,-86 149.5,-86 149.5,-52 110.5,-52"></polygon>
<text text-anchor="start" x="123.43" y="-64.4" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="149.5,-52 149.5,-86 188.5,-86 188.5,-52 149.5,-52"></polygon>
<text text-anchor="start" x="164" y="-64.4" font-family="Arial" font-size="14.00">'r'</text>
<polygon fill="none" stroke="black" points="188.5,-52 188.5,-86 227.5,-86 227.5,-52 188.5,-52"></polygon>
<text text-anchor="start" x="201.43" y="-64.4" font-family="Arial" font-size="14.00">'e'</text>
<polygon fill="none" stroke="black" points="227.5,-52 227.5,-86 266.5,-86 266.5,-52 227.5,-52"></polygon>
<text text-anchor="start" x="238.5" y="-64.4" font-family="Arial" font-size="14.00">'m'</text>
<polygon fill="none" stroke="black" points="266.5,-52 266.5,-86 305.5,-86 305.5,-52 266.5,-52"></polygon>
<text text-anchor="start" x="281.38" y="-64.4" font-family="Arial" font-size="14.00">' '</text>
<polygon fill="none" stroke="black" points="305.5,-52 305.5,-86 344.5,-86 344.5,-52 305.5,-52"></polygon>
<text text-anchor="start" x="320.77" y="-64.4" font-family="Arial" font-size="14.00">'i'</text>
<polygon fill="none" stroke="black" points="344.5,-52 344.5,-86 383.5,-86 383.5,-52 344.5,-52"></polygon>
<text text-anchor="start" x="357.43" y="-64.4" font-family="Arial" font-size="14.00">'p'</text>
<polygon fill="none" stroke="black" points="383.5,-52 383.5,-86 422.5,-86 422.5,-52 383.5,-52"></polygon>
<text text-anchor="start" x="396.83" y="-64.4" font-family="Arial" font-size="14.00">'s'</text>
<polygon fill="none" stroke="black" points="422.5,-52 422.5,-86 461.5,-86 461.5,-52 422.5,-52"></polygon>
<text text-anchor="start" x="435.43" y="-64.4" font-family="Arial" font-size="14.00">'u'</text>
<polygon fill="none" stroke="black" points="461.5,-52 461.5,-86 500.5,-86 500.5,-52 461.5,-52"></polygon>
<text text-anchor="start" x="472.5" y="-64.4" font-family="Arial" font-size="14.00">'m'</text>
<polygon fill="none" stroke="black" points="500.5,-52 500.5,-86 539.5,-86 539.5,-52 500.5,-52"></polygon>
<text text-anchor="start" x="515.38" y="-64.4" font-family="Arial" font-size="14.00">' '</text>
<polygon fill="none" stroke="black" points="539.5,-52 539.5,-86 578.5,-86 578.5,-52 539.5,-52"></polygon>
<text text-anchor="start" x="552.43" y="-64.4" font-family="Arial" font-size="14.00">'d'</text>
<polygon fill="none" stroke="black" points="578.5,-52 578.5,-86 617.5,-86 617.5,-52 578.5,-52"></polygon>
<text text-anchor="start" x="591.43" y="-64.4" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="617.5,-52 617.5,-86 656.5,-86 656.5,-52 617.5,-52"></polygon>
<text text-anchor="start" x="632.77" y="-64.4" font-family="Arial" font-size="14.00">'l'</text>
<polygon fill="none" stroke="black" points="656.5,-52 656.5,-86 695.5,-86 695.5,-52 656.5,-52"></polygon>
<text text-anchor="start" x="669.43" y="-64.4" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="695.5,-52 695.5,-86 734.5,-86 734.5,-52 695.5,-52"></polygon>
<text text-anchor="start" x="710" y="-64.4" font-family="Arial" font-size="14.00">'r'</text>
<text text-anchor="start" x="742.44" y="-64.8" font-family="Arial" font-size="14.00">Stream</text>
<text text-anchor="start" x="79.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="87.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">00</text>
<text text-anchor="start" x="118.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="126.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">01</text>
<text text-anchor="start" x="157.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="165.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">02</text>
<text text-anchor="start" x="196.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="204.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">03</text>
<text text-anchor="start" x="235.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="243.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">04</text>
<text text-anchor="start" x="274.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="282.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">05</text>
<text text-anchor="start" x="313.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="321.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">06</text>
<text text-anchor="start" x="352.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="360.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">07</text>
<text text-anchor="start" x="391.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="399.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">08</text>
<text text-anchor="start" x="430.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="438.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">09</text>
<text text-anchor="start" x="469.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="477.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">10</text>
<text text-anchor="start" x="508.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="516.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">11</text>
<text text-anchor="start" x="547.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="555.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">12</text>
<text text-anchor="start" x="586.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="594.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">13</text>
<text text-anchor="start" x="625.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="633.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">14</text>
<text text-anchor="start" x="664.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="672.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">15</text>
<text text-anchor="start" x="703.32" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="711.11" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">16</text>
</g>
<!-- p -->
<g id="node2" class="node">
<title>p</title>
<text text-anchor="middle" x="227" y="-139.8" font-family="Arial" font-size="14.00">fs.Position = 4</text>
</g>
<!-- p&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="black" d="M227,-126.28C227,-126.28 227,-97.51 227,-97.51"></path>
<polygon fill="black" stroke="black" points="230.5,-97.51 227,-87.51 223.5,-97.51 230.5,-97.51"></polygon>
</g>
<!-- l -->
<g id="node3" class="node">
<title>l</title>
<text text-anchor="middle" x="735" y="-139.8" font-family="Arial" font-size="14.00">fs.Length = 17</text>
</g>
<!-- l&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>l-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" stroke-dasharray="1,5" d="M735,-126.28C735,-109.23 735,-86 735,-86"></path>
</g>
</g>
</svg>
</p><p></p>
<blockquote>
<p>üí° <strong>Tip:</strong> estos valores nos pueden ser √∫tiles para controlar si hemos llegado o no al final de las secuencia en <strong>algunos casos</strong>.<br>
Por ejemplo con la condici√≥n <strong><code>while (fichero.Position &lt; fichero.Length)</code></strong> puedo saber si estoy al final de un stream.</p>
</blockquote>
<div style="page-break-after:always;"></div>
<h5 id="desplaz√°ndonos-por-el-stream">Desplaz√°ndonos por el Stream </h5>
<p><strong>public override long <a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.filestream.seek?view=net-5.0">Seek</a>(long offset, SeekOrigin origin)</strong></p>
<ul>
<li><strong><code>long offset</code></strong>: El punto relativo a origin desde el que comienza la operaci√≥n Seek. Pude ser un valor negativo si me desplazo hacia la ‚Äúizquierda‚Äù.</li>
<li><strong><code>SeekOrigin origin</code></strong>: Especifica el comienzo, el final o la posici√≥n actual como un punto de referencia para origin, mediante el uso de un valor del <strong><code>Enum SeekOrigin</code></strong>.<br>
Estos valores pueden ser: <strong><code>Begin</code></strong>, <strong><code>Current</code></strong> y <strong><code>End</code></strong></li>
<li>
<blockquote>
<p>‚úã <strong>Nota:</strong> No en todos los streams podremos desplazarnos con <strong><code>Seek</code></strong> como en los <strong><code>FileStream</code></strong>. Por esa raz√≥n la clase base <strong><code>Stream</code></strong> dispone de una propiedad <strong><code>CanSeek</code></strong> que me dir√° si puedo desplazarme por √©l o no. F√≠jate en el siguiente ejemplo.</p>
</blockquote>
</li>
</ul>
<p><strong>Ejemplo b√°sico de uso</strong>:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">FileStream</span> fichero <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>fichero<span class="token punctuation">.</span>CanSeek<span class="token punctuation">)</span> <span class="token comment">// Para streams que no admiten desplazamientos </span>
<span class="token punctuation">{</span>
    <span class="token comment">// Me sit√∫o al final y me desplazo 1 a la izquierda.</span>
    fichero<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>End<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">// Leo el √∫ltimo byte.         </span>
    <span class="token class-name"><span class="token keyword keyword-int">int</span></span> ultimoByte <span class="token operator">=</span> fichero<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"El valor del √∫ltimo byte es </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ultimoByte</span><span class="token format-string"><span class="token punctuation">:</span>X</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-else">else</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"El stream no admite desplazamientos."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fichero<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><strong>Caso de desplazamiento 1</strong>:</p>
<p><strong><code>fichero.Seek(-1, SeekOrigin.End);</code></strong></p>
<p>Me sit√∫o al <strong>final</strong> y me desplazo <strong>1 byte a la izquierda</strong>, de tal manera que me quedo para escribir o leer sobre el √∫ltimo byte el <strong>byte n</strong>.</p>
<p></p><p align="left" style="zoom:1" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: G Pages: 1 -->
<svg width="466pt" height="170pt" viewBox="0.00 0.00 466.00 170.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 166)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-166 462,-166 462,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-8 8,-98 450,-98 450,-8 8,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<polygon fill="none" stroke="black" points="40,-52 40,-86 79,-86 79,-52 40,-52"></polygon>
<polygon fill="none" stroke="black" points="79,-52 79,-86 118,-86 118,-52 79,-52"></polygon>
<polygon fill="none" stroke="black" points="118,-52 118,-86 157,-86 157,-52 118,-52"></polygon>
<text text-anchor="start" x="164.67" y="-64.8" font-family="Arial" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="184,-52 184,-86 228,-86 228,-52 184,-52"></polygon>
<polygon fill="none" stroke="black" points="228,-52 228,-86 272,-86 272,-52 228,-52"></polygon>
<polygon fill="none" stroke="black" points="272,-52 272,-86 373,-86 373,-52 272,-52"></polygon>
<text text-anchor="start" x="280.86" y="-65.4" font-family="Arial" font-size="14.00">Byte</text>
<text text-anchor="start" x="308.87" y="-65.4" font-family="Arial" baseline-shift="sub" font-size="14.00">Lenght-1</text>
<text text-anchor="start" x="380.94" y="-64.8" font-family="Arial" font-size="14.00">Stream</text>
<text text-anchor="start" x="47.82" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="55.61" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">00</text>
<text text-anchor="start" x="86.82" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="94.61" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">01</text>
<text text-anchor="start" x="125.82" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="133.61" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">02</text>
<text text-anchor="start" x="191.99" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="199.78" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">L-3</text>
<text text-anchor="start" x="235.99" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="243.78" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">L-2</text>
<text text-anchor="start" x="308.49" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="316.28" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">L-1</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="254" y="-139.8" font-family="Arial" font-size="14.00">SeekOrigin.End-1</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="black" d="M255.35,-126.19C256.73,-117.01 259.5,-105.6 265.1,-96.07"></path>
<polygon fill="black" stroke="black" points="267.81,-98.28 271.08,-88.2 262.24,-94.04 267.81,-98.28"></polygon>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="392" y="-139.8" font-family="Arial" font-size="14.00" fill="lightgray">SeekOrigin.End</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="lightgray" d="M390.27,-126.23C388.7,-117.05 385.71,-105.65 379.99,-96.1"></path>
<polygon fill="lightgray" stroke="lightgray" points="382.79,-94 373.92,-88.2 377.24,-98.26 382.79,-94"></polygon>
</g>
</g>
</svg>
</p><p></p>
<div style="page-break-after:always;"></div>
<p><strong>Caso de desplazamiento 2</strong>:</p>
<p><strong><code>fichero.Seek(2, SeekOrigin.Begin);</code></strong></p>
<p>Me sit√∫o al <strong>principio</strong> y me desplazo <strong>2 bytes</strong> a la derecha, de tal manera que me quedo para escribir o leer sobre el <strong>byte 2</strong>.</p>
<p></p><p align="left" style="zoom:1" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: G Pages: 1 -->
<svg width="482pt" height="170pt" viewBox="0.00 0.00 482.48 170.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 166)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-166 478.48,-166 478.48,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="66.48,-8 66.48,-98 466.48,-98 466.48,-8 66.48,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<polygon fill="none" stroke="black" points="98.98,-52 98.98,-86 137.98,-86 137.98,-52 98.98,-52"></polygon>
<polygon fill="none" stroke="black" points="137.98,-52 137.98,-86 176.98,-86 176.98,-52 137.98,-52"></polygon>
<polygon fill="none" stroke="black" points="176.98,-52 176.98,-86 229.98,-86 229.98,-52 176.98,-52"></polygon>
<text text-anchor="start" x="185.58" y="-65.4" font-family="Arial" font-size="14.00">Byte</text>
<text text-anchor="start" x="213.59" y="-65.4" font-family="Arial" baseline-shift="sub" font-size="14.00">2</text>
<text text-anchor="start" x="237.64" y="-64.8" font-family="Arial" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="256.98,-52 256.98,-86 300.98,-86 300.98,-52 256.98,-52"></polygon>
<polygon fill="none" stroke="black" points="300.98,-52 300.98,-86 344.98,-86 344.98,-52 300.98,-52"></polygon>
<polygon fill="none" stroke="black" points="344.98,-52 344.98,-86 388.98,-86 388.98,-52 344.98,-52"></polygon>
<text text-anchor="start" x="396.91" y="-64.8" font-family="Arial" font-size="14.00">Stream</text>
<text text-anchor="start" x="106.8" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="114.58" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">00</text>
<text text-anchor="start" x="145.8" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="153.58" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">01</text>
<text text-anchor="start" x="191.8" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="199.58" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">02</text>
<text text-anchor="start" x="264.97" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="272.75" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">L-3</text>
<text text-anchor="start" x="308.97" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="316.75" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">L-2</text>
<text text-anchor="start" x="352.97" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="360.75" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">L-1</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="62.48" y="-139.8" font-family="Arial" font-size="14.00" fill="lightgray">SeekOrigin.Begin</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="lightgray" d="M70.77,-126.23C75.74,-117.03 82.7,-105.49 90.93,-95.4"></path>
<polygon fill="lightgray" stroke="lightgray" points="93.39,-97.9 97.46,-88.13 88.18,-93.23 93.39,-97.9"></polygon>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="213.48" y="-139.8" font-family="Arial" font-size="14.00">SeekOrigin.Begin+2</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" d="M204.68,-126.03C199.51,-116.88 192.37,-105.44 184.06,-95.38"></path>
<polygon fill="black" stroke="black" points="186.79,-93.19 177.49,-88.12 181.6,-97.89 186.79,-93.19"></polygon>
</g>
</g>
</svg>
</p><p></p>
<p><strong>Caso de desplazamiento 3</strong>:</p>
<ol>
<li>
<p><strong><code>fichero.Seek(-2, SeekOrigin.Current);</code></strong> Desde <strong>donde me encuentre</strong>, me desplazo <strong>2 bytes</strong> a la <strong>izquierda</strong>, de tal manera que me quedo para escribir o leer sobre el primer byte el <strong>byte 0</strong>.</p>
</li>
<li>
<p><strong><code>fichero.Seek(3, SeekOrigin.Current);</code></strong> Desde <strong>donde me encuentre</strong>, me desplazo <strong>3 bytes</strong> a la derecha, de tal manera que me quedo para escribir o leer sobre el <strong>byte 5</strong>.</p>
</li>
</ol>
<p></p><p align="left" style="zoom:1" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: G Pages: 1 -->
<svg width="524pt" height="170pt" viewBox="0.00 0.00 524.14 170.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 166)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-166 520.14,-166 520.14,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="110.14,-8 110.14,-98 508.14,-98 508.14,-8 110.14,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<polygon fill="none" stroke="black" points="142.14,-52 142.14,-86 195.14,-86 195.14,-52 142.14,-52"></polygon>
<text text-anchor="start" x="150.74" y="-65.4" font-family="Arial" font-size="14.00">Byte</text>
<text text-anchor="start" x="178.75" y="-65.4" font-family="Arial" baseline-shift="sub" font-size="14.00">0</text>
<polygon fill="none" stroke="black" points="195.14,-52 195.14,-86 234.14,-86 234.14,-52 195.14,-52"></polygon>
<text text-anchor="start" x="210.75" y="-64.4" font-family="Arial" font-size="14.00"> &nbsp;</text>
<polygon fill="none" stroke="black" points="234.14,-52 234.14,-86 273.14,-86 273.14,-52 234.14,-52"></polygon>
<text text-anchor="start" x="249.75" y="-64.4" font-family="Arial" font-size="14.00"> &nbsp;</text>
<polygon fill="none" stroke="black" points="273.14,-52 273.14,-86 312.14,-86 312.14,-52 273.14,-52"></polygon>
<text text-anchor="start" x="288.75" y="-64.4" font-family="Arial" font-size="14.00"> &nbsp;</text>
<polygon fill="none" stroke="black" points="312.14,-52 312.14,-86 351.14,-86 351.14,-52 312.14,-52"></polygon>
<text text-anchor="start" x="327.75" y="-64.4" font-family="Arial" font-size="14.00"> &nbsp;</text>
<polygon fill="none" stroke="black" points="351.14,-52 351.14,-86 404.14,-86 404.14,-52 351.14,-52"></polygon>
<text text-anchor="start" x="359.74" y="-65.4" font-family="Arial" font-size="14.00">Byte</text>
<text text-anchor="start" x="387.75" y="-65.4" font-family="Arial" baseline-shift="sub" font-size="14.00">5</text>
<text text-anchor="start" x="411.8" y="-64.8" font-family="Arial" font-size="14.00">...</text>
<text text-anchor="start" x="439.08" y="-64.8" font-family="Arial" font-size="14.00">Stream</text>
<text text-anchor="start" x="156.96" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="164.74" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">00</text>
<text text-anchor="start" x="202.96" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="210.74" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">01</text>
<text text-anchor="start" x="241.96" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="249.74" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">02</text>
<text text-anchor="start" x="280.96" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="288.74" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">03</text>
<text text-anchor="start" x="319.96" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="327.74" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">04</text>
<text text-anchor="start" x="365.96" y="-32.4" font-family="Arial" font-size="14.00">b</text>
<text text-anchor="start" x="373.74" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00">05</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="74.14" y="-139.8" font-family="Arial" font-size="14.00">SeekOrigin.Current-2</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="black" d="M96.81,-126.12C107.93,-117.49 121.55,-106.41 133.87,-94.96"></path>
<polygon fill="black" stroke="black" points="136.27,-97.51 141.05,-88.05 131.42,-92.46 136.27,-97.51"></polygon>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="234.14" y="-139.8" font-family="Arial" font-size="14.00" fill="lightgray">SeekOrigin.Current</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="lightgray" d="M228.52,-126.17C226.34,-117.14 225.05,-106.01 228.19,-96.76"></path>
<polygon fill="lightgray" stroke="lightgray" points="231.14,-98.65 233.35,-88.29 225.16,-95.01 231.14,-98.65"></polygon>
</g>
<!-- p3 -->
<g id="node4" class="node">
<title>p3</title>
<text text-anchor="middle" x="396.14" y="-139.8" font-family="Arial" font-size="14.00">SeekOrigin.Current+3</text>
</g>
<!-- p3&#45;&gt;cluster0_stream -->
<g id="edge3" class="edge">
<title>p3-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" d="M384.03,-126.03C377.25,-116.93 368.27,-105.47 358.8,-95.06"></path>
<polygon fill="black" stroke="black" points="361.61,-92.93 352.18,-88.1 356.54,-97.75 361.61,-92.93"></polygon>
</g>
</g>
</svg>
</p><p></p>
<div style="page-break-after:always;"></div>
<h5 id="recorriendo-un-filestream-hasta-el-final">Recorriendo un FileStream hasta el final </h5>
<p>Veamos a trav√©s de un ejemplo simple, varias formas de recorrer leyendo un <strong><code>FileStream</code></strong> hasta el final de la secuencia.</p>
<ul>
<li>
<p><strong>Caso 1:</strong></p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">FileStream</span> fs <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> buffer <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span><span class="token string">"Lorem ipsum dolor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Definimos un buffer de 3 bytes para las lecturas</span>
    <span class="token comment">// esto es, podremos leer de tres en tres bytes con fs.read()</span>
    <span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> datos <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-byte">byte</span></span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword keyword-int">int</span></span> bytesLeidos<span class="token punctuation">;</span>
    <span class="token keyword keyword-do">do</span>
    <span class="token punctuation">{</span>
        bytesLeidos <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>datos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> datos<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bytesLeidos<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>datos<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>bytesLeidos <span class="token operator">&gt;=</span> datos<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p>En el c√≥digo anterior, leer√© el stream mientras se llene el buffer de 3 bytes en cada lectura. En el momento que lea menos de 3 es que he llegado al final de la secuencia.</p>
<blockquote>
<p>‚ö†Ô∏è üíÄ <strong>Aviso:</strong> No deber√≠amos recorrer en ning√∫n caso el buffer con un <strong><code>foreach</code></strong> ya que siempre recorrer√° 3 que es la longitud del buffer y podr√≠amos haber le√≠do solo 2 y por tanto podr√≠a mostrarme bytes que realmente no he le√≠do y que est√°n en el buffer de lecturas anteriores.</p>
</blockquote>
</li>
<li>
<p><strong>Caso 2:</strong></p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code>    fs<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>Begin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Vuelvo al principio para volver a recorrerla.</span>
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span>Position <span class="token operator">&lt;</span> fs<span class="token punctuation">.</span>Length<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        bytesLeidos <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>datos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> datos<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bytesLeidos<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>datos<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p>Recorreremos la secuencia, mientras la <strong>posici√≥n</strong> en la que nos encontramos sea menor que la <strong>longitud</strong> de la misma.</p>
</li>
<li>
<p><strong>Caso 3:</strong></p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code>    fs<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>Begin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Vuelvo al principio para volver a recorrerla.</span>
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword keyword-int">int</span></span> _byte<span class="token punctuation">;</span>
    <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>_byte <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>_byte</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p>Voy <strong>leyendo byte a byte</strong> mientras el valor de byte le√≠do sea distinto de -1 o positivo.</p>
<blockquote>
<p>‚ö†Ô∏è <strong>Nota:</strong> Esta opci√≥n es mucho m√°s ineficiente en t√©rminos temporales que leer bloques de bytes con Read().</p>
</blockquote>
</li>
</ul>
<div style="page-break-after:always;"></div>
<h4 id="pasando-el-flujo-por-un-decorator-stream">Pasando el flujo por un '<em>Decorator Stream</em>' </h4>
<p>Aunque este tipo de streams no los vamos a ver en profundidad en este curso por falta de tiempo. B√°sicamente, un <strong><a href="https://es.wikipedia.org/wiki/Decorator_(patr%C3%B3n_de_dise%C3%B1o)">decorator</a></strong> en POO es un patr√≥n de dise√±o que a√±ade funcionalidad a un objetos sin necesidad de utilizar el mecanismo de her√©ncia.</p>
<h5 id="ejemplo-de-decorator-stream-usando-bufferedstream">Ejemplo de '<em>Decorator Stream</em>' usando BufferedStream </h5>
<p>La funcionalidad que agrega una capa de almacenamiento en buffer a las operaciones de lectura y escritura para otra secuencia (la cual '<em>envuelve</em>').</p>
<blockquote>
<p><strong>Nota:</strong> Aunque <strong><code>FileStream</code></strong> ya tiene un buffer de escritura intermedio por defecto, nosotros <strong>podremos ampliarlo o reducirlo</strong> mediante esta capa de abstracci√≥n.</p>
</blockquote>
<p></p><p align="center" style="zoom:0.6" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: G Pages: 1 -->
<svg width="1129pt" height="208pt" viewBox="0.00 0.00 1129.24 208.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 204)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-204 1125.24,-204 1125.24,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-12 8,-156 168,-156 168,-12 8,-12"></polygon>
<text text-anchor="middle" x="88" y="-125" font-family="Arial" font-size="30.00">Datos</text>
</g>
<g id="clust2" class="cluster">
<title>clusterG</title>
<polygon fill="none" stroke="#104e8b" points="288.41,-8 288.41,-192 820.83,-192 820.83,-8 288.41,-8"></polygon>
<text text-anchor="middle" x="554.62" y="-161" font-family="Arial" font-size="30.00" fill="#104e8b">Clases para el manejo de streams</text>
</g>
<g id="clust3" class="cluster">
<title>cluster2</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="293.41,-13 293.41,-143 477.41,-143 477.41,-13 293.41,-13"></polygon>
<text text-anchor="middle" x="385.41" y="-121" font-family="Arial" font-size="20.00" fill="#104e8b">Decorator Streams</text>
</g>
<g id="clust4" class="cluster">
<title>cluster3</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="595.83,-13 595.83,-143 815.83,-143 815.83,-13 595.83,-13"></polygon>
<text text-anchor="middle" x="705.83" y="-121" font-family="Arial" font-size="20.00" fill="#104e8b">Backing Store Streams</text>
</g>
<g id="clust5" class="cluster">
<title>cluster4</title>
<polygon fill="none" stroke="none" points="929.24,-13 929.24,-155 1113.24,-155 1113.24,-13 929.24,-13"></polygon>
<text text-anchor="middle" x="1021.24" y="-124" font-family="Arial" font-size="30.00">Dispositivos</text>
</g>
<!-- Bytes -->
<g id="node1" class="node">
<title>Bytes</title>
<polygon fill="none" stroke="black" points="154,-104 16,-104 16,-20 160,-20 160,-98 154,-104"></polygon>
<polyline fill="none" stroke="black" points="154,-104 154,-98"></polyline>
<polyline fill="none" stroke="black" points="160,-98 154,-98"></polyline>
<text text-anchor="middle" x="88" y="-68" font-family="Arial" font-size="20.00">Bytes sin</text>
<text text-anchor="middle" x="88" y="-44" font-family="Arial" font-size="20.00">transformar</text>
</g>
<!-- BufferedStream -->
<g id="node2" class="node">
<title>BufferedStream</title>
<polygon fill="#4f94cd" stroke="#4f94cd" points="457.41,-90.8 313.41,-90.8 313.41,-33.2 457.41,-33.2 457.41,-90.8"></polygon>
</g>
<!-- Bytes&#45;&gt;BufferedStream -->
<g id="edge1" class="edge">
<title>Bytes-&gt;BufferedStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M174.92,-62C174.92,-62 298.43,-62 298.43,-62"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="174.92,-58.5 164.92,-62 174.92,-65.5 174.92,-58.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="298.43,-65.5 308.43,-62 298.43,-58.5 298.43,-65.5"></polygon>
<text text-anchor="middle" x="236.71" y="-67.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- FileStream -->
<g id="node3" class="node">
<title>FileStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="777.83,-90.8 633.83,-90.8 633.83,-33.2 777.83,-33.2 777.83,-90.8"></polygon>
</g>
<!-- BufferedStream&#45;&gt;FileStream -->
<g id="edge2" class="edge">
<title>BufferedStream-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M472.26,-62C472.26,-62 618.96,-62 618.96,-62"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="472.26,-58.5 462.26,-62 472.26,-65.5 472.26,-58.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="618.96,-65.5 628.96,-62 618.96,-58.5 618.96,-65.5"></polygon>
<text text-anchor="middle" x="534.12" y="-67.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- Fichero -->
<g id="node4" class="node">
<title>Fichero</title>
<polygon fill="none" stroke="black" points="1093.24,-90.8 953.24,-90.8 949.24,-86.8 949.24,-33.2 1089.24,-33.2 1093.24,-37.2 1093.24,-90.8"></polygon>
<polyline fill="none" stroke="black" points="1089.24,-86.8 949.24,-86.8"></polyline>
<polyline fill="none" stroke="black" points="1089.24,-86.8 1089.24,-33.2"></polyline>
<polyline fill="none" stroke="black" points="1089.24,-86.8 1093.24,-90.8"></polyline>
</g>
<!-- FileStream&#45;&gt;Fichero -->
<g id="edge3" class="edge">
<title>FileStream-&gt;Fichero</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M792.73,-62C792.73,-62 934.4,-62 934.4,-62"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="792.73,-58.5 782.73,-62 792.73,-65.5 792.73,-58.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="934.4,-65.5 944.4,-62 934.4,-58.5 934.4,-65.5"></polygon>
<text text-anchor="middle" x="872.53" y="-67.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
</g>
</svg>
</p><p></p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Stopwatch</span> cronometro <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">Stopwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    cronometro<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileStream</span> fichero <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"prueba.txt"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Voy escribiendo bytes y cuando se llene el buffer del FileStream que yo no controlo</span>
    <span class="token comment">// se realizar√° un volcado (flush) del mismo en el disco.</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
        fichero<span class="token punctuation">.</span><span class="token function">WriteByte</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fichero<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cronometro<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Sin BufferedStream milisegundos = </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">cronometro<span class="token punctuation">.</span>ElapsedMilliseconds</span><span class="token punctuation">}</span></span><span class="token string">ms"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    cronometro<span class="token punctuation">.</span><span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cronometro<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fichero <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"prueba.txt"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// A√±ado un decorador que me a√±ade la posibilidad de gestionar un buffer de forma</span>
    <span class="token comment">// 'transparente' antes del mandar los bytes al FileStream.</span>
    <span class="token comment">// Le a√±ado una capacidad de almacenaje en memoria antes de volcado de 100 bytes</span>
    <span class="token comment">// que es bastante menor que la que tiene el FileStream por defecto. Lo cual </span>
    <span class="token comment">// ralentizar√° much√≠simo la escritura porque se realizar√°n m√°s volcados o (flush). </span>
    <span class="token comment">// en el disco que es una operaci√≥n extrem√°damente costosa.                     </span>
    <span class="token class-name">BufferedStream</span> ficheroBuff <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">BufferedStream</span><span class="token punctuation">(</span>fichero<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
        ficheroBuff<span class="token punctuation">.</span><span class="token function">WriteByte</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ficheroBuff<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cronometro<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Sin BufferedStream milisegundos = </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">cronometro<span class="token punctuation">.</span>ElapsedMilliseconds</span><span class="token punctuation">}</span></span><span class="token string">ms"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><blockquote>
<p><strong>üéì Casos de estudio</strong>:</p>
<ul>
<li>Prueba a ver que sucede si aumentamos la capacidad de  almacenaje del <strong><code>BufferedStream</code></strong> de <strong>100</strong> a <strong>1000000</strong>.</li>
<li>Prueba a ver que sucede si hacemos un <strong><code>Flush()</code></strong> despu√©s  de cada escritura.</li>
</ul>
</blockquote>
<div style="page-break-after:always;"></div>
<h4 id="transformando-el-flujo-con-un-stream-adapter">Transformando el flujo con un '<em>Stream Adapter</em>' </h4>
<p>Un <strong><a href="https://es.wikipedia.org/wiki/Adaptador_(patr%C3%B3n_de_dise%C3%B1o)">adaptador</a></strong> en POO es un patr√≥n de dise√±o que b√°sicamente se utiliza para ampliar y/o transformar el interfaz de las operaciones sobre una determinada clase.</p>
<ul>
<li>
<p><strong>Raz√≥n de ser:</strong></p>
<p>La forma de acceder a ficheros a nivel de Byte no es muy conveniente, en tanto que generalmente, en las aplicaciones no suele trabajarse directamente con bytes sino con objetos m√°s complejos formados por m√∫ltiples bytes y/o cadenas de texto. Por esto, en <strong><code>System.IO</code></strong> se han incluido tipos que encapsulan <strong><code>FileStream</code></strong> a trav√©s de una agregaci√≥n y les proporcionan una serie de m√©todos mejorados con los que se simplifica la lectura y escritura de datos de cualquier tipo en ficheros.</p>
<blockquote>
<p>üì£ <strong>Resumen:</strong></p>
<ul>
<li>Trabajar con <strong>arrays de bytes</strong> (buffers) es poco √∫til adem√°s de engorroso.</li>
<li>Son una capa de abstracci√≥n para manejar de forma m√°s c√≥moda los tipos datos que usamos en nuestros programas.</li>
<li>'<em>Envuelven</em>' otros streams de almacenamiento abiertos como por ejemplo <strong><code>FileStream</code></strong>.</li>
</ul>
</blockquote>
</li>
</ul>
<h5 id="stream-adapters-binarywriter-y-binaryreader">Stream Adapters BinaryWriter y BinaryReader </h5>
<p>B√°sicamente escriben o leen tipos b√°sicos del lenguaje en una secuencia y tambi√©n escriben o leen cadenas en una <strong>codificaci√≥n espec√≠fica</strong>.</p>
<p></p><p align="center" style="zoom:0.6" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: G Pages: 1 -->
<svg width="1243pt" height="284pt" viewBox="0.00 0.00 1242.77 284.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 280)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-280 1238.77,-280 1238.77,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-54 8,-198 182.27,-198 182.27,-54 8,-54"></polygon>
<text text-anchor="middle" x="95.13" y="-167" font-family="Arial" font-size="30.00">Datos</text>
</g>
<g id="clust2" class="cluster">
<title>clusterG</title>
<polygon fill="none" stroke="#104e8b" points="401.95,-8 401.95,-268 934.36,-268 934.36,-8 401.95,-8"></polygon>
<text text-anchor="middle" x="668.15" y="-237" font-family="Arial" font-size="30.00" fill="#104e8b">Clases para el manejo de streams</text>
</g>
<g id="clust3" class="cluster">
<title>cluster1</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="406.95,-13 406.95,-219 590.95,-219 590.95,-13 406.95,-13"></polygon>
<text text-anchor="middle" x="498.95" y="-197" font-family="Arial" font-size="20.00" fill="#104e8b">Stream Adapters</text>
</g>
<g id="clust4" class="cluster">
<title>cluster3</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="709.36,-43 709.36,-173 929.36,-173 929.36,-43 709.36,-43"></polygon>
<text text-anchor="middle" x="819.36" y="-151" font-family="Arial" font-size="20.00" fill="#104e8b">Backing Store Streams</text>
</g>
<g id="clust5" class="cluster">
<title>cluster4</title>
<polygon fill="none" stroke="none" points="1042.77,-43 1042.77,-185 1226.77,-185 1226.77,-43 1042.77,-43"></polygon>
<text text-anchor="middle" x="1134.77" y="-154" font-family="Arial" font-size="30.00">Dispositivos</text>
</g>
<!-- Bytes -->
<g id="node1" class="node">
<title>Bytes</title>
<polygon fill="none" stroke="black" points="168.27,-146 16,-146 16,-62 174.27,-62 174.27,-140 168.27,-146"></polygon>
<polyline fill="none" stroke="black" points="168.27,-146 168.27,-140"></polyline>
<polyline fill="none" stroke="black" points="174.27,-140 168.27,-140"></polyline>
<text text-anchor="middle" x="95.13" y="-110" font-family="Arial" font-size="20.00">Tipos b√°sicos</text>
<text text-anchor="middle" x="95.13" y="-86" font-family="Arial" font-size="20.00">del CLR.</text>
</g>
<!-- BinaryWriter -->
<g id="node2" class="node">
<title>BinaryWriter</title>
<polygon fill="#36648b" stroke="#36648b" points="570.95,-166.8 426.95,-166.8 426.95,-109.2 570.95,-109.2 570.95,-166.8"></polygon>
</g>
<!-- Bytes&#45;&gt;BinaryWriter -->
<g id="edge1" class="edge">
<title>Bytes-&gt;BinaryWriter</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M174.56,-110.64C242.93,-116.42 341.91,-124.8 412.33,-130.76"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="411.67,-134.21 421.93,-131.57 412.26,-127.24 411.67,-134.21"></polygon>
<text text-anchor="middle" x="300.61" y="-155.5" font-family="Arial" font-size="19.00" fill="#1874cd">int, char, double,</text>
<text text-anchor="middle" x="300.61" y="-132.7" font-family="Arial" font-size="19.00" fill="#1874cd">bool, string, etc...</text>
</g>
<!-- BinaryReader -->
<g id="node3" class="node">
<title>BinaryReader</title>
<polygon fill="#36648b" stroke="#36648b" points="570.95,-90.8 426.95,-90.8 426.95,-33.2 570.95,-33.2 570.95,-90.8"></polygon>
</g>
<!-- Bytes&#45;&gt;BinaryReader -->
<g id="edge2" class="edge">
<title>Bytes-&gt;BinaryReader</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M188.91,-92.64C202.11,-91.1 215.53,-89.58 228.27,-88.2 295.49,-80.92 372.25,-73.55 426.64,-68.49"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="188.74,-89.14 179.21,-93.78 189.55,-96.09 188.74,-89.14"></polygon>
<text text-anchor="middle" x="300.61" y="-93.7" font-family="Arial" font-size="19.00" fill="#1874cd">Tipos b√°sicos</text>
</g>
<!-- FileStream -->
<g id="node4" class="node">
<title>FileStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="891.36,-120.8 747.36,-120.8 747.36,-63.2 891.36,-63.2 891.36,-120.8"></polygon>
</g>
<!-- BinaryWriter&#45;&gt;FileStream -->
<g id="edge3" class="edge">
<title>BinaryWriter-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M571.4,-127.68C619.15,-120.78 682.21,-111.67 732.66,-104.38"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="732.97,-107.87 742.37,-102.98 731.97,-100.94 732.97,-107.87"></polygon>
<text text-anchor="middle" x="647.65" y="-124.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- BinaryReader&#45;&gt;FileStream -->
<g id="edge4" class="edge">
<title>BinaryReader-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M585.61,-70.07C636.05,-74.82 699.11,-80.76 746.86,-85.26"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="586.21,-66.61 575.92,-69.16 585.55,-73.58 586.21,-66.61"></polygon>
<text text-anchor="middle" x="647.65" y="-82.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- Fichero -->
<g id="node5" class="node">
<title>Fichero</title>
<polygon fill="none" stroke="black" points="1206.77,-120.8 1066.77,-120.8 1062.77,-116.8 1062.77,-63.2 1202.77,-63.2 1206.77,-67.2 1206.77,-120.8"></polygon>
<polyline fill="none" stroke="black" points="1202.77,-116.8 1062.77,-116.8"></polyline>
<polyline fill="none" stroke="black" points="1202.77,-116.8 1202.77,-63.2"></polyline>
<polyline fill="none" stroke="black" points="1202.77,-116.8 1206.77,-120.8"></polyline>
</g>
<!-- FileStream&#45;&gt;Fichero -->
<g id="edge5" class="edge">
<title>FileStream-&gt;Fichero</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M905.97,-92C950.15,-92 1003.91,-92 1048.1,-92"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="906.02,-88.5 896.02,-92 906.02,-95.5 906.02,-88.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1047.85,-95.5 1057.85,-92 1047.85,-88.5 1047.85,-95.5"></polygon>
<text text-anchor="middle" x="986.06" y="-97.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
</g>
</svg>
</p><p></p>
<ul>
<li>Sus m√©todo de escritura <strong><code>Write</code></strong> y lectura <strong><code>Read&lt;Tipo&gt;</code></strong> '<em>adaptar√°n</em>' los Write y Read de FileStream permitiendo escribir y leer respectivamente los tipos b√°sicos definidos en el lenguaje, <strong><code>int</code></strong>, <strong><code>short</code></strong>, <strong><code>string</code></strong> etc.</li>
<li>Estos tipos b√°sicos se transformar√°n en una secuencia de bytes <strong>tal y como los guarda internamente en memoria .NET</strong>. Por tanto, si hacemos un <strong><code>Write</code></strong> de una <strong>cadena</strong> la escribir√° en disco guardando la marca de fin de cadena para saber hasta donde tiene que leer en un posterior <strong><code>ReadString</code></strong> del adaptador de lectura.</li>
</ul>
<p><strong>Adaptador <code>BinaryWriter</code></strong></p>
<p>El constructor b√°sico ser√° <strong><code>BinaryWriter(Stream streamAdaptado, Encoding codificacionCadenas)</code></strong></p>
<p>Veamos un <strong>ejemplo b√°sico de uso</strong> escribiendo un tipo <strong><code>int</code></strong> (entero) en la secuencia.</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token comment">// Creamos el FileStream</span>
<span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"ejemplo.bin"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Lo pasamos a un objeto adaptador como una agregaci√≥n, indic√°ndo que las cadenas las </span>
<span class="token comment">// codifique c√≥mo UTF-8. </span>
<span class="token comment">// Aunque es posible hacerlo, ya no deber√≠amos usar el fs porque ahora es responsabilidad del BinaryWriter.</span>
<span class="token class-name">BinaryWriter</span> bw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">BinaryWriter</span><span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword keyword-int">int</span></span> valor <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment">// El Write de bw espera todos los tipos b√°sicos del lenguaje y los adaptar√°</span>
<span class="token comment">// a la secuencia de bytes correspondiente para pas√°rselos al fs que adapta.</span>
bw<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>valor<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// El Close de BinaryWriter cerrar√° el stream subyacente al que est√° adaptando.</span>
bw<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p></p><p align="center" style="zoom:0.8" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: G Pages: 1 -->
<svg width="441pt" height="113pt" viewBox="0.00 0.00 440.80 112.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 108.6)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-108.6 436.8,-108.6 436.8,4 -4,4"></polygon>
<!-- bw -->
<g id="node1" class="node">
<title>bw</title>
<ellipse fill="none" stroke="black" cx="23.38" cy="-61.8" rx="23.38" ry="23.38"></ellipse>
<text text-anchor="middle" x="23.38" y="-57.6" font-family="Arial" font-size="14.00">bw</text>
</g>
<!-- obw -->
<g id="node2" class="node">
<title>obw</title>
<polygon fill="none" stroke="black" points="90.76,-61.8 90.76,-100.6 236.44,-100.6 236.44,-61.8 90.76,-61.8"></polygon>
<text text-anchor="start" x="101.76" y="-77" font-family="Arial" font-size="14.00"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BinaryWriter &nbsp;&nbsp;&nbsp;</text>
<polygon fill="none" stroke="black" points="90.76,-23 90.76,-61.8 236.44,-61.8 236.44,-23 90.76,-23"></polygon>
<text text-anchor="start" x="122.71" y="-38.2" font-family="Arial" font-size="14.00">streamAdaptado</text>
</g>
<!-- bw&#45;&gt;obw -->
<g id="edge1" class="edge">
<title>bw-&gt;obw</title>
<path fill="none" stroke="black" d="M47.21,-61.8C54.32,-61.8 62.65,-61.8 71.52,-61.8"></path>
<polygon fill="black" stroke="black" points="71.47,-65.3 81.47,-61.8 71.47,-58.3 71.47,-65.3"></polygon>
</g>
<!-- ofs -->
<g id="node3" class="node">
<title>ofs</title>
<polygon fill="none" stroke="black" points="288.44,-42.8 288.44,-81.6 424.8,-81.6 424.8,-42.8 288.44,-42.8"></polygon>
<text text-anchor="start" x="299.44" y="-58" font-family="Arial" font-size="14.00"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FileStream &nbsp;&nbsp;&nbsp;</text>
<polygon fill="none" stroke="black" points="288.44,-4 288.44,-42.8 424.8,-42.8 424.8,-4 288.44,-4"></polygon>
<text text-anchor="start" x="350.79" y="-19.2" font-family="Arial" font-size="14.00">...</text>
</g>
<!-- obw&#45;&gt;ofs -->
<g id="edge2" class="edge">
<title>obw:stream-&gt;ofs</title>
<path fill="none" stroke="black" d="M226.6,-42.8C240.39,-42.8 255,-42.8 269.25,-42.8"></path>
<polygon fill="black" stroke="black" points="269.06,-46.3 279.06,-42.8 269.06,-39.3 269.06,-46.3"></polygon>
</g>
</g>
</svg>
</p><p></p>
<div style="page-break-after:always;"></div>
<p>Una  implementaci√≥n simplificada de lo que har√≠a el <strong><code>Write</code></strong> del <strong><code>BinaryWriter</code></strong> en la <code>l√≠nea 11</code> ser√≠a la siguiente...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">BinaryWriter</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name">Stream</span> streamAdaptado<span class="token punctuation">;</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name">Encoding</span> codificacionCadenas<span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Write</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> valor<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Adapto el entero a un array de bits.</span>
        <span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> bytes <span class="token operator">=</span> BitConverter<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>valor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Lo escribo en el flujo que estoy adaptando.</span>
        streamAdaptado<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytes<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>De hecho, si ahora ley√©semos la secuencia de bytes en '<em>bruto</em>' de lo que se ha grabado en en fichero con el siguiente c√≥digo...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"ejemplo.bin"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Reservo espacio para leer los 4 bytes (32 bits) resultado de guardar el entero.</span>
<span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> bytesInt <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-byte">byte</span></span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// Los leo con un FileStream normal.</span>
fs<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>bytesInt<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytesInt<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Algunos Sistemas Operativos guardan los bytes a la inversa en memoria, </span>
<span class="token comment">// por tanto tengo que preguntar si lo est√°n haciendo as√≠ para invertirlos. </span>
<span class="token comment">// Si tines curiosidad en saber el porqu√© puedes leer esta entrada de la </span>
<span class="token comment">// Wikipedia https://es.wikipedia.org/wiki/Endianness aunque no es objetivo de este curso.</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>BitConverter<span class="token punctuation">.</span>IsLittleEndian<span class="token punctuation">)</span>
    Array<span class="token punctuation">.</span><span class="token function">Reverse</span><span class="token punctuation">(</span>bytesInt<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Muestro cada uno de los bytes le√≠dos.</span>
<span class="token comment">// Nos mostrar√° 0000000A que es el 10 en hexadecimal guardado con 32 bits.</span>
Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"Valor guardado en hexadecimal: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-byte">byte</span></span> _byte <span class="token keyword keyword-in">in</span> bytesInt<span class="token punctuation">)</span> 
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_byte</span><span class="token format-string"><span class="token punctuation">:</span>X2</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>Algo similar har√° para el resto de tipos b√°sicos y en el caso concreto de las cadenas realizaremos un proceso parecido utilizando la codificaci√≥n indicada (<strong>Si no la indicamos en el constructor por defecto ser√° UTF-8</strong>). Las codificaciones pueden ser ...</p>
<table>
<thead>
<tr>
<th style="text-align:left">Propiedad</th>
<th style="text-align:left">Formato que representa el objeto devuelto</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>ASCII</strong></td>
<td style="text-align:left">ASCII (7 bits por car√°cter)</td>
</tr>
<tr>
<td style="text-align:left"><strong>Unicode</strong></td>
<td style="text-align:left">Unicode (16 bits por car√°cter) usando notaci√≥n little-endian</td>
</tr>
<tr>
<td style="text-align:left"><strong>BigEndianUnicode</strong></td>
<td style="text-align:left">Unicode (16 bits por car√°cter) usando notaci√≥n big-endian</td>
</tr>
<tr>
<td style="text-align:left"><strong>UTF8</strong></td>
<td style="text-align:left">UTF8 (16 bits por car√°cter en grupos de 8 bits)</td>
</tr>
<tr>
<td style="text-align:left"><strong>UTF7</strong></td>
<td style="text-align:left">UTF7(16 bits por car√°cter en grupos de 7 bits)</td>
</tr>
<tr>
<td style="text-align:left"><strong>Default</strong></td>
<td style="text-align:left">Juego de caracteres usado por defecto en el sistema.</td>
</tr>
</tbody>
</table>
<blockquote>
<p>‚úã <strong>Importante</strong>:</p>
<p>Es importante tener en cuenta que la codificaci√≥n a usar al leer los caracteres de un fichero de texto debe ser la misma que la que se us√≥ para escribirlos, pues si no podr√≠an obtenerse resultados extra√±os.<br>
Adem√°s, aunque binary reader permita guardar y leer cadenas. Al guardarse tal y como se almacenan en memoria, su uso no estar√° indicado para leer y escribir ficheros de texto <strong><code>.txt</code></strong> para ser abiertos posteriormente por un editor como el <strong>notepad</strong>.</p>
</blockquote>
<div style="page-break-after:always;"></div>
<p><strong>Adaptador <code>BinaryReader</code></strong></p>
<p>El constructor b√°sico ser√° <strong><code>BinaryReader(Stream streamAdaptado, Encoding codificacionCadenas)</code></strong></p>
<p>Realizar√° el proceso inverso al <strong>BinaryWriter</strong> y tendr√©mos un m√©todo de lectura espec√≠fico para la adaptar la lectura de cada tipo b√°sico.</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"ejemplo.bin"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BinaryReader</span> br <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">BinaryReader</span><span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Leemos un entero de 4 bytes (32 bits) a partir de la posici√≥n donde se encuentre</span>
<span class="token comment">// el descriptor del fichero actualmente.</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> valor <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">ReadInt32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"El valor guardado como ulong es: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">valor</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
br<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p>Si nos fijamos el los <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.binaryreader?view=net-5.0#methods">m√©todos de lectura definidos por la clase</a></strong>, todos leer√°n los tipos definidos en el lenguaje y al leer cualquier tipo, el descriptor del flujo avanzar√° en el mismo. Sin embargo habr√° un caso especial de dos m√©todos que se complementan y comentaremos a continuaci√≥n.</p>
<ul>
<li>
<p><strong><code>char ReadChar()</code></strong>: Leer√° un caracter del flujo y <strong>avanzar√° el descriptor</strong>. Si el descriptor se encuentra al final del mismo, se producir√° una excepti√≥n.</p>
<blockquote>
<p><strong>Nota:</strong> El n√∫mero de bytes que avanza el descriptor, depender√° de la codificaci√≥n de caracteres indicada. Por ejemplo <strong>1 byte</strong> para <strong>UTF7</strong> y <strong>2 bytes</strong> para <strong>Unicode</strong>.</p>
</blockquote>
</li>
</ul>
<p align="center" style="zoom:0.8" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: G Pages: 1 -->
<svg width="550pt" height="189pt" viewBox="0.00 0.00 550.31 188.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184.8)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-184.8 546.31,-184.8 546.31,4 -4,4"></polygon>
<text text-anchor="middle" x="271.15" y="-164.2" font-family="Arial" font-size="14.00">Ejemplo descriptor con ReadChar() y codificaci√≥n UTF7</text>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-8 8,-83.6 504,-83.6 504,-8 8,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<text text-anchor="start" x="48.1" y="-41.6" font-family="Arial" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="67.77,-20 67.77,-71.6 85.77,-71.6 85.77,-20 67.77,-20"></polygon>
<polygon fill="none" stroke="black" points="85.77,-20 85.77,-71.6 134.13,-71.6 134.13,-20 85.77,-20"></polygon>
<text text-anchor="start" x="94.77" y="-50" font-family="Arial" font-size="14.00">0x63</text>
<text text-anchor="start" x="103.78" y="-33.2" font-family="Arial" font-size="14.00">'c'</text>
<polygon fill="none" stroke="black" points="134.13,-20 134.13,-71.6 183.26,-71.6 183.26,-20 134.13,-20"></polygon>
<text text-anchor="start" x="143.13" y="-50" font-family="Arial" font-size="14.00">0x6F</text>
<text text-anchor="start" x="152.13" y="-33.2" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="183.26,-20 183.26,-71.6 233.17,-71.6 233.17,-20 183.26,-20"></polygon>
<text text-anchor="start" x="192.26" y="-50" font-family="Arial" font-size="14.00">0x6E</text>
<text text-anchor="start" x="201.64" y="-33.2" font-family="Arial" font-size="14.00">'n'</text>
<polygon fill="none" stroke="black" points="233.17,-20 233.17,-71.6 251.17,-71.6 251.17,-20 233.17,-20"></polygon>
<text text-anchor="start" x="259.17" y="-41.6" font-family="Arial" font-size="14.00">...</text>
<text text-anchor="start" x="302.83" y="-41.6" font-family="Arial" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="322.5,-20 322.5,-71.6 340.5,-71.6 340.5,-20 322.5,-20"></polygon>
<polygon fill="none" stroke="black" points="340.5,-20 340.5,-71.6 388.86,-71.6 388.86,-20 340.5,-20"></polygon>
<text text-anchor="start" x="349.5" y="-50" font-family="Arial" font-size="14.00">0x63</text>
<text text-anchor="start" x="358.51" y="-33.2" font-family="Arial" font-size="14.00">'c'</text>
<polygon fill="none" stroke="black" points="388.86,-20 388.86,-71.6 437.99,-71.6 437.99,-20 388.86,-20"></polygon>
<text text-anchor="start" x="397.86" y="-50" font-family="Arial" font-size="14.00">0x6F</text>
<text text-anchor="start" x="406.86" y="-33.2" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="437.99,-20 437.99,-71.6 487.9,-71.6 487.9,-20 437.99,-20"></polygon>
<text text-anchor="start" x="446.99" y="-50" font-family="Arial" font-size="14.00">0x6E</text>
<text text-anchor="start" x="456.38" y="-33.2" font-family="Arial" font-size="14.00">'n'</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="105" y="-131" font-family="Arial" font-size="14.00" fill="lightgray">Antes</text>
<text text-anchor="middle" x="105" y="-114.2" font-family="Arial" font-size="14.00" fill="lightgray">ReadChar()</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="lightgray" d="M112.49,-106.16C116,-98.38 120.71,-89.42 126.58,-81.49"></path>
<polygon fill="lightgray" stroke="lightgray" points="129.19,-83.83 133.02,-73.95 123.86,-79.28 129.19,-83.83"></polygon>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="212" y="-139.4" font-family="Arial" font-size="14.00">Despu√©s</text>
<text text-anchor="middle" x="212" y="-122.6" font-family="Arial" font-size="14.00">ReadChar()</text>
<text text-anchor="middle" x="212" y="-105.8" font-family="Arial" font-size="14.00">retorna 'o'</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" d="M200.38,-97.64C197.55,-92.22 194.22,-86.62 190.4,-81.47"></path>
<polygon fill="black" stroke="black" points="193.14,-79.28 183.98,-73.95 187.82,-83.83 193.14,-79.28"></polygon>
</g>
<!-- p3 -->
<g id="node4" class="node">
<title>p3</title>
<text text-anchor="middle" x="488" y="-139.4" font-family="Arial" font-size="14.00" fill="red">ReadChar()</text>
<text text-anchor="middle" x="488" y="-122.6" font-family="Arial" font-size="14.00" fill="red">al final del flujo</text>
<text text-anchor="middle" x="488" y="-105.8" font-family="Arial" font-size="14.00" fill="red">ERROR</text>
</g>
<!-- p3&#45;&gt;cluster0_stream -->
<g id="edge3" class="edge">
<title>p3-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="red" d="M495.27,-97.72C495.62,-92.6 495.32,-87.4 493.84,-82.67"></path>
<polygon fill="red" stroke="red" points="496.87,-80.93 488.77,-74.1 490.85,-84.49 496.87,-80.93"></polygon>
</g>
</g>
</svg>
</p><ul>
<li><strong><code>int PeekChar()</code></strong>: Mirar√° el siguiente caracter del flujo <strong>sin avanzar el descriptor</strong>. Si el descriptor se encuentra al final de la secuencia, devolver√° -<strong>1</strong> (Por esa raz√≥n retorna un <strong><code>int</code></strong> en lugar de un <strong><code>char</code></strong> como el otro m√©todo).</li>
</ul>
<p align="center" style="zoom:0.8" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: G Pages: 1 -->
<svg width="550pt" height="189pt" viewBox="0.00 0.00 550.31 188.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184.8)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-184.8 546.31,-184.8 546.31,4 -4,4"></polygon>
<text text-anchor="middle" x="271.15" y="-164.2" font-family="Arial" font-size="14.00">Ejemplo descriptor con PeekChar() y codificaci√≥n UTF7</text>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-8 8,-83.6 504,-83.6 504,-8 8,-8"></polygon>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<text text-anchor="start" x="48.1" y="-41.6" font-family="Arial" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="67.77,-20 67.77,-71.6 85.77,-71.6 85.77,-20 67.77,-20"></polygon>
<polygon fill="none" stroke="black" points="85.77,-20 85.77,-71.6 134.13,-71.6 134.13,-20 85.77,-20"></polygon>
<text text-anchor="start" x="94.77" y="-50" font-family="Arial" font-size="14.00">0x63</text>
<text text-anchor="start" x="103.78" y="-33.2" font-family="Arial" font-size="14.00">'c'</text>
<polygon fill="none" stroke="black" points="134.13,-20 134.13,-71.6 183.26,-71.6 183.26,-20 134.13,-20"></polygon>
<text text-anchor="start" x="143.13" y="-50" font-family="Arial" font-size="14.00">0x6F</text>
<text text-anchor="start" x="152.13" y="-33.2" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="183.26,-20 183.26,-71.6 233.17,-71.6 233.17,-20 183.26,-20"></polygon>
<text text-anchor="start" x="192.26" y="-50" font-family="Arial" font-size="14.00">0x6E</text>
<text text-anchor="start" x="201.64" y="-33.2" font-family="Arial" font-size="14.00">'n'</text>
<polygon fill="none" stroke="black" points="233.17,-20 233.17,-71.6 251.17,-71.6 251.17,-20 233.17,-20"></polygon>
<text text-anchor="start" x="259.17" y="-41.6" font-family="Arial" font-size="14.00">...</text>
<text text-anchor="start" x="302.83" y="-41.6" font-family="Arial" font-size="14.00">...</text>
<polygon fill="none" stroke="black" points="322.5,-20 322.5,-71.6 340.5,-71.6 340.5,-20 322.5,-20"></polygon>
<polygon fill="none" stroke="black" points="340.5,-20 340.5,-71.6 388.86,-71.6 388.86,-20 340.5,-20"></polygon>
<text text-anchor="start" x="349.5" y="-50" font-family="Arial" font-size="14.00">0x63</text>
<text text-anchor="start" x="358.51" y="-33.2" font-family="Arial" font-size="14.00">'c'</text>
<polygon fill="none" stroke="black" points="388.86,-20 388.86,-71.6 437.99,-71.6 437.99,-20 388.86,-20"></polygon>
<text text-anchor="start" x="397.86" y="-50" font-family="Arial" font-size="14.00">0x6F</text>
<text text-anchor="start" x="406.86" y="-33.2" font-family="Arial" font-size="14.00">'o'</text>
<polygon fill="none" stroke="black" points="437.99,-20 437.99,-71.6 487.9,-71.6 487.9,-20 437.99,-20"></polygon>
<text text-anchor="start" x="446.99" y="-50" font-family="Arial" font-size="14.00">0x6E</text>
<text text-anchor="start" x="456.38" y="-33.2" font-family="Arial" font-size="14.00">'n'</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="73" y="-131" font-family="Arial" font-size="14.00" fill="lightgray">Antes</text>
<text text-anchor="middle" x="73" y="-114.2" font-family="Arial" font-size="14.00" fill="lightgray">PeekChar()</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="lightgray" d="M97.16,-106.16C106.05,-98.67 116.28,-89.75 125.83,-80.73"></path>
<polygon fill="lightgray" stroke="lightgray" points="128.18,-83.33 132.91,-73.85 123.3,-78.31 128.18,-83.33"></polygon>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="196" y="-139.4" font-family="Arial" font-size="14.00">Despu√©s</text>
<text text-anchor="middle" x="196" y="-122.6" font-family="Arial" font-size="14.00">PeekChar()</text>
<text text-anchor="middle" x="196" y="-105.8" font-family="Arial" font-size="14.00">retorna 0x6F ('o')</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="black" d="M138.57,-97.84C133.17,-93.19 129.57,-88.24 129.32,-83.2"></path>
<polygon fill="black" stroke="black" points="132.46,-84.74 133.38,-74.18 126.08,-81.86 132.46,-84.74"></polygon>
</g>
<!-- p3 -->
<g id="node4" class="node">
<title>p3</title>
<text text-anchor="middle" x="488" y="-139.4" font-family="Arial" font-size="14.00">PeekChar()</text>
<text text-anchor="middle" x="488" y="-122.6" font-family="Arial" font-size="14.00">al final del flujo</text>
<text text-anchor="middle" x="488" y="-105.8" font-family="Arial" font-size="14.00">retorna -1</text>
</g>
<!-- p3&#45;&gt;cluster0_stream -->
<g id="edge3" class="edge">
<title>p3-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="black" d="M495.27,-97.72C495.62,-92.6 495.32,-87.4 493.84,-82.67"></path>
<polygon fill="black" stroke="black" points="496.87,-80.93 488.77,-74.1 490.85,-84.49 496.87,-80.93"></polygon>
</g>
</g>
</svg>
</p><p>Por ejemplo, en el siguiente c√≥digo leemos byte a byte de un <strong>fichero de texto</strong> que se guard√≥ como UTF7 y mostramos la representaci√≥n en caracter de dicho byte.<br>
<strong>Utilizamos <code>PeekChar()</code> para detectar el final del fichero</strong>.</p>
<blockquote>
<p><strong>Nota:</strong> Si fuera un <strong>fichero en binario</strong> esta lectura no tendr√≠a mucho sentido pues obtendr√≠amos caracteres no representables por consola.</p>
</blockquote>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BinaryReader</span> br <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">BinaryReader</span><span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-while">while</span><span class="token punctuation">(</span>br<span class="token punctuation">.</span><span class="token function">PeekChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>br<span class="token punctuation">.</span><span class="token function">ReadChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           
br<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></pre><div style="page-break-after:always;"></div>
<h5 id="mortar_board-caso-de-estudio-de-lectura-en-binario-con-binaryreader">üéì Caso de estudio de lectura en binario con BinaryReader </h5>
<p>Imaginemos que tenemos una serie de archivos de audio en formato <strong>mp3</strong> en la carpeta <strong><code>C:\Musica</code></strong>. Si los examinamos con el explorador de archivos de Windows 10 (<strong>Mostrando las columnas adecuadas</strong>). Podemos ver que nos muestra cierta informaci√≥n de T√≠tulo, √Ålbum, etc.</p>
<div align="center">
    <img width="500" src="assets/mp3_lista_ficheros.png">
</div>
<p>Es m√°s <strong>podemos editar y modificar esta informaci√≥n</strong> a trav√©s del propio Windows 10 a trav√©s de la pesta√±a <strong>Detalles</strong>, haciendo click con el bot√≥n derecho sobre el fichero y seleccionando la opci√≥n del men√∫ contextual <strong>Propiedades</strong>.</p>
<div align="center">
    <img width="300" src="assets/mp3_editar_info.png">
</div>
<p>Hay varias formas de guardar estas etiquetas de informaci√≥n en un archivo mp3 pero la usada para estos es la m√°s simple y se denomina <strong>TAGID3V1</strong>.</p>
<p><strong>¬øC√≥mo se guarda la informaci√≥n del  TAGID3V1?</strong></p>
<p>De estar incluida esta informaci√≥n, ser√° al final del archivo:<br>
Se a√±aden 128 bytes fijos:</p>
<ul>
<li><strong><code>TagID</code></strong>: 3 caracteres <strong>fijos</strong> 'T', 'A' y 'G'<br>
Estos bytes me indicar√°n si en esos 128 bytes del final del mp3 realmente hay informaci√≥n del TAGID3V1 o es simple codificaci√≥n de audio.</li>
<li><strong><code>T√≠tulo</code></strong>: 30 caracteres</li>
<li><strong><code>Artista</code></strong>: 30 caracteres</li>
<li><strong><code>√Ålbum</code></strong>: 30 caracteres</li>
<li><strong><code>A√±o</code></strong>: 4 caracteres</li>
<li><strong><code>Comentario</code></strong>: 30 caracteres</li>
<li><strong><code>G√©nero</code></strong>: 1 byte<br>
Ser√° un √≠ndice natural entre 0 y 79 codificado en 1byte de tal manera que:√ß...<br>
0 ‚Üí BLUES, 1 ‚Üí CLASSIC ROCK, ‚Ä¶ , 79 ‚Üí  HARD ROCK y si hubiera un valor superior a 79 se calificar√≠a como OTHERS.</li>
</ul>
<blockquote>
<p><strong>Nota:</strong> Si te fijas 3 + 30 + 30 + 30 + 4 + 30 + 1 = <strong>128</strong>.</p>
</blockquote>
<p>Si examinamos el c√≥digo en binario del final del fichero editado en el di√°logo anterior tendremos:</p>
<pre data-role="codeBlock" data-info="txt" class="language-txt txt"><code>...
0040b020: FF FF FF 54 41 47 41 20 4B 69 6E 64 20 4F 66 20    ...TAGA.Kind.Of.
0040b030: 4D 61 67 69 63 20 20 20 20 20 20 20 20 20 20 20    Magic...........
0040b040: 20 20 20 20 51 75 65 65 6E 20 20 20 20 20 20 20    ....Queen.......
0040b050: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20    ................
0040b060: 20 20 44 45 53 43 4F 4E 4F 43 49 44 4F 20 20 20    ..DESCONOCIDO...
0040b070: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20    ................
0040b080: 31 39 36 36 20 20 20 20 20 20 20 20 20 20 20 20    1966............
0040b090: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20    ................
0040b0a0: 20 20 0C
</code></pre><div style="page-break-after:always;"></div>
<h6 id="pasos-para-resolver-el-caso-de-estudio">Pasos para resolver el caso de estudio </h6>
<ol>
<li>
<p>Vamos a definir una clase en C# denominada <strong><code>TagId3v1</code></strong>, para leer esta informaci√≥n en los ficheros. En ella en primer lugar <strong>definiremos constantes</strong> para los tama√±os reservados para cada dato seg√∫n la especificaci√≥n anterior y un array '<strong><code>generosTagID3v1</code></strong>' de solo lectura con los nombres de los g√©neros conforme a la especificaci√≥n de TAGID3V1.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">TagId3v1</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_TAG_ID <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_TITULO <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_ARTISTA <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_ALBUM <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> BYTES_A√ëO <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_COMENTARIO <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_GENERO <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> TOTAL_BYTES <span class="token operator">=</span> BYTES_TAG_ID <span class="token operator">+</span> BYTES_TITULO <span class="token operator">+</span> BYTES_ARTISTA <span class="token operator">+</span> 
                            BYTES_ALBUM <span class="token operator">+</span> BYTES_A√ëO <span class="token operator">+</span> BYTES_COMENTARIO <span class="token operator">+</span> BYTES_GENERO<span class="token punctuation">;</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-readonly">readonly</span> <span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> generosTagID3v1 <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span>
    <span class="token punctuation">{</span>
        <span class="token string">"BLUES"</span><span class="token punctuation">,</span> <span class="token string">"CLASSIC ROCK"</span><span class="token punctuation">,</span> <span class="token string">"COUNTRY"</span><span class="token punctuation">,</span> <span class="token string">"DANCE"</span><span class="token punctuation">,</span> <span class="token string">"DISCO"</span><span class="token punctuation">,</span> <span class="token string">"FUNK"</span><span class="token punctuation">,</span>
        <span class="token string">"GRUNGE"</span><span class="token punctuation">,</span> <span class="token string">"HIP-HOP"</span><span class="token punctuation">,</span> <span class="token string">"JAZZ"</span><span class="token punctuation">,</span> <span class="token string">"METAL"</span><span class="token punctuation">,</span> <span class="token string">"NEW AGE"</span><span class="token punctuation">,</span> <span class="token string">"OLDIES"</span><span class="token punctuation">,</span> <span class="token string">"OTHER"</span><span class="token punctuation">,</span>
        <span class="token string">"POP"</span><span class="token punctuation">,</span> <span class="token string">"R&amp;B"</span><span class="token punctuation">,</span> <span class="token string">"RAP"</span><span class="token punctuation">,</span> <span class="token string">"REGGAE"</span><span class="token punctuation">,</span> <span class="token string">"ROCK"</span><span class="token punctuation">,</span> <span class="token string">"TECHNO"</span><span class="token punctuation">,</span> <span class="token string">"INDUSTRIAL"</span><span class="token punctuation">,</span>
        <span class="token string">"ALTERNATIVE"</span><span class="token punctuation">,</span> <span class="token string">"SKA"</span><span class="token punctuation">,</span> <span class="token string">"DEATH METAL"</span><span class="token punctuation">,</span> <span class="token string">"PRANKS"</span><span class="token punctuation">,</span> <span class="token string">"SOUNDTRACK"</span><span class="token punctuation">,</span>
        <span class="token string">"EURO-TECHNO"</span><span class="token punctuation">,</span> <span class="token string">"AMBIENT"</span><span class="token punctuation">,</span> <span class="token string">"TRIP-HOP"</span><span class="token punctuation">,</span> <span class="token string">"VOCAL"</span><span class="token punctuation">,</span> <span class="token string">"JAZZ+FUNK"</span><span class="token punctuation">,</span> <span class="token string">"FUSION"</span><span class="token punctuation">,</span>
        <span class="token string">"TRANCE"</span><span class="token punctuation">,</span> <span class="token string">"CLASSICAL"</span><span class="token punctuation">,</span> <span class="token string">"INSTRUMENTAL"</span><span class="token punctuation">,</span> <span class="token string">"ACID"</span><span class="token punctuation">,</span> <span class="token string">"HOUSE"</span><span class="token punctuation">,</span> <span class="token string">"GAME"</span><span class="token punctuation">,</span>
        <span class="token string">"SOUND CLIP"</span><span class="token punctuation">,</span> <span class="token string">"GOSPEL"</span><span class="token punctuation">,</span> <span class="token string">"NOISE"</span><span class="token punctuation">,</span> <span class="token string">"ALTERN ROCK"</span><span class="token punctuation">,</span> <span class="token string">"BASS"</span><span class="token punctuation">,</span> <span class="token string">"SOUL"</span><span class="token punctuation">,</span>
        <span class="token string">"PUNK"</span><span class="token punctuation">,</span> <span class="token string">"SPACE"</span><span class="token punctuation">,</span> <span class="token string">"MEDITATIVE"</span><span class="token punctuation">,</span> <span class="token string">"INSTRUMENTAL POP"</span><span class="token punctuation">,</span> <span class="token string">"INSTRUMENTAL ROCK"</span><span class="token punctuation">,</span>
        <span class="token string">"ETHNIC"</span><span class="token punctuation">,</span> <span class="token string">"GOTHIC"</span><span class="token punctuation">,</span> <span class="token string">"DARKWAVE"</span><span class="token punctuation">,</span> <span class="token string">"TECHNO-INDUSTRIAL"</span><span class="token punctuation">,</span> <span class="token string">"ELECTRONIC"</span><span class="token punctuation">,</span>
        <span class="token string">"POP-FOLK"</span><span class="token punctuation">,</span> <span class="token string">"EURODANCE"</span><span class="token punctuation">,</span> <span class="token string">"DREAM"</span><span class="token punctuation">,</span> <span class="token string">"SOUTHERN ROCK"</span><span class="token punctuation">,</span> <span class="token string">"COMEDY"</span><span class="token punctuation">,</span> <span class="token string">"CULT"</span><span class="token punctuation">,</span>
        <span class="token string">"GANGSTA"</span><span class="token punctuation">,</span> <span class="token string">"TOP 40"</span><span class="token punctuation">,</span> <span class="token string">"CHRISTIAN POP"</span><span class="token punctuation">,</span> <span class="token string">"POP/FUNK"</span><span class="token punctuation">,</span> <span class="token string">"JUNGLE"</span><span class="token punctuation">,</span> <span class="token string">"NATIVE AMERICAN"</span><span class="token punctuation">,</span>
        <span class="token string">"CABARET"</span><span class="token punctuation">,</span> <span class="token string">"NEW WAVE"</span><span class="token punctuation">,</span> <span class="token string">"PSYCHADELIC"</span><span class="token punctuation">,</span> <span class="token string">"RAVE"</span><span class="token punctuation">,</span> <span class="token string">"SHOWTUNES"</span><span class="token punctuation">,</span> <span class="token string">"TRAILER"</span><span class="token punctuation">,</span> <span class="token string">"LO-FI"</span><span class="token punctuation">,</span>
        <span class="token string">"TRIBAL"</span><span class="token punctuation">,</span> <span class="token string">"ACID PUNK"</span><span class="token punctuation">,</span> <span class="token string">"ACID JAZZ"</span><span class="token punctuation">,</span> <span class="token string">"POLKA"</span><span class="token punctuation">,</span> <span class="token string">"RETRO"</span><span class="token punctuation">,</span> <span class="token string">"MUSICAL"</span><span class="token punctuation">,</span> <span class="token string">"ROCK &amp; ROLL"</span><span class="token punctuation">,</span>
        <span class="token string">"HARD ROCK"</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p>A continuac√≠on vamos a a√±adir a la clase <strong><code>TagId3v1</code></strong> los campos privados <strong>titulo</strong>, <strong>artista</strong>, <strong>√°lbum</strong> y <strong>comentario</strong> de tipo <strong><code>string</code></strong>, <strong>a√±o</strong> de tipo <strong><code>ushort</code></strong> y <strong>g√©nero</strong> de tipo <strong><code>byte</code></strong>. (Se acceder√°n siempre a trav√©s de sus getters).<br>
Adem√°s, vamos a definir los accesores p√∫blicos para t√≠tulo, artista, √°lbum, comentario y a√±o. Sin embargo, para g√©nero definiremos <strong>dos</strong> accesores p√∫blicos uno que devuelva el <strong><code>byte</code></strong> y otro el <strong><code>string</code></strong> con el texto del g√©nero.<br>
Una posible implementaci√≥n ser√≠a la siguiente ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">TagId3V1</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ... c√≥digo omitido por abreviar</span>

    <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> titulo<span class="token punctuation">;</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> artista<span class="token punctuation">;</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> album<span class="token punctuation">;</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-ushort">ushort</span> a√±o<span class="token punctuation">;</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-byte">byte</span></span> genero<span class="token punctuation">;</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> comentario<span class="token punctuation">;</span>

    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">GetTitulo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> titulo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">GetArtista</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> artista<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-ushort">ushort</span> GetA√±<span class="token function">o</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> a√±o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">GetComentario</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> comentario<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">GetAlbum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> album<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
</code></pre> <div style="page-break-after:always;"></div>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">GetGenero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>genero <span class="token operator">&gt;=</span> <span class="token number">80</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-return">return</span> <span class="token string">"OTHER"</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span>
            <span class="token keyword keyword-return">return</span> generosTagID3v1<span class="token punctuation">[</span>genero<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>        
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-byte">byte</span></span> <span class="token function">GetByteGenero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> genero<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p><strong>Constructor privado</strong> que reciba todos los campos (excepto, claro est√°, el array de g√©neros). Adem√°s, vamos a invalidar el m√©todo <strong><code>ToString</code></strong> para que muestre los datos del objeto.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">TagId3V1</span>
<span class="token punctuation">{</span>
   <span class="token comment">// ... c√≥digo omitido por abreviar</span>
   <span class="token keyword keyword-private">private</span> <span class="token function">TagId3V1</span><span class="token punctuation">(</span>
       <span class="token class-name"><span class="token keyword keyword-string">string</span></span> titulo<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> artista<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> album<span class="token punctuation">,</span> 
       <span class="token keyword keyword-in">in</span> <span class="token keyword keyword-ushort">ushort</span> a√±o<span class="token punctuation">,</span> <span class="token keyword keyword-in">in</span> <span class="token class-name"><span class="token keyword keyword-byte">byte</span></span> genero<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> comentario<span class="token punctuation">)</span>
   <span class="token punctuation">{</span> 
       <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>titulo <span class="token operator">=</span> titulo <span class="token operator">??</span> <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword keyword-nameof">nameof</span><span class="token punctuation">(</span>titulo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>artista <span class="token operator">=</span> artista <span class="token operator">??</span> <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword keyword-nameof">nameof</span><span class="token punctuation">(</span>artista<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>album <span class="token operator">=</span> album <span class="token operator">??</span> <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword keyword-nameof">nameof</span><span class="token punctuation">(</span>album<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>a√±o <span class="token operator">=</span> a√±o<span class="token punctuation">;</span>
       <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>genero <span class="token operator">=</span> genero<span class="token punctuation">;</span>
       <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>comentario <span class="token operator">=</span> comentario <span class="token operator">??</span> <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword keyword-nameof">nameof</span><span class="token punctuation">(</span>comentario<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-override">override</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
       <span class="token keyword keyword-return">return</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token string">"Titulo:"</span><span class="token punctuation">,</span><span class="token number">11</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetTitulo</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span>
               <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token string">"Artista:"</span><span class="token punctuation">,</span><span class="token number">11</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetArtista</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span>
               <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token string">"Album:"</span><span class="token punctuation">,</span><span class="token number">11</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetAlbum</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span>
               <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token string">"A√±o:"</span><span class="token punctuation">,</span><span class="token number">11</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">GetA√±<span class="token function">o</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span>
               <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token string">"Genero:"</span><span class="token punctuation">,</span><span class="token number">11</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetGenero</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">\n"</span></span>
               <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token string">"Comentario:"</span><span class="token punctuation">,</span><span class="token number">11</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetComentario</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></li>
<li>
<p>Ser√≠a interesante implementar un m√©todo de clase p√∫blico <strong><code>HayTAG</code></strong> que <strong>reciba un fichero</strong> y me devuelva un boolenao indic√°ndome si el fichero contiene un TAGIDID3 v√°lido. Una posible implementaci√≥n ser√≠a...</p>
<blockquote>
<p>‚úã <strong>Nota:</strong> Con el f√≠n de mostrate un c√≥digo de mayor calidad, se han controlado las excepciones de apertura usado la clausula <strong><code>using</code></strong>. Esta se explicar√° m√°s adelante en el punto <strong><a href="#manejo-de-excepciones-con-ficheros">Manejo de excepciones con ficheros</a></strong>. As√≠ pues, si aunque ahora no la entiendas, te recomiendo que vuelvas a revisar este c√≥digo cuando la veas.</p>
</blockquote>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">TagId3V1</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ... c√≥digo omitido por abreviar</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-bool">bool</span></span> <span class="token function">HayTAG</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> rutaFichero<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-bool">bool</span></span> hayTAG <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-using">using</span> <span class="token punctuation">(</span><span class="token class-name">FileStream</span> stream <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span>rutaFichero<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">,</span> FileShare<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-using">using</span> <span class="token punctuation">(</span><span class="token class-name">BinaryReader</span> streamRB <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">BinaryReader</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Habr√° TAG si como m√≠nimo el fichero mide m√°s de los 128 bytes que ocupa el mismo.</span>
            hayTAG <span class="token operator">=</span> stream<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> TOTAL_BYTES<span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>hayTAG<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Se que ocupa esos bytes y me desplazo donde en teor√≠a est√° el principio del TAG</span>
                stream<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token operator">-</span>TOTAL_BYTES<span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>End<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// Leo los 3 caracteres del TAG y los transformo a cadena.</span>
                <span class="token class-name"><span class="token keyword keyword-string">string</span></span> tag <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span></span><span class="token punctuation">(</span>streamRB<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_TAG_ID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                hayTAG <span class="token operator">=</span> tag <span class="token operator">==</span> <span class="token string">"TAG"</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> hayTAG<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<ol start="5">
<li>
<p>Vamos a crear un m√©todo de m√©todo de clase <strong><code>LeeTAG</code></strong> y que reciba la <strong>ubicaci√≥n de una fichero fichero mp3</strong> y que genere una excepci√≥n <strong><code>TagId3v1Exception</code></strong> si no hay tag y si lo hay, lo lea devolviendo una instancia de la clase <strong><code>TagId3v1</code></strong> con los datos del mismo.<br>
Si durante la lectura se genera una excepci√≥n. Esta se relanzar√° '<em>envuelta</em>' en un TagId3v1Exception que indique de que fichero se estaba intentando leer el TAG.</p>
<blockquote>
<p>üì£ <strong>Nota:</strong> A este tipo de m√©todos que inst√°ncian un objeto de la clase a la que pertenecen sin ser un constructor, se les denomina <strong><code>factor√≠a</code></strong>.</p>
</blockquote>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token comment">// Definiremos la clase con la excepci√≥n personalizada fuera de la clase TagId3v1</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">TagId3v1Exception</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Exception</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token function">TagId3v1Exception</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> message<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword keyword-base">base</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token function">TagId3v1Exception</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> message<span class="token punctuation">,</span> <span class="token class-name">Exception</span> innerException<span class="token punctuation">)</span> 
    <span class="token punctuation">:</span> <span class="token keyword keyword-base">base</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> innerException<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">TagId3V1</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ... c√≥digo omitido por abreviar</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">TagId3V1</span> <span class="token function">LeeTAG</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> rutaFichero<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-string">string</span></span> error <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"El fichero </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">rutaFichero</span><span class="token punctuation">}</span></span><span class="token string"> no tiene informaci√≥n v√°lida de TagId3v1"</span></span><span class="token punctuation">;</span>
        <span class="token comment">// Si llamo a este m√©todo es porque estoy seguro de que hay 'tag' para leer</span>
        <span class="token comment">// en caso contrario generar√© una excepci√≥n.</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">HayTAG</span><span class="token punctuation">(</span>rutaFichero<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">TagId3v1Exception</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-using">using</span> <span class="token punctuation">(</span><span class="token class-name">FileStream</span> stream <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span>rutaFichero<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-using">using</span> <span class="token punctuation">(</span><span class="token class-name">BinaryReader</span> streamBR <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">BinaryReader</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-try">try</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Me sit√∫o al principio del t√≠tulo justo despu√©s de los bytes ['T']['A']['G']</span>
                stream<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span>BYTES_TAG_ID <span class="token operator">-</span> TOTAL_BYTES<span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>End<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// Como pude haber esp√°cios hasta rellenar lo que ocupa cada valor </span>
                <span class="token comment">// los recorto con el m√©todo Trim</span>
                <span class="token class-name"><span class="token keyword keyword-string">string</span></span> titulo <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span></span> <span class="token punctuation">(</span>streamBR<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_TITULO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword keyword-string">string</span></span> artista <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span></span><span class="token punctuation">(</span>streamBR<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_ARTISTA<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword keyword-string">string</span></span> album <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span></span> <span class="token punctuation">(</span>streamBR<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_ALBUM<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-ushort">ushort</span> a√±o <span class="token operator">=</span> <span class="token keyword keyword-ushort">ushort</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span></span><span class="token punctuation">(</span>streamBR<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_A√ëO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword keyword-string">string</span></span> comentario <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span></span> <span class="token punctuation">(</span>streamBR<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_COMENTARIO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword keyword-byte">byte</span></span> genero <span class="token operator">=</span> streamBR<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">TagId3V1</span><span class="token punctuation">(</span>titulo<span class="token punctuation">,</span> artista<span class="token punctuation">,</span> album<span class="token punctuation">,</span> a√±o<span class="token punctuation">,</span> genero<span class="token punctuation">,</span> comentario<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">TagId3v1Exception</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<ol start="6">
<li>
<p>Vamos ahora a realizar un peque√±o programa principal, usando m√©todos de la clase TagId3v ...</p>
<ul>
<li>Leeremos todos archivos mp3 que encuentre en el directorio <strong><code>C:\Musica</code></strong> y mostrar√° la informaci√≥n del TAGID3V1 si la tuviera y "<em>No contiene informaci√≥n</em>" en caso contrario.</li>
<li>Adem√°s, controlaremos cualquier <strong><code>TagId3v1Exception</code></strong> que se produzca al leer un fichero, nos recuperaremos y continuaremos intentado leer el siguiente.</li>
</ul>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> ficheros <span class="token operator">=</span> Directory<span class="token punctuation">.</span><span class="token function">GetFiles</span><span class="token punctuation">(</span><span class="token string">@"C:\Musica"</span><span class="token punctuation">,</span> <span class="token string">"*.mp3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-var">var</span></span> fichero <span class="token keyword keyword-in">in</span> ficheros<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-try">try</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Informaci√≥n del fichero </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">fichero</span><span class="token punctuation">}</span></span><span class="token string">..."</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword keyword-string">string</span></span> informacion <span class="token operator">=</span> <span class="token punctuation">(</span>TagId3V1<span class="token punctuation">.</span><span class="token function">HayTAG</span><span class="token punctuation">(</span>fichero<span class="token punctuation">)</span> 
                                    <span class="token punctuation">?</span> TagId3V1<span class="token punctuation">.</span><span class="token function">LeeTAG</span><span class="token punctuation">(</span>fichero<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                                    <span class="token punctuation">:</span> <span class="token string">"\tNo contiene informaci√≥n."</span>
                                     <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>informacion<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">TagId3v1Exception</span> e<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<h5 id="stream-adapters-streamwriter-y-streamreader">Stream Adapters StreamWriter y StreamReader </h5>
<p></p><p align="center" style="zoom:0.6" class="dot"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 9.0.0 (20230911.1827)
 -->
<!-- Title: G Pages: 1 -->
<svg width="1131pt" height="284pt" viewBox="0.00 0.00 1131.34 284.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 280)">
<title>G</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-280 1127.34,-280 1127.34,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="none" points="8,-54 8,-198 168,-198 168,-54 8,-54"></polygon>
<text text-anchor="middle" x="88" y="-167" font-family="Arial" font-size="30.00">Datos</text>
</g>
<g id="clust2" class="cluster">
<title>clusterG</title>
<polygon fill="none" stroke="#104e8b" points="290.52,-8 290.52,-268 822.93,-268 822.93,-8 290.52,-8"></polygon>
<text text-anchor="middle" x="556.72" y="-237" font-family="Arial" font-size="30.00" fill="#104e8b">Clases para el manejo de streams</text>
</g>
<g id="clust3" class="cluster">
<title>cluster1</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="295.52,-13 295.52,-219 479.52,-219 479.52,-13 295.52,-13"></polygon>
<text text-anchor="middle" x="387.52" y="-197" font-family="Arial" font-size="20.00" fill="#104e8b">Stream Adapters</text>
</g>
<g id="clust4" class="cluster">
<title>cluster3</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="597.93,-43 597.93,-173 817.93,-173 817.93,-43 597.93,-43"></polygon>
<text text-anchor="middle" x="707.93" y="-151" font-family="Arial" font-size="20.00" fill="#104e8b">Backing Store Streams</text>
</g>
<g id="clust5" class="cluster">
<title>cluster4</title>
<polygon fill="none" stroke="none" points="931.34,-43 931.34,-185 1115.34,-185 1115.34,-43 931.34,-43"></polygon>
<text text-anchor="middle" x="1023.34" y="-154" font-family="Arial" font-size="30.00">Dispositivos</text>
</g>
<!-- Bytes -->
<g id="node1" class="node">
<title>Bytes</title>
<polygon fill="none" stroke="black" points="154,-146 16,-146 16,-62 160,-62 160,-140 154,-146"></polygon>
<polyline fill="none" stroke="black" points="154,-146 154,-140"></polyline>
<polyline fill="none" stroke="black" points="160,-140 154,-140"></polyline>
<text text-anchor="middle" x="88" y="-110" font-family="Arial" font-size="20.00">Texto</text>
<text text-anchor="middle" x="88" y="-86" font-family="Arial" font-size="20.00">codificado</text>
</g>
<!-- StreamWriter -->
<g id="node2" class="node">
<title>StreamWriter</title>
<polygon fill="#36648b" stroke="#36648b" points="459.52,-166.8 315.52,-166.8 315.52,-109.2 459.52,-109.2 459.52,-166.8"></polygon>
</g>
<!-- Bytes&#45;&gt;StreamWriter -->
<g id="edge1" class="edge">
<title>Bytes-&gt;StreamWriter</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M160.26,-112.14C202.44,-116.96 256.15,-123.1 300.66,-128.19"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="300.22,-131.66 310.55,-129.32 301.01,-124.71 300.22,-131.66"></polygon>
<text text-anchor="middle" x="237.76" y="-128.7" font-family="Arial" font-size="19.00" fill="#1874cd">Texto</text>
</g>
<!-- StreamReader -->
<g id="node3" class="node">
<title>StreamReader</title>
<polygon fill="#36648b" stroke="#36648b" points="459.52,-90.8 315.52,-90.8 315.52,-33.2 459.52,-33.2 459.52,-90.8"></polygon>
</g>
<!-- Bytes&#45;&gt;StreamReader -->
<g id="edge2" class="edge">
<title>Bytes-&gt;StreamReader</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M174.66,-91.91C219.13,-85.63 272.85,-78.05 315.06,-72.09"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="174.17,-88.44 164.76,-93.31 175.15,-95.37 174.17,-88.44"></polygon>
<text text-anchor="middle" x="237.76" y="-90.7" font-family="Arial" font-size="19.00" fill="#1874cd">Texto</text>
</g>
<!-- FileStream -->
<g id="node4" class="node">
<title>FileStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="779.93,-120.8 635.93,-120.8 635.93,-63.2 779.93,-63.2 779.93,-120.8"></polygon>
</g>
<!-- StreamWriter&#45;&gt;FileStream -->
<g id="edge3" class="edge">
<title>StreamWriter-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M459.98,-127.68C507.72,-120.78 570.78,-111.67 621.23,-104.38"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="621.55,-107.87 630.94,-102.98 620.55,-100.94 621.55,-107.87"></polygon>
<text text-anchor="middle" x="536.22" y="-124.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- StreamReader&#45;&gt;FileStream -->
<g id="edge4" class="edge">
<title>StreamReader-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M474.18,-70.07C524.62,-74.82 587.68,-80.76 635.44,-85.26"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="474.78,-66.61 464.5,-69.16 474.12,-73.58 474.78,-66.61"></polygon>
<text text-anchor="middle" x="536.22" y="-82.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- Fichero -->
<g id="node5" class="node">
<title>Fichero</title>
<polygon fill="none" stroke="black" points="1095.34,-120.8 955.34,-120.8 951.34,-116.8 951.34,-63.2 1091.34,-63.2 1095.34,-67.2 1095.34,-120.8"></polygon>
<polyline fill="none" stroke="black" points="1091.34,-116.8 951.34,-116.8"></polyline>
<polyline fill="none" stroke="black" points="1091.34,-116.8 1091.34,-63.2"></polyline>
<polyline fill="none" stroke="black" points="1091.34,-116.8 1095.34,-120.8"></polyline>
</g>
<!-- FileStream&#45;&gt;Fichero -->
<g id="edge5" class="edge">
<title>FileStream-&gt;Fichero</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M794.54,-92C838.73,-92 892.48,-92 936.67,-92"></path>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="794.59,-88.5 784.59,-92 794.59,-95.5 794.59,-88.5"></polygon>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="936.42,-95.5 946.42,-92 936.42,-88.5 936.42,-95.5"></polygon>
<text text-anchor="middle" x="874.64" y="-97.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
</g>
</svg>
</p><p></p>
<ul>
<li>
<p>Est√°n dise√±ados para escribir y leer texto como salida en una codificaci√≥n determinada. Por tanto <strong>est√°n pensados para trabajar solo con archivos de texto</strong> y no archivos con datos en binario.</p>
</li>
<li>
<p><strong><code>StreamWriter</code></strong> utiliza de forma <strong>predeterminada</strong> una instancia de <strong>UTF8</strong> Encoding, a menos que se especifique lo contrario. Adem√°s, <strong>se a√±adir√° a la cabecera del archivo</strong> de texto <strong>2 bytes</strong> con la codificaci√≥n de caracteres utilizada. Estos bytes se denominar√°n <strong>BOM</strong> (<strong>Byte Order Mark</strong>).<br>
// A√±adir√° los bytes de BOM con la codificaci√≥n al principio del Stream.<br>
// Ya no podremos usar fs porque no nos pertenecer√° ya.</p>
</li>
<li>
<p>Para <strong><code>StreamReader</code></strong> la forma de controlar que se ha llegado al final de fichero. Es cuando una lectura <strong>devuelve null en lugar de un <code>string</code></strong> o a trav√©s de la propiedad <strong><code>EndOfStream</code></strong>.</p>
<blockquote>
<p>‚úã ‚ö†Ô∏è üíÄ No podemos en ning√∫n caso basarnos en el atributo <strong><code>Position</code></strong> de su <strong><code>FileStream</code></strong> <strong>base</strong> pues su valor no lo controlaremos. <strong>Tampoco podremos desplazarnos por el <code>FileStream</code> al que adapta con un <code>Seek</code></strong>.</p>
</blockquote>
<p>Por tanto, una vez adaptemos un <strong><code>FileStream</code></strong> con un <strong><code>StreamWriter</code></strong> o <strong><code>StreamReader</code></strong> <strong>ya no podremos usarlo</strong>, pues deja de estar bajo nuestro control.</p>
</li>
</ul>
<p><strong>Adaptador</strong> <strong><code>StreamWriter</code></strong></p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Unicode<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Escribimos dos l√≠neas de texto con la codificaci√≥n de salto de l√≠nea espec√≠fica</span>
<span class="token comment">// del Sistema Operativo donde estemos ejecutando.</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"L√≠nea de texto con salto al final codificada en Unicode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Podemos escribir cualquier caracter Unicode. Fuera de esta codificaci√≥n ya no </span>
<span class="token comment">// serian bien interpretados los siguiente caracteres.</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"ÈôêÂÆöÊ°∂„ÄåÂÜ¨Âá™„Äç„ÄåÈ´òÈõÖ„Äç„Ç≠„É£„É≥„Éö„Éº„É≥Êé≤Ëºâ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// El Close de StreamWriter cerrar√° el stream subyacente al que est√° adaptando.</span>
sw<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p>C√≥mo una vez adaptado <strong><code>StreamWriter</code></strong> ya no tiene sentido usar el <strong><code>FileStream</code></strong>, nos ofrece un constructor para hacer la adaptaci√≥n de forma completamente transparente, abriendo el fichero directamente en modo escritura para creaci√≥n o a√±adir al final. Por ejemplo, el siguiente c√≥digo ser√≠a equivalente al anterior.</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> A√ëADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> A√ëADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Unicode<span class="token punctuation">)</span><span class="token punctuation">;</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"L√≠nea de texto con salto al final codificada en Unicode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"ÈôêÂÆöÊ°∂„ÄåÂÜ¨Âá™„Äç„ÄåÈ´òÈõÖ„Äç„Ç≠„É£„É≥„Éö„Éº„É≥Êé≤Ëºâ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sw<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></pre><p>Si abrimos el fichero con un editor de texto, lo podremos leer cl√°ramente con los saltos de l√≠nea correspondiente. Pero si lo <strong>abrimos con editor hexadecimal</strong> para ber que secuencia de bytes ha escrito nos encontraremos lo siguiente...</p>
<pre data-role="codeBlock" data-info="hex {class=&quot;line-numbers&quot;}" class="language-hex hex line-numbers"><code>00000000: FF FE 4C 00 ED 00 6E 00 65 00 61 00 20 00 64 00    .~L.m.n.e.a...d.
00000010: 65 00 20 00 74 00 65 00 78 00 74 00 6F 00 20 00    e...t.e.x.t.o...
00000020: 63 00 6F 00 6E 00 20 00 73 00 61 00 6C 00 74 00    c.o.n...s.a.l.t.
00000030: 6F 00 20 00 61 00 6C 00 20 00 66 00 69 00 6E 00    o...a.l...f.i.n.
00000040: 61 00 6C 00 20 00 63 00 6F 00 64 00 69 00 66 00    a.l...c.o.d.i.f.
00000050: 69 00 63 00 61 00 64 00 61 00 20 00 65 00 6E 00    i.c.a.d.a...e.n.
00000060: 20 00 55 00 6E 00 69 00 63 00 6F 00 64 00 65 00    ..U.n.i.c.o.d.e.
00000070: 0D 00 0A 00 50 96 9A 5B 76 68 0C 30 AC 51 EA 51    ....P..[vh.0,QjQ
00000080: 0D 30 0C 30 D8 9A C5 96 0D 30 AD 30 E3 30 F3 30    .0.0X.E..0-0c0s0
00000090: DA 30 FC 30 F3 30 B2 63 09 8F 0D 00 0A 00          Z0|0s02c......
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p>Donde <strong><code>FF FE</code></strong> ser√°n los <strong><code>bytes de BOM</code></strong> indicando que los caracteres a continuaci√≥n est√°n codificados en Unicode, esto es, cada caracter est√° codificado con 16 bits (2 bytes). As√≠ pues, el caracter <strong><code>'L'</code></strong> se ha adaptado a la secuencia de bytes <strong><code>4C 00</code></strong>.</p>
<p>Adem√°s, si nos fijamos al principio de la <strong><code>l√≠nea 8</code></strong> est√°n los caracteres que que definen el salto de l√≠nea en los Sistemas Windows <strong><code>0D 00 0A 00</code></strong>. Donde, <strong><code>0D 00</code></strong> esl <em>Carriage Return</em> (<strong>CR</strong>) y <strong><code>0A 00</code></strong> es el <em>Line Feed</em> (<strong>LF</strong>) codificados en Unicode. (Tambi√©n aparecen al final del fichero porque hemos escrito 2 l√≠neas).</p>
<blockquote>
<p>üëÅÔ∏è <strong>Nota:</strong> Dependiendo del SO este <strong><a href="https://es.wikipedia.org/wiki/Nueva_l%C3%ADnea">salto de l√≠nea</a></strong> o <strong><code>\n</code></strong> se codificar√° de diferente manera.</p>
<table>
<thead>
<tr>
<th style="text-align:left">SO</th>
<th style="text-align:left">Caracter/es</th>
<th style="text-align:left">Hexadecimal</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Windows</td>
<td style="text-align:left">CR+LF</td>
<td style="text-align:left"><strong><code>0D 0A</code></strong></td>
</tr>
<tr>
<td style="text-align:left">Linux, Unix, Android, iOS, MacOS X</td>
<td style="text-align:left">LF</td>
<td style="text-align:left"><strong><code>0A</code></strong></td>
</tr>
<tr>
<td style="text-align:left">Hasta Mac OS 9</td>
<td style="text-align:left">CR</td>
<td style="text-align:left"><strong><code>0D</code></strong></td>
</tr>
</tbody>
</table>
</blockquote>
<p>Si usamos otra codificaci√≥n como <strong>UTF8</strong>, ya no podremos usar caracteres asi√°ticos porque no son soportados pero sin embargo cada caracter ocupar√≠a 1 byte (8 bits) y el fichero ocupar√≠a menos a pesar de tener m√°s caracteres. Por <strong>ejemplo</strong>, si hacemos ...</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> A√ëADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> A√ëADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"L√≠nea de texto con salto al final codificada en Unicode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Ya no podr√≠amos escribir caracteres asi√°ticos en esta codificaci√≥n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sw<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></pre><p>Ahora tendremos la siguiente secuencia de bytes en el fichero, en la cual ya no tenemos tantos bytes a <strong><code>00</code></strong>.</p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>00000000: EF BB BF 4C C3 AD 6E 65 61 20 64 65 20 74 65 78    o;?LC-nea.de.tex
00000010: 74 6F 20 63 6F 6E 20 73 61 6C 74 6F 20 61 6C 20    to.con.salto.al.
00000020: 66 69 6E 61 6C 20 63 6F 64 69 66 69 63 61 64 61    final.codificada
00000030: 20 65 6E 20 55 6E 69 63 6F 64 65 0D 0A 59 61 20    .en.Unicode..Ya.
00000040: 6E 6F 20 70 6F 64 72 C3 AD 61 6D 6F 73 20 65 73    no.podrC-amos.es
00000050: 63 72 69 62 69 72 20 63 61 72 61 63 74 65 72 65    cribir.caractere
00000060: 73 20 61 73 69 C3 A1 74 69 63 6F 73 20 65 6E 20    s.asiC!ticos.en.
00000070: 65 73 74 61 20 63 6F 64 69 66 69 63 61 63 69 C3    esta.codificaciC
00000080: B3 6E 0D 0A                                        3n..
</code></pre><p>F√≠jate que los bytes de BOM para representar UTF8 ahora son 3 <strong><code>EF BB BF</code></strong> y los saltos de l√≠nea si has ejecutado en un SO Windows son <strong><code>0D 0A</code></strong>. Para nosotros todo esto es <strong>'<em>transparente</em>'</strong> si usamos <strong><code>StreamWriter</code></strong>.</p>
<p>Aunque en los ejemplos hemos usado el m√©todo <strong><code>WriteLine(string texto)</code></strong> que escribe con un salto de l√≠nea al final, tambi√©n podemos usar <strong><code>Write(string texto)</code></strong> para escribir un texto <strong>sin</strong> salto de l√≠nea al final.</p>
<div style="page-break-after:always;"></div>
<p><strong>Adaptador</strong> <strong><code>StreamReader</code></strong></p>
<p>Har√° el proceso inverso al <strong><code>StreamWriter</code></strong> y me ayudar√° a leer flujos de texto de forma <strong>trasparente</strong> a la la codificaci√≥n usada para los caracteres y los saltos de l√≠nea.</p>
<p>Tendremos varias posibilidades de lectura de caracteres con este adaptador:</p>
<ol>
<li>
<p><strong>De uno en uno</strong>: El m√©todo <strong>int Read()</strong> devuelve el pr√≥ximo car√°cter del flujo como <strong>entero</strong>, o un ‚Äì1 si se ha llegado a su final.<br>
Por si s√≥lo quisi√©semos consultar el car√°cter actual pero no pasar al siguiente tambi√©n se ha incluido un m√©todo <strong>int Peek()</strong>.</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token comment">// Abrimos la secuencia.</span>
<span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>            
<span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-bool">bool</span></span> AUTODETECTAR_CODIFICACION_BOM <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// Adaptamos la secuencia para leer texto codificado. </span>
<span class="token comment">// Si el fichero contiene BOM lo leer√° con la codificac√≥n indicada en el mismo.</span>
<span class="token comment">// sino contiene BOM lo leer√° con la codificaci√≥n indicada</span>
<span class="token class-name">StreamReader</span> sr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamReader</span><span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Unicode<span class="token punctuation">,</span> AUTODETECTAR_CODIFICACION_BOM<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Leo car√°cter a car√°cter y lo muestro.</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> c<span class="token punctuation">;</span>
<span class="token keyword keyword-while">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> sr<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
sr<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></li>
<li>
<p><strong>Por grupos</strong>: El m√©todo <strong>int Read(out char[] caracteres, int inicio, int nCaracteres)</strong> lee un grupo de <strong><code>n</code></strong> caracteres y los almacena a partir de la posici√≥n inicio en la tabla que se le indica.<br>
El valor que devuelve es el n√∫mero de caracteres que se hayan le√≠do, que puede ser inferior a <strong><code>n</code></strong> si el flujo ten√≠a menos caracteres de los indicados o un ‚Äì1 si se ha llegado al final del flujo.</p>
<blockquote>
<p><strong>Nota:</strong> Podemos decir que es un m√©todo an√°logo al <strong><code>Read</code></strong> del <strong><code>FileStream</code></strong>.</p>
</blockquote>
</li>
<li>
<p><strong>Por l√≠neas:</strong> El m√©todo <strong><code>string ReadLine()</code></strong> devuelve la cadena de texto correspondiente a la <strong>siguiente l√≠nea</strong> del flujo o null si se ha llegado a su final. La cadena devuelta no incluir√° al final el caracter de salto de l√≠nea correspondiente.</p>
<blockquote>
<p><strong>Nota:</strong> Puede ser una opci√≥n interesante si se trata de un <strong>fichero de texto muy grande o desconocemos su tama√±o</strong>.</p>
</blockquote>
<p><strong>Ejemplo:</strong></p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-bool">bool</span></span> AUTODETECTAR_CODIFICACION_BOM <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token class-name">StreamReader</span> sr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamReader</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Unicode<span class="token punctuation">,</span> AUTODETECTAR_CODIFICACION_BOM<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Leo l√≠nea a l√≠nea hasta final de fichero y la muestro por consola.</span>
<span class="token keyword keyword-while">while</span><span class="token punctuation">(</span><span class="token operator">!</span>sr<span class="token punctuation">.</span>EndOfStream<span class="token punctuation">)</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>sr<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sr<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></li>
<li>
<p><strong>Por completo:</strong> Un m√©todo muy √∫til es <strong><code>string ReadToEnd()</code></strong>, que nos devuelve una cadena con todo el texto que hubiese desde la posici√≥n actual del flujo sobre el que se aplica hasta el final del mismo (o null si ya est√°bamos en su final).</p>
<blockquote>
<p><strong>Notas:</strong></p>
<ol>
<li>üëÅÔ∏è Si el <strong>fichero es muy grande</strong>, podemos obtener un error de <strong>memoria insuficiente</strong>.</li>
<li>En la cadena se incluir√°n los saltos de l√≠nea con la codificaci√≥n dependiente de la plataforma.</li>
</ol>
</blockquote>
<p><strong>Ejemplo:</strong></p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-bool">bool</span></span> AUTODETECTAR_CODIFICACION_BOM <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>           
<span class="token class-name">StreamReader</span> sr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamReader</span><span class="token punctuation">(</span><span class="token string">"ejemplo.txt"</span><span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Unicode<span class="token punctuation">,</span> AUTODETECTAR_CODIFICACION_BOM<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Muestro todo el texto pero antes, cambio cualquier posible salto de l√≠nea como CRLF o CR por LF.</span>
Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span>sr<span class="token punctuation">.</span><span class="token function">ReadToEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"\r"</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sr<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<h2 id="manejo-de-excepciones-con-ficheros">Manejo de excepciones con ficheros </h2>
<p>Como ya se vi√≥ al hablar de la cl√°usula <strong><code>finally</code></strong> al manejar excepciones. Uno de los casos donde el uso de excepciones se hace casi imprescindible, es la manejo de ficheros. Esto es, porque se pueden producir multitud de errores como:</p>
<ul>
<li>Rutas de acceso (path) no v√°lidas.</li>
<li>Carencia de premisos de acceso.</li>
<li>Estar el acceso bloqueado por otro usuario.</li>
<li>Problemas de disco devueltos por el Sistema Operativo.</li>
<li>etc.</li>
</ul>
<p>Adem√°s, si no hacemos un <strong><code>Close()</code></strong> tras una excepci√≥n, puede que dejemos el recurso abierto y bloqueado para su acceso por otros usuarios o borrado.</p>
<p>Veamos <strong>a trav√©s de un ejemplo</strong> cual es la <strong>mejor forma de abordarlo</strong> en C#. Para ello, imaginemos una funci√≥n que encapsula una escritura en disco de las que hemos realizado en los puntos anteriores y que va a realizar una gesti√≥n de excepciones tradicional de las que vimos en el tema anterior.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Debo declarar el id aqu√≠ para que est√© accesible desde el bloque finally.</span>
    <span class="token class-name">StreamWriter<span class="token punctuation">?</span></span> sw <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-try">try</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> A√ëADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span><span class="token string">@".\\NOEXISTE\\ejemplo.txt"</span><span class="token punctuation">,</span> A√ëADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"L√≠nea de texto con salto al final codificada en Unicode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Ya no hago el Close() aqu√≠ pues se hace en el finally</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// En este ejemplo solo captura las excepciones de entrada y salida y las muestro.</span>
    <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Creando ejemplo.txt </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">e<span class="token punctuation">.</span>Message</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-finally">finally</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// El cierre solo lo hago aqu√≠ y solo si logr√© abrir el Stream</span>
        <span class="token comment">// y he finalizado correctamente el proceso o el error se produjo</span>
        <span class="token comment">// una vez abierto, durante el proceso de escritura.</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>sw <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
            sw<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Como podemos apreciar de la implementaci√≥n anterior hemos tenido que a√±adir muchos bloques de control. No obstante, lo normal ser√≠a hacer solo el bloque <strong><code>finally</code></strong> y el control de errores en en un m√≥dulo superior como.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">StreamWriter<span class="token punctuation">?</span></span> sw <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-try">try</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> A√ëADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span><span class="token string">@".\\NOEXISTE\\ejemplo.txt"</span><span class="token punctuation">,</span> A√ëADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"L√≠nea de texto con salto al final codificada en Unicode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-finally">finally</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>sw <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
            sw<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-try">try</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Aqu√≠ podemos llamar a otros m√≥dulos que puede generar tambi√©n IOException</span>
        <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">?</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            e <span class="token operator">=</span> e<span class="token punctuation">.</span>InnerException<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>C√≥mo vemos el <strong><code>finally</code></strong> lo tenemos que hacer en el m√≥dulo donde se hace la apertura del fichero y aunque hemos quitado el <strong><code>catch</code></strong> el c√≥digo sigue siendo algo engorroso. Por esa raz√≥n, el lenguaje C# a√±ade una cl√°usula que nos permitir√° hacer el c√≥digo anterior de forma simplificada.<br>
La cl√°usula es <strong><code>using</code></strong> y <strong>aunque la explicaremos en m√°s profundidad en temas posteriores</strong>. Lo que har√° b√°sicamente, es definir un bloque de uso de un <strong><code>Stream</code></strong> para el cual, si ocurre cualquier excepci√≥n <strong>nos asegurar√° el cierre del mismo</strong>.<br>
El c√≥digo del anterior de <strong><code>EscribeFichero()</code></strong> se puede reescribir de la siguiente manera y ser√≠a equivalente al anterior pero m√°s simplificado y que ser√° la forma de uso m√°s com√∫n en los ejemplos de uso de Streams en la documentaci√≥n oficial de Microsoft o cundo busquemos el uso de Streams en C# por Internet.</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> A√ëADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-using">using</span> <span class="token punctuation">(</span><span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token string">@".\\NOEXISTE\\ejemplo.txt"</span><span class="token punctuation">,</span> A√ëADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// sw estar√° accesible solo en este bloque y nos asegurar√° su cierre ante un error.</span>
        sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"L√≠nea de texto con salto al final codificada en Unicode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// No tenemos que cerrar el Stream porque ya lo hace el using. (NOS ASEGURA SU CIERRE)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p>Sin embargo, a partir de <strong>C# 8</strong> ha simplificado a√∫n m√°s el <strong><a href="https://docs.microsoft.com/es-es/dotnet/csharp/whats-new/csharp-8#using-declarations">uso de la cl√°usula <code>using</code></a></strong> de tal manera que ahora podremos hacer un c√≥digo equivalente los dos anteriores del m√©todo <strong><code>EscribeFichero()</code></strong> de la siguiente forma...</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> A√ëADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-using">using</span> <span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token string">@".\\NOEXISTE\\ejemplo.txt"</span><span class="token punctuation">,</span> A√ëADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"L√≠nea de texto con salto al final codificada en Unicode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// sw ser√° accesible en todo el m√©todo y adem√°s nos asegura su cierre </span>
    <span class="token comment">// al salir del √°mbito del mismo ya sea porque finaliza correctamente o porque</span>
    <span class="token comment">// se ha producido alg√∫n error.</span>
<span class="token punctuation">}</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p>Est√° sintaxis adem√°s nos permitir√° relanzar la excepci√≥n de forma sencilla sin tener que a√±adir el bloque <strong><code>finally</code></strong> y asegur√°ndonos el cierre cuando relancemos la excepci√≥n.</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp csharp line-numbers"><code><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-try">try</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> A√ëADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-using">using</span> <span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token string">@".\\NOEXISTE\\ejemplo.txt"</span><span class="token punctuation">,</span> A√ëADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"L√≠nea de texto con salto al final codificada en Unicode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">IOException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Creando ejemplo.txt"</span></span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><div style="page-break-after:always;"></div>
<h2 id="mortar_board-caso-de-estudio-de-streamwriter-streamreader-y-excepciones">üéì Caso de estudio de StreamWriter, StreamReader y excepciones </h2>
<p>Vamos a escribir un programa que gestione datos de Alumnos y los almacene en un <strong><a href="https://es.wikipedia.org/wiki/Valores_separados_por_comas">fichero CSV (Comma-Separated Values)</a>.</strong></p>
<ol>
<li>
<p>Para ello vamos a definir una clase <strong><code>Alumno</code></strong> de la siguiente forma:</p>
<ul>
<li>Guardaremos los siguientes campos: <strong><code>nia</code></strong>, <strong><code>nombre</code></strong>, <strong><code>apellido</code></strong>.</li>
<li>La clase tendr√° un constructor que recibe todos los campos.</li>
<li><strong>Accesores</strong> o <em>getters</em> para cada uno de los campos.</li>
<li>Invalidaci√≥n de <strong><code>ToString()</code></strong> para que muestre los datos del alumno <strong>en una l√≠nea</strong>.</li>
</ul>
</li>
<li>
<p>Definiremos un men√∫ con las siguientes opciones:</p>
<ul>
<li><strong>Introduce Alumno:</strong> El cual pedir√° los datos de un alumno y lo almacenar√° en un fichero de texto con codificaci√≥n <strong>UTF8</strong> y separado por comas CSV denominado <strong><code>alumnos.csv</code></strong> en la misma carpeta del ejecutable.<br>
Si el archivo existe, se permitir√° a√±adir al final m√°s informaci√≥n sin eliminar el contenido.</li>
<li><strong>Mostrar Alumnos:</strong> La cual mostrar√° en pantalla el contenido del fichero <strong>alumnos.csv</strong>.</li>
<li><strong>Buscar Alumno:</strong> Buscar√° en el fichero mostrar√° la informaci√≥n de un determinado alumno a partir de su <strong>NIA</strong> introducido.</li>
</ul>
</li>
<li>
<p>Para realizar la gesti√≥n del punto 2 vamos a definir una concreci√≥n de la clase <strong><code>Alumno</code></strong> denominada <strong><code>AlumnoCSV</code></strong>. Dicha clase tendr√° como '<em>responsabilidad</em>' las operaciones '<em>b√°sicas</em>' sobre el fichero CSV que <strong>NO impliquen una lectura y escritura por consola</strong>:</p>
<ul>
<li>
<p>M√©todo de <strong>instancia</strong> <strong><code>void Guarda(string ruta)</code></strong> que a√±ada los datos del alumno al final del fichero CSV indicado en la ruta.<br>
La '<em>coma</em>' de separaci√≥n de los campos ser√° el car√°cter <strong>';'</strong> (punto y coma).<br>
Al a√±adir un alumno, deberemos tener en cuenta que <strong>la primera l√≠nea del fichero csv guarda el nombre de los campos</strong>. Por lo que si estamos a√±adiendo el primer alumno, antes deberemos a√±adir la fila con el nombre de los campos.</p>
<blockquote>
<p><strong>Nota:</strong> Podr√° haber NIA repetidos, puesto que no controlaremos tal hecho.</p>
</blockquote>
<blockquote>
<p><strong>Ejemplo:</strong> Tras guardar  2 alumnos el aspecto del fichero podr√≠a ser el siguiente ...</p>
<pre data-role="codeBlock" data-info="csv" class="language-csv csv"><code><span class="token value">NIA;Apellido;Nombre</span>
<span class="token value">1;Garcia;Xusa</span>
<span class="token value">2;Guarinos;Juanjo</span>
</code></pre></blockquote>
</li>
<li>
<p>M√©todo de <strong>clase</strong> <strong><code>Alumno[] Lee(string ruta)</code></strong> que leer√° los alumnos guardados en el fichero especificado en la ruta o null si est√° vac√≠o.</p>
</li>
<li>
<p>M√©todo de <strong>clase</strong> <strong><code>public static bool Busca(in ulong nia, string ruta, out Alumno alumno)</code></strong> que me dir√° si existe un alumno un alumno o no en el fichero especificado y en caso afirmativo me devolver√° un objeto con la informaci√≥n del mismo.</p>
</li>
</ul>
</li>
<li>
<p>Por √∫ltimo, a√±adiremos la gesti√≥n de <strong>excepciones</strong> para controlar posibles problemas de acceso a los ficheros.</p>
</li>
</ol>
<p>Propuesta de soluci√≥n explicada (<strong>lee los comentarios del c√≥digo</strong>):</p>
<ol>
<li>
<p>Definiremos la clase <strong><code>Alumno</code></strong> donde su <strong>√∫nica responsabilidad</strong> ser√° gestionar los campos, sus accesores y como se pasa a cadena sus datos.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">Alumno</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-readonly">readonly</span> <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-ulong">ulong</span></span> nia<span class="token punctuation">;</span>
    <span class="token keyword keyword-readonly">readonly</span> <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> nombre<span class="token punctuation">;</span>
    <span class="token keyword keyword-readonly">readonly</span> <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> apellido<span class="token punctuation">;</span>

    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-ulong">ulong</span></span> <span class="token function">GetNIA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> nia<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">GetNombre</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> nombre<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">GetApellido</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> apellido<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token function">Alumno</span><span class="token punctuation">(</span><span class="token keyword keyword-in">in</span> <span class="token class-name"><span class="token keyword keyword-ulong">ulong</span></span> nia<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> nombre<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> apellido<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>nia <span class="token operator">=</span> nia<span class="token punctuation">;</span>
        <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>nombre <span class="token operator">=</span> nombre<span class="token punctuation">;</span>
        <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>apellido <span class="token operator">=</span> apellido<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-override">override</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetNIA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">8</span></span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetApellido</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">12</span></span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetNombre</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">12</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<ol start="2">
<li>
<p>Ahora definimos la concreci√≥n de <strong><code>Alumno</code></strong> con para gestionar la escritura y lectura de sus datos sobre el fichero CSV.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">AlumnoCSV</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Alumno</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">// Una de las posibilidades de gestionar excepciones particulares de una clase </span>
    <span class="token comment">// es definir un tipo anidado para ela excepci√≥n. De tal manera que cuando</span>
    <span class="token comment">// la usemos fuera de la misma el tipo ser√° AlumnoCSV.Excepci√≥n lo cual</span>
    <span class="token comment">// me indicar√° claramente que ser√°n excepciones derivadas de la escritura</span>
    <span class="token comment">// y lectura del CSV por parte de AlumnoCSV</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">Excepci</span>√≥n <span class="token punctuation">:</span> Exception
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-public">public</span> Excepci√≥<span class="token function">n</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> message<span class="token punctuation">,</span> <span class="token class-name">Exception</span> inner<span class="token punctuation">)</span> 
        <span class="token punctuation">:</span> <span class="token keyword keyword-base">base</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> inner<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-public">public</span> <span class="token function">AlumnoCSV</span><span class="token punctuation">(</span><span class="token keyword keyword-in">in</span> <span class="token class-name"><span class="token keyword keyword-ulong">ulong</span></span> nia<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> nombre<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> apellido<span class="token punctuation">)</span> 
    <span class="token punctuation">:</span> <span class="token keyword keyword-base">base</span><span class="token punctuation">(</span>nia<span class="token punctuation">,</span> nombre<span class="token punctuation">,</span> apellido<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Constructor </span>
    <span class="token punctuation">}</span>

    <span class="token comment">// M√©todo de clase privado que se encargar√° de leer la pr√≥xima l√≠nea del </span>
    <span class="token comment">// CSV a partir de donde se encuentre situado el descriptor de </span>
    <span class="token comment">// StreamReader sr (deber√≠a estar al principio de la misma).</span>
    <span class="token comment">// EVITA QUE SE REPITAN ESTAS L√çNEAS EN EL LEE Y EN EL BUSCA.</span>
    <span class="token comment">// Al ser privada cualquier excepci√≥n producida por la lectura o no correspondencia </span>
    <span class="token comment">// de de lo le√≠do en la l√≠nea con lo que se espera para poder crear un objeto Alumno</span>
    <span class="token comment">// ser√° gestionada por los m√©todos que la usen.</span>
    <span class="token comment">// Por ejemplo: Una excepci√≥n posible podr√≠a ser un OutOfBoundsException</span>
    <span class="token comment">// resultado que que no hay tres elementos en el array tras el Split.</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">Alumno</span> <span class="token function">Lee</span><span class="token punctuation">(</span><span class="token class-name">StreamReader</span> sr<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> campos <span class="token operator">=</span> sr<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">?.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token char">';'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> 
                        <span class="token operator">??</span> 
                        <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">NullReferenceException</span><span class="token punctuation">(</span><span class="token string">"No se ha podido leer Alumno en el CSV"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">Alumno</span><span class="token punctuation">(</span><span class="token keyword keyword-ulong">ulong</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>campos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> campos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> campos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Recibe una ruta a un fichero CSV de alumnos y me devuelve un array con los</span>
    <span class="token comment">// alumnos guardados en el mismo o null si no hay ninguno.</span>
    <span class="token comment">// EL m√©todo no puede mostrar nada porque generar√≠amos una dependencia con</span>
    <span class="token comment">// la consola que exceder√≠a la responsabilidad de la clase y la har√≠a menos</span>
    <span class="token comment">// reutilizable. Por la misma raz√≥n, tampoco devolvemos un string con todos </span>
    <span class="token comment">// los alumnos.</span>
    <span class="token comment">// Quien use el m√©todo decidir√° como se visualizan.</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">Alumno<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">Lee</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> ruta<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Inicializamos el array a null.</span>
        <span class="token class-name">Alumno<span class="token punctuation">[</span><span class="token punctuation">]</span></span> alumnos <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">Alumno</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-try">try</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Al usar el using, nos aseguramos que al salir del √°mbito de</span>
            <span class="token comment">// declaraci√≥n se ha realizado un finally para cerrar los streams</span>
            <span class="token keyword keyword-using">using</span> <span class="token class-name">FileStream</span> stream <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>ruta<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-using">using</span> <span class="token class-name">StreamReader</span> sr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>

             <span class="token comment">// Leemos y saltamos cabecera de las columnas</span>
            sr<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>sr<span class="token punctuation">.</span>EndOfStream<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Array<span class="token punctuation">.</span><span class="token function">Resize</span><span class="token punctuation">(</span><span class="token keyword keyword-ref">ref</span> alumnos<span class="token punctuation">,</span> alumnos<span class="token punctuation">?.</span>Length <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">??</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// A√±adimos el array le√≠do al hueco que hemos hecho para el mismo.</span>
                alumnos<span class="token punctuation">[</span><span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Lee</span><span class="token punctuation">(</span>sr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Relanzo cualquier excepci√≥n envolvi√©ndola en un tipo</span>
            <span class="token comment">// AlumnoCSV.Excepci√≥n e indicando el proceso que estaba haciendo</span>
            <span class="token comment">// para poder saber mejor de donde ha venido la misma.</span>
            <span class="token comment">// En este momento se que los streams est√°n cerrados porque ya se</span>
            <span class="token comment">// ha ejecutado el finally impl√≠cito por los using.</span>
            <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> Excepci√≥<span class="token function">n</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Leyendo alumnos de </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ruta</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> alumnos<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div style="page-break-after:always;"></div>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token comment">// M√©todo de instancia encargado de guardar el Alumno que en el fichero CSV</span>
    <span class="token comment">// especificado en la ruta.</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Guarda</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> ruta<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-try">try</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Abrimos con Append que a√±ade al final del fichero o lo crea si no existe.</span>
            <span class="token keyword keyword-using">using</span> <span class="token class-name">FileStream</span> stream <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>ruta<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Append<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-using">using</span> <span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Si el stream se acaba de crear a√±adiremos la fila con los nombre de</span>
            <span class="token comment">// las columnas antes de escribir el primer registro.</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>stream<span class="token punctuation">.</span>Length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"NIA;Apellido;Nombre"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// Escribimos la l√≠nea y hacemos un flush para asegurarnos de que </span>
            <span class="token comment">// se modifique el fichero.</span>
            sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetNIA</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetApellido</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetNombre</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sw<span class="token punctuation">.</span><span class="token function">Flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Relanzo cualquier excepci√≥n envolvi√©ndola en un tipo</span>
            <span class="token comment">// AlumnoCSV.Excepci√≥n e indicando el proceso que estaba haciendo</span>
            <span class="token comment">// para poder saber mejor de donde ha venido la misma.</span>
            <span class="token comment">// En este momento se que los streams est√°n cerrados porque ya se</span>
            <span class="token comment">// ha ejecutado el finally impl√≠cito por los using.</span>
            <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> Excepci√≥<span class="token function">n</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Guardando Alumno </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword keyword-this">this</span></span><span class="token punctuation">}</span></span><span class="token string"> en </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ruta</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// M√©todo de clase que recibe un NIA y una ruta a un fichero CSV y busca</span>
    <span class="token comment">// el primer alumno con el NIA especificado.</span>
    <span class="token comment">// Si no lo encuentra devuelve falso y si lo encuentra devuelve cierto y </span>
    <span class="token comment">// una inst√°ncia a un objeto Alumno con los datos del mismo.</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-bool">bool</span></span> <span class="token function">Busca</span><span class="token punctuation">(</span><span class="token keyword keyword-in">in</span> <span class="token class-name"><span class="token keyword keyword-ulong">ulong</span></span> nia<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> ruta<span class="token punctuation">,</span> <span class="token keyword keyword-out">out</span> <span class="token class-name">Alumno<span class="token punctuation">?</span></span> alumno<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        alumno <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-try">try</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-using">using</span> <span class="token class-name">FileStream</span> stream <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>ruta<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-using">using</span> <span class="token class-name">StreamReader</span> sr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Leemos y saltamos cabecera de las columnas</span>
            sr<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>sr<span class="token punctuation">.</span>EndOfStream <span class="token operator">&amp;&amp;</span> alumno <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Llamo al m√©todo de privado de clase Lee al que le paso</span>
                <span class="token comment">// el stream apuntado a la lectura de la siguiente l√≠nea</span>
                <span class="token comment">// con los datos de una alumno.</span>
                <span class="token class-name">Alumno</span> a <span class="token operator">=</span> <span class="token function">Lee</span><span class="token punctuation">(</span>sr<span class="token punctuation">)</span><span class="token punctuation">;</span>                    
                <span class="token comment">// Si encuentro el n√≠a establezco el par√°metro de salida</span>
                <span class="token comment">// encontrado y finalizo el bucle.</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>nia <span class="token operator">==</span> a<span class="token punctuation">.</span><span class="token function">GetNIA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    alumno <span class="token operator">=</span> a<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Relanzo cualquier excepci√≥n envolvi√©ndola en un tipo</span>
            <span class="token comment">// AlumnoCSV.Excepci√≥n e indicando el proceso que estaba haciendo</span>
            <span class="token comment">// para poder saber mejor de donde ha venido la misma.</span>
            <span class="token comment">// En este momento se que los streams est√°n cerrados porque ya se</span>
            <span class="token comment">// ha ejecutado el finally impl√≠cito por los using.</span>
            <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> Excepci√≥<span class="token function">n</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Buscando alumno con NIA </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">nia</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword keyword-return">return</span> alumno <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<ol start="3">
<li>
<p>Vamos a implementar el programa principal bas√°ndonos en las clases definidas anteriormente.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code><span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Enumeraci√≥n con las opciones del programa para autodocumentar y evitar n√∫meros m√°gicos.</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-enum">enum</span> <span class="token class-name">Opci</span>√≥nPrograma <span class="token punctuation">{</span>IntroduceAlumno <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> MostrarAlumnos <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> BuscarAlumno <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> Salir <span class="token operator">=</span> <span class="token number">4</span> <span class="token punctuation">}</span>

    <span class="token comment">// Modularizaci√≥n de mostrar men√∫ para autodocumentar y simplificar el Main.</span>
    <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span>Opci√≥nPrograma<span class="token punctuation">.</span>IntroduceAlumno</span><span class="token punctuation">}</span></span><span class="token string"> - Introduce Alumno."</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span>Opci√≥nPrograma<span class="token punctuation">.</span>MostrarAlumnos</span><span class="token punctuation">}</span></span><span class="token string"> - Mostrar Alumnos."</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span>Opci√≥nPrograma<span class="token punctuation">.</span>BuscarAlumno</span><span class="token punctuation">}</span></span><span class="token string"> - Buscar Alumno."</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span>Opci√≥nPrograma<span class="token punctuation">.</span>Salir</span><span class="token punctuation">}</span></span><span class="token string"> - Salir."</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Lee una opci√≥n v√°lida de programa.</span>
    <span class="token keyword keyword-static">static</span> Opci√≥<span class="token return-type class-name">nPrograma</span> <span class="token function">Lee</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-bool">bool</span> v√°lida<span class="token punctuation">;</span>
        Opci√≥<span class="token class-name">nPrograma</span> o <span class="token operator">=</span> Opci√≥nPrograma<span class="token punctuation">.</span>Salir<span class="token punctuation">;</span>
        <span class="token keyword keyword-do">do</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"Introduce una opci√≥n: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            v√°lida <span class="token operator">=</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-out">out</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> valor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>v√°lida<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> valores <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>Enum<span class="token punctuation">.</span><span class="token function">GetValues</span><span class="token punctuation">(</span><span class="token keyword keyword-typeof">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Opci√≥nPrograma</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                v√°lida <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span>valores<span class="token punctuation">,</span> valor<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>v√°lida<span class="token punctuation">)</span>
                o <span class="token operator">=</span> <span class="token punctuation">(</span>Opci√≥nPrograma<span class="token punctuation">)</span>valor<span class="token punctuation">;</span>
            <span class="token keyword keyword-else">else</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Opci√≥n incorrecta!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>v√°lida<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Modularizaci√≥n del proceso de introducci√≥n de un alumno para </span>
    <span class="token comment">// autodocumentar y simplificar el Main.</span>
    <span class="token comment">// Cualquier excepci√≥n producida se gestionar√° en el Main</span>
    <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">IntroduceAlumno</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> fichero<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"NIA: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword keyword-ulong">ulong</span></span> nia <span class="token operator">=</span> <span class="token keyword keyword-ulong">ulong</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"Nombre: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword keyword-string">string</span></span> nombre <span class="token operator">=</span> Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">""</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"Apellido: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword keyword-string">string</span></span> apellido <span class="token operator">=</span> Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">""</span><span class="token punctuation">;</span>

        <span class="token comment">// Creo una inst√°ncia de AlumnoCSV y guardo sus datos en el</span>
        <span class="token comment">// fichero que me indican por par√°metro.</span>
        <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">AlumnoCSV</span><span class="token punctuation">(</span>nia<span class="token punctuation">,</span> nombre<span class="token punctuation">,</span> apellido<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Guarda</span><span class="token punctuation">(</span>fichero<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Datos guardados."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Modularizaci√≥n del proceso de buscar y mostrar los datos de un alumno </span>
    <span class="token comment">// para autodocumentar y simplificar el Main.</span>
    <span class="token comment">// Cualquier excepci√≥n producida se gestionar√° en el Main</span>
    <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">BuscaAlumno</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> fichero<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Hago un control preliminar para evitar excepciones obvias que se</span>
        <span class="token comment">// pueden controlar f√°cilmente con la l√≥gica del programa.</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>fichero<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"NIA a buscar: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword keyword-ulong">ulong</span></span> nia <span class="token operator">=</span> <span class="token keyword keyword-ulong">ulong</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Una ves le√≠do el NIA uso el m√©todo de clase definido en AlumnoCSV </span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>AlumnoCSV<span class="token punctuation">.</span><span class="token function">Busca</span><span class="token punctuation">(</span>nia<span class="token punctuation">,</span> fichero<span class="token punctuation">,</span> <span class="token keyword keyword-out">out</span> <span class="token class-name">Alumno<span class="token punctuation">?</span></span> a<span class="token punctuation">)</span><span class="token punctuation">)</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Los datos del alumno con nia </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">nia</span><span class="token punctuation">}</span></span><span class="token string"> son:\n</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">a</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-else">else</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"No existe ning√∫n alumno de nia </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">nia</span><span class="token punctuation">}</span></span><span class="token string">."</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-else">else</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"El fichero de datos </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">fichero</span><span class="token punctuation">}</span></span><span class="token string"> a√∫n no se ha creado."</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div style="page-break-after:always;"></div>
<p>Continuamos con la implementaci√≥n del Main que adem√°s de gestionar y recuperarse de las posibles excepciones. Controlar√° la l√≥gica de ejecuci√≥n de las opciones posibles.<br>
Aunque ha quedado bastante legible, su n√∫mero de l√≠neas podr√≠a sugerirnos una posible modularizaci√≥n m√°s para simplificar que incluya el Switch.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp csharp"><code>    <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> FICHERO <span class="token operator">=</span> <span class="token string">"alumnos.csv"</span><span class="token punctuation">;</span>
        Opci√≥nPrograma opci√≥n <span class="token operator">=</span> Opci√≥nPrograma<span class="token punctuation">.</span>Salir<span class="token punctuation">;</span>

        <span class="token keyword keyword-do">do</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-bool">bool</span> pausaTrasOpci√≥n <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-try">try</span>
            <span class="token punctuation">{</span>
                <span class="token function">Menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// El usar un enum para las opciones de men√∫. Adem√°s de darnos legibilidad</span>
                <span class="token comment">// Nos asegura que no se va a poder dar el caso default si hemos</span>
                <span class="token comment">// a√±adido todas los valores en el switch.</span>
                opci√≥n <span class="token operator">=</span> <span class="token function">Lee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>opci√≥n<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword keyword-case">case</span> Opci√≥nPrograma<span class="token punctuation">.</span>IntroduceAlumno<span class="token punctuation">:</span>
                        <span class="token function">IntroduceAlumno</span><span class="token punctuation">(</span>FICHERO<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-case">case</span> Opci√≥nPrograma<span class="token punctuation">.</span>MostrarAlumnos<span class="token punctuation">:</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>FICHERO<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            <span class="token class-name"><span class="token keyword keyword-var">var</span></span> alumnos <span class="token operator">=</span> AlumnoCSV<span class="token punctuation">.</span><span class="token function">Lee</span><span class="token punctuation">(</span>FICHERO<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>alumnos <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span> 
                            <span class="token punctuation">?</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Join</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Alumno<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">,</span> alumnos<span class="token punctuation">)</span>
                            <span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">$"El fichero </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">FICHERO</span><span class="token punctuation">}</span></span><span class="token string"> est√° vac√≠o."</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword keyword-else">else</span>
                            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"El fichero de datos </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">FICHERO</span><span class="token punctuation">}</span></span><span class="token string"> a√∫n no se ha creado."</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-case">case</span> Opci√≥nPrograma<span class="token punctuation">.</span>BuscarAlumno<span class="token punctuation">:</span>
                        <span class="token function">BuscaAlumno</span><span class="token punctuation">(</span>FICHERO<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-case">case</span> Opci√≥nPrograma<span class="token punctuation">.</span>Salir<span class="token punctuation">:</span>
                        pausaTrasOpci√≥n <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">?</span> e<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>e<span class="token punctuation">?.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    e <span class="token operator">=</span> e<span class="token punctuation">?.</span>InnerException<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>pausaTrasOpci√≥n<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"Pulsa una tecla..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>opci√≥n <span class="token operator">!=</span> Opci√≥nPrograma<span class="token punctuation">.</span>Salir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token comment">// Cierre de la definici√≥n de la clase Program</span>
</code></pre></li>
</ol>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>