<!DOCTYPE html><html><head>
      <title>Programaci&#xF3;n 1&#xBA; DAM Tema 8.2</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
.markdown-preview.markdown-preview .slides > section {
  height: 100%;
  font-size: 90%;
  overflow-y: auto !important;
}
.markdown-preview.markdown-preview .slide code {
  color: yellow;
}

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <h1 class="mume-header undefined" id="tema-82">Tema 8.2</h1>

<p>Descargar estos apuntes en <a href="./Tema8_2.pdf">pdf</a> o <a href="./Tema8_2.html">html</a></p>
<h2 class="mume-header undefined" id="%C3%ADndice">&#xCD;ndice</h2>

<ol>
<li><a href="#flujos-de-datos-en-serie-o-streams">Flujos de datos en serie o streams</a>
<ol>
<li><a href="#conceptos-generales-sobre-streams">Conceptos generales sobre Streams</a>
<ol>
<li><a href="#operaciones-y-nomenclatura-relacionada-con-streams">Operaciones y nomenclatura relacionada con Streams</a>
<ol>
<li><a href="#apertura-open">Apertura (Open)</a></li>
<li><a href="#cierre-close">Cierre (Close)</a></li>
<li><a href="#lectura-read-y-escritura-write">Lectura (Read) y Escritura (Write)</a></li>
<li><a href="#volcado-flush">Volcado (Flush)</a></li>
</ol>
</li>
</ol>
</li>
<li><a href="#streams-en-chttpsdocsmicrosoftcomes-esdotnetstandardio">Streams en C#</a>
<ol>
<li><a href="#lectura-y-escritura-de-ficheros-sin-transformar">Lectura y escritura de ficheros sin transformar</a>
<ol>
<li><a href="#apertura-y-cierre-de-un-fichero-con-filestream">Apertura y Cierre de un fichero con FileStream</a></li>
<li><a href="#escritura-de-un-fichero-con-filestream">Escritura de un fichero con FileStream</a></li>
<li><a href="#lectura-de-un-fichero-con-filestream">Lectura de un fichero con FileStream</a></li>
<li><a href="#longitud-y-posici%C3%B3n-en-el-stream">Longitud y Posici&#xF3;n en el Stream</a></li>
<li><a href="#desplaz%C3%A1ndonos-por-el-stream">Desplaz&#xE1;ndonos por el Stream</a></li>
<li><a href="#recorriendo-un-filestream-hasta-el-final">Recorriendo un FileStream hasta el final</a></li>
</ol>
</li>
<li><a href="#pasando-el-flujo-por-un-decorator-stream">Pasando el flujo por un &apos;<em>Decorator Stream</em>&apos;</a>
<ol>
<li><a href="#ejemplo-de-decorator-stream-usando-bufferedstream">Ejemplo de &apos;<em>Decorator Stream</em>&apos; usando BufferedStream</a></li>
</ol>
</li>
<li><a href="#transformando-el-flujo-con-un-stream-adapter">Transformando el flujo con un &apos;<em>Stream Adapter</em>&apos;</a>
<ol>
<li><a href="#stream-adapters-binarywriter-y-binaryreader">Stream Adapters BinaryWriter y BinaryReader</a></li>
<li><a href="#mortar_board-caso-de-estudio-de-lectura-en-binario-con-binaryreader">&#x1F393; Caso de estudio de lectura en binario con BinaryReader</a></li>
<li><a href="#stream-adapters-streamwriter-y-streamreader">Stream Adapters StreamWriter y StreamReader</a></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li><a href="#manejo-de-excepciones-con-ficheros">Manejo de excepciones con ficheros</a></li>
<li><a href="#mortar_board-caso-de-estudio-de-streamwriter-streamreader-y-excepciones">&#x1F393; Caso de estudio de StreamWriter, StreamReader y excepciones</a></li>
</ol>
<div style="page-break-after:always;"></div>
<h2 class="mume-header" id="flujos-de-datos-en-serie-o-streams">Flujos de datos en serie o streams</h2>

<h3 class="mume-header" id="conceptos-generales-sobre-streams">Conceptos generales sobre Streams</h3>

<p>La lectura y escritura de un archivo son hechas usando un concepto gen&#xE9;rico llamado <strong>stream</strong>.</p>
<p>Los <strong>stream</strong> son <strong>flujos de datos</strong> <strong>secuenciales</strong> que se utilizan para la <strong>transferencia de informaci&#xF3;n de un punto a otro</strong>.</p>
<p>Los datos del stream se agrupan de forma b&#xE1;sica en una <strong>secuencia de bytes</strong>....</p>
<p align="center" style="zoom:1"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="474pt" height="140pt" viewBox="0.00 0.00 474.00 140.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 136)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-136 470,-136 470,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="transparent" points="8,-8 8,-124 458,-124 458,-8 8,-8"/>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<polygon fill="none" stroke="#000000" points="24,-20 24,-54 80,-54 80,-20 24,-20"/>
<text text-anchor="start" x="32.9355" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">byte 0</text>
<polygon fill="none" stroke="#000000" points="80,-20 80,-54 136,-54 136,-20 80,-20"/>
<text text-anchor="start" x="88.9355" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">byte 1</text>
<polygon fill="none" stroke="#000000" points="136,-20 136,-54 192,-54 192,-20 136,-20"/>
<text text-anchor="start" x="144.9355" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">byte 2</text>
<polygon fill="none" stroke="#000000" points="192,-20 192,-54 248,-54 248,-20 192,-20"/>
<text text-anchor="start" x="200.9355" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">byte 3</text>
<polygon fill="none" stroke="#000000" points="248,-20 248,-54 304,-54 304,-20 248,-20"/>
<text text-anchor="start" x="256.9355" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">byte 4</text>
<polygon fill="none" stroke="#000000" points="304,-20 304,-54 360,-54 360,-20 304,-20"/>
<text text-anchor="start" x="312.9355" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">byte 5</text>
<polygon fill="none" stroke="#000000" points="360,-20 360,-54 416,-54 416,-20 360,-20"/>
<text text-anchor="start" x="368.9355" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">byte 6</text>
<text text-anchor="start" x="423.6641" y="-32.8" font-family="Arial" font-size="14.00" fill="#000000">...</text>
</g>
<!-- posición -->
<g id="node2" class="node">
<title>posici&#xF3;n</title>
<text text-anchor="middle" x="192" y="-93.8" font-family="Arial" font-size="14.00" fill="#000000">posici&#xF3;n</text>
</g>
<!-- posición&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>posici&#xF3;n-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="#000000" d="M192,-79.8495C192,-79.8495 192,-64 192,-64"/>
<polygon fill="#000000" stroke="#000000" points="195.5001,-64 192,-54 188.5001,-64 195.5001,-64"/>
</g>
</g>
</svg>
</p><p>Los stream pueden ser transferidos en <strong>dos posibles direcciones</strong>:</p>
<ol>
<li>Si los datos son transferidos desde una fuente externa al programa, entonces se habla de <strong>&apos;<em>leer desde el stream</em>&apos;</strong>.</li>
<li>Si los datos son transferidos desde el programa a alguna fuente externa, entonces se habla de <strong>&apos;<em>escribir al stream</em>&apos;</strong>.</li>
</ol>
<p>Frecuentemente, la fuente externa ser&#xE1; un <strong>archivo</strong>, pero no es absolutamente necesario. Las fuentes de informaci&#xF3;n externas  pueden ser de diversos tipos. Algunas posibilidades incluyen:</p>
<ul>
<li>Leer o escribir datos a una red utilizando alg&#xFA;n protocolo de red, donde la intenci&#xF3;n es que estos datos sean recibidos o enviados por otro computador.</li>
<li>Lectura o escritura a un &#xE1;rea de memoria.</li>
<li>La Consola.</li>
<li>La Impresora.</li>
<li>Otros ...</li>
</ul>
<blockquote>
<p>&#x1F4E3; <strong>Resumen:</strong> Por tanto, podemos considerar un <strong>flujo</strong> o <strong>stream</strong> como una <strong>secuencia bytes</strong> sobre la que podemos leer o escribir. Un fichero es un tipo espec&#xED;fico de <strong>stream</strong>.</p>
</blockquote>
<div style="page-break-after:always;"></div>
<h4 class="mume-header" id="operaciones-y-nomenclatura-relacionada-con-streams">Operaciones y nomenclatura relacionada con Streams</h4>

<h5 class="mume-header" id="apertura-open">Apertura (Open)</h5>

<p>Adem&#xE1;s de memoria, muchos flujos necesitan recursos extra. Por ejemplo, las conexiones de red crean sockets y los ficheros crean descriptores de ficheros en el sistema operativo.</p>
<p>En ocasiones, este proceso de apertura puede devolver errores o excepciones normalmente generadas por el SO como podr&#xED;an ser:</p>
<ul>
<li>Falta de permisos de acceso.</li>
<li>Bloqueo o uso por parte de otro programa.</li>
<li>El SO no puede crear m&#xE1;s descriptores o &apos;<em>manejadores</em>&apos; de ficheros.</li>
<li>Otros ...</li>
</ul>
<blockquote>
<p>&#x1F4E3; <strong>Resumen:</strong> Por tanto, al proceso de reservar, adquirir o bloquear estos recursos se denomina <strong>&apos;<em>apertura</em>&apos;</strong> y tras crear un flujo de datos diremos que lo estamos <strong>&apos;<em>abriendo</em>&apos;</strong>.</p>
</blockquote>
<h5 class="mume-header" id="cierre-close">Cierre (Close)</h5>

<p>C&#xF3;mo hemos comentado, si en el proceso de apertura necesitamos reservar, adquirir o bloquear recursos. Necesitaremos realizar el proceso opuesto de <strong>&apos;<em>liberaci&#xF3;n</em>&apos;</strong> de los mismos.</p>
<p>Deberemos llevar especial cuidado que este proceso de cierre se haga tambi&#xE9;n si se ha producido alg&#xFA;n error. Por tanto, si usamos excepciones, el <strong>&apos;<em>cierre</em>&apos;</strong> de un flujo deber&#xED;a ir en un bloque <strong><code>finally</code></strong>.</p>
<blockquote>
<p>&#x1F4E3; <strong>Resumen:</strong> Por tanto, tras finalizar el trabajo con el flujo de datos deberemos <strong>&apos;<em>cerrarlo</em>&apos;</strong>.</p>
</blockquote>
<h5 class="mume-header" id="lectura-read-y-escritura-write">Lectura (Read) y Escritura (Write)</h5>

<p>Son las operaciones b&#xE1;sicas sobre flujos y por tanto en su forma m&#xE1;s b&#xE1;sica transferir&#xE1;n bytes. Sin embargo en ocasiones estos bytes se pueden &apos;<em>agrupar</em>&apos; en la lectura para obtener tipos m&#xE1;s manejables y por tanto tambi&#xE9;n puede suceder el proceso inverso en el proceso de escritura.</p>
<h5 class="mume-header" id="volcado-flush">Volcado (Flush)</h5>

<p>Muchos flujos, en especial los que manejan ficheros, trabajan internamente con buffers donde se almacena temporalmente los bytes que se solicita <strong>escribir</strong>, hasta que su n&#xFA;mero alcance una cierta cantidad, momento en que son verdaderamente escritos todos a la vez en el flujo.<br>
Esto se hace porque las <strong>escrituras</strong> en flujos suelen ser <strong>operaciones lentas</strong>, e interesa que se hagan el menor n&#xFA;mero de veces posible.<br>
Sin embargo, hay ocasiones en que puede interesar asegurarse de que en un cierto instante se haya realizado el <strong>&apos;<em>volcado</em>&apos;</strong> real de los bytes en un flujo. En esos casos puede forzarse el volcado mediante la operaci&#xF3;n <strong>Flush</strong>, que vac&#xED;a por completo su buffer interno en el flujo.</p>
<blockquote>
<p>&#x1F4E3; <strong>Resumen:</strong> Por tanto, la operaci&#xF3;n de <strong>escritura</strong> en ficheros se realiza sobre un buffer de memoria RAM el cual se <strong>&apos;<em>volcar&#xE1;</em>&apos;</strong> en el soporte de almacenamiento por bloques para optimizar, ya sea de forma transparente o forzada.</p>
</blockquote>
<div style="page-break-after:always;"></div>
<h3 class="mume-header" id="streams-en-chttpsdocsmicrosoftcomes-esdotnetstandardio"><a href="https://docs.microsoft.com/es-es/dotnet/standard/io/">Streams en C#</a></h3>

<p>En C# los archivos, directorios y flujos con ficheros, se manejan con clases del las BCL definidas en el namespace: <strong><code>System.IO</code></strong></p>
<p><strong>Todos los flujos de datos</strong> en C# heredan de la clase <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.stream?view=net-5.0">Stream</a></strong> que implementa las operaciones b&#xE1;sicas antes descritas.</p>
<p>En el diagrama siguiente podemos ver de forma <strong>resumida</strong> c&#xF3;mo ha dise&#xF1;ado .NET sus clases para manejo de flujos.</p>
<blockquote>
<p><strong>Nota:</strong> Estos patrones de dise&#xF1;o y clases son an&#xE1;logos en otros lenguajes OO.</p>
</blockquote>
<p align="center" style="zoom:0.4"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="1624pt" height="496pt" viewBox="0.00 0.00 1624.30 496.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 492)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-492 1620.2953,-492 1620.2953,4 -4,4"/>
<g id="clust2" class="cluster">
<title>clusterG</title>
<polygon fill="none" stroke="#104e8b" points="354.891,-48 354.891,-480 1315.891,-480 1315.891,-48 354.891,-48"/>
<text text-anchor="middle" x="835.391" y="-449" font-family="Arial" font-size="30.00" fill="#104e8b">Clases para el manejo de streams</text>
</g>
<g id="clust3" class="cluster">
<title>cluster1</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="359.891,-73 359.891,-431 543.891,-431 543.891,-73 359.891,-73"/>
<text text-anchor="middle" x="451.891" y="-409" font-family="Arial" font-size="20.00" fill="#104e8b">Stream Adapters</text>
</g>
<g id="clust4" class="cluster">
<title>cluster2</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="722.891,-73 722.891,-431 906.891,-431 906.891,-73 722.891,-73"/>
<text text-anchor="middle" x="814.891" y="-409" font-family="Arial" font-size="20.00" fill="#104e8b">Decorator Streams</text>
</g>
<g id="clust5" class="cluster">
<title>cluster3</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="1090.891,-149 1090.891,-431 1310.891,-431 1310.891,-149 1090.891,-149"/>
<text text-anchor="middle" x="1200.891" y="-409" font-family="Arial" font-size="20.00" fill="#104e8b">Backing Store Streams</text>
</g>
<g id="clust6" class="cluster">
<title>cluster4</title>
<polygon fill="none" stroke="transparent" points="1424.2953,-146 1424.2953,-446 1608.2953,-446 1608.2953,-146 1424.2953,-146"/>
<text text-anchor="middle" x="1516.2953" y="-415" font-family="Arial" font-size="30.00" fill="#000000">Dispositivos</text>
</g>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="transparent" points="8,-8 8,-404 168,-404 168,-8 8,-8"/>
<text text-anchor="middle" x="88" y="-373" font-family="Arial" font-size="30.00" fill="#000000">Datos</text>
</g>
<!-- Texto -->
<g id="node1" class="node">
<title>Texto</title>
<polygon fill="none" stroke="#000000" points="154,-352 16,-352 16,-268 160,-268 160,-346 154,-352"/>
<polyline fill="none" stroke="#000000" points="154,-352 154,-346 "/>
<polyline fill="none" stroke="#000000" points="160,-346 154,-346 "/>
<text text-anchor="middle" x="88" y="-316" font-family="Arial" font-size="20.00" fill="#000000">Texto en</text>
<text text-anchor="middle" x="88" y="-292" font-family="Arial" font-size="20.00" fill="#000000">UTF-8</text>
</g>
<!-- StreamWriter -->
<g id="node4" class="node">
<title>StreamWriter</title>
<polygon fill="#36648b" stroke="#36648b" points="523.891,-379 379.891,-379 379.891,-321 523.891,-321 523.891,-379"/>
<text text-anchor="middle" x="451.891" y="-345.2" font-family="Arial" font-size="16.00" fill="#ffffff">StreamWriter</text>
</g>
<!-- Texto&#45;&gt;StreamWriter -->
<g id="edge1" class="edge">
<title>Texto-&gt;StreamWriter</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M160.3282,-336.5C160.3282,-336.5 369.6997,-336.5 369.6997,-336.5"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="369.6997,-340.0001 379.6997,-336.5 369.6996,-333.0001 369.6997,-340.0001"/>
<text text-anchor="middle" x="269.9455" y="-324.7" font-family="Arial" font-size="19.00" fill="#1874cd">string</text>
</g>
<!-- Tipos -->
<g id="node2" class="node">
<title>Tipos</title>
<polygon fill="none" stroke="#000000" points="154,-250 16,-250 16,-118 160,-118 160,-244 154,-250"/>
<polyline fill="none" stroke="#000000" points="154,-250 154,-244 "/>
<polyline fill="none" stroke="#000000" points="160,-244 154,-244 "/>
<text text-anchor="start" x="34" y="-214" font-family="Arial" font-size="20.00" fill="#000000">int</text>
<text text-anchor="start" x="34" y="-190" font-family="Arial" font-size="20.00" fill="#000000">double</text>
<text text-anchor="start" x="34" y="-166" font-family="Arial" font-size="20.00" fill="#000000">string</text>
<text text-anchor="start" x="34" y="-142" font-family="Arial" font-size="20.00" fill="#000000">...</text>
</g>
<!-- BinaryWriter -->
<g id="node6" class="node">
<title>BinaryWriter</title>
<polygon fill="#36648b" stroke="#36648b" points="523.891,-151 379.891,-151 379.891,-93 523.891,-93 523.891,-151"/>
<text text-anchor="middle" x="451.891" y="-117.2" font-family="Arial" font-size="16.00" fill="#ffffff">BinaryWriter</text>
</g>
<!-- Tipos&#45;&gt;BinaryWriter -->
<g id="edge2" class="edge">
<title>Tipos-&gt;BinaryWriter</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M160.3282,-134.5C160.3282,-134.5 369.6997,-134.5 369.6997,-134.5"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="369.6997,-138.0001 379.6997,-134.5 369.6996,-131.0001 369.6997,-138.0001"/>
<text text-anchor="middle" x="269.9455" y="-150.7" font-family="Arial" font-size="19.00" fill="#1874cd">tipos b&#xE1;sicos</text>
</g>
<!-- Bytes -->
<g id="node3" class="node">
<title>Bytes</title>
<polygon fill="none" stroke="#000000" points="154,-100 16,-100 16,-16 160,-16 160,-94 154,-100"/>
<polyline fill="none" stroke="#000000" points="154,-100 154,-94 "/>
<polyline fill="none" stroke="#000000" points="160,-94 154,-94 "/>
<text text-anchor="middle" x="88" y="-64" font-family="Arial" font-size="20.00" fill="#000000">Bytes sin</text>
<text text-anchor="middle" x="88" y="-40" font-family="Arial" font-size="20.00" fill="#000000">transformar</text>
</g>
<!-- DeflateStream -->
<g id="node8" class="node">
<title>DeflateStream</title>
<polygon fill="#4f94cd" stroke="#4f94cd" points="886.891,-379 742.891,-379 742.891,-321 886.891,-321 886.891,-379"/>
<text text-anchor="middle" x="814.891" y="-345.2" font-family="Arial" font-size="16.00" fill="#ffffff">DeflateStream</text>
</g>
<!-- StreamWriter&#45;&gt;DeflateStream -->
<g id="edge5" class="edge">
<title>StreamWriter-&gt;DeflateStream</title>
<path fill="none" stroke="transparent" stroke-width="3" d="M524.0421,-350C524.0421,-350 732.8764,-350 732.8764,-350"/>
<polygon fill="transparent" stroke="transparent" stroke-width="3" points="732.8765,-353.5001 742.8764,-350 732.8764,-346.5001 732.8765,-353.5001"/>
</g>
<!-- StreamReader -->
<g id="node5" class="node">
<title>StreamReader</title>
<polygon fill="#36648b" stroke="#36648b" points="523.891,-303 379.891,-303 379.891,-245 523.891,-245 523.891,-303"/>
<text text-anchor="middle" x="451.891" y="-269.2" font-family="Arial" font-size="16.00" fill="#ffffff">StreamReader</text>
</g>
<!-- StreamReader&#45;&gt;Texto -->
<g id="edge3" class="edge">
<title>StreamReader-&gt;Texto</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M379.5628,-285.5C379.5628,-285.5 170.1913,-285.5 170.1913,-285.5"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="170.1914,-282.0001 160.1913,-285.5 170.1913,-289.0001 170.1914,-282.0001"/>
</g>
<!-- BinaryReader -->
<g id="node7" class="node">
<title>BinaryReader</title>
<polygon fill="#36648b" stroke="#36648b" points="523.891,-227 379.891,-227 379.891,-169 523.891,-169 523.891,-227"/>
<text text-anchor="middle" x="451.891" y="-193.2" font-family="Arial" font-size="16.00" fill="#ffffff">BinaryReader</text>
</g>
<!-- BinaryReader&#45;&gt;Tipos -->
<g id="edge4" class="edge">
<title>BinaryReader-&gt;Tipos</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M379.5628,-198C379.5628,-198 170.1913,-198 170.1913,-198"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="170.1914,-194.5001 160.1913,-198 170.1913,-201.5001 170.1914,-194.5001"/>
</g>
<!-- FileStream -->
<g id="node13" class="node">
<title>FileStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="1272.891,-379 1128.891,-379 1128.891,-321 1272.891,-321 1272.891,-379"/>
<text text-anchor="middle" x="1200.891" y="-345.2" font-family="Arial" font-size="16.00" fill="#ffffff">FileStream</text>
</g>
<!-- DeflateStream&#45;&gt;FileStream -->
<g id="edge6" class="edge">
<title>DeflateStream-&gt;FileStream</title>
<path fill="none" stroke="transparent" stroke-width="3" d="M887.0418,-350C887.0418,-350 1118.7671,-350 1118.7671,-350"/>
<polygon fill="transparent" stroke="transparent" stroke-width="3" points="1118.7671,-353.5001 1128.7671,-350 1118.7671,-346.5001 1118.7671,-353.5001"/>
</g>
<!-- GZipStream -->
<g id="node9" class="node">
<title>GZipStream</title>
<polygon fill="#4f94cd" stroke="#4f94cd" points="886.891,-303 742.891,-303 742.891,-245 886.891,-245 886.891,-303"/>
<text text-anchor="middle" x="814.891" y="-269.2" font-family="Arial" font-size="16.00" fill="#ffffff">GZipStream</text>
</g>
<!-- CryptoStream -->
<g id="node10" class="node">
<title>CryptoStream</title>
<polygon fill="#4f94cd" stroke="#4f94cd" points="886.891,-227 742.891,-227 742.891,-169 886.891,-169 886.891,-227"/>
<text text-anchor="middle" x="814.891" y="-193.2" font-family="Arial" font-size="16.00" fill="#ffffff">CryptoStream</text>
</g>
<!-- BufferedStream -->
<g id="node11" class="node">
<title>BufferedStream</title>
<polygon fill="#4f94cd" stroke="#4f94cd" points="886.891,-151 742.891,-151 742.891,-93 886.891,-93 886.891,-151"/>
<text text-anchor="middle" x="814.891" y="-117.2" font-family="Arial" font-size="16.00" fill="#ffffff">BufferedStream</text>
</g>
<!-- c1 -->
<g id="node12" class="node">
<title>c1</title>
<ellipse fill="#000000" stroke="#000000" cx="451.891" cy="-53" rx=".36" ry=".36"/>
</g>
<!-- Fichero -->
<g id="node16" class="node">
<title>Fichero</title>
<polygon fill="none" stroke="#000000" points="1588.2953,-382 1448.2953,-382 1444.2953,-378 1444.2953,-322 1584.2953,-322 1588.2953,-326 1588.2953,-382"/>
<polyline fill="none" stroke="#000000" points="1584.2953,-378 1444.2953,-378 "/>
<polyline fill="none" stroke="#000000" points="1584.2953,-378 1584.2953,-322 "/>
<polyline fill="none" stroke="#000000" points="1584.2953,-378 1588.2953,-382 "/>
<text text-anchor="middle" x="1516.2953" y="-346" font-family="Arial" font-size="20.00" fill="#000000">Fichero</text>
</g>
<!-- FileStream&#45;&gt;Fichero -->
<g id="edge7" class="edge">
<title>FileStream-&gt;Fichero</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M1283.2511,-350.5C1283.2511,-350.5 1434.2719,-350.5 1434.2719,-350.5"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1434.2719,-354 1444.2719,-350.5 1434.2719,-347 1434.2719,-354"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1283.2511,-347 1273.2511,-350.5 1283.2511,-354 1283.2511,-347"/>
<text text-anchor="middle" x="1367.5932" y="-356.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- MemoryStream -->
<g id="node14" class="node">
<title>MemoryStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="1272.891,-303 1128.891,-303 1128.891,-245 1272.891,-245 1272.891,-303"/>
<text text-anchor="middle" x="1200.891" y="-269.2" font-family="Arial" font-size="16.00" fill="#ffffff">MemoryStream</text>
</g>
<!-- Memoria -->
<g id="node17" class="node">
<title>Memoria</title>
<polygon fill="none" stroke="#000000" points="1588.2953,-304 1448.2953,-304 1444.2953,-300 1444.2953,-244 1584.2953,-244 1588.2953,-248 1588.2953,-304"/>
<polyline fill="none" stroke="#000000" points="1584.2953,-300 1444.2953,-300 "/>
<polyline fill="none" stroke="#000000" points="1584.2953,-300 1584.2953,-244 "/>
<polyline fill="none" stroke="#000000" points="1584.2953,-300 1588.2953,-304 "/>
<text text-anchor="middle" x="1516.2953" y="-268" font-family="Arial" font-size="20.00" fill="#000000">Memoria</text>
</g>
<!-- MemoryStream&#45;&gt;Memoria -->
<g id="edge8" class="edge">
<title>MemoryStream-&gt;Memoria</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M1283.2511,-274C1283.2511,-274 1434.2719,-274 1434.2719,-274"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1434.2719,-277.5 1444.2719,-274 1434.2719,-270.5 1434.2719,-277.5"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1283.2511,-270.5 1273.2511,-274 1283.2511,-277.5 1283.2511,-270.5"/>
<text text-anchor="middle" x="1367.5932" y="-279.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- NetworkStream -->
<g id="node15" class="node">
<title>NetworkStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="1272.891,-227 1128.891,-227 1128.891,-169 1272.891,-169 1272.891,-227"/>
<text text-anchor="middle" x="1200.891" y="-193.2" font-family="Arial" font-size="16.00" fill="#ffffff">NetworkStream</text>
</g>
<!-- Red -->
<g id="node18" class="node">
<title>Red</title>
<polygon fill="none" stroke="#000000" points="1588.2953,-226 1448.2953,-226 1444.2953,-222 1444.2953,-166 1584.2953,-166 1588.2953,-170 1588.2953,-226"/>
<polyline fill="none" stroke="#000000" points="1584.2953,-222 1444.2953,-222 "/>
<polyline fill="none" stroke="#000000" points="1584.2953,-222 1584.2953,-166 "/>
<polyline fill="none" stroke="#000000" points="1584.2953,-222 1588.2953,-226 "/>
<text text-anchor="middle" x="1516.2953" y="-190" font-family="Arial" font-size="20.00" fill="#000000">Red</text>
</g>
<!-- NetworkStream&#45;&gt;Red -->
<g id="edge9" class="edge">
<title>NetworkStream-&gt;Red</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M1283.2511,-197.5C1283.2511,-197.5 1434.2719,-197.5 1434.2719,-197.5"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1434.2719,-201 1444.2719,-197.5 1434.2719,-194 1434.2719,-201"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1283.2511,-194 1273.2511,-197.5 1283.2511,-201 1283.2511,-194"/>
<text text-anchor="middle" x="1367.5932" y="-202.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
</g>
</svg>
</p><p>Si nos fijamos, tendremos de derecha a izquierda ...</p>
<ul>
<li>Una serie de <strong>dispositivos</strong> donde vamos a realizar las operaciones de lectura y escritura.</li>
<li>Una serie de clases denominadas <strong>Backing Store Streams</strong> que ser&#xE1;n las que hereden de <strong><code>Stream</code></strong> y hagan las operaciones del lectura y escritura en los dispositivos. En concreto, <strong>para ficheros usaremos</strong> la subclase de stream <strong><code>FileStream</code></strong>.</li>
<li>Una serie de clases denominadas <strong>Decorator Streams</strong> que transformar&#xE1;n una secuencia de <strong>bytes</strong> en otra secuencia de <strong>bytes</strong> y cuyo uso ser&#xE1; opcional si queremos hacer operaciones como compresi&#xF3;n, cifrado, etc. En este, tema veremos un case de uso <strong><code>BufferedStream</code></strong> pero no profundizaremos en su uso.</li>
<li>&#x270B; <strong>Importante:</strong> Una serie de clases denominadas <strong>Stream Adapters</strong> adapter que adaptar&#xE1;n, en ambos sentidos, <strong>tipos de datos b&#xE1;sicos</strong> manejables por los programas a secuencias de <strong>bytes</strong> manejables por los streams.<br>
<strong>Nota:</strong> Si los datos que manejamos en el programa son directamente <strong>bytes sin transformar</strong> nos saltaremos estas clases para manejar directamente &apos;<em>Decorator Streams</em>&apos; o &apos;<em>Backing Store Streams</em>&apos;</li>
</ul>
<p>Podremos realizar correspondencias, entre los diferentes bloques de clases, dependiendo de flujo de datos que queramos manejar y lo que queramos hacer teniendo en cuenta los datos.</p>
<div style="page-break-after:always;"></div>
<h4 class="mume-header" id="lectura-y-escritura-de-ficheros-sin-transformar">Lectura y escritura de ficheros sin transformar</h4>

<p>Escribiremos y leeremos bloques de <strong>bytes</strong>. Por tanto, solo necesitaremos usar la clase <strong><code>FileStream</code></strong> y por tanto estaremos usando la siguiente combinaci&#xF3;n...</p>
<p align="center" style="zoom:0.4"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="1078pt" height="208pt" viewBox="0.00 0.00 1077.81 208.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 204)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-204 1073.8086,-204 1073.8086,4 -4,4"/>
<g id="clust4" class="cluster">
<title>cluster4</title>
<polygon fill="none" stroke="transparent" points="877.8086,-12 877.8086,-156 1061.8086,-156 1061.8086,-12 877.8086,-12"/>
<text text-anchor="middle" x="969.8086" y="-125" font-family="Arial" font-size="30.00" fill="#000000">Dispositivos</text>
</g>
<g id="clust2" class="cluster">
<title>clusterG</title>
<polygon fill="none" stroke="#104e8b" points="293.4043,-8 293.4043,-192 764.4043,-192 764.4043,-8 293.4043,-8"/>
<text text-anchor="middle" x="528.9043" y="-161" font-family="Arial" font-size="30.00" fill="#104e8b">Clases para el manejo de streams</text>
</g>
<g id="clust3" class="cluster">
<title>cluster3</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="418.4043,-13 418.4043,-143 638.4043,-143 638.4043,-13 418.4043,-13"/>
<text text-anchor="middle" x="528.4043" y="-121" font-family="Arial" font-size="20.00" fill="#104e8b">Backing Store Streams</text>
</g>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="transparent" points="8,-12 8,-156 168,-156 168,-12 8,-12"/>
<text text-anchor="middle" x="88" y="-125" font-family="Arial" font-size="30.00" fill="#000000">Datos</text>
</g>
<!-- Bytes -->
<g id="node1" class="node">
<title>Bytes</title>
<polygon fill="none" stroke="#000000" points="154,-104 16,-104 16,-20 160,-20 160,-98 154,-104"/>
<polyline fill="none" stroke="#000000" points="154,-104 154,-98 "/>
<polyline fill="none" stroke="#000000" points="160,-98 154,-98 "/>
<text text-anchor="middle" x="88" y="-68" font-family="Arial" font-size="20.00" fill="#000000">Bytes sin</text>
<text text-anchor="middle" x="88" y="-44" font-family="Arial" font-size="20.00" fill="#000000">transformar</text>
</g>
<!-- FileStream -->
<g id="node2" class="node">
<title>FileStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="600.4043,-91 456.4043,-91 456.4043,-33 600.4043,-33 600.4043,-91"/>
<text text-anchor="middle" x="528.4043" y="-57.2" font-family="Arial" font-size="16.00" fill="#ffffff">FileStream</text>
</g>
<!-- Bytes&#45;&gt;FileStream -->
<g id="edge1" class="edge">
<title>Bytes-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M170.2307,-62C170.2307,-62 446.1342,-62 446.1342,-62"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="446.1342,-65.5 456.1342,-62 446.1342,-58.5 446.1342,-65.5"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="170.2307,-58.5 160.2307,-62 170.2307,-65.5 170.2307,-58.5"/>
<text text-anchor="middle" x="236.7022" y="-67.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- Fichero -->
<g id="node3" class="node">
<title>Fichero</title>
<polygon fill="none" stroke="#000000" points="1041.8086,-92 901.8086,-92 897.8086,-88 897.8086,-32 1037.8086,-32 1041.8086,-36 1041.8086,-92"/>
<polyline fill="none" stroke="#000000" points="1037.8086,-88 897.8086,-88 "/>
<polyline fill="none" stroke="#000000" points="1037.8086,-88 1037.8086,-32 "/>
<polyline fill="none" stroke="#000000" points="1037.8086,-88 1041.8086,-92 "/>
<text text-anchor="middle" x="969.8086" y="-56" font-family="Arial" font-size="20.00" fill="#000000">Fichero</text>
</g>
<!-- FileStream&#45;&gt;Fichero -->
<g id="edge2" class="edge">
<title>FileStream-&gt;Fichero</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M610.799,-62C610.799,-62 887.741,-62 887.741,-62"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="887.741,-65.5 897.741,-62 887.741,-58.5 887.741,-65.5"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="610.799,-58.5 600.799,-62 610.799,-65.5 610.799,-58.5"/>
<text text-anchor="middle" x="821.1065" y="-67.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
</g>
</svg>
</p><h5 class="mume-header" id="apertura-y-cierre-de-un-fichero-con-filestream">Apertura y Cierre de un fichero con FileStream</h5>

<p>La forma de abrirlo o crearlo m&#xE1;s com&#xFA;n de encontrar en la mayor&#xED;a de lenguajes es usando el constructor...</p>
<p><strong>public <a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.filestream.-ctor?view=net-5.0#System_IO_FileStream__ctor_System_String_System_IO_FileMode_System_IO_FileAccess_">FileStream</a>(string path, FileMode mode, FileAccess access)</strong></p>
<ul>
<li>
<p><strong><code>string path</code></strong>: Ubicaci&#xF3;n del fichero sobre el que queremos abrir un flujo.</p>
</li>
<li>
<p><strong><code>FileMode mode</code></strong>: Enum con las posibilidades de apertura del fichero.</p>
<ul>
<li><strong><code>Append</code></strong>: Abre el archivo si existe y realiza una b&#xFA;squeda hasta el final del mismo, o crea un archivo nuevo.</li>
<li><strong><code>Create</code></strong>: Especifica que el sistema operativo debe crear un archivo nuevo. Si el archivo ya existe, se sobrescribir&#xE1;.</li>
<li><strong><code>CreateNew</code></strong>: Especifica que el sistema operativo debe crear un archivo nuevo. Si el archivo ya existe hay una excepci&#xF3;n.</li>
<li><strong><code>Open</code></strong>: Especifica que el sistema operativo debe abrir un archivo existente.</li>
<li><strong><code>OpenOrCreate</code></strong>: Especifica que el sistema operativo debe abrir un archivo si ya existe; en caso contrario, debe crearse uno nuevo.</li>
<li><strong><code>Truncate</code></strong>: Especifica que el sistema operativo debe abrir un archivo existente. Una vez abierto, debe truncarse el archivo para que su tama&#xF1;o sea de cero bytes.</li>
</ul>
</li>
<li>
<p><strong><code>FileAccess access</code></strong>: Enum con el tipo de operaci&#xF3;n que vamos a realizar.</p>
<ul>
<li><strong><code>Read</code></strong>: Acceso de lectura al archivo.</li>
<li><strong><code>ReadWrite</code></strong>: Acceso de lectura y escritura al archivo.</li>
<li><strong><code>Write</code></strong>: Acceso de escritura al archivo.</li>
</ul>
</li>
</ul>
<p>El cierre del fichero lo haremos a trav&#xE9;s de...</p>
<p><strong>public void Stream.<a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.stream.close?view=net-5.0">Close</a>()</strong></p>
<ul>
<li>Libera el descriptor o manejador del fichero creado por el SO.</li>
<li>Hace un <strong><code>Flush()</code></strong> del buffer del <strong><code>Stream</code></strong> en el dispositivo si lo hemos abierto para escritura y hay escrituras pendientes de guardar.</li>
<li>En el lenguaje C#, esta tarea la hace el m&#xE9;todo <strong><code>Dispose()</code></strong> con el que todo flujo cuenta como <strong>est&#xE1;ndar recomendado</strong> para liberar recursos de manera determinista. Sin embargo, por analog&#xED;a con otros lenguajes a la clase <strong><code>Stream</code></strong> tambi&#xE9;n dispone de un m&#xE9;todo <strong><code>Close()</code></strong> que hace lo mismo.</li>
</ul>
<div style="page-break-after:always;"></div>
<p><strong>Ejemplo b&#xE1;sico de uso</strong>:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-using">using</span> <span class="token namespace">System<span class="token punctuation">.</span>IO</span><span class="token punctuation">;</span>
<span class="token keyword keyword-namespace">namespace</span> <span class="token namespace">Ejemplo</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// El siguiente programa crea o sobrescribe el archivo ejemplo.txt en el</span>
        <span class="token comment">// directorio donde me estoy ejecutando.</span>
        <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">FileStream</span> fichero <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span>
                                        <span class="token string">&quot;ejemplo.txt&quot;</span><span class="token punctuation">,</span>      <span class="token comment">// Nombre del fichero</span>
                                        FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span>    <span class="token comment">// Lo creo o sobrescribo si existe</span>
                                        FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Solo puedo escribir en &#xE9;l.</span>
            fichero<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><h5 class="mume-header" id="escritura-de-un-fichero-con-filestream">Escritura de un fichero con FileStream</h5>

<p>La forma escribir m&#xE1;s com&#xFA;n, herencia del lenguaje C es el m&#xE9;todo...</p>
<p><strong>public override void fileStream.<a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.filestream.write?view=net-5.0#System_IO_FileStream_Write_System_Byte___System_Int32_System_Int32_">Write</a>(byte[] array, int offset, int count)</strong></p>
<ul>
<li><strong><code>byte[] array</code></strong>: Buffer que contiene los datos a escribir.</li>
<li><strong><code>int offset</code></strong>: Desplazamiento en bytes de base cero de array donde se comienzan a copiar los datos en la secuencia actual.</li>
<li><strong>int count</strong>: N&#xFA;mero m&#xE1;ximo de bytes que se deben escribir.</li>
</ul>
<p><strong>Ejemplo b&#xE1;sico de uso</strong>:</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;ejemplo.txt&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Escribo 3 bytes con el valor en hexadecimal del </span>
<span class="token comment">// d&#xED;gito &apos;0&apos; en UTF-8 al principio del stream.</span>
<span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> datos <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x30</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>datos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> datos<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Volcamos a disco el buffer de manera forzada.</span>
fs<span class="token punctuation">.</span><span class="token function">Flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Cerramos el stream.</span>
fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p align="center" style="zoom:0.8"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="348pt" height="203pt" viewBox="0.00 0.00 348.00 203.40" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 199.4)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-199.4 344,-199.4 344,4 -4,4"/>
<text text-anchor="middle" x="170" y="-178.8" font-family="Arial" font-size="14.00" fill="#000000">El descriptor se se desplzar&#xE1; por el Stream</text>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="transparent" points="8,-8 8,-115 332,-115 332,-8 8,-8"/>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<polygon fill="none" stroke="#000000" points="40,-51.5 40,-102.5 88,-102.5 88,-51.5 40,-51.5"/>
<text text-anchor="start" x="48.8261" y="-80.9" font-family="Arial" font-size="14.00" fill="#000000">0x30</text>
<text text-anchor="start" x="57.0161" y="-64.1" font-family="Arial" font-size="14.00" fill="#000000">&apos;0&apos;</text>
<polygon fill="none" stroke="#000000" points="88,-51.5 88,-102.5 136,-102.5 136,-51.5 88,-51.5"/>
<text text-anchor="start" x="96.8261" y="-80.9" font-family="Arial" font-size="14.00" fill="#000000">0x30</text>
<text text-anchor="start" x="105.0161" y="-64.1" font-family="Arial" font-size="14.00" fill="#000000">&apos;0&apos;</text>
<polygon fill="none" stroke="#000000" points="136,-51.5 136,-102.5 184,-102.5 184,-51.5 136,-51.5"/>
<text text-anchor="start" x="144.8261" y="-80.9" font-family="Arial" font-size="14.00" fill="#000000">0x30</text>
<text text-anchor="start" x="153.0161" y="-64.1" font-family="Arial" font-size="14.00" fill="#000000">&apos;0&apos;</text>
<polygon fill="none" stroke="#000000" points="184,-51.5 184,-102.5 202,-102.5 202,-51.5 184,-51.5"/>
<polygon fill="none" stroke="#000000" points="202,-51.5 202,-102.5 220,-102.5 220,-51.5 202,-51.5"/>
<polygon fill="none" stroke="#000000" points="220,-51.5 220,-102.5 238,-102.5 238,-51.5 220,-51.5"/>
<polygon fill="none" stroke="#000000" points="238,-51.5 238,-102.5 256,-102.5 256,-51.5 238,-51.5"/>
<text text-anchor="start" x="263.9432" y="-72.8" font-family="Arial" font-size="14.00" fill="#000000">Stream</text>
<text text-anchor="start" x="52.3261" y="-31.9" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="60.1087" y="-31.9" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">00</text>
<text text-anchor="start" x="100.3261" y="-31.9" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="108.1087" y="-31.9" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">01</text>
<text text-anchor="start" x="148.3261" y="-31.9" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="156.1087" y="-31.9" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">02</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="40" y="-154" font-family="Arial" font-size="14.00" fill="#d3d3d3">antes</text>
<text text-anchor="middle" x="40" y="-137.2" font-family="Arial" font-size="14.00" fill="#d3d3d3">Write</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="#d3d3d3" d="M41.25,-129.1911C41.25,-129.1911 41.25,-112.5 41.25,-112.5"/>
<polygon fill="#d3d3d3" stroke="#d3d3d3" points="44.7501,-112.5 41.25,-102.5 37.7501,-112.5 44.7501,-112.5"/>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="184" y="-154" font-family="Arial" font-size="14.00" fill="#000000">despu&#xE9;s</text>
<text text-anchor="middle" x="184" y="-137.2" font-family="Arial" font-size="14.00" fill="#000000">Write</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="#000000" d="M184,-129.1911C184,-129.1911 184,-112.5 184,-112.5"/>
<polygon fill="#000000" stroke="#000000" points="187.5001,-112.5 184,-102.5 180.5001,-112.5 187.5001,-112.5"/>
</g>
</g>
</svg>
</p><div style="page-break-after:always;"></div>
<p><strong>public override void fileStream.<a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.filestream.writebyte?view=net-5.0">WriteByte</a>(byte byte)</strong></p>
<p>Est&#xE9; m&#xE9;todo ser&#xE1; an&#xE1;logo al anterior pero escribir&#xE1; solo 1 byte en el flujo desplazando el descriptor una posici&#xF3;n.</p>
<h5 class="mume-header" id="lectura-de-un-fichero-con-filestream">Lectura de un fichero con FileStream</h5>

<p>La forma escribir m&#xE1;s com&#xFA;n, herencia del lenguaje C es el m&#xE9;todo...</p>
<p><strong>public override int <a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.filestream.read?view=net-5.0#System_IO_FileStream_Read_System_Byte___System_Int32_System_Int32_">Read</a>(byte[] array, int offset, int count)</strong></p>
<ul>
<li><strong><code>byte[] array</code></strong>: Array a rellenar con los bytes le&#xED;dos.<br>
&#x270B; <strong>Debe estar predimensionado con el espacio suficiente</strong>. Adem&#xE1;s, esta dimensi&#xF3;n puede ser mayor al n&#xFA;mero de bytes a leer.</li>
<li><strong><code>int offset</code></strong>: Desplazamiento de bytes en el par&#xE1;metro array donde debe comenzar la lectura.</li>
<li><strong><code>int count</code></strong>: N&#xFA;mero m&#xE1;ximo de bytes que se pueden leer.</li>
<li><strong>Devuelve:</strong> un entero con <strong>el n&#xFA;mero de bytes le&#xED;dos</strong>.</li>
</ul>
<p><strong>Ejemplo b&#xE1;sico de uso</strong>:</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token class-name">FileStream</span> fichero <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span>
        <span class="token string">&quot;ejemplo.txt&quot;</span><span class="token punctuation">,</span> 
        FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span>      <span class="token comment">// Abro un fichero existente (sino error)</span>
        FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Lo abro espec&#xED;ficamente para lectura.</span>

<span class="token comment">// Como voy a leer los 3 bytes que escrib&#xED; en el ejemplo anterior</span>
<span class="token comment">// creo un array con esp&#xE1;cio de 3 como m&#xED;nimo.</span>
<span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> datos <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-byte">byte</span></span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Leo desde el principio datos.Length = 3 bytes y los a&#xF1;ado del array datos </span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> bytesLeidos <span class="token operator">=</span> fichero<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>datos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> datos<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// C&#xF3;mo no se lo que ha le&#xED;do realmente porque en el fichero a lo </span>
<span class="token comment">// mejor solo hab&#xED;a 2 bytes. En lugar de recorrer con un foreach</span>
<span class="token comment">// recorro hasta el n&#xFA;mero de bytes le&#xED;dos que me ha devuelto el m&#xE9;todo.</span>
<span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bytesLeidos<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">datos<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span><span class="token format-string"><span class="token punctuation">:</span>X</span><span class="token punctuation">}</span></span><span class="token string"> &quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fichero<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p><strong>public override int fileStream.<a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.filestream.readbyte?view=net-5.0">ReadByte</a>()</strong></p>
<p>Lee un byte del archivo y avanza la posici&#xF3;n de lectura un byte. Devuelve, el byte, convertido en un int, o <strong>-1 si se ha alcanzado el final de la secuencia</strong>.</p>
<div style="page-break-after:always;"></div>
<h5 class="mume-header" id="longitud-y-posici%C3%B3n-en-el-stream">Longitud y Posici&#xF3;n en el Stream</h5>

<ul>
<li><strong>long Length</strong>: N&#xFA;mero de bytes almacenados en el flujo (tama&#xF1;o del flujo).<br>
En ficheros, el tama&#xF1;o en bytes el fichero.</li>
<li><strong>long Position</strong>: N&#xFA;mero del <strong>byte actual</strong> en el flujo <strong>empezando en 0</strong>.<br>
En ficheros, la posici&#xF3;n actual <strong>donde se encuentra el descriptor</strong> de lectura o escritura del fichero.</li>
</ul>
<p><strong>Ejemplo b&#xE1;sico</strong>:</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">&quot;ejemplo.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Paso la cadena a un array de 17 bytes para poder</span>
<span class="token comment">// escribirla con un FileStream.</span>
<span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> buffer <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span><span class="token string">&quot;Lorem ipsum dolor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;ejemplo.txt&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Longitud Fichero: &quot;</span> <span class="token operator">+</span> fs<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Mostrar&#xE1; 17</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Posicion descriptor lectura: &quot;</span> <span class="token operator">+</span> fs<span class="token punctuation">.</span>Position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Devolver&#xE1; un 0</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p align="center" style="zoom:0.5"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="828pt" height="170pt" viewBox="0.00 0.00 828.00 170.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 166)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-166 824,-166 824,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="transparent" points="8,-8 8,-98 812,-98 812,-8 8,-8"/>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<text text-anchor="start" x="32.9376" y="-64.8" font-family="Arial" font-size="14.00" fill="#000000"> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</text>
<polygon fill="none" stroke="#000000" points="72,-52 72,-86 111,-86 111,-52 72,-52"/>
<text text-anchor="start" x="84.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;L&apos;</text>
<polygon fill="none" stroke="#000000" points="111,-52 111,-86 150,-86 150,-52 111,-52"/>
<text text-anchor="start" x="123.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;o&apos;</text>
<polygon fill="none" stroke="#000000" points="150,-52 150,-86 189,-86 189,-52 150,-52"/>
<text text-anchor="start" x="164.0771" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;r&apos;</text>
<polygon fill="none" stroke="#000000" points="189,-52 189,-86 228,-86 228,-52 189,-52"/>
<text text-anchor="start" x="201.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;e&apos;</text>
<polygon fill="none" stroke="#000000" points="228,-52 228,-86 267,-86 267,-52 228,-52"/>
<text text-anchor="start" x="238.5771" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;m&apos;</text>
<polygon fill="none" stroke="#000000" points="267,-52 267,-86 306,-86 306,-52 267,-52"/>
<text text-anchor="start" x="281.4621" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos; &apos;</text>
<polygon fill="none" stroke="#000000" points="306,-52 306,-86 345,-86 345,-52 306,-52"/>
<text text-anchor="start" x="320.8541" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;i&apos;</text>
<polygon fill="none" stroke="#000000" points="345,-52 345,-86 384,-86 384,-52 345,-52"/>
<text text-anchor="start" x="357.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;p&apos;</text>
<polygon fill="none" stroke="#000000" points="384,-52 384,-86 423,-86 423,-52 384,-52"/>
<text text-anchor="start" x="396.9074" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;s&apos;</text>
<polygon fill="none" stroke="#000000" points="423,-52 423,-86 462,-86 462,-52 423,-52"/>
<text text-anchor="start" x="435.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;u&apos;</text>
<polygon fill="none" stroke="#000000" points="462,-52 462,-86 501,-86 501,-52 462,-52"/>
<text text-anchor="start" x="472.5771" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;m&apos;</text>
<polygon fill="none" stroke="#000000" points="501,-52 501,-86 540,-86 540,-52 501,-52"/>
<text text-anchor="start" x="515.4621" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos; &apos;</text>
<polygon fill="none" stroke="#000000" points="540,-52 540,-86 579,-86 579,-52 540,-52"/>
<text text-anchor="start" x="552.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;d&apos;</text>
<polygon fill="none" stroke="#000000" points="579,-52 579,-86 618,-86 618,-52 579,-52"/>
<text text-anchor="start" x="591.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;o&apos;</text>
<polygon fill="none" stroke="#000000" points="618,-52 618,-86 657,-86 657,-52 618,-52"/>
<text text-anchor="start" x="632.8541" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;l&apos;</text>
<polygon fill="none" stroke="#000000" points="657,-52 657,-86 696,-86 696,-52 657,-52"/>
<text text-anchor="start" x="669.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;o&apos;</text>
<polygon fill="none" stroke="#000000" points="696,-52 696,-86 735,-86 735,-52 696,-52"/>
<text text-anchor="start" x="710.0771" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;r&apos;</text>
<text text-anchor="start" x="742.9432" y="-64.8" font-family="Arial" font-size="14.00" fill="#000000">Stream</text>
<text text-anchor="start" x="79.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="87.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">00</text>
<text text-anchor="start" x="118.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="126.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">01</text>
<text text-anchor="start" x="157.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="165.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">02</text>
<text text-anchor="start" x="196.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="204.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">03</text>
<text text-anchor="start" x="235.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="243.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">04</text>
<text text-anchor="start" x="274.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="282.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">05</text>
<text text-anchor="start" x="313.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="321.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">06</text>
<text text-anchor="start" x="352.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="360.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">07</text>
<text text-anchor="start" x="391.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="399.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">08</text>
<text text-anchor="start" x="430.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="438.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">09</text>
<text text-anchor="start" x="469.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="477.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">10</text>
<text text-anchor="start" x="508.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="516.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">11</text>
<text text-anchor="start" x="547.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="555.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">12</text>
<text text-anchor="start" x="586.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="594.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">13</text>
<text text-anchor="start" x="625.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="633.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">14</text>
<text text-anchor="start" x="664.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="672.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">15</text>
<text text-anchor="start" x="703.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="711.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">16</text>
</g>
<!-- p -->
<g id="node2" class="node">
<title>p</title>
<text text-anchor="middle" x="72" y="-139.8" font-family="Arial" font-size="14.00" fill="#000000">fs.Position = 0</text>
</g>
<!-- p&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="#000000" d="M72,-125.9664C72,-125.9664 72,-96 72,-96"/>
<polygon fill="#000000" stroke="#000000" points="75.5001,-96 72,-86 68.5001,-96 75.5001,-96"/>
</g>
<!-- l -->
<g id="node3" class="node">
<title>l</title>
<text text-anchor="middle" x="735" y="-139.8" font-family="Arial" font-size="14.00" fill="#000000">fs.Length = 17</text>
</g>
<!-- l&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>l-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="#000000" stroke-dasharray="1,5" d="M735,-125.9664C735,-108.9403 735,-86 735,-86"/>
</g>
</g>
</svg>
</p><pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token class-name"><span class="token keyword keyword-char">char</span></span> c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>fs<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c = &apos;L&apos;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Posici&#xF3;n descriptor lectura: &quot;</span> <span class="token operator">+</span> fs<span class="token punctuation">.</span>Position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Devolver&#xE1; un 1</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></pre><p align="center" style="zoom:0.5"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="828pt" height="170pt" viewBox="0.00 0.00 828.00 170.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 166)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-166 824,-166 824,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="transparent" points="8,-8 8,-98 812,-98 812,-8 8,-8"/>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<text text-anchor="start" x="32.9376" y="-64.8" font-family="Arial" font-size="14.00" fill="#000000"> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</text>
<polygon fill="none" stroke="#000000" points="72,-52 72,-86 111,-86 111,-52 72,-52"/>
<text text-anchor="start" x="84.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;L&apos;</text>
<polygon fill="none" stroke="#000000" points="111,-52 111,-86 150,-86 150,-52 111,-52"/>
<text text-anchor="start" x="123.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;o&apos;</text>
<polygon fill="none" stroke="#000000" points="150,-52 150,-86 189,-86 189,-52 150,-52"/>
<text text-anchor="start" x="164.0771" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;r&apos;</text>
<polygon fill="none" stroke="#000000" points="189,-52 189,-86 228,-86 228,-52 189,-52"/>
<text text-anchor="start" x="201.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;e&apos;</text>
<polygon fill="none" stroke="#000000" points="228,-52 228,-86 267,-86 267,-52 228,-52"/>
<text text-anchor="start" x="238.5771" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;m&apos;</text>
<polygon fill="none" stroke="#000000" points="267,-52 267,-86 306,-86 306,-52 267,-52"/>
<text text-anchor="start" x="281.4621" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos; &apos;</text>
<polygon fill="none" stroke="#000000" points="306,-52 306,-86 345,-86 345,-52 306,-52"/>
<text text-anchor="start" x="320.8541" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;i&apos;</text>
<polygon fill="none" stroke="#000000" points="345,-52 345,-86 384,-86 384,-52 345,-52"/>
<text text-anchor="start" x="357.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;p&apos;</text>
<polygon fill="none" stroke="#000000" points="384,-52 384,-86 423,-86 423,-52 384,-52"/>
<text text-anchor="start" x="396.9074" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;s&apos;</text>
<polygon fill="none" stroke="#000000" points="423,-52 423,-86 462,-86 462,-52 423,-52"/>
<text text-anchor="start" x="435.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;u&apos;</text>
<polygon fill="none" stroke="#000000" points="462,-52 462,-86 501,-86 501,-52 462,-52"/>
<text text-anchor="start" x="472.5771" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;m&apos;</text>
<polygon fill="none" stroke="#000000" points="501,-52 501,-86 540,-86 540,-52 501,-52"/>
<text text-anchor="start" x="515.4621" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos; &apos;</text>
<polygon fill="none" stroke="#000000" points="540,-52 540,-86 579,-86 579,-52 540,-52"/>
<text text-anchor="start" x="552.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;d&apos;</text>
<polygon fill="none" stroke="#000000" points="579,-52 579,-86 618,-86 618,-52 579,-52"/>
<text text-anchor="start" x="591.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;o&apos;</text>
<polygon fill="none" stroke="#000000" points="618,-52 618,-86 657,-86 657,-52 618,-52"/>
<text text-anchor="start" x="632.8541" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;l&apos;</text>
<polygon fill="none" stroke="#000000" points="657,-52 657,-86 696,-86 696,-52 657,-52"/>
<text text-anchor="start" x="669.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;o&apos;</text>
<polygon fill="none" stroke="#000000" points="696,-52 696,-86 735,-86 735,-52 696,-52"/>
<text text-anchor="start" x="710.0771" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;r&apos;</text>
<text text-anchor="start" x="742.9432" y="-64.8" font-family="Arial" font-size="14.00" fill="#000000">Stream</text>
<text text-anchor="start" x="79.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="87.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">00</text>
<text text-anchor="start" x="118.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="126.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">01</text>
<text text-anchor="start" x="157.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="165.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">02</text>
<text text-anchor="start" x="196.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="204.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">03</text>
<text text-anchor="start" x="235.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="243.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">04</text>
<text text-anchor="start" x="274.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="282.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">05</text>
<text text-anchor="start" x="313.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="321.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">06</text>
<text text-anchor="start" x="352.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="360.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">07</text>
<text text-anchor="start" x="391.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="399.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">08</text>
<text text-anchor="start" x="430.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="438.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">09</text>
<text text-anchor="start" x="469.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="477.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">10</text>
<text text-anchor="start" x="508.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="516.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">11</text>
<text text-anchor="start" x="547.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="555.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">12</text>
<text text-anchor="start" x="586.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="594.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">13</text>
<text text-anchor="start" x="625.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="633.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">14</text>
<text text-anchor="start" x="664.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="672.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">15</text>
<text text-anchor="start" x="703.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="711.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">16</text>
</g>
<!-- p -->
<g id="node2" class="node">
<title>p</title>
<text text-anchor="middle" x="111" y="-139.8" font-family="Arial" font-size="14.00" fill="#000000">fs.Position = 1</text>
</g>
<!-- p&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="#000000" d="M111,-125.9664C111,-125.9664 111,-96 111,-96"/>
<polygon fill="#000000" stroke="#000000" points="114.5001,-96 111,-86 107.5001,-96 114.5001,-96"/>
</g>
<!-- l -->
<g id="node3" class="node">
<title>l</title>
<text text-anchor="middle" x="735" y="-139.8" font-family="Arial" font-size="14.00" fill="#000000">fs.Length = 17</text>
</g>
<!-- l&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>l-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="#000000" stroke-dasharray="1,5" d="M735,-125.9664C735,-108.9403 735,-86 735,-86"/>
</g>
</g>
</svg>
</p><pre data-role="codeBlock" data-info="csharp" class="language-csharp">c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>fs<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c = &apos;o&apos;</span>
c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>fs<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c = &apos;r&apos;</span>
c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>fs<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c = &apos;e&apos;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Posici&#xF3;n descriptor lectura: &quot;</span> <span class="token operator">+</span> fs<span class="token punctuation">.</span>Position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Devolver&#xE1; un 4</span>
fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p align="center" style="zoom:0.5"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="828pt" height="170pt" viewBox="0.00 0.00 828.00 170.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 166)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-166 824,-166 824,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="transparent" points="8,-8 8,-98 812,-98 812,-8 8,-8"/>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<text text-anchor="start" x="32.9376" y="-64.8" font-family="Arial" font-size="14.00" fill="#000000"> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</text>
<polygon fill="none" stroke="#000000" points="72,-52 72,-86 111,-86 111,-52 72,-52"/>
<text text-anchor="start" x="84.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;L&apos;</text>
<polygon fill="none" stroke="#000000" points="111,-52 111,-86 150,-86 150,-52 111,-52"/>
<text text-anchor="start" x="123.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;o&apos;</text>
<polygon fill="none" stroke="#000000" points="150,-52 150,-86 189,-86 189,-52 150,-52"/>
<text text-anchor="start" x="164.0771" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;r&apos;</text>
<polygon fill="none" stroke="#000000" points="189,-52 189,-86 228,-86 228,-52 189,-52"/>
<text text-anchor="start" x="201.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;e&apos;</text>
<polygon fill="none" stroke="#000000" points="228,-52 228,-86 267,-86 267,-52 228,-52"/>
<text text-anchor="start" x="238.5771" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;m&apos;</text>
<polygon fill="none" stroke="#000000" points="267,-52 267,-86 306,-86 306,-52 267,-52"/>
<text text-anchor="start" x="281.4621" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos; &apos;</text>
<polygon fill="none" stroke="#000000" points="306,-52 306,-86 345,-86 345,-52 306,-52"/>
<text text-anchor="start" x="320.8541" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;i&apos;</text>
<polygon fill="none" stroke="#000000" points="345,-52 345,-86 384,-86 384,-52 345,-52"/>
<text text-anchor="start" x="357.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;p&apos;</text>
<polygon fill="none" stroke="#000000" points="384,-52 384,-86 423,-86 423,-52 384,-52"/>
<text text-anchor="start" x="396.9074" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;s&apos;</text>
<polygon fill="none" stroke="#000000" points="423,-52 423,-86 462,-86 462,-52 423,-52"/>
<text text-anchor="start" x="435.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;u&apos;</text>
<polygon fill="none" stroke="#000000" points="462,-52 462,-86 501,-86 501,-52 462,-52"/>
<text text-anchor="start" x="472.5771" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;m&apos;</text>
<polygon fill="none" stroke="#000000" points="501,-52 501,-86 540,-86 540,-52 501,-52"/>
<text text-anchor="start" x="515.4621" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos; &apos;</text>
<polygon fill="none" stroke="#000000" points="540,-52 540,-86 579,-86 579,-52 540,-52"/>
<text text-anchor="start" x="552.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;d&apos;</text>
<polygon fill="none" stroke="#000000" points="579,-52 579,-86 618,-86 618,-52 579,-52"/>
<text text-anchor="start" x="591.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;o&apos;</text>
<polygon fill="none" stroke="#000000" points="618,-52 618,-86 657,-86 657,-52 618,-52"/>
<text text-anchor="start" x="632.8541" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;l&apos;</text>
<polygon fill="none" stroke="#000000" points="657,-52 657,-86 696,-86 696,-52 657,-52"/>
<text text-anchor="start" x="669.5161" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;o&apos;</text>
<polygon fill="none" stroke="#000000" points="696,-52 696,-86 735,-86 735,-52 696,-52"/>
<text text-anchor="start" x="710.0771" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000">&apos;r&apos;</text>
<text text-anchor="start" x="742.9432" y="-64.8" font-family="Arial" font-size="14.00" fill="#000000">Stream</text>
<text text-anchor="start" x="79.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="87.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">00</text>
<text text-anchor="start" x="118.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="126.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">01</text>
<text text-anchor="start" x="157.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="165.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">02</text>
<text text-anchor="start" x="196.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="204.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">03</text>
<text text-anchor="start" x="235.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="243.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">04</text>
<text text-anchor="start" x="274.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="282.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">05</text>
<text text-anchor="start" x="313.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="321.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">06</text>
<text text-anchor="start" x="352.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="360.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">07</text>
<text text-anchor="start" x="391.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="399.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">08</text>
<text text-anchor="start" x="430.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="438.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">09</text>
<text text-anchor="start" x="469.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="477.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">10</text>
<text text-anchor="start" x="508.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="516.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">11</text>
<text text-anchor="start" x="547.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="555.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">12</text>
<text text-anchor="start" x="586.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="594.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">13</text>
<text text-anchor="start" x="625.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="633.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">14</text>
<text text-anchor="start" x="664.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="672.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">15</text>
<text text-anchor="start" x="703.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="711.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">16</text>
</g>
<!-- p -->
<g id="node2" class="node">
<title>p</title>
<text text-anchor="middle" x="228" y="-139.8" font-family="Arial" font-size="14.00" fill="#000000">fs.Position = 4</text>
</g>
<!-- p&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="#000000" d="M228,-125.9664C228,-125.9664 228,-96 228,-96"/>
<polygon fill="#000000" stroke="#000000" points="231.5001,-96 228,-86 224.5001,-96 231.5001,-96"/>
</g>
<!-- l -->
<g id="node3" class="node">
<title>l</title>
<text text-anchor="middle" x="735" y="-139.8" font-family="Arial" font-size="14.00" fill="#000000">fs.Length = 17</text>
</g>
<!-- l&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>l-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="#000000" stroke-dasharray="1,5" d="M735,-125.9664C735,-108.9403 735,-86 735,-86"/>
</g>
</g>
</svg>
</p><blockquote>
<p>&#x1F4A1; <strong>Tip:</strong> estos valores nos pueden ser &#xFA;tiles para controlar si hemos llegado o no al final de las secuencia en <strong>algunos casos</strong>.<br>
Por ejemplo con la condici&#xF3;n <strong><code>while (fichero.Position &lt; fichero.Length)</code></strong> puedo saber si estoy al final de un stream.</p>
</blockquote>
<div style="page-break-after:always;"></div>
<h5 class="mume-header" id="desplaz%C3%A1ndonos-por-el-stream">Desplaz&#xE1;ndonos por el Stream</h5>

<p><strong>public override long <a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.filestream.seek?view=net-5.0">Seek</a>(long offset, SeekOrigin origin)</strong></p>
<ul>
<li><strong><code>long offset</code></strong>: El punto relativo a origin desde el que comienza la operaci&#xF3;n Seek. Pude ser un valor negativo si me desplazo hacia la &#x201C;izquierda&#x201D;.</li>
<li><strong><code>SeekOrigin origin</code></strong>: Especifica el comienzo, el final o la posici&#xF3;n actual como un punto de referencia para origin, mediante el uso de un valor del <strong><code>Enum SeekOrigin</code></strong>.<br>
Estos valores pueden ser: <strong><code>Begin</code></strong>, <strong><code>Current</code></strong> y <strong><code>End</code></strong></li>
<li>
<blockquote>
<p>&#x270B; <strong>Nota:</strong> No en todos los streams podremos desplazarnos con <strong><code>Seek</code></strong> como en los <strong><code>FileStream</code></strong>. Por esa raz&#xF3;n la clase base <strong><code>Stream</code></strong> dispone de una propiedad <strong><code>CanSeek</code></strong> que me dir&#xE1; si puedo desplazarme por &#xE9;l o no. F&#xED;jate en el siguiente ejemplo.</p>
</blockquote>
</li>
</ul>
<p><strong>Ejemplo b&#xE1;sico de uso</strong>:</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name">FileStream</span> fichero <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;ejemplo.txt&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>fichero<span class="token punctuation">.</span>CanSeek<span class="token punctuation">)</span> <span class="token comment">// Para streams que no admiten desplazamientos </span>
<span class="token punctuation">{</span>
    <span class="token comment">// Me sit&#xFA;o al final y me desplazo 1 a la izquierda.</span>
    fichero<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>End<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">// Leo el &#xFA;ltimo byte.         </span>
    <span class="token class-name"><span class="token keyword keyword-int">int</span></span> ultimoByte <span class="token operator">=</span> fichero<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;El valor del &#xFA;ltimo byte es </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ultimoByte</span><span class="token format-string"><span class="token punctuation">:</span>X</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-else">else</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;El stream no admite desplazamientos.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fichero<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong>Caso de desplazamiento 1</strong>:</p>
<p><strong><code>fichero.Seek(-1, SeekOrigin.End);</code></strong></p>
<p>Me sit&#xFA;o al <strong>final</strong> y me desplazo <strong>1 byte a la izquierda</strong>, de tal manera que me quedo para escribir o leer sobre el &#xFA;ltimo byte el <strong>byte n</strong>.</p>
<p align="left" style="zoom:1"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="466pt" height="170pt" viewBox="0.00 0.00 466.00 170.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 166)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-166 462,-166 462,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="transparent" points="8,-8 8,-98 450,-98 450,-8 8,-8"/>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<polygon fill="none" stroke="#000000" points="40,-52 40,-86 79,-86 79,-52 40,-52"/>
<polygon fill="none" stroke="#000000" points="79,-52 79,-86 118,-86 118,-52 79,-52"/>
<polygon fill="none" stroke="#000000" points="118,-52 118,-86 157,-86 157,-52 118,-52"/>
<text text-anchor="start" x="164.6641" y="-64.8" font-family="Arial" font-size="14.00" fill="#000000">...</text>
<polygon fill="none" stroke="#000000" points="184,-52 184,-86 228,-86 228,-52 184,-52"/>
<polygon fill="none" stroke="#000000" points="228,-52 228,-86 272,-86 272,-52 228,-52"/>
<polygon fill="none" stroke="#000000" points="272,-52 272,-86 373,-86 373,-52 272,-52"/>
<text text-anchor="start" x="280.8717" y="-65.4" font-family="Arial" font-size="14.00" fill="#000000">Byte</text>
<text text-anchor="start" x="308.8815" y="-65.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">Lenght-1</text>
<text text-anchor="start" x="380.9432" y="-64.8" font-family="Arial" font-size="14.00" fill="#000000">Stream</text>
<text text-anchor="start" x="47.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="55.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">00</text>
<text text-anchor="start" x="86.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="94.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">01</text>
<text text-anchor="start" x="125.8261" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="133.6087" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">02</text>
<text text-anchor="start" x="191.9958" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="199.7784" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">L-3</text>
<text text-anchor="start" x="235.9958" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="243.7784" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">L-2</text>
<text text-anchor="start" x="308.4958" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="316.2784" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">L-1</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="254" y="-139.8" font-family="Arial" font-size="14.00" fill="#000000">SeekOrigin.End-1</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="#000000" d="M255.2699,-125.7665C256.6817,-115.9226 259.6295,-103.8057 265.7562,-93.9569"/>
<polygon fill="#000000" stroke="#000000" points="268.5802,-96.0277 272,-86 263.0732,-91.7064 268.5802,-96.0277"/>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="392" y="-139.8" font-family="Arial" font-size="14.00" fill="#d3d3d3">SeekOrigin.End</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="#d3d3d3" d="M390.3379,-125.7984C388.7271,-115.9664 385.5561,-103.8553 379.314,-93.9843"/>
<polygon fill="#d3d3d3" stroke="#d3d3d3" points="381.9482,-91.6728 373,-86 376.4576,-96.0148 381.9482,-91.6728"/>
</g>
</g>
</svg>
</p><div style="page-break-after:always;"></div>
<p><strong>Caso de desplazamiento 2</strong>:</p>
<p><strong><code>fichero.Seek(2, SeekOrigin.Begin);</code></strong></p>
<p>Me sit&#xFA;o al <strong>principio</strong> y me desplazo <strong>2 bytes</strong> a la derecha, de tal manera que me quedo para escribir o leer sobre el <strong>byte 2</strong>.</p>
<p align="left" style="zoom:1"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="480pt" height="170pt" viewBox="0.00 0.00 480.46 170.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 166)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-166 476.4565,-166 476.4565,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="transparent" points="66.4565,-8 66.4565,-98 464.4565,-98 464.4565,-8 66.4565,-8"/>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<polygon fill="none" stroke="#000000" points="98.4565,-52 98.4565,-86 137.4565,-86 137.4565,-52 98.4565,-52"/>
<polygon fill="none" stroke="#000000" points="137.4565,-52 137.4565,-86 176.4565,-86 176.4565,-52 137.4565,-52"/>
<polygon fill="none" stroke="#000000" points="176.4565,-52 176.4565,-86 229.4565,-86 229.4565,-52 176.4565,-52"/>
<text text-anchor="start" x="185.0603" y="-65.4" font-family="Arial" font-size="14.00" fill="#000000">Byte</text>
<text text-anchor="start" x="213.0701" y="-65.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">2</text>
<text text-anchor="start" x="237.1206" y="-64.8" font-family="Arial" font-size="14.00" fill="#000000">...</text>
<polygon fill="none" stroke="#000000" points="256.4565,-52 256.4565,-86 300.4565,-86 300.4565,-52 256.4565,-52"/>
<polygon fill="none" stroke="#000000" points="300.4565,-52 300.4565,-86 344.4565,-86 344.4565,-52 300.4565,-52"/>
<polygon fill="none" stroke="#000000" points="344.4565,-52 344.4565,-86 388.4565,-86 388.4565,-52 344.4565,-52"/>
<text text-anchor="start" x="396.3997" y="-64.8" font-family="Arial" font-size="14.00" fill="#000000">Stream</text>
<text text-anchor="start" x="106.2826" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="114.0652" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">00</text>
<text text-anchor="start" x="145.2826" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="153.0652" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">01</text>
<text text-anchor="start" x="191.2826" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="199.0652" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">02</text>
<text text-anchor="start" x="264.4523" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="272.2349" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">L-3</text>
<text text-anchor="start" x="308.4523" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="316.2349" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">L-2</text>
<text text-anchor="start" x="352.4523" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="360.2349" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">L-1</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="62.4565" y="-139.8" font-family="Arial" font-size="14.00" fill="#d3d3d3">SeekOrigin.Begin</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="#d3d3d3" d="M70.9802,-125.7628C76.0435,-116.0031 83.1412,-103.8919 91.6677,-93.5223"/>
<polygon fill="#d3d3d3" stroke="#d3d3d3" points="94.355,-95.7687 98.4565,-86 89.1583,-91.0788 94.355,-95.7687"/>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="213.4565" y="-139.8" font-family="Arial" font-size="14.00" fill="#000000">SeekOrigin.Begin+2</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="#000000" d="M204.5488,-125.8203C199.2925,-116.0811 191.9755,-103.9785 183.3222,-93.5659"/>
<polygon fill="#000000" stroke="#000000" points="185.7685,-91.0534 176.4565,-86 180.5847,-95.7575 185.7685,-91.0534"/>
</g>
</g>
</svg>
</p><p><strong>Caso de desplazamiento 3</strong>:</p>
<ol>
<li>
<p><strong><code>fichero.Seek(-2, SeekOrigin.Current);</code></strong> Desde <strong>donde me encuentre</strong>, me desplazo <strong>2 bytes</strong> a la <strong>izquierda</strong>, de tal manera que me quedo para escribir o leer sobre el primer byte el <strong>byte 0</strong>.</p>
</li>
<li>
<p><strong><code>fichero.Seek(3, SeekOrigin.Current);</code></strong> Desde <strong>donde me encuentre</strong>, me desplazo <strong>3 bytes</strong> a la derecha, de tal manera que me quedo para escribir o leer sobre el <strong>byte 5</strong>.</p>
</li>
</ol>
<p align="left" style="zoom:1"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="524pt" height="170pt" viewBox="0.00 0.00 524.12 170.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 166)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-166 520.1157,-166 520.1157,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="transparent" points="110.1157,-8 110.1157,-98 508.1157,-98 508.1157,-8 110.1157,-8"/>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<polygon fill="none" stroke="#000000" points="142.1157,-52 142.1157,-86 195.1157,-86 195.1157,-52 142.1157,-52"/>
<text text-anchor="start" x="150.7195" y="-65.4" font-family="Arial" font-size="14.00" fill="#000000">Byte</text>
<text text-anchor="start" x="178.7293" y="-65.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">0</text>
<polygon fill="none" stroke="#000000" points="195.1157,-52 195.1157,-86 234.1157,-86 234.1157,-52 195.1157,-52"/>
<text text-anchor="start" x="210.7251" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000"> &#xA0;</text>
<polygon fill="none" stroke="#000000" points="234.1157,-52 234.1157,-86 273.1157,-86 273.1157,-52 234.1157,-52"/>
<text text-anchor="start" x="249.7251" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000"> &#xA0;</text>
<polygon fill="none" stroke="#000000" points="273.1157,-52 273.1157,-86 312.1157,-86 312.1157,-52 273.1157,-52"/>
<text text-anchor="start" x="288.7251" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000"> &#xA0;</text>
<polygon fill="none" stroke="#000000" points="312.1157,-52 312.1157,-86 351.1157,-86 351.1157,-52 312.1157,-52"/>
<text text-anchor="start" x="327.7251" y="-64.4" font-family="Arial" font-size="14.00" fill="#000000"> &#xA0;</text>
<polygon fill="none" stroke="#000000" points="351.1157,-52 351.1157,-86 404.1157,-86 404.1157,-52 351.1157,-52"/>
<text text-anchor="start" x="359.7195" y="-65.4" font-family="Arial" font-size="14.00" fill="#000000">Byte</text>
<text text-anchor="start" x="387.7293" y="-65.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">5</text>
<text text-anchor="start" x="411.7798" y="-64.8" font-family="Arial" font-size="14.00" fill="#000000">...</text>
<text text-anchor="start" x="439.0589" y="-64.8" font-family="Arial" font-size="14.00" fill="#000000">Stream</text>
<text text-anchor="start" x="156.9418" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="164.7244" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">00</text>
<text text-anchor="start" x="202.9418" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="210.7244" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">01</text>
<text text-anchor="start" x="241.9418" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="249.7244" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">02</text>
<text text-anchor="start" x="280.9418" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="288.7244" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">03</text>
<text text-anchor="start" x="319.9418" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="327.7244" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">04</text>
<text text-anchor="start" x="365.9418" y="-32.4" font-family="Arial" font-size="14.00" fill="#000000">b</text>
<text text-anchor="start" x="373.7244" y="-32.4" font-family="Arial" baseline-shift="sub" font-size="14.00" fill="#000000">05</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="74.1157" y="-139.8" font-family="Arial" font-size="14.00" fill="#000000">SeekOrigin.Current-2</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="#000000" d="M97.2672,-125.7899C108.5847,-116.5785 122.43,-104.8531 134.9362,-92.9858"/>
<polygon fill="#000000" stroke="#000000" points="137.3894,-95.4822 142.1157,-86 132.5078,-90.4652 137.3894,-95.4822"/>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="234.1157" y="-139.8" font-family="Arial" font-size="14.00" fill="#d3d3d3">SeekOrigin.Current</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="#d3d3d3" d="M228.1008,-125.7538C225.835,-115.9752 224.6512,-103.9938 228.6108,-94.3638"/>
<polygon fill="#d3d3d3" stroke="#d3d3d3" points="231.5414,-96.2773 234.1157,-86 225.6942,-92.4288 231.5414,-96.2773"/>
</g>
<!-- p3 -->
<g id="node4" class="node">
<title>p3</title>
<text text-anchor="middle" x="396.1157" y="-139.8" font-family="Arial" font-size="14.00" fill="#000000">SeekOrigin.Current+3</text>
</g>
<!-- p3&#45;&gt;cluster0_stream -->
<g id="edge3" class="edge">
<title>p3-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="#000000" d="M383.8014,-125.7942C376.9653,-116.1904 367.9025,-104.2112 358.237,-93.5121"/>
<polygon fill="#000000" stroke="#000000" points="360.5356,-90.8494 351.1157,-86 355.4554,-95.6653 360.5356,-90.8494"/>
</g>
</g>
</svg>
</p><div style="page-break-after:always;"></div>
<h5 class="mume-header" id="recorriendo-un-filestream-hasta-el-final">Recorriendo un FileStream hasta el final</h5>

<p>Veamos a trav&#xE9;s de un ejemplo simple, varias formas de recorrer leyendo un <strong><code>FileStream</code></strong> hasta el final de la secuencia.</p>
<ul>
<li>
<p><strong>Caso 1:</strong></p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">FileStream</span> fs <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">&quot;ejemplo.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> buffer <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span><span class="token string">&quot;Lorem ipsum dolor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;ejemplo.txt&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Definimos un buffer de 3 bytes para las lecturas</span>
    <span class="token comment">// esto es, podremos leer de tres en tres bytes con fs.read()</span>
    <span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> datos <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-byte">byte</span></span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword keyword-int">int</span></span> bytesLeidos<span class="token punctuation">;</span>
    <span class="token keyword keyword-do">do</span>
    <span class="token punctuation">{</span>
        bytesLeidos <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>datos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> datos<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bytesLeidos<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>datos<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>bytesLeidos <span class="token operator">&gt;=</span> datos<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p>En el c&#xF3;digo anterior, leer&#xE9; el stream mientras se llene el buffer de 3 bytes en cada lectura. En el momento que lea menos de 3 es que he llegado al final de la secuencia.</p>
<blockquote>
<p>&#x26A0;&#xFE0F; &#x1F480; <strong>Aviso:</strong> No deber&#xED;amos recorrer en ning&#xFA;n caso el buffer con un <strong><code>foreach</code></strong> ya que siempre recorrer&#xE1; 3 que es la longitud del buffer y podr&#xED;amos haber le&#xED;do solo 2 y por tanto podr&#xED;a mostrarme bytes que realmente no he le&#xED;do y que est&#xE1;n en el buffer de lecturas anteriores.</p>
</blockquote>
</li>
<li>
<p><strong>Caso 2:</strong></p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers">    fs<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>Begin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Vuelvo al principio para volver a recorrerla.</span>
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span>Position <span class="token operator">&lt;</span> fs<span class="token punctuation">.</span>Length<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        bytesLeidos <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>datos<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> datos<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bytesLeidos<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>datos<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p>Recorreremos la secuencia, mientras la <strong>posici&#xF3;n</strong> en la que nos encontramos sea menor que la <strong>longitud</strong> de la misma.</p>
</li>
<li>
<p><strong>Caso 3:</strong></p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers">    fs<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>Begin<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Vuelvo al principio para volver a recorrerla.</span>
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword keyword-int">int</span></span> _byte<span class="token punctuation">;</span>
    <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>_byte <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>_byte</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p>Voy <strong>leyendo byte a byte</strong> mientras el valor de byte le&#xED;do sea distinto de -1 o positivo.</p>
<blockquote>
<p>&#x26A0;&#xFE0F; <strong>Nota:</strong> Esta opci&#xF3;n es mucho m&#xE1;s ineficiente en t&#xE9;rminos temporales que leer bloques de bytes con Read().</p>
</blockquote>
</li>
</ul>
<div style="page-break-after:always;"></div>
<h4 class="mume-header" id="pasando-el-flujo-por-un-decorator-stream">Pasando el flujo por un &apos;<em>Decorator Stream</em>&apos;</h4>

<p>Aunque este tipo de streams no los vamos a ver en profundidad en este curso por falta de tiempo. B&#xE1;sicamente, un <strong><a href="https://es.wikipedia.org/wiki/Decorator_(patr%C3%B3n_de_dise%C3%B1o)">decorator</a></strong> en POO es un patr&#xF3;n de dise&#xF1;o que a&#xF1;ade funcionalidad a un objetos sin necesidad de utilizar el mecanismo de her&#xE9;ncia.</p>
<h5 class="mume-header" id="ejemplo-de-decorator-stream-usando-bufferedstream">Ejemplo de &apos;<em>Decorator Stream</em>&apos; usando BufferedStream</h5>

<p>La funcionalidad que agrega una capa de almacenamiento en buffer a las operaciones de lectura y escritura para otra secuencia (la cual &apos;<em>envuelve</em>&apos;).</p>
<blockquote>
<p><strong>Nota:</strong> Aunque <strong><code>FileStream</code></strong> ya tiene un buffer de escritura intermedio por defecto, nosotros <strong>podremos ampliarlo o reducirlo</strong> mediante esta capa de abstracci&#xF3;n.</p>
</blockquote>
<p align="center" style="zoom:0.6"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="1239pt" height="208pt" viewBox="0.00 0.00 1239.21 208.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 204)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-204 1235.2129,-204 1235.2129,4 -4,4"/>
<g id="clust2" class="cluster">
<title>clusterG</title>
<polygon fill="none" stroke="#104e8b" points="288.4043,-8 288.4043,-192 930.8086,-192 930.8086,-8 288.4043,-8"/>
<text text-anchor="middle" x="609.6065" y="-161" font-family="Arial" font-size="30.00" fill="#104e8b">Clases para el manejo de streams</text>
</g>
<g id="clust3" class="cluster">
<title>cluster2</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="293.4043,-13 293.4043,-143 477.4043,-143 477.4043,-13 293.4043,-13"/>
<text text-anchor="middle" x="385.4043" y="-121" font-family="Arial" font-size="20.00" fill="#104e8b">Decorator Streams</text>
</g>
<g id="clust4" class="cluster">
<title>cluster3</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="705.8086,-13 705.8086,-143 925.8086,-143 925.8086,-13 705.8086,-13"/>
<text text-anchor="middle" x="815.8086" y="-121" font-family="Arial" font-size="20.00" fill="#104e8b">Backing Store Streams</text>
</g>
<g id="clust5" class="cluster">
<title>cluster4</title>
<polygon fill="none" stroke="transparent" points="1039.2129,-12 1039.2129,-156 1223.2129,-156 1223.2129,-12 1039.2129,-12"/>
<text text-anchor="middle" x="1131.2129" y="-125" font-family="Arial" font-size="30.00" fill="#000000">Dispositivos</text>
</g>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="transparent" points="8,-12 8,-156 168,-156 168,-12 8,-12"/>
<text text-anchor="middle" x="88" y="-125" font-family="Arial" font-size="30.00" fill="#000000">Datos</text>
</g>
<!-- Bytes -->
<g id="node1" class="node">
<title>Bytes</title>
<polygon fill="none" stroke="#000000" points="154,-104 16,-104 16,-20 160,-20 160,-98 154,-104"/>
<polyline fill="none" stroke="#000000" points="154,-104 154,-98 "/>
<polyline fill="none" stroke="#000000" points="160,-98 154,-98 "/>
<text text-anchor="middle" x="88" y="-68" font-family="Arial" font-size="20.00" fill="#000000">Bytes sin</text>
<text text-anchor="middle" x="88" y="-44" font-family="Arial" font-size="20.00" fill="#000000">transformar</text>
</g>
<!-- BufferedStream -->
<g id="node2" class="node">
<title>BufferedStream</title>
<polygon fill="#4f94cd" stroke="#4f94cd" points="457.4043,-91 313.4043,-91 313.4043,-33 457.4043,-33 457.4043,-91"/>
<text text-anchor="middle" x="385.4043" y="-57.2" font-family="Arial" font-size="16.00" fill="#ffffff">BufferedStream</text>
</g>
<!-- Bytes&#45;&gt;BufferedStream -->
<g id="edge1" class="edge">
<title>Bytes-&gt;BufferedStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M170.373,-62C170.373,-62 303.2227,-62 303.2227,-62"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="303.2227,-65.5 313.2227,-62 303.2227,-58.5 303.2227,-65.5"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="170.373,-58.5 160.373,-62 170.373,-65.5 170.373,-58.5"/>
<text text-anchor="middle" x="236.7022" y="-67.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- FileStream -->
<g id="node3" class="node">
<title>FileStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="887.8086,-91 743.8086,-91 743.8086,-33 887.8086,-33 887.8086,-91"/>
<text text-anchor="middle" x="815.8086" y="-57.2" font-family="Arial" font-size="16.00" fill="#ffffff">FileStream</text>
</g>
<!-- BufferedStream&#45;&gt;FileStream -->
<g id="edge2" class="edge">
<title>BufferedStream-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M467.4443,-62C467.4443,-62 733.5336,-62 733.5336,-62"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="733.5336,-65.5 743.5336,-62 733.5336,-58.5 733.5336,-65.5"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="467.4443,-58.5 457.4443,-62 467.4443,-65.5 467.4443,-58.5"/>
<text text-anchor="middle" x="589.1065" y="-67.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- Fichero -->
<g id="node4" class="node">
<title>Fichero</title>
<polygon fill="none" stroke="#000000" points="1203.2129,-92 1063.2129,-92 1059.2129,-88 1059.2129,-32 1199.2129,-32 1203.2129,-36 1203.2129,-92"/>
<polyline fill="none" stroke="#000000" points="1199.2129,-88 1059.2129,-88 "/>
<polyline fill="none" stroke="#000000" points="1199.2129,-88 1199.2129,-32 "/>
<polyline fill="none" stroke="#000000" points="1199.2129,-88 1203.2129,-92 "/>
<text text-anchor="middle" x="1131.2129" y="-56" font-family="Arial" font-size="20.00" fill="#000000">Fichero</text>
</g>
<!-- FileStream&#45;&gt;Fichero -->
<g id="edge3" class="edge">
<title>FileStream-&gt;Fichero</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M898.1687,-62C898.1687,-62 1049.1895,-62 1049.1895,-62"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1049.1895,-65.5 1059.1895,-62 1049.1895,-58.5 1049.1895,-65.5"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="898.1687,-58.5 888.1687,-62 898.1687,-65.5 898.1687,-58.5"/>
<text text-anchor="middle" x="982.5108" y="-67.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
</g>
</svg>
</p><pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">Stopwatch</span> cronometro <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">Stopwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    cronometro<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FileStream</span> fichero <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;prueba.txt&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Voy escribiendo bytes y cuando se llene el buffer del FileStream que yo no controlo</span>
    <span class="token comment">// se realizar&#xE1; un volcado (flush) del mismo en el disco.</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
        fichero<span class="token punctuation">.</span><span class="token function">WriteByte</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fichero<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cronometro<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Sin BufferedStream milisegundos = </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">cronometro<span class="token punctuation">.</span>ElapsedMilliseconds</span><span class="token punctuation">}</span></span><span class="token string">ms&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    cronometro<span class="token punctuation">.</span><span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cronometro<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fichero <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;prueba.txt&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// A&#xF1;ado un decorador que me a&#xF1;ade la posibilidad de gestionar un buffer de forma</span>
    <span class="token comment">// &apos;transparente&apos; antes del mandar los bytes al FileStream.</span>
    <span class="token comment">// Le a&#xF1;ado una capacidad de almacenaje en memoria antes de volcado de 100 bytes</span>
    <span class="token comment">// que es bastante menor que la que tiene el FileStream por defecto. Lo cual </span>
    <span class="token comment">// ralentizar&#xE1; much&#xED;simo la escritura porque se realizar&#xE1;n m&#xE1;s volcados o (flush). </span>
    <span class="token comment">// en el disco que es una operaci&#xF3;n extrem&#xE1;damente costosa.                     </span>
    <span class="token class-name">BufferedStream</span> ficheroBuff <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">BufferedStream</span><span class="token punctuation">(</span>fichero<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
        ficheroBuff<span class="token punctuation">.</span><span class="token function">WriteByte</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ficheroBuff<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cronometro<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Sin BufferedStream milisegundos = </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">cronometro<span class="token punctuation">.</span>ElapsedMilliseconds</span><span class="token punctuation">}</span></span><span class="token string">ms&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><blockquote>
<p><strong>&#x1F393; Casos de estudio</strong>:</p>
<ul>
<li>Prueba a ver que sucede si aumentamos la capacidad de &gt; almacenaje del <strong><code>BufferedStream</code></strong> de <strong>100</strong> a <strong>1000000</strong>.</li>
<li>Prueba a ver que sucede si hacemos un <strong><code>Flush()</code></strong> despu&#xE9;s &gt; de cada escritura.</li>
</ul>
</blockquote>
<div style="page-break-after:always;"></div>
<h4 class="mume-header" id="transformando-el-flujo-con-un-stream-adapter">Transformando el flujo con un &apos;<em>Stream Adapter</em>&apos;</h4>

<p>Un <strong><a href="https://es.wikipedia.org/wiki/Adaptador_(patr%C3%B3n_de_dise%C3%B1o)">adaptador</a></strong> en POO es un patr&#xF3;n de dise&#xF1;o que b&#xE1;sicamente se utiliza para ampliar y/o transformar el interfaz de las operaciones sobre una determinada clase.</p>
<ul>
<li>
<p><strong>Raz&#xF3;n de ser:</strong></p>
<p>La forma de acceder a ficheros a nivel de Byte no es muy conveniente, en tanto que generalmente, en las aplicaciones no suele trabajarse directamente con bytes sino con objetos m&#xE1;s complejos formados por m&#xFA;ltiples bytes y/o cadenas de texto. Por esto, en <strong><code>System.IO</code></strong> se han incluido tipos que encapsulan <strong><code>FileStream</code></strong> a trav&#xE9;s de una agregaci&#xF3;n y les proporcionan una serie de m&#xE9;todos mejorados con los que se simplifica la lectura y escritura de datos de cualquier tipo en ficheros.</p>
<blockquote>
<p>&#x1F4E3; <strong>Resumen:</strong></p>
<ul>
<li>Trabajar con <strong>arrays de bytes</strong> (buffers) es poco &#xFA;til adem&#xE1;s de engorroso.</li>
<li>Son una capa de abstracci&#xF3;n para manejar de forma m&#xE1;s c&#xF3;moda los tipos datos que usamos en nuestros programas.</li>
<li>&apos;<em>Envuelven</em>&apos; otros streams de almacenamiento abiertos como por ejemplo <strong><code>FileStream</code></strong>.</li>
</ul>
</blockquote>
</li>
</ul>
<h5 class="mume-header" id="stream-adapters-binarywriter-y-binaryreader">Stream Adapters BinaryWriter y BinaryReader</h5>

<p>B&#xE1;sicamente escriben o leen tipos b&#xE1;sicos del lenguaje en una secuencia y tambi&#xE9;n escribir o leer cadenas en una <strong>codificaci&#xF3;n espec&#xED;fica</strong>.</p>
<p align="center" style="zoom:0.6"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="1355pt" height="284pt" viewBox="0.00 0.00 1354.90 284.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 280)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-280 1350.8994,-280 1350.8994,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="transparent" points="8,-54 8,-198 184.44,-198 184.44,-54 8,-54"/>
<text text-anchor="middle" x="96.22" y="-167" font-family="Arial" font-size="30.00" fill="#000000">Datos</text>
</g>
<g id="clust2" class="cluster">
<title>clusterG</title>
<polygon fill="none" stroke="#104e8b" points="404.0908,-8 404.0908,-268 1046.4951,-268 1046.4951,-8 404.0908,-8"/>
<text text-anchor="middle" x="725.293" y="-237" font-family="Arial" font-size="30.00" fill="#104e8b">Clases para el manejo de streams</text>
</g>
<g id="clust3" class="cluster">
<title>cluster1</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="409.0908,-13 409.0908,-219 593.0908,-219 593.0908,-13 409.0908,-13"/>
<text text-anchor="middle" x="501.0908" y="-197" font-family="Arial" font-size="20.00" fill="#104e8b">Stream Adapters</text>
</g>
<g id="clust4" class="cluster">
<title>cluster3</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="821.4951,-46 821.4951,-176 1041.4951,-176 1041.4951,-46 821.4951,-46"/>
<text text-anchor="middle" x="931.4951" y="-154" font-family="Arial" font-size="20.00" fill="#104e8b">Backing Store Streams</text>
</g>
<g id="clust5" class="cluster">
<title>cluster4</title>
<polygon fill="none" stroke="transparent" points="1154.8994,-45 1154.8994,-189 1338.8994,-189 1338.8994,-45 1154.8994,-45"/>
<text text-anchor="middle" x="1246.8994" y="-158" font-family="Arial" font-size="30.00" fill="#000000">Dispositivos</text>
</g>
<!-- Bytes -->
<g id="node1" class="node">
<title>Bytes</title>
<polygon fill="none" stroke="#000000" points="170.6606,-146 15.7794,-146 15.7794,-62 176.6606,-62 176.6606,-140 170.6606,-146"/>
<polyline fill="none" stroke="#000000" points="170.6606,-146 170.6606,-140 "/>
<polyline fill="none" stroke="#000000" points="176.6606,-140 170.6606,-140 "/>
<text text-anchor="middle" x="96.22" y="-110" font-family="Arial" font-size="20.00" fill="#000000">Tipos b&#xE1;sicos</text>
<text text-anchor="middle" x="96.22" y="-86" font-family="Arial" font-size="20.00" fill="#000000">del CLR.</text>
</g>
<!-- BinaryWriter -->
<g id="node2" class="node">
<title>BinaryWriter</title>
<polygon fill="#36648b" stroke="#36648b" points="573.0908,-167 429.0908,-167 429.0908,-109 573.0908,-109 573.0908,-167"/>
<text text-anchor="middle" x="501.0908" y="-133.2" font-family="Arial" font-size="16.00" fill="#ffffff">BinaryWriter</text>
</g>
<!-- Bytes&#45;&gt;BinaryWriter -->
<g id="edge1" class="edge">
<title>Bytes-&gt;BinaryWriter</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M176.6935,-110.758C246.8099,-116.6461 348.0482,-125.1479 418.7191,-131.0826"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="418.659,-134.5898 428.9168,-131.939 419.2448,-127.6144 418.659,-134.5898"/>
<text text-anchor="middle" x="302.7654" y="-155.5" font-family="Arial" font-size="19.00" fill="#1874cd">int, char, double,</text>
<text text-anchor="middle" x="302.7654" y="-132.7" font-family="Arial" font-size="19.00" fill="#1874cd">bool, string, etc...</text>
</g>
<!-- BinaryReader -->
<g id="node3" class="node">
<title>BinaryReader</title>
<polygon fill="#36648b" stroke="#36648b" points="573.0908,-91 429.0908,-91 429.0908,-33 573.0908,-33 573.0908,-91"/>
<text text-anchor="middle" x="501.0908" y="-57.2" font-family="Arial" font-size="16.00" fill="#ffffff">BinaryReader</text>
</g>
<!-- Bytes&#45;&gt;BinaryReader -->
<g id="edge2" class="edge">
<title>Bytes-&gt;BinaryReader</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M186.7777,-93.0812C201.3711,-91.3962 216.3185,-89.7145 230.44,-88.2 297.6793,-80.9887 374.4143,-73.6441 428.964,-68.5734"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="186.2751,-89.616 176.7457,-94.2464 187.0827,-96.5693 186.2751,-89.616"/>
<text text-anchor="middle" x="302.7654" y="-93.7" font-family="Arial" font-size="19.00" fill="#1874cd">Tipos b&#xE1;sicos</text>
</g>
<!-- FileStream -->
<g id="node4" class="node">
<title>FileStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="1003.4951,-124 859.4951,-124 859.4951,-66 1003.4951,-66 1003.4951,-124"/>
<text text-anchor="middle" x="931.4951" y="-90.2" font-family="Arial" font-size="16.00" fill="#ffffff">FileStream</text>
</g>
<!-- BinaryWriter&#45;&gt;FileStream -->
<g id="edge3" class="edge">
<title>BinaryWriter-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M573.1308,-130.8028C649.3223,-123.1908 769.3305,-111.2012 849.199,-103.2219"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="849.6176,-106.6976 859.2201,-102.2207 848.9216,-99.7323 849.6176,-106.6976"/>
<text text-anchor="middle" x="704.793" y="-124.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- BinaryReader&#45;&gt;FileStream -->
<g id="edge4" class="edge">
<title>BinaryReader-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M583.1408,-68.2909C662.9268,-74.4083 782.9386,-83.6099 859.2201,-89.4585"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="583.3691,-64.7983 573.1308,-67.5235 582.8339,-71.7778 583.3691,-64.7983"/>
<text text-anchor="middle" x="704.793" y="-84.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- Fichero -->
<g id="node5" class="node">
<title>Fichero</title>
<polygon fill="none" stroke="#000000" points="1318.8994,-125 1178.8994,-125 1174.8994,-121 1174.8994,-65 1314.8994,-65 1318.8994,-69 1318.8994,-125"/>
<polyline fill="none" stroke="#000000" points="1314.8994,-121 1174.8994,-121 "/>
<polyline fill="none" stroke="#000000" points="1314.8994,-121 1314.8994,-65 "/>
<polyline fill="none" stroke="#000000" points="1314.8994,-121 1318.8994,-125 "/>
<text text-anchor="middle" x="1246.8994" y="-89" font-family="Arial" font-size="20.00" fill="#000000">Fichero</text>
</g>
<!-- FileStream&#45;&gt;Fichero -->
<g id="edge5" class="edge">
<title>FileStream-&gt;Fichero</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M1013.9777,-95C1060.4909,-95 1118.4045,-95 1164.8471,-95"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1013.8553,-91.5001 1003.8552,-95 1013.8552,-98.5001 1013.8553,-91.5001"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1164.876,-98.5001 1174.876,-95 1164.876,-91.5001 1164.876,-98.5001"/>
<text text-anchor="middle" x="1098.1973" y="-100.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
</g>
</svg>
</p><ul>
<li>Sus m&#xE9;todo de escritura <strong><code>Write</code></strong> y lectura <strong><code>Read&lt;Tipo&gt;</code></strong> &apos;<em>adaptar&#xE1;n</em>&apos; los Write y Read de FileStream permitiendo escribir y leer respectivamente los tipos b&#xE1;sicos definidos en el lenguaje, <strong><code>int</code></strong>, <strong><code>short</code></strong>, <strong><code>string</code></strong> etc.</li>
<li>Estos tipos b&#xE1;sicos se transformar&#xE1;n en una secuencia de bytes <strong>tal y como los guarda internamente en memoria .NET</strong>. Por tanto, si hacemos un <strong><code>Write</code></strong> de una <strong>cadena</strong> la escribir&#xE1; en disco guardando la marca de fin de cadena para saber hasta donde tiene que leer en un posterior <strong><code>ReadString</code></strong> del adaptador de lectura.</li>
</ul>
<p><strong>Adaptador <code>BinaryWriter</code></strong></p>
<p>El constructor b&#xE1;sico ser&#xE1; <strong><code>BinaryWriter(Stream streamAdaptado, Encoding codificacionCadenas)</code></strong></p>
<p>Veamos un <strong>ejemplo b&#xE1;sico de uso</strong> escribiendo un tipo <strong><code>int</code></strong> (entero) en la secuencia.</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token comment">// Creamos el FileStream</span>
<span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;ejemplo.bin&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Lo pasamos a un objeto adaptador como una agregaci&#xF3;n, indic&#xE1;ndo que las cadenas las </span>
<span class="token comment">// codifique c&#xF3;mo UTF-8. </span>
<span class="token comment">// Aunque es posible hacerlo, ya no deber&#xED;amos usar el fs porque ahora es responsabilidad del BinaryWriter.</span>
<span class="token class-name">BinaryWriter</span> bw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">BinaryWriter</span><span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword keyword-int">int</span></span> valor <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment">// El Write de bw espera todos los tipos b&#xE1;sicos del lenguaje y los adaptar&#xE1;</span>
<span class="token comment">// a la secuencia de bytes correspondiente para pas&#xE1;rselos al fs que adapta.</span>
bw<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>valor<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// El Close de BinaryWriter cerrar&#xE1; el stream subyacente al que est&#xE1; adaptando.</span>
bw<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p align="center" style="zoom:0.8"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="440pt" height="111pt" viewBox="0.00 0.00 439.75 111.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 107)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-107 435.7523,-107 435.7523,4 -4,4"/>
<!-- bw -->
<g id="node1" class="node">
<title>bw</title>
<ellipse fill="none" stroke="#000000" cx="23.3762" cy="-61" rx="23.253" ry="23.253"/>
<text text-anchor="middle" x="23.3762" y="-56.8" font-family="Arial" font-size="14.00" fill="#000000">bw</text>
</g>
<!-- obw -->
<g id="node2" class="node">
<title>obw</title>
<polygon fill="none" stroke="#000000" points="91.2523,-61 91.2523,-99 236.2523,-99 236.2523,-61 91.2523,-61"/>
<text text-anchor="start" x="101.9164" y="-75.4" font-family="Arial" font-size="14.00" fill="#000000"> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;BinaryWriter &#xA0;&#xA0;&#xA0;</text>
<polygon fill="none" stroke="#000000" points="91.2523,-23 91.2523,-61 236.2523,-61 236.2523,-23 91.2523,-23"/>
<text text-anchor="start" x="122.5525" y="-37.4" font-family="Arial" font-size="14.00" fill="#000000">streamAdaptado</text>
</g>
<!-- bw&#45;&gt;obw -->
<g id="edge1" class="edge">
<title>bw-&gt;obw</title>
<path fill="none" stroke="#000000" d="M46.7883,-61C54.3498,-61 63.2392,-61 72.6796,-61"/>
<polygon fill="#000000" stroke="#000000" points="72.6844,-64.5001 82.6844,-61 72.6843,-57.5001 72.6844,-64.5001"/>
</g>
<!-- ofs -->
<g id="node3" class="node">
<title>ofs</title>
<polygon fill="none" stroke="#000000" points="287.7523,-42 287.7523,-80 423.7523,-80 423.7523,-42 287.7523,-42"/>
<text text-anchor="start" x="298.5777" y="-56.4" font-family="Arial" font-size="14.00" fill="#000000"> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;FileStream &#xA0;&#xA0;&#xA0;</text>
<polygon fill="none" stroke="#000000" points="287.7523,-4 287.7523,-42 423.7523,-42 423.7523,-4 287.7523,-4"/>
<text text-anchor="start" x="349.9164" y="-18.4" font-family="Arial" font-size="14.00" fill="#000000">...</text>
</g>
<!-- obw&#45;&gt;ofs -->
<g id="edge2" class="edge">
<title>obw:stream-&gt;ofs</title>
<path fill="none" stroke="#000000" d="M225.2523,-42C239.5187,-42 254.6623,-42 269.3885,-42"/>
<polygon fill="#000000" stroke="#000000" points="269.501,-45.5001 279.501,-42 269.5009,-38.5001 269.501,-45.5001"/>
</g>
</g>
</svg>
</p><div style="page-break-after:always;"></div>
<p>Una  implementaci&#xF3;n simplificada de lo que har&#xED;a el <strong><code>Write</code></strong> del <strong><code>BinaryWriter</code></strong> en la <code>l&#xED;nea 11</code> ser&#xED;a la siguiente...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-class">class</span> <span class="token class-name">BinaryWriter</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name">Stream</span> streamAdaptado<span class="token punctuation">;</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name">Encoding</span> codificacionCadenas<span class="token punctuation">;</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Write</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-int">int</span></span> valor<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Adapto el entero a un array de bits.</span>
        <span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> bytes <span class="token operator">=</span> BitConverter<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>valor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Lo escribo en el flujo que estoy adaptando.</span>
        streamAdaptado<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytes<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>De hecho, si ahora ley&#xE9;semos la secuencia de bytes en &apos;<em>bruto</em>&apos; de lo que se ha grabado en en fichero con el siguiente c&#xF3;digo...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;ejemplo.bin&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Reservo espacio para leer los 4 bytes (32 bits) resultado de guardar el entero.</span>
<span class="token class-name"><span class="token keyword keyword-byte">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> bytesInt <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-byte">byte</span></span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// Los leo con un FileStream normal.</span>
fs<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>bytesInt<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytesInt<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Algunos Sistemas Operativos guardan los bytes a la inversa en memoria, </span>
<span class="token comment">// por tanto tengo que preguntar si lo est&#xE1;n haciendo as&#xED; para invertirlos. </span>
<span class="token comment">// Si tines curiosidad en saber el porqu&#xE9; puedes leer esta entrada de la </span>
<span class="token comment">// Wikipedia https://es.wikipedia.org/wiki/Endianness aunque no es objetivo de este curso.</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>BitConverter<span class="token punctuation">.</span>IsLittleEndian<span class="token punctuation">)</span>
    Array<span class="token punctuation">.</span><span class="token function">Reverse</span><span class="token punctuation">(</span>bytesInt<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Muestro cada uno de los bytes le&#xED;dos.</span>
<span class="token comment">// Nos mostrar&#xE1; 0000000A que es el 10 en hexadecimal guardado con 32 bits.</span>
Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;Valor guardado en hexadecimal: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-byte">byte</span></span> _byte <span class="token keyword keyword-in">in</span> bytesInt<span class="token punctuation">)</span> 
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_byte</span><span class="token format-string"><span class="token punctuation">:</span>X2</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Algo similar har&#xE1; para el resto de tipos b&#xE1;sicos y en el caso concreto de las cade las cadenas realizaremos un proceso parecido utilizando la codificaci&#xF3;n indicada (<strong>Si no la indicamos en el constructor por defecto ser&#xE1; UTF-8</strong>). Las codificaciones pueden ser ...</p>
<table>
<thead>
<tr>
<th style="text-align:left">Propiedad</th>
<th style="text-align:left">Formato que representa el objeto devuelto</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>ASCII</strong></td>
<td style="text-align:left">ASCII (7 bits por car&#xE1;cter)</td>
</tr>
<tr>
<td style="text-align:left"><strong>Unicode</strong></td>
<td style="text-align:left">Unicode (16 bits por car&#xE1;cter) usando notaci&#xF3;n little-endian</td>
</tr>
<tr>
<td style="text-align:left"><strong>BigEndianUnicode</strong></td>
<td style="text-align:left">Unicode (16 bits por car&#xE1;cter) usando notaci&#xF3;n big-endian</td>
</tr>
<tr>
<td style="text-align:left"><strong>UTF8</strong></td>
<td style="text-align:left">UTF8 (16 bits por car&#xE1;cter en grupos de 8 bits)</td>
</tr>
<tr>
<td style="text-align:left"><strong>UTF7</strong></td>
<td style="text-align:left">UTF7(16 bits por car&#xE1;cter en grupos de 7 bits)</td>
</tr>
<tr>
<td style="text-align:left"><strong>Default</strong></td>
<td style="text-align:left">Juego de caracteres usado por defecto en el sistema.</td>
</tr>
</tbody>
</table>
<blockquote>
<p>&#x270B; <strong>Importante</strong>:</p>
<p>Es importante tener en cuenta que la codificaci&#xF3;n a usar al leer los caracteres de un fichero de texto debe ser la misma que la que se us&#xF3; para escribirlos, pues si no podr&#xED;an obtenerse resultados extra&#xF1;os.<br>
Adem&#xE1;s, aunque binary reader permita guardar y leer cadenas. Al guardarse tal y como se almacenan en memoria, su uso no estar&#xE1; indicado para leer y escribir ficheros de texto <strong><code>.txt</code></strong> para ser abiertos posteriormente por un editor como el <strong>notepad</strong>.</p>
</blockquote>
<div style="page-break-after:always;"></div>
<p><strong>Adaptador <code>BinaryReader</code></strong></p>
<p>El constructor b&#xE1;sico ser&#xE1; <strong><code>BinaryReader(Stream streamAdaptado, Encoding codificacionCadenas)</code></strong></p>
<p>Realizar&#xE1; el proceso inverso al <strong>BinaryWriter</strong> y tendr&#xE9;mos un m&#xE9;todo de lectura espec&#xED;fico para la adaptar la lectura de cada tipo b&#xE1;sico.</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;ejemplo.bin&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BinaryReader</span> br <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">BinaryReader</span><span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Leemos un entero de 4 bytes (32 bits) a partir de la posici&#xF3;n donde se encuentre</span>
<span class="token comment">// el descriptor del fichero actualmente.</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> valor <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">ReadInt32</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;El valor guardado como ulong es: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">valor</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
br<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p>Si nos fijamos el los <strong><a href="https://docs.microsoft.com/es-es/dotnet/api/system.io.binaryreader?view=net-5.0#methods">m&#xE9;todos de lectura definidos por la clase</a></strong>, todos leer&#xE1;n los tipos definidos en el lenguaje y al leer cualquier tipo, el descriptor del flujo avanzar&#xE1; en el mismo. Sin embargo habr&#xE1; un caso especial de dos m&#xE9;todos que se complementan y comentaremos a continuaci&#xF3;n.</p>
<ul>
<li>
<p><strong><code>char ReadChar()</code></strong>: Leer&#xE1; un caracter del flujo y <strong>avanzar&#xE1; el descriptor</strong>. Si el descriptor se encuentra al final del mismo, se producir&#xE1; una excepti&#xF3;n.</p>
<blockquote>
<p><strong>Nota:</strong> El n&#xFA;mero de bytes que avanza el descriptor, depender&#xE1; de la codificaci&#xF3;n de caracteres indicada. Por ejemplo <strong>1 byte</strong> para <strong>UTF7</strong> y <strong>2 bytes</strong> para <strong>Unicode</strong>.</p>
</blockquote>
</li>
</ul>
<p align="center" style="zoom:0.8"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="545pt" height="188pt" viewBox="0.00 0.00 545.29 188.20" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184.2)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-184.2 541.2854,-184.2 541.2854,4 -4,4"/>
<text text-anchor="middle" x="268.6427" y="-163.6" font-family="Arial" font-size="14.00" fill="#000000">Ejemplo descriptor con ReadChar() y codificaci&#xF3;n UTF7</text>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="transparent" points="8,-8 8,-83 498,-83 498,-8 8,-8"/>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<text text-anchor="start" x="47.6641" y="-40.8" font-family="Arial" font-size="14.00" fill="#000000">...</text>
<polygon fill="none" stroke="#000000" points="67,-19.5 67,-70.5 85,-70.5 85,-19.5 67,-19.5"/>
<polygon fill="none" stroke="#000000" points="85,-19.5 85,-70.5 133,-70.5 133,-19.5 85,-19.5"/>
<text text-anchor="start" x="93.8261" y="-48.9" font-family="Arial" font-size="14.00" fill="#000000">0x63</text>
<text text-anchor="start" x="102.4074" y="-32.1" font-family="Arial" font-size="14.00" fill="#000000">&apos;c&apos;</text>
<polygon fill="none" stroke="#000000" points="133,-19.5 133,-70.5 182,-70.5 182,-19.5 133,-19.5"/>
<text text-anchor="start" x="141.9411" y="-48.9" font-family="Arial" font-size="14.00" fill="#000000">0x6F</text>
<text text-anchor="start" x="150.5161" y="-32.1" font-family="Arial" font-size="14.00" fill="#000000">&apos;o&apos;</text>
<polygon fill="none" stroke="#000000" points="182,-19.5 182,-70.5 231,-70.5 231,-19.5 182,-19.5"/>
<text text-anchor="start" x="190.5491" y="-48.9" font-family="Arial" font-size="14.00" fill="#000000">0x6E</text>
<text text-anchor="start" x="199.5161" y="-32.1" font-family="Arial" font-size="14.00" fill="#000000">&apos;n&apos;</text>
<polygon fill="none" stroke="#000000" points="231,-19.5 231,-70.5 249,-70.5 249,-19.5 231,-19.5"/>
<text text-anchor="start" x="256.6641" y="-40.8" font-family="Arial" font-size="14.00" fill="#000000">...</text>
<text text-anchor="start" x="299.6641" y="-40.8" font-family="Arial" font-size="14.00" fill="#000000">...</text>
<polygon fill="none" stroke="#000000" points="319,-19.5 319,-70.5 337,-70.5 337,-19.5 319,-19.5"/>
<polygon fill="none" stroke="#000000" points="337,-19.5 337,-70.5 385,-70.5 385,-19.5 337,-19.5"/>
<text text-anchor="start" x="345.8261" y="-48.9" font-family="Arial" font-size="14.00" fill="#000000">0x63</text>
<text text-anchor="start" x="354.4074" y="-32.1" font-family="Arial" font-size="14.00" fill="#000000">&apos;c&apos;</text>
<polygon fill="none" stroke="#000000" points="385,-19.5 385,-70.5 434,-70.5 434,-19.5 385,-19.5"/>
<text text-anchor="start" x="393.9411" y="-48.9" font-family="Arial" font-size="14.00" fill="#000000">0x6F</text>
<text text-anchor="start" x="402.5161" y="-32.1" font-family="Arial" font-size="14.00" fill="#000000">&apos;o&apos;</text>
<polygon fill="none" stroke="#000000" points="434,-19.5 434,-70.5 483,-70.5 483,-19.5 434,-19.5"/>
<text text-anchor="start" x="442.5491" y="-48.9" font-family="Arial" font-size="14.00" fill="#000000">0x6E</text>
<text text-anchor="start" x="451.5161" y="-32.1" font-family="Arial" font-size="14.00" fill="#000000">&apos;n&apos;</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="104" y="-130.4" font-family="Arial" font-size="14.00" fill="#d3d3d3">Antes</text>
<text text-anchor="middle" x="104" y="-113.6" font-family="Arial" font-size="14.00" fill="#d3d3d3">ReadChar()</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="#d3d3d3" d="M111.2118,-105.4817C114.8372,-96.8378 119.8579,-86.828 126.3379,-78.2258"/>
<polygon fill="#d3d3d3" stroke="#d3d3d3" points="129.1201,-80.3589 133,-70.5 123.8189,-75.7875 129.1201,-80.3589"/>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="211" y="-138.8" font-family="Arial" font-size="14.00" fill="#000000">Despu&#xE9;s</text>
<text text-anchor="middle" x="211" y="-122" font-family="Arial" font-size="14.00" fill="#000000">ReadChar()</text>
<text text-anchor="middle" x="211" y="-105.2" font-family="Arial" font-size="14.00" fill="#000000">retorna &apos;o&apos;</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="#000000" d="M199.8485,-96.7965C196.812,-90.6067 193.1395,-84.2046 188.8117,-78.425"/>
<polygon fill="#000000" stroke="#000000" points="191.1726,-75.8022 182,-70.5 185.8641,-80.3651 191.1726,-75.8022"/>
</g>
<!-- p3 -->
<g id="node4" class="node">
<title>p3</title>
<text text-anchor="middle" x="483" y="-138.8" font-family="Arial" font-size="14.00" fill="#ff0000">ReadChar()</text>
<text text-anchor="middle" x="483" y="-122" font-family="Arial" font-size="14.00" fill="#ff0000">al final del flujo</text>
<text text-anchor="middle" x="483" y="-105.2" font-family="Arial" font-size="14.00" fill="#ff0000">ERROR</text>
</g>
<!-- p3&#45;&gt;cluster0_stream -->
<g id="edge3" class="edge">
<title>p3-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="#ff0000" d="M490.6174,-96.9749C491.0762,-90.7979 490.6272,-84.4761 488.4475,-78.9323"/>
<polygon fill="#ff0000" stroke="#ff0000" points="491.3663,-77.0004 483,-70.5 485.4866,-80.7989 491.3663,-77.0004"/>
</g>
</g>
</svg>
</p><ul>
<li><strong><code>int PeekChar()</code></strong>: Mirar&#xE1; el siguiente caracter del flujo <strong>sin avanzar el descriptor</strong>. Si el descriptor se encuentra al final de la secuencia, devolver&#xE1; -<strong>1</strong> (Por esa raz&#xF3;n retorna un <strong><code>int</code></strong> en lugar de un <strong><code>char</code></strong> como el otro m&#xE9;todo).</li>
</ul>
<p align="center" style="zoom:0.8"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="545pt" height="188pt" viewBox="0.00 0.00 545.29 188.20" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 184.2)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-184.2 541.2854,-184.2 541.2854,4 -4,4"/>
<text text-anchor="middle" x="268.6427" y="-163.6" font-family="Arial" font-size="14.00" fill="#000000">Ejemplo descriptor con PeekChar() y codificaci&#xF3;n UTF7</text>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="transparent" points="8,-8 8,-83 498,-83 498,-8 8,-8"/>
</g>
<!-- cluster0_stream -->
<g id="node1" class="node">
<title>cluster0_stream</title>
<text text-anchor="start" x="47.6641" y="-40.8" font-family="Arial" font-size="14.00" fill="#000000">...</text>
<polygon fill="none" stroke="#000000" points="67,-19.5 67,-70.5 85,-70.5 85,-19.5 67,-19.5"/>
<polygon fill="none" stroke="#000000" points="85,-19.5 85,-70.5 133,-70.5 133,-19.5 85,-19.5"/>
<text text-anchor="start" x="93.8261" y="-48.9" font-family="Arial" font-size="14.00" fill="#000000">0x63</text>
<text text-anchor="start" x="102.4074" y="-32.1" font-family="Arial" font-size="14.00" fill="#000000">&apos;c&apos;</text>
<polygon fill="none" stroke="#000000" points="133,-19.5 133,-70.5 182,-70.5 182,-19.5 133,-19.5"/>
<text text-anchor="start" x="141.9411" y="-48.9" font-family="Arial" font-size="14.00" fill="#000000">0x6F</text>
<text text-anchor="start" x="150.5161" y="-32.1" font-family="Arial" font-size="14.00" fill="#000000">&apos;o&apos;</text>
<polygon fill="none" stroke="#000000" points="182,-19.5 182,-70.5 231,-70.5 231,-19.5 182,-19.5"/>
<text text-anchor="start" x="190.5491" y="-48.9" font-family="Arial" font-size="14.00" fill="#000000">0x6E</text>
<text text-anchor="start" x="199.5161" y="-32.1" font-family="Arial" font-size="14.00" fill="#000000">&apos;n&apos;</text>
<polygon fill="none" stroke="#000000" points="231,-19.5 231,-70.5 249,-70.5 249,-19.5 231,-19.5"/>
<text text-anchor="start" x="256.6641" y="-40.8" font-family="Arial" font-size="14.00" fill="#000000">...</text>
<text text-anchor="start" x="299.6641" y="-40.8" font-family="Arial" font-size="14.00" fill="#000000">...</text>
<polygon fill="none" stroke="#000000" points="319,-19.5 319,-70.5 337,-70.5 337,-19.5 319,-19.5"/>
<polygon fill="none" stroke="#000000" points="337,-19.5 337,-70.5 385,-70.5 385,-19.5 337,-19.5"/>
<text text-anchor="start" x="345.8261" y="-48.9" font-family="Arial" font-size="14.00" fill="#000000">0x63</text>
<text text-anchor="start" x="354.4074" y="-32.1" font-family="Arial" font-size="14.00" fill="#000000">&apos;c&apos;</text>
<polygon fill="none" stroke="#000000" points="385,-19.5 385,-70.5 434,-70.5 434,-19.5 385,-19.5"/>
<text text-anchor="start" x="393.9411" y="-48.9" font-family="Arial" font-size="14.00" fill="#000000">0x6F</text>
<text text-anchor="start" x="402.5161" y="-32.1" font-family="Arial" font-size="14.00" fill="#000000">&apos;o&apos;</text>
<polygon fill="none" stroke="#000000" points="434,-19.5 434,-70.5 483,-70.5 483,-19.5 434,-19.5"/>
<text text-anchor="start" x="442.5491" y="-48.9" font-family="Arial" font-size="14.00" fill="#000000">0x6E</text>
<text text-anchor="start" x="451.5161" y="-32.1" font-family="Arial" font-size="14.00" fill="#000000">&apos;n&apos;</text>
</g>
<!-- p1 -->
<g id="node2" class="node">
<title>p1</title>
<text text-anchor="middle" x="72" y="-130.4" font-family="Arial" font-size="14.00" fill="#d3d3d3">Antes</text>
<text text-anchor="middle" x="72" y="-113.6" font-family="Arial" font-size="14.00" fill="#d3d3d3">PeekChar()</text>
</g>
<!-- p1&#45;&gt;cluster0_stream -->
<g id="edge1" class="edge">
<title>p1-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="#d3d3d3" d="M95.6354,-105.5245C104.8921,-97.2447 115.6975,-87.3593 125.8001,-77.5788"/>
<polygon fill="#d3d3d3" stroke="#d3d3d3" points="128.323,-80.0066 133,-70.5 123.4154,-75.0151 128.323,-80.0066"/>
</g>
<!-- p2 -->
<g id="node3" class="node">
<title>p2</title>
<text text-anchor="middle" x="195" y="-138.8" font-family="Arial" font-size="14.00" fill="#000000">Despu&#xE9;s</text>
<text text-anchor="middle" x="195" y="-122" font-family="Arial" font-size="14.00" fill="#000000">PeekChar()</text>
<text text-anchor="middle" x="195" y="-105.2" font-family="Arial" font-size="14.00" fill="#000000">retorna 0x6F (&apos;o&apos;)</text>
</g>
<!-- p2&#45;&gt;cluster0_stream -->
<g id="edge2" class="edge">
<title>p2-&gt;cluster0_stream:nw</title>
<path fill="none" stroke="#000000" d="M137.649,-96.7753C131.5206,-91.3265 127.6441,-85.503 128.19,-79.6562"/>
<polygon fill="#000000" stroke="#000000" points="131.4478,-80.9805 133,-70.5 125.2508,-77.7251 131.4478,-80.9805"/>
</g>
<!-- p3 -->
<g id="node4" class="node">
<title>p3</title>
<text text-anchor="middle" x="483" y="-138.8" font-family="Arial" font-size="14.00" fill="#000000">PeekChar()</text>
<text text-anchor="middle" x="483" y="-122" font-family="Arial" font-size="14.00" fill="#000000">al final del flujo</text>
<text text-anchor="middle" x="483" y="-105.2" font-family="Arial" font-size="14.00" fill="#000000">retorna -1</text>
</g>
<!-- p3&#45;&gt;cluster0_stream -->
<g id="edge3" class="edge">
<title>p3-&gt;cluster0_stream:ne</title>
<path fill="none" stroke="#000000" d="M490.6174,-96.9749C491.0762,-90.7979 490.6272,-84.4761 488.4475,-78.9323"/>
<polygon fill="#000000" stroke="#000000" points="491.3663,-77.0004 483,-70.5 485.4866,-80.7989 491.3663,-77.0004"/>
</g>
</g>
</svg>
</p><p>Por ejemplo, en el siguiente c&#xF3;digo leemos byte a byte de un <strong>fichero de texto</strong> que se guard&#xF3; como UTF7 y mostramos la representaci&#xF3;n en caracter de dicho byte.<br>
<strong>Utilizamos <code>PeekChar()</code> para detectar el final del fichero</strong>.</p>
<blockquote>
<p><strong>Nota:</strong> Si fuera un <strong>fichero en binario</strong> esta lectura no tendr&#xED;a mucho sentido pues obtendr&#xED;amos caracteres no representables por consola.</p>
</blockquote>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;ejemplo.txt&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BinaryReader</span> br <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">BinaryReader</span><span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-while">while</span><span class="token punctuation">(</span>br<span class="token punctuation">.</span><span class="token function">PeekChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>br<span class="token punctuation">.</span><span class="token function">ReadChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           
br<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></pre><div style="page-break-after:always;"></div>
<h5 class="mume-header" id="mortar_board-caso-de-estudio-de-lectura-en-binario-con-binaryreader">&#x1F393; Caso de estudio de lectura en binario con BinaryReader</h5>

<p>Imaginemos que tenemos una serie de archivos de audio en formato <strong>mp3</strong> en la carpeta <strong><code>C:\Musica</code></strong>. Si los examinamos con el explorador de archivos de Windows 10 (<strong>Mostrando las columnas adecuadas</strong>). Podemos ver que nos muestra cierta informaci&#xF3;n de T&#xED;tulo, &#xC1;lbum, etc.</p>
<div align="center">
    <img width="500" src="assets/mp3_lista_ficheros.png">
</div>
<p>Es m&#xE1;s <strong>podemos editar y modificar esta informaci&#xF3;n</strong> a trav&#xE9;s del propio Windows 10 a trav&#xE9;s de la pesta&#xF1;a <strong>Detalles</strong>, haciendo click con el bot&#xF3;n derecho sobre el fichero y seleccionando la opci&#xF3;n del men&#xFA; contextual <strong>Propiedades</strong>.</p>
<div align="center">
    <img width="300" src="assets/mp3_editar_info.png">
</div>
<p>Hay varias formas de guardar estas etiquetas de informaci&#xF3;n en un archivo mp3 pero la usada para estos es la m&#xE1;s simple y se denomina <strong>TAGID3V1</strong>.</p>
<p><strong>&#xBF;C&#xF3;mo se guarda la informaci&#xF3;n del  TAGID3V1?</strong></p>
<p>De estar incluida esta informaci&#xF3;n, ser&#xE1; al final del archivo:<br>
Se a&#xF1;aden 128 bytes fijos:</p>
<ul>
<li><strong><code>TagID</code></strong>: 3 caracteres <strong>fijos</strong> &apos;T&apos;, &apos;A&apos; y &apos;G&apos;<br>
Estos bytes me indicar&#xE1;n si en esos 128 bytes del final del mp3 realmente hay informaci&#xF3;n del TAGID3V1 o es simple codificaci&#xF3;n de audio.</li>
<li><strong><code>T&#xED;tulo</code></strong>: 30 caracteres</li>
<li><strong><code>Artista</code></strong>: 30 caracteres</li>
<li><strong><code>&#xC1;lbum</code></strong>: 30 caracteres</li>
<li><strong><code>A&#xF1;o</code></strong>: 4 caracteres</li>
<li><strong><code>Comentario</code></strong>: 30 caracteres</li>
<li><strong><code>G&#xE9;nero</code></strong>: 1 byte<br>
Ser&#xE1; un &#xED;ndice natural entre 0 y 79 codificado en 1byte de tal manera que:&#xE7;...<br>
0 &#x2192; BLUES, 1 &#x2192; CLASSIC ROCK, &#x2026; , 79 &#x2192;  HARD ROCK y si hubiera un valor superior a 79 se calificar&#xED;a como OTHERS.</li>
</ul>
<blockquote>
<p><strong>Nota:</strong> Si te fijas 3 + 30 + 30 + 30 + 4 + 30 + 1 = <strong>128</strong>.</p>
</blockquote>
<p>Si examinamos el c&#xF3;digo en binario del final del fichero editado en el di&#xE1;logo anterior tendremos:</p>
<pre data-role="codeBlock" data-info="txt" class="language-txt">...
0040b020: FF FF FF 54 41 47 41 20 4B 69 6E 64 20 4F 66 20    ...TAGA.Kind.Of.
0040b030: 4D 61 67 69 63 20 20 20 20 20 20 20 20 20 20 20    Magic...........
0040b040: 20 20 20 20 51 75 65 65 6E 20 20 20 20 20 20 20    ....Queen.......
0040b050: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20    ................
0040b060: 20 20 44 45 53 43 4F 4E 4F 43 49 44 4F 20 20 20    ..DESCONOCIDO...
0040b070: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20    ................
0040b080: 31 39 36 36 20 20 20 20 20 20 20 20 20 20 20 20    1966............
0040b090: 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20 20    ................
0040b0a0: 20 20 0C
</pre><div style="page-break-after:always;"></div>
<h6 class="mume-header" id="pasos-para-resolver-el-caso-de-estudio">Pasos para resolver el caso de estudio</h6>

<ol>
<li>
<p>Vamos a definir una clase en C# denominada <strong><code>TagId3v1</code></strong>, para leer esta informaci&#xF3;n en los ficheros. En ella en primer lugar <strong>definiremos constantes</strong> para los tama&#xF1;os reservados para cada dato seg&#xFA;n la especificaci&#xF3;n anterior y un array &apos;<strong><code>generosTagID3v1</code></strong>&apos; de solo lectura con los nombres de los g&#xE9;neros conforme a la especificaci&#xF3;n de TAGID3V1.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-class">class</span> <span class="token class-name">TagId3v1</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_TAG_ID <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_TITULO <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_ARTISTA <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_ALBUM <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-int">int</span> BYTES_A&#xD1;O <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_COMENTARIO <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> BYTES_GENERO <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> TOTAL_BYTES <span class="token operator">=</span> BYTES_TAG_ID <span class="token operator">+</span> BYTES_TITULO <span class="token operator">+</span> BYTES_ARTISTA <span class="token operator">+</span> 
                            BYTES_ALBUM <span class="token operator">+</span> BYTES_A&#xD1;O <span class="token operator">+</span> BYTES_COMENTARIO <span class="token operator">+</span> BYTES_GENERO<span class="token punctuation">;</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-readonly">readonly</span> <span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> generosTagID3v1 <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;BLUES&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CLASSIC ROCK&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;COUNTRY&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DANCE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DISCO&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;FUNK&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;GRUNGE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;HIP-HOP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;JAZZ&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;METAL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NEW AGE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OLDIES&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;OTHER&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;POP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;R&amp;B&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;RAP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;REGGAE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ROCK&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TECHNO&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;INDUSTRIAL&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ALTERNATIVE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;SKA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DEATH METAL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PRANKS&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;SOUNDTRACK&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;EURO-TECHNO&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;AMBIENT&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TRIP-HOP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;VOCAL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;JAZZ+FUNK&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;FUSION&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;TRANCE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CLASSICAL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;INSTRUMENTAL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ACID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;HOUSE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GAME&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;SOUND CLIP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GOSPEL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NOISE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ALTERN ROCK&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;BASS&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;SOUL&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;PUNK&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;SPACE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;MEDITATIVE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;INSTRUMENTAL POP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;INSTRUMENTAL ROCK&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ETHNIC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GOTHIC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DARKWAVE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TECHNO-INDUSTRIAL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ELECTRONIC&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;POP-FOLK&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;EURODANCE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DREAM&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;SOUTHERN ROCK&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;COMEDY&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CULT&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;GANGSTA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TOP 40&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CHRISTIAN POP&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POP/FUNK&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;JUNGLE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NATIVE AMERICAN&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;CABARET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NEW WAVE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PSYCHADELIC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;RAVE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;SHOWTUNES&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;TRAILER&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;LO-FI&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;TRIBAL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ACID PUNK&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ACID JAZZ&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POLKA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;RETRO&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;MUSICAL&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ROCK &amp; ROLL&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;HARD ROCK&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre></li>
<li>
<p>A continuac&#xED;on vamos a a&#xF1;adir a la clase <strong><code>TagId3v1</code></strong> los campos privados <strong>titulo</strong>, <strong>artista</strong>, <strong>&#xE1;lbum</strong> y <strong>comentario</strong> de tipo <strong><code>string</code></strong>, <strong>a&#xF1;o</strong> de tipo <strong><code>ushort</code></strong> y <strong>g&#xE9;nero</strong> de tipo <strong><code>byte</code></strong>. (Se acceder&#xE1;n siempre a trav&#xE9;s de sus getters).<br>
Adem&#xE1;s, vamos a definir los accesores p&#xFA;blicos para t&#xED;tulo, artista, &#xE1;lbum, comentario y a&#xF1;o. Sin embargo, para g&#xE9;nero definiremos <strong>dos</strong> accesores p&#xFA;blicos uno que devuelva el <strong><code>byte</code></strong> y otro el <strong><code>string</code></strong> con el texto del g&#xE9;nero.<br>
Una posible implementaci&#xF3;n ser&#xED;a la siguiente ...</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-class">class</span> <span class="token class-name">TagId3V1</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ... c&#xF3;digo omitido por abreviar</span>

    <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> titulo<span class="token punctuation">;</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> artista<span class="token punctuation">;</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> album<span class="token punctuation">;</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-ushort">ushort</span> a&#xF1;o<span class="token punctuation">;</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-byte">byte</span></span> genero<span class="token punctuation">;</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> comentario<span class="token punctuation">;</span>

    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">GetTitulo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> titulo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">GetArtista</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> artista<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-ushort">ushort</span> GetA&#xF1;<span class="token function">o</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> a&#xF1;o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">GetComentario</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> comentario<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">GetAlbum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> album<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
</pre> <div style="page-break-after:always;"></div>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp">    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">GetGenero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>genero <span class="token operator">&gt;=</span> <span class="token number">80</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-return">return</span> <span class="token string">&quot;OTHER&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span>
            <span class="token keyword keyword-return">return</span> generosTagID3v1<span class="token punctuation">[</span>genero<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>        
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-byte">byte</span></span> <span class="token function">GetByteGenero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> genero<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
</pre></li>
<li>
<p><strong>Constructor privado</strong> que reciba todos los campos (excepto, claro est&#xE1;, el array de g&#xE9;neros). Adem&#xE1;s, vamos a invalidar el m&#xE9;todo <strong><code>ToString</code></strong> para que muestre los datos del objeto.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-class">class</span> <span class="token class-name">TagId3V1</span>
<span class="token punctuation">{</span>
   <span class="token comment">// ... c&#xF3;digo omitido por abreviar</span>
   <span class="token keyword keyword-private">private</span> <span class="token function">TagId3V1</span><span class="token punctuation">(</span>
       <span class="token class-name"><span class="token keyword keyword-string">string</span></span> titulo<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> artista<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> album<span class="token punctuation">,</span> 
       <span class="token keyword keyword-in">in</span> <span class="token keyword keyword-ushort">ushort</span> a&#xF1;o<span class="token punctuation">,</span> <span class="token keyword keyword-in">in</span> <span class="token class-name"><span class="token keyword keyword-byte">byte</span></span> genero<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> comentario<span class="token punctuation">)</span>
   <span class="token punctuation">{</span> 
       <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>titulo <span class="token operator">=</span> titulo <span class="token operator">??</span> <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword keyword-nameof">nameof</span><span class="token punctuation">(</span>titulo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>artista <span class="token operator">=</span> artista <span class="token operator">??</span> <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword keyword-nameof">nameof</span><span class="token punctuation">(</span>artista<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>album <span class="token operator">=</span> album <span class="token operator">??</span> <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword keyword-nameof">nameof</span><span class="token punctuation">(</span>album<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>a&#xF1;o <span class="token operator">=</span> a&#xF1;o<span class="token punctuation">;</span>
       <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>genero <span class="token operator">=</span> genero<span class="token punctuation">;</span>
       <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>comentario <span class="token operator">=</span> comentario <span class="token operator">??</span> <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword keyword-nameof">nameof</span><span class="token punctuation">(</span>comentario<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-override">override</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">{</span>
       <span class="token keyword keyword-return">return</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token string">&quot;Titulo:&quot;</span><span class="token punctuation">,</span><span class="token number">11</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetTitulo</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span>
               <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token string">&quot;Artista:&quot;</span><span class="token punctuation">,</span><span class="token number">11</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetArtista</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span>
               <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token string">&quot;Album:&quot;</span><span class="token punctuation">,</span><span class="token number">11</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetAlbum</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span>
               <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token string">&quot;A&#xF1;o:&quot;</span><span class="token punctuation">,</span><span class="token number">11</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">GetA&#xF1;<span class="token function">o</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span>
               <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token string">&quot;Genero:&quot;</span><span class="token punctuation">,</span><span class="token number">11</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetGenero</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">\n&quot;</span></span>
               <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token string">&quot;Comentario:&quot;</span><span class="token punctuation">,</span><span class="token number">11</span></span><span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetComentario</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></li>
<li>
<p>Ser&#xED;a interesante implementar un m&#xE9;todo de clase p&#xFA;blico <strong><code>HayTAG</code></strong> que <strong>reciba un fichero</strong> y me devuelva un boolenao indic&#xE1;ndome si el fichero contiene un TAGIDID3 v&#xE1;lido. Una posible implementaci&#xF3;n ser&#xED;a...</p>
<blockquote>
<p>&#x270B; <strong>Nota:</strong> Con el f&#xED;n de mostrate un c&#xF3;digo de mayor calidad, se han controlado las excepciones de apertura usado la clausula <strong><code>using</code></strong>. Esta se explicar&#xE1; m&#xE1;s adelante en el punto <strong><a href="#manejo-de-excepciones-con-ficheros">Manejo de excepciones con ficheros</a></strong>. As&#xED; pues, si aunque ahora no la entiendas, te recomiendo que vuelvas a revisar este c&#xF3;digo cuando la veas.</p>
</blockquote>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token keyword keyword-class">class</span> <span class="token class-name">TagId3V1</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ... c&#xF3;digo omitido por abreviar</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-bool">bool</span></span> <span class="token function">HayTAG</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> rutaFichero<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-bool">bool</span></span> hayTAG <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-using">using</span> <span class="token punctuation">(</span><span class="token class-name">FileStream</span> stream <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span>rutaFichero<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">,</span> FileShare<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-using">using</span> <span class="token punctuation">(</span><span class="token class-name">BinaryReader</span> streamRB <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">BinaryReader</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Habr&#xE1; TAG si como m&#xED;nimo el fichero mide m&#xE1;s de los 128 bytes que ocupa el mismo.</span>
            hayTAG <span class="token operator">=</span> stream<span class="token punctuation">.</span>Length <span class="token operator">&gt;</span> TOTAL_BYTES<span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>hayTAG<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Se que ocupa esos bytes y me desplazo donde en teor&#xED;a est&#xE1; el principio del TAG</span>
                stream<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span><span class="token operator">-</span>TOTAL_BYTES<span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>End<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// Leo los 3 caracteres del TAG y los transformo a cadena.</span>
                <span class="token class-name"><span class="token keyword keyword-string">string</span></span> tag <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span></span><span class="token punctuation">(</span>streamRB<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_TAG_ID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                hayTAG <span class="token operator">=</span> tag <span class="token operator">==</span> <span class="token string">&quot;TAG&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> hayTAG<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<ol start="5">
<li>
<p>Vamos a crear un m&#xE9;todo de m&#xE9;todo de clase <strong><code>LeeTAG</code></strong> y que reciba la <strong>ubicaci&#xF3;n de una fichero fichero mp3</strong> y que genere una excepci&#xF3;n <strong><code>TagId3v1Exception</code></strong> si no hay tag y si lo hay, lo lea devolviendo una instancia de la clase <strong><code>TagId3v1</code></strong> con los datos del mismo.<br>
Si durante la lectura se genera una excepci&#xF3;n. Esta se relanzar&#xE1; &apos;<em>envuelta</em>&apos; en un TagId3v1Exception que indique de que fichero se estaba intentando leer el TAG.</p>
<blockquote>
<p>&#x1F4E3; <strong>Nota:</strong> A este tipo de m&#xE9;todos que inst&#xE1;ncian un objeto de la clase a la que pertenecen sin ser un constructor, se les denomina <strong><code>factor&#xED;a</code></strong>.</p>
</blockquote>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token comment">// Definiremos la clase con la excepci&#xF3;n personalizada fuera de la clase TagId3v1</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">TagId3v1Exception</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Exception</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-public">public</span> <span class="token function">TagId3v1Exception</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> message<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword keyword-base">base</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token function">TagId3v1Exception</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> message<span class="token punctuation">,</span> <span class="token class-name">Exception</span> innerException<span class="token punctuation">)</span> 
    <span class="token punctuation">:</span> <span class="token keyword keyword-base">base</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> innerException<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">TagId3V1</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ... c&#xF3;digo omitido por abreviar</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">TagId3V1</span> <span class="token function">LeeTAG</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> rutaFichero<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-string">string</span></span> error <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;El fichero </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">rutaFichero</span><span class="token punctuation">}</span></span><span class="token string"> no tiene informaci&#xF3;n v&#xE1;lida de TagId3v1&quot;</span></span><span class="token punctuation">;</span>
        <span class="token comment">// Si llamo a este m&#xE9;todo es porque estoy seguro de que hay &apos;tag&apos; para leer</span>
        <span class="token comment">// en caso contrario generar&#xE9; una excepci&#xF3;n.</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">HayTAG</span><span class="token punctuation">(</span>rutaFichero<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">TagId3v1Exception</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-using">using</span> <span class="token punctuation">(</span><span class="token class-name">FileStream</span> stream <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span>rutaFichero<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword keyword-using">using</span> <span class="token punctuation">(</span><span class="token class-name">BinaryReader</span> streamBR <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">BinaryReader</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-try">try</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Me sit&#xFA;o al principio del t&#xED;tulo justo despu&#xE9;s de los bytes [&apos;T&apos;][&apos;A&apos;][&apos;G&apos;]</span>
                stream<span class="token punctuation">.</span><span class="token function">Seek</span><span class="token punctuation">(</span>BYTES_TAG_ID <span class="token operator">-</span> TOTAL_BYTES<span class="token punctuation">,</span> SeekOrigin<span class="token punctuation">.</span>End<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// Como pude haber esp&#xE1;cios hasta rellenar lo que ocupa cada valor </span>
                <span class="token comment">// los recorto con el m&#xE9;todo Trim</span>
                <span class="token class-name"><span class="token keyword keyword-string">string</span></span> titulo <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span></span> <span class="token punctuation">(</span>streamBR<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_TITULO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword keyword-string">string</span></span> artista <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span></span><span class="token punctuation">(</span>streamBR<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_ARTISTA<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword keyword-string">string</span></span> album <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span></span> <span class="token punctuation">(</span>streamBR<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_ALBUM<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-ushort">ushort</span> a&#xF1;o <span class="token operator">=</span> <span class="token keyword keyword-ushort">ushort</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span></span><span class="token punctuation">(</span>streamBR<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_A&#xD1;O<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword keyword-string">string</span></span> comentario <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-string">string</span></span> <span class="token punctuation">(</span>streamBR<span class="token punctuation">.</span><span class="token function">ReadChars</span><span class="token punctuation">(</span>BYTES_COMENTARIO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword keyword-byte">byte</span></span> genero <span class="token operator">=</span> streamBR<span class="token punctuation">.</span><span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">TagId3V1</span><span class="token punctuation">(</span>titulo<span class="token punctuation">,</span> artista<span class="token punctuation">,</span> album<span class="token punctuation">,</span> a&#xF1;o<span class="token punctuation">,</span> genero<span class="token punctuation">,</span> comentario<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">TagId3v1Exception</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<ol start="6">
<li>
<p>Vamos ahora a realizar un peque&#xF1;o programa principal, usando m&#xE9;todos de la clase TagId3v ...</p>
<ul>
<li>Leeremos todos archivos mp3 que encuentre en el directorio <strong><code>C:\Musica</code></strong> y mostrar&#xE1; la informaci&#xF3;n del TAGID3V1 si la tuviera y &quot;<em>No contiene informaci&#xF3;n</em>&quot; en caso contrario.</li>
<li>Adem&#xE1;s, controlaremos cualquier <strong><code>TagId3v1Exception</code></strong> que se produzca al leer un fichero, nos recuperaremos y continuaremos intentado leer el siguiente.</li>
</ul>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> ficheros <span class="token operator">=</span> Directory<span class="token punctuation">.</span><span class="token function">GetFiles</span><span class="token punctuation">(</span><span class="token string">@&quot;C:\Musica&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;*.mp3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-foreach">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-var">var</span></span> fichero <span class="token keyword keyword-in">in</span> ficheros<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-try">try</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Informaci&#xF3;n del fichero </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">fichero</span><span class="token punctuation">}</span></span><span class="token string">...&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword keyword-string">string</span></span> informacion <span class="token operator">=</span> <span class="token punctuation">(</span>TagId3V1<span class="token punctuation">.</span><span class="token function">HayTAG</span><span class="token punctuation">(</span>fichero<span class="token punctuation">)</span> 
                                    <span class="token punctuation">?</span> TagId3V1<span class="token punctuation">.</span><span class="token function">LeeTAG</span><span class="token punctuation">(</span>fichero<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
                                    <span class="token punctuation">:</span> <span class="token string">&quot;\tNo contiene informaci&#xF3;n.&quot;</span>
                                     <span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>informacion<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">TagId3v1Exception</span> e<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></li>
</ol>
<div style="page-break-after:always;"></div>
<h5 class="mume-header" id="stream-adapters-streamwriter-y-streamreader">Stream Adapters StreamWriter y StreamReader</h5>

<p align="center" style="zoom:0.6"><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: G Pages: 1 -->
<svg width="1241pt" height="284pt" viewBox="0.00 0.00 1241.32 284.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 280)">
<title>G</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-280 1237.32,-280 1237.32,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster0</title>
<polygon fill="none" stroke="transparent" points="8,-54 8,-198 168,-198 168,-54 8,-54"/>
<text text-anchor="middle" x="88" y="-167" font-family="Arial" font-size="30.00" fill="#000000">Datos</text>
</g>
<g id="clust2" class="cluster">
<title>clusterG</title>
<polygon fill="none" stroke="#104e8b" points="290.5114,-8 290.5114,-268 932.9157,-268 932.9157,-8 290.5114,-8"/>
<text text-anchor="middle" x="611.7135" y="-237" font-family="Arial" font-size="30.00" fill="#104e8b">Clases para el manejo de streams</text>
</g>
<g id="clust3" class="cluster">
<title>cluster1</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="295.5114,-13 295.5114,-219 479.5114,-219 479.5114,-13 295.5114,-13"/>
<text text-anchor="middle" x="387.5114" y="-197" font-family="Arial" font-size="20.00" fill="#104e8b">Stream Adapters</text>
</g>
<g id="clust4" class="cluster">
<title>cluster3</title>
<polygon fill="#e0eeee" stroke="#e0eeee" points="707.9157,-46 707.9157,-176 927.9157,-176 927.9157,-46 707.9157,-46"/>
<text text-anchor="middle" x="817.9157" y="-154" font-family="Arial" font-size="20.00" fill="#104e8b">Backing Store Streams</text>
</g>
<g id="clust5" class="cluster">
<title>cluster4</title>
<polygon fill="none" stroke="transparent" points="1041.32,-45 1041.32,-189 1225.32,-189 1225.32,-45 1041.32,-45"/>
<text text-anchor="middle" x="1133.32" y="-158" font-family="Arial" font-size="30.00" fill="#000000">Dispositivos</text>
</g>
<!-- Bytes -->
<g id="node1" class="node">
<title>Bytes</title>
<polygon fill="none" stroke="#000000" points="154,-146 16,-146 16,-62 160,-62 160,-140 154,-146"/>
<polyline fill="none" stroke="#000000" points="154,-146 154,-140 "/>
<polyline fill="none" stroke="#000000" points="160,-140 154,-140 "/>
<text text-anchor="middle" x="88" y="-110" font-family="Arial" font-size="20.00" fill="#000000">Texto</text>
<text text-anchor="middle" x="88" y="-86" font-family="Arial" font-size="20.00" fill="#000000">codificado</text>
</g>
<!-- StreamWriter -->
<g id="node2" class="node">
<title>StreamWriter</title>
<polygon fill="#36648b" stroke="#36648b" points="459.5114,-167 315.5114,-167 315.5114,-109 459.5114,-109 459.5114,-167"/>
<text text-anchor="middle" x="387.5114" y="-133.2" font-family="Arial" font-size="16.00" fill="#ffffff">StreamWriter</text>
</g>
<!-- Bytes&#45;&gt;StreamWriter -->
<g id="edge1" class="edge">
<title>Bytes-&gt;StreamWriter</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M160.1216,-112.1871C203.8932,-117.156 259.8956,-123.5133 305.3699,-128.6754"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="305.1661,-132.1747 315.4971,-129.8251 305.9557,-125.2194 305.1661,-132.1747"/>
<text text-anchor="middle" x="237.7557" y="-128.7" font-family="Arial" font-size="19.00" fill="#1874cd">Texto</text>
</g>
<!-- StreamReader -->
<g id="node3" class="node">
<title>StreamReader</title>
<polygon fill="#36648b" stroke="#36648b" points="459.5114,-91 315.5114,-91 315.5114,-33 459.5114,-33 459.5114,-91"/>
<text text-anchor="middle" x="387.5114" y="-57.2" font-family="Arial" font-size="16.00" fill="#ffffff">StreamReader</text>
</g>
<!-- Bytes&#45;&gt;StreamReader -->
<g id="edge2" class="edge">
<title>Bytes-&gt;StreamReader</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M170.253,-92.4658C215.7445,-86.0866 271.7454,-78.2337 315.4971,-72.0985"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="169.5386,-89.0316 160.1216,-93.8865 170.5108,-95.9638 169.5386,-89.0316"/>
<text text-anchor="middle" x="237.7557" y="-90.7" font-family="Arial" font-size="19.00" fill="#1874cd">Texto</text>
</g>
<!-- FileStream -->
<g id="node4" class="node">
<title>FileStream</title>
<polygon fill="#5cacee" stroke="#5cacee" points="889.9157,-124 745.9157,-124 745.9157,-66 889.9157,-66 889.9157,-124"/>
<text text-anchor="middle" x="817.9157" y="-90.2" font-family="Arial" font-size="16.00" fill="#ffffff">FileStream</text>
</g>
<!-- StreamWriter&#45;&gt;FileStream -->
<g id="edge3" class="edge">
<title>StreamWriter-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M459.5514,-130.8028C535.7429,-123.1908 655.7511,-111.2012 735.6196,-103.2219"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="736.0382,-106.6976 745.6407,-102.2207 735.3422,-99.7323 736.0382,-106.6976"/>
<text text-anchor="middle" x="591.2135" y="-124.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- StreamReader&#45;&gt;FileStream -->
<g id="edge4" class="edge">
<title>StreamReader-&gt;FileStream</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M469.5614,-68.2909C549.3474,-74.4083 669.3592,-83.6099 745.6407,-89.4585"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="469.7897,-64.7983 459.5514,-67.5235 469.2545,-71.7778 469.7897,-64.7983"/>
<text text-anchor="middle" x="591.2135" y="-84.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
<!-- Fichero -->
<g id="node5" class="node">
<title>Fichero</title>
<polygon fill="none" stroke="#000000" points="1205.32,-125 1065.32,-125 1061.32,-121 1061.32,-65 1201.32,-65 1205.32,-69 1205.32,-125"/>
<polyline fill="none" stroke="#000000" points="1201.32,-121 1061.32,-121 "/>
<polyline fill="none" stroke="#000000" points="1201.32,-121 1201.32,-65 "/>
<polyline fill="none" stroke="#000000" points="1201.32,-121 1205.32,-125 "/>
<text text-anchor="middle" x="1133.32" y="-89" font-family="Arial" font-size="20.00" fill="#000000">Fichero</text>
</g>
<!-- FileStream&#45;&gt;Fichero -->
<g id="edge5" class="edge">
<title>FileStream-&gt;Fichero</title>
<path fill="none" stroke="#1874cd" stroke-width="3" d="M900.3983,-95C946.9115,-95 1004.8251,-95 1051.2677,-95"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="900.2759,-91.5001 890.2758,-95 900.2758,-98.5001 900.2759,-91.5001"/>
<polygon fill="#1874cd" stroke="#1874cd" stroke-width="3" points="1051.2966,-98.5001 1061.2966,-95 1051.2966,-91.5001 1051.2966,-98.5001"/>
<text text-anchor="middle" x="984.6178" y="-100.7" font-family="Arial" font-size="19.00" fill="#1874cd">bytes</text>
</g>
</g>
</svg>
</p><ul>
<li>
<p>Est&#xE1;n dise&#xF1;ados para escribir y leer texto como salida en una codificaci&#xF3;n determinada. Por tanto <strong>est&#xE1;n pensados para trabajar solo con archivos de texto</strong> y no archivos con datos en binario.</p>
</li>
<li>
<p><strong><code>StreamWriter</code></strong> utiliza de forma <strong>predeterminada</strong> una instancia de <strong>UTF8</strong> Encoding, a menos que se especifique lo contrario. Adem&#xE1;s, <strong>se a&#xF1;adir&#xE1; a la cabecera del archivo</strong> de texto <strong>2 bytes</strong> con la codificaci&#xF3;n de caracteres utilizada. Estos bytes se denominar&#xE1;n <strong>BOM</strong> (<strong>Byte Order Mark</strong>).</p>
</li>
<li>
<p>Para <strong><code>StreamReader</code></strong> la forma de controlar que se ha llegado al final de fichero. Es cuando una lectura <strong>devuelve null en lugar de un <code>string</code></strong> o a trav&#xE9;s de la propiedad <strong><code>EndOfStream</code></strong>.</p>
<blockquote>
<p>&#x270B; &#x26A0;&#xFE0F; &#x1F480; No podemos en ning&#xFA;n caso basarnos en el atributo <strong><code>Position</code></strong> de su <strong><code>FileStream</code></strong> <strong>base</strong> pues su valor no lo controlaremos. <strong>Tampoco podremos desplazarnos por el <code>FileStream</code> al que adapta con un <code>Seek</code></strong>.</p>
</blockquote>
<p>Por tanto, una vez adaptemos un <strong><code>FileStream</code></strong> con un <strong><code>StreamWriter</code></strong> o <strong><code>StreamReader</code></strong> <strong>ya no podremos usarlo</strong>, pues deja de estar bajo nuestro control.</p>
</li>
</ul>
<p><strong>Adaptador</strong> <strong><code>StreamWriter</code></strong></p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;ejemplo.txt&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Unicode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// A&#xF1;adir&#xE1; los bytes de BOM con la codificaci&#xF3;n al principio del Stream.</span>
<span class="token comment">// Ya no podremos usar fs porque no nos pertenecer&#xE1; ya.</span>

<span class="token comment">// Escribimos dos l&#xED;neas de texto con la codificaci&#xF3;n de salto de l&#xED;nea espec&#xED;fica</span>
<span class="token comment">// del Sistema Operativo donde estemos ejecutando.</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;L&#xED;nea de texto con salto al final codificada en Unicode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Podemos escribir cualquier caracter Unicode. Fuera de esta codificaci&#xF3;n ya no </span>
<span class="token comment">// serian bien interpretados los siguiente caracteres.</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;&#x9650;&#x5B9A;&#x6876;&#x300C;&#x51AC;&#x51EA;&#x300D;&#x300C;&#x9AD8;&#x96C5;&#x300D;&#x30AD;&#x30E3;&#x30F3;&#x30DA;&#x30FC;&#x30F3;&#x63B2;&#x8F09;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// El Close de StreamWriter cerrar&#xE1; el stream subyacente al que est&#xE1; adaptando.</span>
sw<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p>C&#xF3;mo una vez adaptado <strong><code>StreamWriter</code></strong> ya no tiene sentido usar el <strong><code>FileStream</code></strong>, nos ofrece un constructor para hacer la adaptaci&#xF3;n de forma completamente transparente, abriendo el fichero directamente en modo escritura para creaci&#xF3;n o a&#xF1;adir al final. Por ejemplo, el siguiente c&#xF3;digo ser&#xED;a equivalente al anterior.</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> A&#xD1;ADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span><span class="token string">&quot;ejemplo.txt&quot;</span><span class="token punctuation">,</span> A&#xD1;ADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Unicode<span class="token punctuation">)</span><span class="token punctuation">;</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;L&#xED;nea de texto con salto al final codificada en Unicode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;&#x9650;&#x5B9A;&#x6876;&#x300C;&#x51AC;&#x51EA;&#x300D;&#x300C;&#x9AD8;&#x96C5;&#x300D;&#x30AD;&#x30E3;&#x30F3;&#x30DA;&#x30FC;&#x30F3;&#x63B2;&#x8F09;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sw<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></pre><p>Si abrimos el fichero con un editor de texto, lo podremos leer cl&#xE1;ramente con los saltos de l&#xED;nea correspondiente. Pero si lo <strong>abrimos con editor hexadecimal</strong> para ber que secuencia de bytes ha escrito nos encontraremos lo siguiente...</p>
<pre data-role="codeBlock" data-info="hex {class=&quot;line-numbers&quot;}" class="language-hex line-numbers"><code>00000000: FF FE 4C 00 ED 00 6E 00 65 00 61 00 20 00 64 00    .~L.m.n.e.a...d.
00000010: 65 00 20 00 74 00 65 00 78 00 74 00 6F 00 20 00    e...t.e.x.t.o...
00000020: 63 00 6F 00 6E 00 20 00 73 00 61 00 6C 00 74 00    c.o.n...s.a.l.t.
00000030: 6F 00 20 00 61 00 6C 00 20 00 66 00 69 00 6E 00    o...a.l...f.i.n.
00000040: 61 00 6C 00 20 00 63 00 6F 00 64 00 69 00 66 00    a.l...c.o.d.i.f.
00000050: 69 00 63 00 61 00 64 00 61 00 20 00 65 00 6E 00    i.c.a.d.a...e.n.
00000060: 20 00 55 00 6E 00 69 00 63 00 6F 00 64 00 65 00    ..U.n.i.c.o.d.e.
00000070: 0D 00 0A 00 50 96 9A 5B 76 68 0C 30 AC 51 EA 51    ....P..[vh.0,QjQ
00000080: 0D 30 0C 30 D8 9A C5 96 0D 30 AD 30 E3 30 F3 30    .0.0X.E..0-0c0s0
00000090: DA 30 FC 30 F3 30 B2 63 09 8F 0D 00 0A 00          Z0|0s02c......
</code><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p>Donde <strong><code>FF FE</code></strong> ser&#xE1;n los <strong><code>bytes de BOM</code></strong> indicando que los caracteres a continuaci&#xF3;n est&#xE1;n codificados en Unicode, esto es, cada caracter est&#xE1; codificado con 16 bits (2 bytes). As&#xED; pues, el caracter <strong><code>&apos;L&apos;</code></strong> se ha adaptado a la secuencia de bytes <strong><code>4C 00</code></strong>.</p>
<p>Adem&#xE1;s, si nos fijamos al principio de la <strong><code>l&#xED;nea 8</code></strong> est&#xE1;n los caracteres que que definen el salto de l&#xED;nea en los Sistemas Windows <strong><code>0D 00 0A 00</code></strong>. Donde, <strong><code>0D 00</code></strong> esl <em>Carriage Return</em> (<strong>CR</strong>) y <strong><code>0A 00</code></strong> es el <em>Line Feed</em> (<strong>LF</strong>) codificados en Unicode. (Tambi&#xE9;n aparecen al final del fichero porque hemos escrito 2 l&#xED;neas).</p>
<blockquote>
<p>&#x1F441; <strong>Nota:</strong> Dependiendo del SO este <strong><a href="https://es.wikipedia.org/wiki/Nueva_l%C3%ADnea">salto de l&#xED;nea</a></strong> o <strong><code>\n</code></strong> se codificar&#xE1; de diferente manera.</p>
<table>
<thead>
<tr>
<th style="text-align:left">SO</th>
<th style="text-align:left">Caracter/es</th>
<th style="text-align:left">Hexadecimal</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Windows</td>
<td style="text-align:left">CR+LF</td>
<td style="text-align:left"><strong><code>0D 0A</code></strong></td>
</tr>
<tr>
<td style="text-align:left">Linux, Unix, Android, iOS, MacOS X</td>
<td style="text-align:left">LF</td>
<td style="text-align:left"><strong><code>0A</code></strong></td>
</tr>
<tr>
<td style="text-align:left">Hasta Mac OS 9</td>
<td style="text-align:left">CR</td>
<td style="text-align:left"><strong><code>0D</code></strong></td>
</tr>
</tbody>
</table>
</blockquote>
<p>Si usamos otra codificaci&#xF3;n como <strong>UTF8</strong>, ya no podremos usar caracteres asi&#xE1;ticos porque no son soportados pero sin embargo cada caracter ocupar&#xED;a 1 byte (8 bits) y el fichero ocupar&#xED;a menos a pesar de tener m&#xE1;s caracteres. Por <strong>ejemplo</strong>, si hacemos ...</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> A&#xD1;ADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span><span class="token string">&quot;ejemplo.txt&quot;</span><span class="token punctuation">,</span> A&#xD1;ADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;L&#xED;nea de texto con salto al final codificada en Unicode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Ya no podr&#xED;amos escribir caracteres asi&#xE1;ticos en esta codificaci&#xF3;n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sw<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></pre><p>Ahora tendremos la siguiente secuencia de bytes en el fichero, en la cual ya no tenemos tantos bytes a <strong><code>00</code></strong>.</p>
<pre data-role="codeBlock" data-info class="language-"><code>00000000: EF BB BF 4C C3 AD 6E 65 61 20 64 65 20 74 65 78    o;?LC-nea.de.tex
00000010: 74 6F 20 63 6F 6E 20 73 61 6C 74 6F 20 61 6C 20    to.con.salto.al.
00000020: 66 69 6E 61 6C 20 63 6F 64 69 66 69 63 61 64 61    final.codificada
00000030: 20 65 6E 20 55 6E 69 63 6F 64 65 0D 0A 59 61 20    .en.Unicode..Ya.
00000040: 6E 6F 20 70 6F 64 72 C3 AD 61 6D 6F 73 20 65 73    no.podrC-amos.es
00000050: 63 72 69 62 69 72 20 63 61 72 61 63 74 65 72 65    cribir.caractere
00000060: 73 20 61 73 69 C3 A1 74 69 63 6F 73 20 65 6E 20    s.asiC!ticos.en.
00000070: 65 73 74 61 20 63 6F 64 69 66 69 63 61 63 69 C3    esta.codificaciC
00000080: B3 6E 0D 0A                                        3n..
</code></pre><p>F&#xED;jate que los bytes de BOM para representar UTF8 ahora son 3 <strong><code>EF BB BF</code></strong> y los saltos de l&#xED;nea si has ejecutado en un SO Windows son <strong><code>0D 0A</code></strong>. Para nosotros todo esto es <strong>&apos;<em>transparente</em>&apos;</strong> si usamos <strong><code>StreamWriter</code></strong>.</p>
<p>Aunque en los ejemplos hemos usado el m&#xE9;todo <strong><code>WriteLine(string texto)</code></strong> que escribe con un salto de l&#xED;nea al final, tambi&#xE9;n podemos usar <strong><code>Write(string texto)</code></strong> para escribir un texto <strong>sin</strong> salto de l&#xED;nea al final.</p>
<div style="page-break-after:always;"></div>
<p><strong>Adaptador</strong> <strong><code>StreamReader</code></strong></p>
<p>Har&#xE1; el proceso inverso al <strong><code>StreamWriter</code></strong> y me ayudar&#xE1; a leer flujos de texto de forma <strong>trasparente</strong> a la la codificaci&#xF3;n usada para los caracteres y los saltos de l&#xED;nea.</p>
<p>Tendremos varias posibilidades de lectura de caracteres con este adaptador:</p>
<ol>
<li>
<p><strong>De uno en uno</strong>: El m&#xE9;todo <strong>int Read()</strong> devuelve el pr&#xF3;ximo car&#xE1;cter del flujo como <strong>entero</strong>, o un &#x2013;1 si se ha llegado a su final.<br>
Por si s&#xF3;lo quisi&#xE9;semos consultar el car&#xE1;cter actual pero no pasar al siguiente tambi&#xE9;n se ha incluido un m&#xE9;todo <strong>int Peek()</strong>.</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token comment">// Abrimos la secuencia.</span>
<span class="token class-name">FileStream</span> fs <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">(</span><span class="token string">&quot;ejemplo.txt&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>            
<span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-bool">bool</span></span> AUTODETECTAR_CODIFICACION_BOM <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token comment">// Adaptamos la secuencia para leer texto codificado. </span>
<span class="token comment">// Si el fichero contiene BOM lo leer&#xE1; con la codificac&#xF3;n indicada en el mismo.</span>
<span class="token comment">// sino contiene BOM lo leer&#xE1; con la codificaci&#xF3;n indicada</span>
<span class="token class-name">StreamReader</span> sr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamReader</span><span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Unicode<span class="token punctuation">,</span> AUTODETECTAR_CODIFICACION_BOM<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Leo car&#xE1;cter a car&#xE1;cter y lo muestro.</span>
<span class="token class-name"><span class="token keyword keyword-int">int</span></span> c<span class="token punctuation">;</span>
<span class="token keyword keyword-while">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> sr<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword keyword-char">char</span><span class="token punctuation">)</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
sr<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></li>
<li>
<p><strong>Por grupos</strong>: El m&#xE9;todo <strong>int Read(out char[] caracteres, int inicio, int nCaracteres)</strong> lee un grupo de <strong><code>n</code></strong> caracteres y los almacena a partir de la posici&#xF3;n inicio en la tabla que se le indica.<br>
El valor que devuelve es el n&#xFA;mero de caracteres que se hayan le&#xED;do, que puede ser inferior a <strong><code>n</code></strong> si el flujo ten&#xED;a menos caracteres de los indicados o un &#x2013;1 si se ha llegado al final del flujo.</p>
<blockquote>
<p><strong>Nota:</strong> Podemos decir que es un m&#xE9;todo an&#xE1;logo al <strong><code>Read</code></strong> del <strong><code>FileStream</code></strong>.</p>
</blockquote>
</li>
<li>
<p><strong>Por l&#xED;neas:</strong> El m&#xE9;todo <strong><code>string ReadLine()</code></strong> devuelve la cadena de texto correspondiente a la <strong>siguiente l&#xED;nea</strong> del flujo o null si se ha llegado a su final. La cadena devuelta no incluir&#xE1; al final el caracter de salto de l&#xED;nea correspondiente.</p>
<blockquote>
<p><strong>Nota:</strong> Puede ser una opci&#xF3;n interesante si se trata de un <strong>fichero de texto muy grande o desconocemos su tama&#xF1;o</strong>.</p>
</blockquote>
<p><strong>Ejemplo:</strong></p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-bool">bool</span></span> AUTODETECTAR_CODIFICACION_BOM <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token class-name">StreamReader</span> sr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamReader</span><span class="token punctuation">(</span><span class="token string">&quot;ejemplo.txt&quot;</span><span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Unicode<span class="token punctuation">,</span> AUTODETECTAR_CODIFICACION_BOM<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Leo l&#xED;nea a l&#xED;nea hasta final de fichero y la muestro por consola.</span>
<span class="token keyword keyword-while">while</span><span class="token punctuation">(</span><span class="token operator">!</span>sr<span class="token punctuation">.</span>EndOfStream<span class="token punctuation">)</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>sr<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sr<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></li>
<li>
<p><strong>Por completo:</strong> Un m&#xE9;todo muy &#xFA;til es <strong><code>string ReadToEnd()</code></strong>, que nos devuelve una cadena con todo el texto que hubiese desde la posici&#xF3;n actual del flujo sobre el que se aplica hasta el final del mismo (o null si ya est&#xE1;bamos en su final).</p>
<blockquote>
<p><strong>Notas:</strong></p>
<ol>
<li>&#x1F441; Si el <strong>fichero es muy grande</strong>, podemos obtener un error de <strong>memoria insuficiente</strong>.</li>
<li>En la cadena se incluir&#xE1;n los saltos de l&#xED;nea con la codificaci&#xF3;n dependiente de la plataforma.</li>
</ol>
</blockquote>
<p><strong>Ejemplo:</strong></p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-bool">bool</span></span> AUTODETECTAR_CODIFICACION_BOM <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>           
<span class="token class-name">StreamReader</span> sr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamReader</span><span class="token punctuation">(</span><span class="token string">&quot;ejemplo.txt&quot;</span><span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Unicode<span class="token punctuation">,</span> AUTODETECTAR_CODIFICACION_BOM<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Muestro todo el texto pero antes, cambio cualquier posible salto de l&#xED;nea como CRLF o CR por LF.</span>
Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span>sr<span class="token punctuation">.</span><span class="token function">ReadToEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">&quot;\r&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sr<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></pre></li>
</ol>
<div style="page-break-after:always;"></div>
<h2 class="mume-header" id="manejo-de-excepciones-con-ficheros">Manejo de excepciones con ficheros</h2>

<p>Como ya se vi&#xF3; al hablar de la cl&#xE1;usula <strong><code>finally</code></strong> al manejar excepciones. Uno de los casos donde el uso de excepciones se hace casi imprescindible, es la manejo de ficheros. Esto es, porque se pueden producir multitud de errores como:</p>
<ul>
<li>Rutas de acceso (path) no v&#xE1;lidas.</li>
<li>Carencia de premisos de acceso.</li>
<li>Estar el acceso bloqueado por otro usuario.</li>
<li>Problemas de disco devueltos por el Sistema Operativo.</li>
<li>etc.</li>
</ul>
<p>Adem&#xE1;s, si no hacemos un <strong><code>Close()</code></strong> tras una excepci&#xF3;n, puede que dejemos el recurso abierto y bloqueado para su acceso por otros usuarios o borrado.</p>
<p>Veamos <strong>a trav&#xE9;s de un ejemplo</strong> cual es la <strong>mejor forma de abordarlo</strong> en C#. Para ello, imaginemos una funci&#xF3;n que encapsula una escritura en disco de las que hemos realizado en los puntos anteriores y que va a realizar una gesti&#xF3;n de excepciones tradicional de las que vimos en el tema anterior.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Debo declarar el id aqu&#xED; para que est&#xE9; accesible desde el bloque finally.</span>
    <span class="token class-name">StreamWriter<span class="token punctuation">?</span></span> sw <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-try">try</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> A&#xD1;ADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span><span class="token string">@&quot;.\\NOEXISTE\\ejemplo.txt&quot;</span><span class="token punctuation">,</span> A&#xD1;ADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;L&#xED;nea de texto con salto al final codificada en Unicode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Ya no hago el Close() aqu&#xED; pues se hace en el finally</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// En este ejemplo solo captura las excepciones de entrada y salida y las muestro.</span>
    <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Creando ejemplo.txt </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">e<span class="token punctuation">.</span>Message</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-finally">finally</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// El cierre solo lo hago aqu&#xED; y solo si logr&#xE9; abrir el Stream</span>
        <span class="token comment">// y he finalizado correctamente el proceso o el error se produjo</span>
        <span class="token comment">// una vez abierto, durante el proceso de escritura.</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>sw <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
            sw<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>Como podemos apreciar de la implementaci&#xF3;n anterior hemos tenido que a&#xF1;adir muchos bloques de control. No obstante, lo normal ser&#xED;a hacer solo el bloque <strong><code>finally</code></strong> y el control de errores en en un m&#xF3;dulo superior como.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">StreamWriter<span class="token punctuation">?</span></span> sw <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-try">try</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> A&#xD1;ADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">StreamWriter</span><span class="token punctuation">(</span><span class="token string">@&quot;.\\NOEXISTE\\ejemplo.txt&quot;</span><span class="token punctuation">,</span> A&#xD1;ADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;L&#xED;nea de texto con salto al final codificada en Unicode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-finally">finally</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>sw <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
            sw<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-try">try</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Aqu&#xED; podemos llamar a otros m&#xF3;dulos que puede generar tambi&#xE9;n IOException</span>
        <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">?</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            e <span class="token operator">=</span> e<span class="token punctuation">.</span>InnerException<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><p>C&#xF3;mo vemos el <strong><code>finally</code></strong> lo tenemos que hacer en el m&#xF3;dulo donde se hace la apertura del fichero y aunque hemos quitado el <strong><code>catch</code></strong> el c&#xF3;digo sigue siendo algo engorroso. Por esa raz&#xF3;n, el lenguaje C# a&#xF1;ade una cl&#xE1;usula que nos permitir&#xE1; hacer el c&#xF3;digo anterior de forma simplificada.<br>
La cl&#xE1;usula es <strong><code>using</code></strong> y <strong>aunque la explicaremos en m&#xE1;s profundidad en temas posteriores</strong>. Lo que har&#xE1; b&#xE1;sicamente, es definir un bloque de uso de un <strong><code>Stream</code></strong> para el cual, si ocurre cualquier excepci&#xF3;n <strong>nos asegurar&#xE1; el cierre del mismo</strong>.<br>
El c&#xF3;digo del anterior de <strong><code>EscribeFichero()</code></strong> se puede reescribir de la siguiente manera y ser&#xED;a equivalente al anterior pero m&#xE1;s simplificado y que ser&#xE1; la forma de uso m&#xE1;s com&#xFA;n en los ejemplos de uso de Streams en la documentaci&#xF3;n oficial de Microsoft o cundo busquemos el uso de Streams en C# por Internet.</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> A&#xD1;ADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-using">using</span> <span class="token punctuation">(</span><span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token string">@&quot;.\\NOEXISTE\\ejemplo.txt&quot;</span><span class="token punctuation">,</span> A&#xD1;ADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// sw estar&#xE1; accesible solo en este bloque y nos asegurar&#xE1; su cierre ante un error.</span>
        sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;L&#xED;nea de texto con salto al final codificada en Unicode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// No tenemos que cerrar el Stream porque ya lo hace el using. (NOS ASEGURA SU CIERRE)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p>Sin embargo, a partir de <strong>C# 8</strong> ha simplificado a&#xFA;n m&#xE1;s el <strong><a href="https://docs.microsoft.com/es-es/dotnet/csharp/whats-new/csharp-8#using-declarations">uso de la cl&#xE1;usula <code>using</code></a></strong> de tal manera que ahora podremos hacer un c&#xF3;digo equivalente los dos anteriores del m&#xE9;todo <strong><code>EscribeFichero()</code></strong> de la siguiente forma...</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> A&#xD1;ADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-using">using</span> <span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token string">@&quot;.\\NOEXISTE\\ejemplo.txt&quot;</span><span class="token punctuation">,</span> A&#xD1;ADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;L&#xED;nea de texto con salto al final codificada en Unicode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// sw ser&#xE1; accesible en todo el m&#xE9;todo y adem&#xE1;s nos asegura su cierre </span>
    <span class="token comment">// al salir del &#xE1;mbito del mismo ya sea porque finaliza correctamente o porque</span>
    <span class="token comment">// se ha producido alg&#xFA;n error.</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><p>Est&#xE1; sintaxis adem&#xE1;s nos permitir&#xE1; relanzar la excepci&#xF3;n de forma sencilla sin tener que a&#xF1;adir el bloque <strong><code>finally</code></strong> y asegur&#xE1;ndonos el cierre cuando relancemos la excepci&#xF3;n.</p>
<pre data-role="codeBlock" data-info="csharp {class=&quot;line-numbers&quot;}" class="language-csharp line-numbers"><span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">EscribeFichero</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-try">try</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token keyword keyword-bool">bool</span> A&#xD1;ADIR_AL_FINAL <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-using">using</span> <span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span><span class="token string">@&quot;.\\NOEXISTE\\ejemplo.txt&quot;</span><span class="token punctuation">,</span> A&#xD1;ADIR_AL_FINAL<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;L&#xED;nea de texto con salto al final codificada en Unicode&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">IOException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Creando ejemplo.txt&quot;</span></span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre><div style="page-break-after:always;"></div>
<h2 class="mume-header" id="mortar_board-caso-de-estudio-de-streamwriter-streamreader-y-excepciones">&#x1F393; Caso de estudio de StreamWriter, StreamReader y excepciones</h2>

<p>Vamos a escribir un programa que gestione datos de Alumnos y los almacene en un <strong><a href="https://es.wikipedia.org/wiki/Valores_separados_por_comas">fichero CSV (Comma-Separated Values)</a>.</strong></p>
<ol>
<li>
<p>Para ello vamos a definir una clase <strong><code>Alumno</code></strong> de la siguiente forma:</p>
<ul>
<li>Guardaremos los siguientes campos: <strong><code>nia</code></strong>, <strong><code>nombre</code></strong>, <strong><code>apellido</code></strong>.</li>
<li>La clase tendr&#xE1; un constructor que recibe todos los campos.</li>
<li><strong>Accesores</strong> o <em>getters</em> para cada uno de los campos.</li>
<li>Invalidaci&#xF3;n de <strong><code>ToString()</code></strong> para que muestre los datos del alumno <strong>en una l&#xED;nea</strong>.</li>
</ul>
</li>
<li>
<p>Definiremos un men&#xFA; con las siguientes opciones:</p>
<ul>
<li><strong>Introduce Alumno:</strong> El cual pedir&#xE1; los datos de un alumno y lo almacenar&#xE1; en un fichero de texto con codificaci&#xF3;n <strong>UTF8</strong> y separado por comas CSV denominado <strong><code>alumnos.csv</code></strong> en la misma carpeta del ejecutable.<br>
Si el archivo existe, se permitir&#xE1; a&#xF1;adir al final m&#xE1;s informaci&#xF3;n sin eliminar el contenido.</li>
<li><strong>Mostrar Alumnos:</strong> La cual mostrar&#xE1; en pantalla el contenido del fichero <strong>alumnos.csv</strong>.</li>
<li><strong>Buscar Alumno:</strong> Buscar&#xE1; en el fichero mostrar&#xE1; la informaci&#xF3;n de un determinado alumno a partir de su <strong>NIA</strong> introducido.</li>
</ul>
</li>
<li>
<p>Para realizar la gesti&#xF3;n del punto 2 vamos a definir una concreci&#xF3;n de la clase <strong><code>Alumno</code></strong> denominada <strong><code>AlumnoCSV</code></strong>. Dicha clase tendr&#xE1; como &apos;<em>responsabilidad</em>&apos; las operaciones &apos;<em>b&#xE1;sicas</em>&apos; sobre el fichero CSV que <strong>NO impliquen una lectura y escritura por consola</strong>:</p>
<ul>
<li>
<p>M&#xE9;todo de <strong>instancia</strong> <strong><code>void Guarda(string ruta)</code></strong> que a&#xF1;ada los datos del alumno al final del fichero CSV indicado en la ruta.<br>
La &apos;<em>coma</em>&apos; de separaci&#xF3;n de los campos ser&#xE1; el car&#xE1;cter <strong>&apos;;&apos;</strong> (punto y coma).<br>
Al a&#xF1;adir un alumno, deberemos tener en cuenta que <strong>la primera l&#xED;nea del fichero csv guarda el nombre de los campos</strong>. Por lo que si estamos a&#xF1;adiendo el primer alumno, antes deberemos a&#xF1;adir la fila con el nombre de los campos.</p>
<blockquote>
<p><strong>Nota:</strong> Podr&#xE1; haber NIA repetidos, puesto que no controlaremos tal hecho.</p>
</blockquote>
<blockquote>
<p><strong>Ejemplo:</strong> Tras guardar  2 alumnos el aspecto del fichero podr&#xED;a ser el siguiente ...</p>
<pre data-role="codeBlock" data-info="csv" class="language-csv"><span class="token value">NIA;Apellido;Nombre</span>
<span class="token value">1;Garcia;Xusa</span>
<span class="token value">2;Guarinos;Juanjo</span>
</pre></blockquote>
</li>
<li>
<p>M&#xE9;todo de <strong>clase</strong> <strong><code>Alumno[] Lee(string ruta)</code></strong> que leer&#xE1; los alumnos guardados en el fichero especificado en la ruta o null si est&#xE1; vac&#xED;o.</p>
</li>
<li>
<p>M&#xE9;todo de <strong>clase</strong> <strong><code>public static bool Busca(in ulong nia, string ruta, out Alumno alumno)</code></strong> que me dir&#xE1; si existe un alumno un alumno o no en el fichero especificado y en caso afirmativo me devolver&#xE1; un objeto con la informaci&#xF3;n del mismo.</p>
</li>
</ul>
</li>
<li>
<p>Por &#xFA;ltimo, a&#xF1;adiremos la gesti&#xF3;n de <strong>excepciones</strong> para controlar posibles problemas de acceso a los ficheros.</p>
</li>
</ol>
<p>Propuesta de soluci&#xF3;n explicada (<strong>lee los comentarios del c&#xF3;digo</strong>):</p>
<ol>
<li>
<p>Definiremos la clase <strong><code>Alumno</code></strong> donde su <strong>&#xFA;nica responsabilidad</strong> ser&#xE1; gestionar los campos, sus accesores y como se pasa a cadena sus datos.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">Alumno</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-readonly">readonly</span> <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-ulong">ulong</span></span> nia<span class="token punctuation">;</span>
    <span class="token keyword keyword-readonly">readonly</span> <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> nombre<span class="token punctuation">;</span>
    <span class="token keyword keyword-readonly">readonly</span> <span class="token keyword keyword-private">private</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> apellido<span class="token punctuation">;</span>

    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-ulong">ulong</span></span> <span class="token function">GetNIA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> nia<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">GetNombre</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> nombre<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">GetApellido</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> apellido<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token function">Alumno</span><span class="token punctuation">(</span><span class="token keyword keyword-in">in</span> <span class="token class-name"><span class="token keyword keyword-ulong">ulong</span></span> nia<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> nombre<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> apellido<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>nia <span class="token operator">=</span> nia<span class="token punctuation">;</span>
        <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>nombre <span class="token operator">=</span> nombre<span class="token punctuation">;</span>
        <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span>apellido <span class="token operator">=</span> apellido<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-override">override</span> <span class="token return-type class-name"><span class="token keyword keyword-string">string</span></span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetNIA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">8</span></span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetApellido</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">12</span></span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetNombre</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">12</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></li>
</ol>
<div style="page-break-after:always;"></div>
<ol start="2">
<li>
<p>Ahora definimos la concreci&#xF3;n de <strong><code>Alumno</code></strong> con para gestionar la escritura y lectura de sus datos sobre el fichero CSV.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">AlumnoCSV</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Alumno</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">// Una de las posibilidades de gestionar excepciones particulares de una clase </span>
    <span class="token comment">// es definir un tipo anidado para ela excepci&#xF3;n. De tal manera que cuando</span>
    <span class="token comment">// la usemos fuera de la misma el tipo ser&#xE1; AlumnoCSV.Excepci&#xF3;n lo cual</span>
    <span class="token comment">// me indicar&#xE1; claramente que ser&#xE1;n excepciones derivadas de la escritura</span>
    <span class="token comment">// y lectura del CSV por parte de AlumnoCSV</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">Excepci</span>&#xF3;n <span class="token punctuation">:</span> Exception
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-public">public</span> Excepci&#xF3;<span class="token function">n</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> message<span class="token punctuation">,</span> <span class="token class-name">Exception</span> inner<span class="token punctuation">)</span> 
        <span class="token punctuation">:</span> <span class="token keyword keyword-base">base</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> inner<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-public">public</span> <span class="token function">AlumnoCSV</span><span class="token punctuation">(</span><span class="token keyword keyword-in">in</span> <span class="token class-name"><span class="token keyword keyword-ulong">ulong</span></span> nia<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> nombre<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> apellido<span class="token punctuation">)</span> 
    <span class="token punctuation">:</span> <span class="token keyword keyword-base">base</span><span class="token punctuation">(</span>nia<span class="token punctuation">,</span> nombre<span class="token punctuation">,</span> apellido<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Constructor </span>
    <span class="token punctuation">}</span>

    <span class="token comment">// M&#xE9;todo de clase privado que se encargar&#xE1; de leer la pr&#xF3;xima l&#xED;nea del </span>
    <span class="token comment">// CSV a partir de donde se encuentre situado el descriptor de </span>
    <span class="token comment">// StreamReader sr (deber&#xED;a estar al principio de la misma).</span>
    <span class="token comment">// EVITA QUE SE REPITAN ESTAS L&#xCD;NEAS EN EL LEE Y EN EL BUSCA.</span>
    <span class="token comment">// Al ser privada cualquier excepci&#xF3;n producida por la lectura o no correspondencia </span>
    <span class="token comment">// de de lo le&#xED;do en la l&#xED;nea con lo que se espera para poder crear un objeto Alumno</span>
    <span class="token comment">// ser&#xE1; gestionada por los m&#xE9;todos que la usen.</span>
    <span class="token comment">// Por ejemplo: Una excepci&#xF3;n posible podr&#xED;a ser un OutOfBoundsException</span>
    <span class="token comment">// resultado que que no hay tres elementos en el array tras el Split.</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">Alumno</span> <span class="token function">Lee</span><span class="token punctuation">(</span><span class="token class-name">StreamReader</span> sr<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword keyword-string">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> campos <span class="token operator">=</span> sr<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">?.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name"><span class="token keyword keyword-char">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token string character">&apos;;&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> 
                        <span class="token operator">??</span> 
                        <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">NullReferenceException</span><span class="token punctuation">(</span><span class="token string">&quot;No se ha podido leer Alumno en el CSV&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">Alumno</span><span class="token punctuation">(</span><span class="token keyword keyword-ulong">ulong</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>campos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> campos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> campos<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Recibe una ruta a un fichero CSV de alumnos y me devuelve un array con los</span>
    <span class="token comment">// alumnos guardados en el mismo o null si no hay ninguno.</span>
    <span class="token comment">// EL m&#xE9;todo no puede mostrar nada porque generar&#xED;amos una dependencia con</span>
    <span class="token comment">// la consola que exceder&#xED;a la responsabilidad de la clase y la har&#xED;a menos</span>
    <span class="token comment">// reutilizable. Por la misma raz&#xF3;n, tampoco devolvemos un string con todos </span>
    <span class="token comment">// los alumnos.</span>
    <span class="token comment">// Quien use el m&#xE9;todo decidir&#xE1; como se visualizan.</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name">Alumno<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">Lee</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> ruta<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Inicializamos el array a null.</span>
        <span class="token class-name">Alumno<span class="token punctuation">[</span><span class="token punctuation">]</span></span> alumnos <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">Alumno</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-try">try</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Al usar el using, nos aseguramos que al salir del &#xE1;mbito de</span>
            <span class="token comment">// declaraci&#xF3;n se ha realizado un finally para cerrar los streams</span>
            <span class="token keyword keyword-using">using</span> <span class="token class-name">FileStream</span> stream <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>ruta<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-using">using</span> <span class="token class-name">StreamReader</span> sr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>

             <span class="token comment">// Leemos y saltamos cabecera de las columnas</span>
            sr<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>sr<span class="token punctuation">.</span>EndOfStream<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Array<span class="token punctuation">.</span><span class="token function">Resize</span><span class="token punctuation">(</span><span class="token keyword keyword-ref">ref</span> alumnos<span class="token punctuation">,</span> alumnos<span class="token punctuation">?.</span>Length <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">??</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// A&#xF1;adimos el array le&#xED;do al hueco que hemos hecho para el mismo.</span>
                alumnos<span class="token punctuation">[</span><span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Lee</span><span class="token punctuation">(</span>sr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Relanzo cualquier excepci&#xF3;n envolvi&#xE9;ndola en un tipo</span>
            <span class="token comment">// AlumnoCSV.Excepci&#xF3;n e indicando el proceso que estaba haciendo</span>
            <span class="token comment">// para poder saber mejor de donde ha venido la misma.</span>
            <span class="token comment">// En este momento se que los streams est&#xE1;n cerrados porque ya se</span>
            <span class="token comment">// ha ejecutado el finally impl&#xED;cito por los using.</span>
            <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> Excepci&#xF3;<span class="token function">n</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Leyendo alumnos de </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ruta</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> alumnos<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre> <div style="page-break-after:always;"></div>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp">    <span class="token comment">// M&#xE9;todo de instancia encargado de guardar el Alumno que en el fichero CSV</span>
    <span class="token comment">// especificado en la ruta.</span>
    <span class="token keyword keyword-public">public</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Guarda</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> ruta<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-try">try</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Abrimos con Append que a&#xF1;ade al final del fichero o lo crea si no existe.</span>
            <span class="token keyword keyword-using">using</span> <span class="token class-name">FileStream</span> stream <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>ruta<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Append<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-using">using</span> <span class="token class-name">StreamWriter</span> sw <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Si el stream se acaba de crear a&#xF1;adiremos la fila con los nombre de</span>
            <span class="token comment">// las columnas antes de escribir el primer registro.</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>stream<span class="token punctuation">.</span>Length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;NIA;Apellido;Nombre&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// Escribimos la l&#xED;nea y hacemos un flush para asegurarnos de que </span>
            <span class="token comment">// se modifique el fichero.</span>
            sw<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetNIA</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetApellido</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token function">GetNombre</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sw<span class="token punctuation">.</span><span class="token function">Flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Relanzo cualquier excepci&#xF3;n envolvi&#xE9;ndola en un tipo</span>
            <span class="token comment">// AlumnoCSV.Excepci&#xF3;n e indicando el proceso que estaba haciendo</span>
            <span class="token comment">// para poder saber mejor de donde ha venido la misma.</span>
            <span class="token comment">// En este momento se que los streams est&#xE1;n cerrados porque ya se</span>
            <span class="token comment">// ha ejecutado el finally impl&#xED;cito por los using.</span>
            <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> Excepci&#xF3;<span class="token function">n</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Guardando Alumno </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword keyword-this">this</span></span><span class="token punctuation">}</span></span><span class="token string"> en </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ruta</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// M&#xE9;todo de clase que recibe un NIA y una ruta a un fichero CSV y busca</span>
    <span class="token comment">// el primer alumno con el NIA especificado.</span>
    <span class="token comment">// Si no lo encuentra devuelve falso y si lo encuentra devuelve cierto y </span>
    <span class="token comment">// una inst&#xE1;ncia a un objeto Alumno con los datos del mismo.</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-bool">bool</span></span> <span class="token function">Busca</span><span class="token punctuation">(</span><span class="token keyword keyword-in">in</span> <span class="token class-name"><span class="token keyword keyword-ulong">ulong</span></span> nia<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> ruta<span class="token punctuation">,</span> <span class="token keyword keyword-out">out</span> <span class="token class-name">Alumno<span class="token punctuation">?</span></span> alumno<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        alumno <span class="token operator">=</span> <span class="token keyword keyword-default">default</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-try">try</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-using">using</span> <span class="token class-name">FileStream</span> stream <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>ruta<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-using">using</span> <span class="token class-name">StreamReader</span> sr <span class="token operator">=</span> <span class="token keyword keyword-new">new</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Leemos y saltamos cabecera de las columnas</span>
            sr<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>sr<span class="token punctuation">.</span>EndOfStream <span class="token operator">&amp;&amp;</span> alumno <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Llamo al m&#xE9;todo de privado de clase Lee al que le paso</span>
                <span class="token comment">// el stream apuntado a la lectura de la siguiente l&#xED;nea</span>
                <span class="token comment">// con los datos de una alumno.</span>
                <span class="token class-name">Alumno</span> a <span class="token operator">=</span> <span class="token function">Lee</span><span class="token punctuation">(</span>sr<span class="token punctuation">)</span><span class="token punctuation">;</span>                    
                <span class="token comment">// Si encuentro el n&#xED;a establezco el par&#xE1;metro de salida</span>
                <span class="token comment">// encontrado y finalizo el bucle.</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>nia <span class="token operator">==</span> a<span class="token punctuation">.</span><span class="token function">GetNIA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    alumno <span class="token operator">=</span> a<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Relanzo cualquier excepci&#xF3;n envolvi&#xE9;ndola en un tipo</span>
            <span class="token comment">// AlumnoCSV.Excepci&#xF3;n e indicando el proceso que estaba haciendo</span>
            <span class="token comment">// para poder saber mejor de donde ha venido la misma.</span>
            <span class="token comment">// En este momento se que los streams est&#xE1;n cerrados porque ya se</span>
            <span class="token comment">// ha ejecutado el finally impl&#xED;cito por los using.</span>
            <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> Excepci&#xF3;<span class="token function">n</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Buscando alumno con NIA </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">nia</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword keyword-return">return</span> alumno <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></li>
</ol>
<div style="page-break-after:always;"></div>
<ol start="3">
<li>
<p>Vamos a implementar el programa principal bas&#xE1;ndonos en las clases definidas anteriormente.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp"><span class="token keyword keyword-class">class</span> <span class="token class-name">Program</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Enumeraci&#xF3;n con las opciones del programa para autodocumentar y evitar n&#xFA;meros m&#xE1;gicos.</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-enum">enum</span> <span class="token class-name">Opci</span>&#xF3;nPrograma <span class="token punctuation">{</span>IntroduceAlumno <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> MostrarAlumnos <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> BuscarAlumno <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> Salir <span class="token operator">=</span> <span class="token number">4</span> <span class="token punctuation">}</span>

    <span class="token comment">// Modularizaci&#xF3;n de mostrar men&#xFA; para autodocumentar y simplificar el Main.</span>
    <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span>Opci&#xF3;nPrograma<span class="token punctuation">.</span>IntroduceAlumno</span><span class="token punctuation">}</span></span><span class="token string"> - Introduce Alumno.&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span>Opci&#xF3;nPrograma<span class="token punctuation">.</span>MostrarAlumnos</span><span class="token punctuation">}</span></span><span class="token string"> - Mostrar Alumnos.&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span>Opci&#xF3;nPrograma<span class="token punctuation">.</span>BuscarAlumno</span><span class="token punctuation">}</span></span><span class="token string"> - Buscar Alumno.&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token punctuation">(</span><span class="token keyword keyword-int">int</span><span class="token punctuation">)</span>Opci&#xF3;nPrograma<span class="token punctuation">.</span>Salir</span><span class="token punctuation">}</span></span><span class="token string"> - Salir.&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Lee una opci&#xF3;n v&#xE1;lida de programa.</span>
    <span class="token keyword keyword-static">static</span> Opci&#xF3;<span class="token return-type class-name">nPrograma</span> <span class="token function">Lee</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-bool">bool</span> v&#xE1;lida<span class="token punctuation">;</span>
        Opci&#xF3;<span class="token class-name">nPrograma</span> o <span class="token operator">=</span> Opci&#xF3;nPrograma<span class="token punctuation">.</span>Salir<span class="token punctuation">;</span>
        <span class="token keyword keyword-do">do</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;Introduce una opci&#xF3;n: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            v&#xE1;lida <span class="token operator">=</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword keyword-out">out</span> <span class="token class-name"><span class="token keyword keyword-int">int</span></span> valor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>v&#xE1;lida<span class="token punctuation">)</span>
                v&#xE1;lida <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span>Enum<span class="token punctuation">.</span><span class="token function">GetValues</span><span class="token punctuation">(</span><span class="token keyword keyword-typeof">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Opci&#xF3;nPrograma</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> valor<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>v&#xE1;lida<span class="token punctuation">)</span>
                o <span class="token operator">=</span> <span class="token punctuation">(</span>Opci&#xF3;nPrograma<span class="token punctuation">)</span>valor<span class="token punctuation">;</span>
            <span class="token keyword keyword-else">else</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Opci&#xF3;n incorrecta!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>v&#xE1;lida<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> o<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Modularizaci&#xF3;n del proceso de introducci&#xF3;n de un alumno para </span>
    <span class="token comment">// autodocumentar y simplificar el Main.</span>
    <span class="token comment">// Cualquier excepci&#xF3;n producida se gestionar&#xE1; en el Main</span>
    <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">IntroduceAlumno</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> fichero<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;NIA: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword keyword-ulong">ulong</span></span> nia <span class="token operator">=</span> <span class="token keyword keyword-ulong">ulong</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;Nombre: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword keyword-string">string</span></span> nombre <span class="token operator">=</span> Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;Apellido: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword keyword-string">string</span></span> apellido <span class="token operator">=</span> Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// Creo una inst&#xE1;ncia de AlumnoCSV y guardo sus datos en el</span>
        <span class="token comment">// fichero que me indican por par&#xE1;metro.</span>
        <span class="token keyword keyword-new">new</span> <span class="token constructor-invocation class-name">AlumnoCSV</span><span class="token punctuation">(</span>nia<span class="token punctuation">,</span> nombre<span class="token punctuation">,</span> apellido<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Guarda</span><span class="token punctuation">(</span>fichero<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Datos guardados.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Modularizaci&#xF3;n del proceso de buscar y mostrar los datos de un alumno </span>
    <span class="token comment">// para autodocumentar y simplificar el Main.</span>
    <span class="token comment">// Cualquier excepci&#xF3;n producida se gestionar&#xE1; en el Main</span>
    <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">BuscaAlumno</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword keyword-string">string</span></span> fichero<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Hago un control preliminar para evitar excepciones obvias que se</span>
        <span class="token comment">// pueden controlar f&#xE1;cilmente con la l&#xF3;gica del programa.</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>fichero<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;NIA a buscar: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword keyword-ulong">ulong</span></span> nia <span class="token operator">=</span> <span class="token keyword keyword-ulong">ulong</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>Console<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Una ves le&#xED;do el NIA uso el m&#xE9;todo de clase definido en AlumnoCSV </span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>AlumnoCSV<span class="token punctuation">.</span><span class="token function">Busca</span><span class="token punctuation">(</span>nia<span class="token punctuation">,</span> fichero<span class="token punctuation">,</span> <span class="token keyword keyword-out">out</span> <span class="token class-name">Alumno<span class="token punctuation">?</span></span> a<span class="token punctuation">)</span><span class="token punctuation">)</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;Los datos del alumno con nia </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">nia</span><span class="token punctuation">}</span></span><span class="token string"> son:\n</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">a</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-else">else</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;No existe ning&#xFA;n alumno de nia </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">nia</span><span class="token punctuation">}</span></span><span class="token string">.&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-else">else</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;El fichero de datos </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">fichero</span><span class="token punctuation">}</span></span><span class="token string"> a&#xFA;n no se ha creado.&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</pre> <div style="page-break-after:always;"></div>
<p>Continuamos con la implementaci&#xF3;n del Main que adem&#xE1;s de gestionar y recuperarse de las posibles excepciones. Controlar&#xE1; la l&#xF3;gica de ejecuci&#xF3;n de las opciones posibles.<br>
Aunque ha quedado bastante legible, su n&#xFA;mero de l&#xED;neas podr&#xED;a sugerirnos una posible modularizaci&#xF3;n m&#xE1;s para simplificar que incluya el Switch.</p>
<pre data-role="codeBlock" data-info="csharp" class="language-csharp">    <span class="token keyword keyword-static">static</span> <span class="token return-type class-name"><span class="token keyword keyword-void">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-const">const</span> <span class="token class-name"><span class="token keyword keyword-string">string</span></span> FICHERO <span class="token operator">=</span> <span class="token string">&quot;alumnos.csv&quot;</span><span class="token punctuation">;</span>
        Opci&#xF3;nPrograma opci&#xF3;n <span class="token operator">=</span> Opci&#xF3;nPrograma<span class="token punctuation">.</span>Salir<span class="token punctuation">;</span>

        <span class="token keyword keyword-do">do</span>
        <span class="token punctuation">{</span>
            <span class="token keyword keyword-bool">bool</span> pausaTrasOpci&#xF3;n <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-try">try</span>
            <span class="token punctuation">{</span>
                <span class="token function">Menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// El usar un enum para las opciones de men&#xFA;. Adem&#xE1;s de darnos legibilidad</span>
                <span class="token comment">// Nos asegura que no se va a poder dar el caso default si hemos</span>
                <span class="token comment">// a&#xF1;adido todas los valores en el switch.</span>
                opci&#xF3;n <span class="token operator">=</span> <span class="token function">Lee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-switch">switch</span> <span class="token punctuation">(</span>opci&#xF3;n<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword keyword-case">case</span> Opci&#xF3;nPrograma<span class="token punctuation">.</span>IntroduceAlumno<span class="token punctuation">:</span>
                        <span class="token function">IntroduceAlumno</span><span class="token punctuation">(</span>FICHERO<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-case">case</span> Opci&#xF3;nPrograma<span class="token punctuation">.</span>MostrarAlumnos<span class="token punctuation">:</span>
                        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>FICHERO<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            <span class="token class-name"><span class="token keyword keyword-var">var</span></span> alumnos <span class="token operator">=</span> AlumnoCSV<span class="token punctuation">.</span><span class="token function">Lee</span><span class="token punctuation">(</span>FICHERO<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>alumnos <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span> 
                            <span class="token punctuation">?</span> <span class="token keyword keyword-string">string</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Join</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Alumno<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">,</span> alumnos<span class="token punctuation">)</span>
                            <span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">$&quot;El fichero </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">FICHERO</span><span class="token punctuation">}</span></span><span class="token string"> est&#xE1; vac&#xED;o.&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword keyword-else">else</span>
                            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;El fichero de datos </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">FICHERO</span><span class="token punctuation">}</span></span><span class="token string"> a&#xFA;n no se ha creado.&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-case">case</span> Opci&#xF3;nPrograma<span class="token punctuation">.</span>BuscarAlumno<span class="token punctuation">:</span>
                        <span class="token function">BuscaAlumno</span><span class="token punctuation">(</span>FICHERO<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                    <span class="token keyword keyword-case">case</span> Opci&#xF3;nPrograma<span class="token punctuation">.</span>Salir<span class="token punctuation">:</span>
                        pausaTrasOpci&#xF3;n <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                        <span class="token keyword keyword-break">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">?</span> e<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>e<span class="token punctuation">?.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    e <span class="token operator">=</span> e<span class="token punctuation">?.</span>InnerException<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>pausaTrasOpci&#xF3;n<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;Pulsa una tecla...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>opci&#xF3;n <span class="token operator">!=</span> Opci&#xF3;nPrograma<span class="token punctuation">.</span>Salir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token comment">// Cierre de la definici&#xF3;n de la clase Program</span>
</pre></li>
</ol>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>